import{useApi as e,defineInterface as t}from"@directus/extensions-sdk";import{computed as r,ref as n,defineComponent as i,watch as o,onMounted as l,nextTick as u,onUnmounted as c,resolveComponent as d,resolveDirective as f,createElementBlock as h,openBlock as g,createCommentVNode as p,createElementVNode as m,normalizeClass as v,createBlock as y,toDisplayString as E,withDirectives as T,withCtx as _,createVNode as S,unref as b,useAttrs as A,inject as I,Fragment as R}from"vue";var w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function D(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function L(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var r=function e(){var r=!1;try{r=this instanceof e}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}),r}var C={exports:{}};var N,P={exports:{}},O=L(Object.freeze({__proto__:null,default:{}}));function M(){return N||(N=1,P.exports=function(){var e=e||function(e,t){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==w&&w.crypto&&(r=w.crypto),!r)try{r=O}catch(e){}var n=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),a={},s=a.lib={},o=s.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=s.WordArray=o.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var a=0;a<i;a++){var s=r[a>>>2]>>>24-a%4*8&255;t[n+a>>>2]|=s<<24-(n+a)%4*8}else for(var o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new l.init(t,e)}}),u=a.enc={},c=u.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var a=t[i>>>2]>>>24-i%4*8&255;n.push((a>>>4).toString(16)),n.push((15&a).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new l.init(r,t/2)}},d=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var a=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(a))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new l.init(r,t)}},f=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},h=s.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,a=n.sigBytes,s=this.blockSize,o=a/(4*s),u=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*s,c=e.min(4*u,a);if(u){for(var d=0;d<u;d+=s)this._doProcessBlock(i,d);r=i.splice(0,u),n.sigBytes-=c}return new l.init(r,c)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});s.Hasher=h.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new g.HMAC.init(e,r).finalize(t)}}});var g=a.algo={};return a}(Math);return e}()),P.exports}var k,x={exports:{}};function F(){return k||(k=1,x.exports=function(e){return n=(r=e).lib,i=n.Base,a=n.WordArray,(s=r.x64={}).Word=i.extend({init:function(e,t){this.high=e,this.low=t}}),s.WordArray=i.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],n=0;n<t;n++){var i=e[n];r.push(i.high),r.push(i.low)}return a.create(r,this.sigBytes)},clone:function(){for(var e=i.clone.call(this),t=e.words=this.words.slice(0),r=t.length,n=0;n<r;n++)t[n]=t[n].clone();return e}}),e;var t,r,n,i,a,s}(M())),x.exports}var B,U={exports:{}};function Z(){return B||(B=1,U.exports=function(e){return function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,r=t.init,n=t.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,n=[],i=0;i<t;i++)n[i>>>2]|=e[i]<<24-i%4*8;r.call(this,n,t)}else r.apply(this,arguments)};n.prototype=t}}(),e.lib.WordArray}(M())),U.exports}var G,H={exports:{}};function $(){return G||(G=1,H.exports=function(e){return function(){var t=e,r=t.lib.WordArray,n=t.enc;function i(e){return e<<8&4278255360|e>>>8&16711935}n.Utf16=n.Utf16BE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i+=2){var a=t[i>>>2]>>>16-i%4*8&65535;n.push(String.fromCharCode(a))}return n.join("")},parse:function(e){for(var t=e.length,n=[],i=0;i<t;i++)n[i>>>1]|=e.charCodeAt(i)<<16-i%2*16;return r.create(n,2*t)}},n.Utf16LE={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],a=0;a<r;a+=2){var s=i(t[a>>>2]>>>16-a%4*8&65535);n.push(String.fromCharCode(s))}return n.join("")},parse:function(e){for(var t=e.length,n=[],a=0;a<t;a++)n[a>>>1]|=i(e.charCodeAt(a)<<16-a%2*16);return r.create(n,2*t)}}}(),e.enc.Utf16}(M())),H.exports}var V,K={exports:{}};function q(){return V||(V=1,K.exports=function(e){return function(){var t=e,r=t.lib.WordArray;function n(e,t,n){for(var i=[],a=0,s=0;s<t;s++)if(s%4){var o=n[e.charCodeAt(s-1)]<<s%4*2|n[e.charCodeAt(s)]>>>6-s%4*2;i[a>>>2]|=o<<24-a%4*8,a++}return r.create(i,a)}t.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var i=[],a=0;a<r;a+=3)for(var s=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,o=0;o<4&&a+.75*o<r;o++)i.push(n.charAt(s>>>6*(3-o)&63));var l=n.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(e){var t=e.length,r=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var a=0;a<r.length;a++)i[r.charCodeAt(a)]=a}var s=r.charAt(64);if(s){var o=e.indexOf(s);-1!==o&&(t=o)}return n(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64}(M())),K.exports}var Y,j={exports:{}};function z(){return Y||(Y=1,j.exports=function(e){return function(){var t=e,r=t.lib.WordArray;function n(e,t,n){for(var i=[],a=0,s=0;s<t;s++)if(s%4){var o=n[e.charCodeAt(s-1)]<<s%4*2|n[e.charCodeAt(s)]>>>6-s%4*2;i[a>>>2]|=o<<24-a%4*8,a++}return r.create(i,a)}t.enc.Base64url={stringify:function(e,t){void 0===t&&(t=!0);var r=e.words,n=e.sigBytes,i=t?this._safe_map:this._map;e.clamp();for(var a=[],s=0;s<n;s+=3)for(var o=(r[s>>>2]>>>24-s%4*8&255)<<16|(r[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|r[s+2>>>2]>>>24-(s+2)%4*8&255,l=0;l<4&&s+.75*l<n;l++)a.push(i.charAt(o>>>6*(3-l)&63));var u=i.charAt(64);if(u)for(;a.length%4;)a.push(u);return a.join("")},parse:function(e,t){void 0===t&&(t=!0);var r=e.length,i=t?this._safe_map:this._map,a=this._reverseMap;if(!a){a=this._reverseMap=[];for(var s=0;s<i.length;s++)a[i.charCodeAt(s)]=s}var o=i.charAt(64);if(o){var l=e.indexOf(o);-1!==l&&(r=l)}return n(e,r,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),e.enc.Base64url}(M())),j.exports}var W,X={exports:{}};function Q(){return W||(W=1,X.exports=function(e){return function(t){var r=e,n=r.lib,i=n.WordArray,a=n.Hasher,s=r.algo,o=[];!function(){for(var e=0;e<64;e++)o[e]=4294967296*t.abs(t.sin(e+1))|0}();var l=s.MD5=a.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var a=this._hash.words,s=e[t+0],l=e[t+1],h=e[t+2],g=e[t+3],p=e[t+4],m=e[t+5],v=e[t+6],y=e[t+7],E=e[t+8],T=e[t+9],_=e[t+10],S=e[t+11],b=e[t+12],A=e[t+13],I=e[t+14],R=e[t+15],w=a[0],D=a[1],L=a[2],C=a[3];w=u(w,D,L,C,s,7,o[0]),C=u(C,w,D,L,l,12,o[1]),L=u(L,C,w,D,h,17,o[2]),D=u(D,L,C,w,g,22,o[3]),w=u(w,D,L,C,p,7,o[4]),C=u(C,w,D,L,m,12,o[5]),L=u(L,C,w,D,v,17,o[6]),D=u(D,L,C,w,y,22,o[7]),w=u(w,D,L,C,E,7,o[8]),C=u(C,w,D,L,T,12,o[9]),L=u(L,C,w,D,_,17,o[10]),D=u(D,L,C,w,S,22,o[11]),w=u(w,D,L,C,b,7,o[12]),C=u(C,w,D,L,A,12,o[13]),L=u(L,C,w,D,I,17,o[14]),w=c(w,D=u(D,L,C,w,R,22,o[15]),L,C,l,5,o[16]),C=c(C,w,D,L,v,9,o[17]),L=c(L,C,w,D,S,14,o[18]),D=c(D,L,C,w,s,20,o[19]),w=c(w,D,L,C,m,5,o[20]),C=c(C,w,D,L,_,9,o[21]),L=c(L,C,w,D,R,14,o[22]),D=c(D,L,C,w,p,20,o[23]),w=c(w,D,L,C,T,5,o[24]),C=c(C,w,D,L,I,9,o[25]),L=c(L,C,w,D,g,14,o[26]),D=c(D,L,C,w,E,20,o[27]),w=c(w,D,L,C,A,5,o[28]),C=c(C,w,D,L,h,9,o[29]),L=c(L,C,w,D,y,14,o[30]),w=d(w,D=c(D,L,C,w,b,20,o[31]),L,C,m,4,o[32]),C=d(C,w,D,L,E,11,o[33]),L=d(L,C,w,D,S,16,o[34]),D=d(D,L,C,w,I,23,o[35]),w=d(w,D,L,C,l,4,o[36]),C=d(C,w,D,L,p,11,o[37]),L=d(L,C,w,D,y,16,o[38]),D=d(D,L,C,w,_,23,o[39]),w=d(w,D,L,C,A,4,o[40]),C=d(C,w,D,L,s,11,o[41]),L=d(L,C,w,D,g,16,o[42]),D=d(D,L,C,w,v,23,o[43]),w=d(w,D,L,C,T,4,o[44]),C=d(C,w,D,L,b,11,o[45]),L=d(L,C,w,D,R,16,o[46]),w=f(w,D=d(D,L,C,w,h,23,o[47]),L,C,s,6,o[48]),C=f(C,w,D,L,y,10,o[49]),L=f(L,C,w,D,I,15,o[50]),D=f(D,L,C,w,m,21,o[51]),w=f(w,D,L,C,b,6,o[52]),C=f(C,w,D,L,g,10,o[53]),L=f(L,C,w,D,_,15,o[54]),D=f(D,L,C,w,l,21,o[55]),w=f(w,D,L,C,E,6,o[56]),C=f(C,w,D,L,R,10,o[57]),L=f(L,C,w,D,v,15,o[58]),D=f(D,L,C,w,A,21,o[59]),w=f(w,D,L,C,p,6,o[60]),C=f(C,w,D,L,S,10,o[61]),L=f(L,C,w,D,h,15,o[62]),D=f(D,L,C,w,T,21,o[63]),a[0]=a[0]+w|0,a[1]=a[1]+D|0,a[2]=a[2]+L|0,a[3]=a[3]+C|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;r[i>>>5]|=128<<24-i%32;var a=t.floor(n/4294967296),s=n;r[15+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),r[14+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(r.length+1),this._process();for(var o=this._hash,l=o.words,u=0;u<4;u++){var c=l[u];l[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return o},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,r,n,i,a,s){var o=e+(t&r|~t&n)+i+s;return(o<<a|o>>>32-a)+t}function c(e,t,r,n,i,a,s){var o=e+(t&n|r&~n)+i+s;return(o<<a|o>>>32-a)+t}function d(e,t,r,n,i,a,s){var o=e+(t^r^n)+i+s;return(o<<a|o>>>32-a)+t}function f(e,t,r,n,i,a,s){var o=e+(r^(t|~n))+i+s;return(o<<a|o>>>32-a)+t}r.MD5=a._createHelper(l),r.HmacMD5=a._createHmacHelper(l)}(Math),e.MD5}(M())),X.exports}var J,ee={exports:{}};function te(){return J||(J=1,ee.exports=function(e){return r=(t=e).lib,n=r.WordArray,i=r.Hasher,a=t.algo,s=[],o=a.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],a=r[2],o=r[3],l=r[4],u=0;u<80;u++){if(u<16)s[u]=0|e[t+u];else{var c=s[u-3]^s[u-8]^s[u-14]^s[u-16];s[u]=c<<1|c>>>31}var d=(n<<5|n>>>27)+l+s[u];d+=u<20?1518500249+(i&a|~i&o):u<40?1859775393+(i^a^o):u<60?(i&a|i&o|a&o)-1894007588:(i^a^o)-899497514,l=o,o=a,a=i<<30|i>>>2,i=n,n=d}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+a|0,r[3]=r[3]+o|0,r[4]=r[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA1=i._createHelper(o),t.HmacSHA1=i._createHmacHelper(o),e.SHA1;var t,r,n,i,a,s,o}(M())),ee.exports}var re,ne={exports:{}};function ie(){return re||(re=1,ne.exports=function(e){return function(t){var r=e,n=r.lib,i=n.WordArray,a=n.Hasher,s=r.algo,o=[],l=[];!function(){function e(e){for(var r=t.sqrt(e),n=2;n<=r;n++)if(!(e%n))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var n=2,i=0;i<64;)e(n)&&(i<8&&(o[i]=r(t.pow(n,.5))),l[i]=r(t.pow(n,1/3)),i++),n++}();var u=[],c=s.SHA256=a.extend({_doReset:function(){this._hash=new i.init(o.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],a=r[2],s=r[3],o=r[4],c=r[5],d=r[6],f=r[7],h=0;h<64;h++){if(h<16)u[h]=0|e[t+h];else{var g=u[h-15],p=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,m=u[h-2],v=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;u[h]=p+u[h-7]+v+u[h-16]}var y=n&i^n&a^i&a,E=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),T=f+((o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25))+(o&c^~o&d)+l[h]+u[h];f=d,d=c,c=o,o=s+T|0,s=a,a=i,i=n,n=T+(E+y)|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+a|0,r[3]=r[3]+s|0,r[4]=r[4]+o|0,r[5]=r[5]+c|0,r[6]=r[6]+d|0,r[7]=r[7]+f|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return r[i>>>5]|=128<<24-i%32,r[14+(i+64>>>9<<4)]=t.floor(n/4294967296),r[15+(i+64>>>9<<4)]=n,e.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});r.SHA256=a._createHelper(c),r.HmacSHA256=a._createHmacHelper(c)}(Math),e.SHA256}(M())),ne.exports}var ae,se={exports:{}};var oe,le={exports:{}};function ue(){return oe||(oe=1,le.exports=function(e){return function(){var t=e,r=t.lib.Hasher,n=t.x64,i=n.Word,a=n.WordArray,s=t.algo;function o(){return i.create.apply(i,arguments)}var l=[o(1116352408,3609767458),o(1899447441,602891725),o(3049323471,3964484399),o(3921009573,2173295548),o(961987163,4081628472),o(1508970993,3053834265),o(2453635748,2937671579),o(2870763221,3664609560),o(3624381080,2734883394),o(310598401,1164996542),o(607225278,1323610764),o(1426881987,3590304994),o(1925078388,4068182383),o(2162078206,991336113),o(2614888103,633803317),o(3248222580,3479774868),o(3835390401,2666613458),o(4022224774,944711139),o(264347078,2341262773),o(604807628,2007800933),o(770255983,1495990901),o(1249150122,1856431235),o(1555081692,3175218132),o(1996064986,2198950837),o(2554220882,3999719339),o(2821834349,766784016),o(2952996808,2566594879),o(3210313671,3203337956),o(3336571891,1034457026),o(3584528711,2466948901),o(113926993,3758326383),o(338241895,168717936),o(666307205,1188179964),o(773529912,1546045734),o(1294757372,1522805485),o(1396182291,2643833823),o(1695183700,2343527390),o(1986661051,1014477480),o(2177026350,1206759142),o(2456956037,344077627),o(2730485921,1290863460),o(2820302411,3158454273),o(3259730800,3505952657),o(3345764771,106217008),o(3516065817,3606008344),o(3600352804,1432725776),o(4094571909,1467031594),o(275423344,851169720),o(430227734,3100823752),o(506948616,1363258195),o(659060556,3750685593),o(883997877,3785050280),o(958139571,3318307427),o(1322822218,3812723403),o(1537002063,2003034995),o(1747873779,3602036899),o(1955562222,1575990012),o(2024104815,1125592928),o(2227730452,2716904306),o(2361852424,442776044),o(2428436474,593698344),o(2756734187,3733110249),o(3204031479,2999351573),o(3329325298,3815920427),o(3391569614,3928383900),o(3515267271,566280711),o(3940187606,3454069534),o(4118630271,4000239992),o(116418474,1914138554),o(174292421,2731055270),o(289380356,3203993006),o(460393269,320620315),o(685471733,587496836),o(852142971,1086792851),o(1017036298,365543100),o(1126000580,2618297676),o(1288033470,3409855158),o(1501505948,4234509866),o(1607167915,987167468),o(1816402316,1246189591)],u=[];!function(){for(var e=0;e<80;e++)u[e]=o()}();var c=s.SHA512=r.extend({_doReset:function(){this._hash=new a.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],a=r[2],s=r[3],o=r[4],c=r[5],d=r[6],f=r[7],h=n.high,g=n.low,p=i.high,m=i.low,v=a.high,y=a.low,E=s.high,T=s.low,_=o.high,S=o.low,b=c.high,A=c.low,I=d.high,R=d.low,w=f.high,D=f.low,L=h,C=g,N=p,P=m,O=v,M=y,k=E,x=T,F=_,B=S,U=b,Z=A,G=I,H=R,$=w,V=D,K=0;K<80;K++){var q,Y,j=u[K];if(K<16)Y=j.high=0|e[t+2*K],q=j.low=0|e[t+2*K+1];else{var z=u[K-15],W=z.high,X=z.low,Q=(W>>>1|X<<31)^(W>>>8|X<<24)^W>>>7,J=(X>>>1|W<<31)^(X>>>8|W<<24)^(X>>>7|W<<25),ee=u[K-2],te=ee.high,re=ee.low,ne=(te>>>19|re<<13)^(te<<3|re>>>29)^te>>>6,ie=(re>>>19|te<<13)^(re<<3|te>>>29)^(re>>>6|te<<26),ae=u[K-7],se=ae.high,oe=ae.low,le=u[K-16],ue=le.high,ce=le.low;Y=(Y=(Y=Q+se+((q=J+oe)>>>0<J>>>0?1:0))+ne+((q+=ie)>>>0<ie>>>0?1:0))+ue+((q+=ce)>>>0<ce>>>0?1:0),j.high=Y,j.low=q}var de,fe=F&U^~F&G,he=B&Z^~B&H,ge=L&N^L&O^N&O,pe=C&P^C&M^P&M,me=(L>>>28|C<<4)^(L<<30|C>>>2)^(L<<25|C>>>7),ve=(C>>>28|L<<4)^(C<<30|L>>>2)^(C<<25|L>>>7),ye=(F>>>14|B<<18)^(F>>>18|B<<14)^(F<<23|B>>>9),Ee=(B>>>14|F<<18)^(B>>>18|F<<14)^(B<<23|F>>>9),Te=l[K],_e=Te.high,Se=Te.low,be=$+ye+((de=V+Ee)>>>0<V>>>0?1:0),Ae=ve+pe;$=G,V=H,G=U,H=Z,U=F,Z=B,F=k+(be=(be=(be=be+fe+((de+=he)>>>0<he>>>0?1:0))+_e+((de+=Se)>>>0<Se>>>0?1:0))+Y+((de+=q)>>>0<q>>>0?1:0))+((B=x+de|0)>>>0<x>>>0?1:0)|0,k=O,x=M,O=N,M=P,N=L,P=C,L=be+(me+ge+(Ae>>>0<ve>>>0?1:0))+((C=de+Ae|0)>>>0<de>>>0?1:0)|0}g=n.low=g+C,n.high=h+L+(g>>>0<C>>>0?1:0),m=i.low=m+P,i.high=p+N+(m>>>0<P>>>0?1:0),y=a.low=y+M,a.high=v+O+(y>>>0<M>>>0?1:0),T=s.low=T+x,s.high=E+k+(T>>>0<x>>>0?1:0),S=o.low=S+B,o.high=_+F+(S>>>0<B>>>0?1:0),A=c.low=A+Z,c.high=b+U+(A>>>0<Z>>>0?1:0),R=d.low=R+H,d.high=I+G+(R>>>0<H>>>0?1:0),D=f.low=D+V,f.high=w+$+(D>>>0<V>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[30+(n+128>>>10<<5)]=Math.floor(r/4294967296),t[31+(n+128>>>10<<5)]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});t.SHA512=r._createHelper(c),t.HmacSHA512=r._createHmacHelper(c)}(),e.SHA512}(M(),F())),le.exports}var ce,de={exports:{}};var fe,he={exports:{}};function ge(){return fe||(fe=1,he.exports=function(e){return function(t){var r=e,n=r.lib,i=n.WordArray,a=n.Hasher,s=r.x64.Word,o=r.algo,l=[],u=[],c=[];!function(){for(var e=1,t=0,r=0;r<24;r++){l[e+5*t]=(r+1)*(r+2)/2%64;var n=(2*e+3*t)%5;e=t%5,t=n}for(e=0;e<5;e++)for(t=0;t<5;t++)u[e+5*t]=t+(2*e+3*t)%5*5;for(var i=1,a=0;a<24;a++){for(var o=0,d=0,f=0;f<7;f++){if(1&i){var h=(1<<f)-1;h<32?d^=1<<h:o^=1<<h-32}128&i?i=i<<1^113:i<<=1}c[a]=s.create(o,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=s.create()}();var f=o.SHA3=a.extend({cfg:a.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new s.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var r=this._state,n=this.blockSize/2,i=0;i<n;i++){var a=e[t+2*i],s=e[t+2*i+1];a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),(D=r[i]).high^=s,D.low^=a}for(var o=0;o<24;o++){for(var f=0;f<5;f++){for(var h=0,g=0,p=0;p<5;p++)h^=(D=r[f+5*p]).high,g^=D.low;var m=d[f];m.high=h,m.low=g}for(f=0;f<5;f++){var v=d[(f+4)%5],y=d[(f+1)%5],E=y.high,T=y.low;for(h=v.high^(E<<1|T>>>31),g=v.low^(T<<1|E>>>31),p=0;p<5;p++)(D=r[f+5*p]).high^=h,D.low^=g}for(var _=1;_<25;_++){var S=(D=r[_]).high,b=D.low,A=l[_];A<32?(h=S<<A|b>>>32-A,g=b<<A|S>>>32-A):(h=b<<A-32|S>>>64-A,g=S<<A-32|b>>>64-A);var I=d[u[_]];I.high=h,I.low=g}var R=d[0],w=r[0];for(R.high=w.high,R.low=w.low,f=0;f<5;f++)for(p=0;p<5;p++){var D=r[_=f+5*p],L=d[_],C=d[(f+1)%5+5*p],N=d[(f+2)%5+5*p];D.high=L.high^~C.high&N.high,D.low=L.low^~C.low&N.low}D=r[0];var P=c[o];D.high^=P.high,D.low^=P.low}},_doFinalize:function(){var e=this._data,r=e.words;this._nDataBytes;var n=8*e.sigBytes,a=32*this.blockSize;r[n>>>5]|=1<<24-n%32,r[(t.ceil((n+1)/a)*a>>>5)-1]|=128,e.sigBytes=4*r.length,this._process();for(var s=this._state,o=this.cfg.outputLength/8,l=o/8,u=[],c=0;c<l;c++){var d=s[c],f=d.high,h=d.low;f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),u.push(h),u.push(f)}return new i.init(u,o)},clone:function(){for(var e=a.clone.call(this),t=e._state=this._state.slice(0),r=0;r<25;r++)t[r]=t[r].clone();return e}});r.SHA3=a._createHelper(f),r.HmacSHA3=a._createHmacHelper(f)}(Math),e.SHA3}(M(),F())),he.exports}var pe,me={exports:{}};var ve,ye={exports:{}};function Ee(){return ve||(ve=1,ye.exports=function(e){var t,r,n;r=(t=e).lib.Base,n=t.enc.Utf8,t.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var r=e.blockSize,i=4*r;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var a=this._oKey=t.clone(),s=this._iKey=t.clone(),o=a.words,l=s.words,u=0;u<r;u++)o[u]^=1549556828,l[u]^=909522486;a.sigBytes=s.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})}(M())),ye.exports}var Te,_e={exports:{}};var Se,be={exports:{}};function Ae(){return Se||(Se=1,be.exports=function(e){return r=(t=e).lib,n=r.Base,i=r.WordArray,a=t.algo,s=a.MD5,o=a.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:s,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,n=this.cfg,a=n.hasher.create(),s=i.create(),o=s.words,l=n.keySize,u=n.iterations;o.length<l;){r&&a.update(r),r=a.update(e).finalize(t),a.reset();for(var c=1;c<u;c++)r=a.finalize(r),a.reset();s.concat(r)}return s.sigBytes=4*l,s}}),t.EvpKDF=function(e,t,r){return o.create(r).compute(e,t)},e.EvpKDF;var t,r,n,i,a,s,o}(M(),te(),Ee())),be.exports}var Ie,Re={exports:{}};function we(){return Ie||(Ie=1,Re.exports=function(e){e.lib.Cipher||function(t){var r=e,n=r.lib,i=n.Base,a=n.WordArray,s=n.BufferedBlockAlgorithm,o=r.enc;o.Utf8;var l=o.Base64,u=r.algo.EvpKDF,c=n.Cipher=s.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?E:v}return function(t){return{encrypt:function(r,n,i){return e(n).encrypt(t,r,n,i)},decrypt:function(r,n,i){return e(n).decrypt(t,r,n,i)}}}}()});n.StreamCipher=c.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var d=r.mode={},f=n.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),h=d.CBC=function(){var e=f.extend();function r(e,r,n){var i,a=this._iv;a?(i=a,this._iv=t):i=this._prevBlock;for(var s=0;s<n;s++)e[r+s]^=i[s]}return e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;r.call(this,e,t,i),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),e.Decryptor=e.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,a=e.slice(t,t+i);n.decryptBlock(e,t),r.call(this,e,t,i),this._prevBlock=a}}),e}(),g=(r.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,i=n<<24|n<<16|n<<8|n,s=[],o=0;o<n;o+=4)s.push(i);var l=a.create(s,n);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};n.BlockCipher=c.extend({cfg:c.cfg.extend({mode:h,padding:g}),reset:function(){var e;c.reset.call(this);var t=this.cfg,r=t.iv,n=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=n.createEncryptor:(e=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(n,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var p=n.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),m=(r.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?a.create([1398893684,1701076831]).concat(r).concat(t):t).toString(l)},parse:function(e){var t,r=l.parse(e),n=r.words;return 1398893684==n[0]&&1701076831==n[1]&&(t=a.create(n.slice(2,4)),n.splice(0,4),r.sigBytes-=16),p.create({ciphertext:r,salt:t})}},v=n.SerializableCipher=i.extend({cfg:i.extend({format:m}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var i=e.createEncryptor(r,n),a=i.finalize(t),s=i.cfg;return p.create({ciphertext:a,key:r,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){return n=this.cfg.extend(n),t=this._parse(t,n.format),e.createDecryptor(r,n).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),y=(r.kdf={}).OpenSSL={execute:function(e,t,r,n,i){if(n||(n=a.random(8)),i)s=u.create({keySize:t+r,hasher:i}).compute(e,n);else var s=u.create({keySize:t+r}).compute(e,n);var o=a.create(s.words.slice(t),4*r);return s.sigBytes=4*t,p.create({key:s,iv:o,salt:n})}},E=n.PasswordBasedCipher=v.extend({cfg:v.cfg.extend({kdf:y}),encrypt:function(e,t,r,n){var i=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize,n.salt,n.hasher);n.iv=i.iv;var a=v.encrypt.call(this,e,t,i.key,n);return a.mixIn(i),a},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var i=n.kdf.execute(r,e.keySize,e.ivSize,t.salt,n.hasher);return n.iv=i.iv,v.decrypt.call(this,e,t,i.key,n)}})}()}(M(),Ae())),Re.exports}var De,Le={exports:{}};function Ce(){return De||(De=1,Le.exports=function(e){return e.mode.CFB=function(){var t=e.lib.BlockCipherMode.extend();function r(e,t,r,n){var i,a=this._iv;a?(i=a.slice(0),this._iv=void 0):i=this._prevBlock,n.encryptBlock(i,0);for(var s=0;s<r;s++)e[t+s]^=i[s]}return t.Encryptor=t.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize;r.call(this,e,t,i,n),this._prevBlock=e.slice(t,t+i)}}),t.Decryptor=t.extend({processBlock:function(e,t){var n=this._cipher,i=n.blockSize,a=e.slice(t,t+i);r.call(this,e,t,i,n),this._prevBlock=a}}),t}(),e.mode.CFB}(M(),we())),Le.exports}var Ne,Pe={exports:{}};function Oe(){return Ne||(Ne=1,Pe.exports=function(e){return e.mode.CTR=(t=e.lib.BlockCipherMode.extend(),r=t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,i=this._iv,a=this._counter;i&&(a=this._counter=i.slice(0),this._iv=void 0);var s=a.slice(0);r.encryptBlock(s,0),a[n-1]=a[n-1]+1|0;for(var o=0;o<n;o++)e[t+o]^=s[o]}}),t.Decryptor=r,t),e.mode.CTR;var t,r}(M(),we())),Pe.exports}var Me,ke={exports:{}};function xe(){return Me||(Me=1,ke.exports=function(e){
/** @preserve
			 * Counter block mode compatible with  Dr Brian Gladman fileenc.c
			 * derived from CryptoJS.mode.CTR
			 * Jan Hruby jhruby.web@gmail.com
			 */
return e.mode.CTRGladman=function(){var t=e.lib.BlockCipherMode.extend();function r(e){if(255&~(e>>24))e+=1<<24;else{var t=e>>16&255,r=e>>8&255,n=255&e;255===t?(t=0,255===r?(r=0,255===n?n=0:++n):++r):++t,e=0,e+=t<<16,e+=r<<8,e+=n}return e}function n(e){return 0===(e[0]=r(e[0]))&&(e[1]=r(e[1])),e}var i=t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize,a=this._iv,s=this._counter;a&&(s=this._counter=a.slice(0),this._iv=void 0),n(s);var o=s.slice(0);r.encryptBlock(o,0);for(var l=0;l<i;l++)e[t+l]^=o[l]}});return t.Decryptor=i,t}(),e.mode.CTRGladman}(M(),we())),ke.exports}var Fe,Be={exports:{}};function Ue(){return Fe||(Fe=1,Be.exports=function(e){return e.mode.OFB=(t=e.lib.BlockCipherMode.extend(),r=t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,n=r.blockSize,i=this._iv,a=this._keystream;i&&(a=this._keystream=i.slice(0),this._iv=void 0),r.encryptBlock(a,0);for(var s=0;s<n;s++)e[t+s]^=a[s]}}),t.Decryptor=r,t),e.mode.OFB;var t,r}(M(),we())),Be.exports}var Ze,Ge={exports:{}};var He,$e={exports:{}};var Ve,Ke={exports:{}};var qe,Ye={exports:{}};var je,ze={exports:{}};var We,Xe={exports:{}};var Qe,Je={exports:{}};var et,tt={exports:{}};var rt,nt={exports:{}};function it(){return rt||(rt=1,nt.exports=function(e){return function(){var t=e,r=t.lib,n=r.WordArray,i=r.BlockCipher,a=t.algo,s=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],o=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],c=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=a.DES=i.extend({_doReset:function(){for(var e=this._key.words,t=[],r=0;r<56;r++){var n=s[r]-1;t[r]=e[n>>>5]>>>31-n%32&1}for(var i=this._subKeys=[],a=0;a<16;a++){var u=i[a]=[],c=l[a];for(r=0;r<24;r++)u[r/6|0]|=t[(o[r]-1+c)%28]<<31-r%6,u[4+(r/6|0)]|=t[28+(o[r+24]-1+c)%28]<<31-r%6;for(u[0]=u[0]<<1|u[0]>>>31,r=1;r<7;r++)u[r]=u[r]>>>4*(r-1)+3;u[7]=u[7]<<5|u[7]>>>27}var d=this._invSubKeys=[];for(r=0;r<16;r++)d[r]=i[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,r){this._lBlock=e[t],this._rBlock=e[t+1],f.call(this,4,252645135),f.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),f.call(this,1,1431655765);for(var n=0;n<16;n++){for(var i=r[n],a=this._lBlock,s=this._rBlock,o=0,l=0;l<8;l++)o|=u[l][((s^i[l])&c[l])>>>0];this._lBlock=s,this._rBlock=a^o}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,f.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),f.call(this,16,65535),f.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function f(e,t){var r=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=r,this._lBlock^=r<<e}function h(e,t){var r=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=r,this._rBlock^=r<<e}t.DES=i._createHelper(d);var g=a.TripleDES=i.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),r=e.length<4?e.slice(0,2):e.slice(2,4),i=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=d.createEncryptor(n.create(t)),this._des2=d.createEncryptor(n.create(r)),this._des3=d.createEncryptor(n.create(i))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});t.TripleDES=i._createHelper(g)}(),e.TripleDES}(M(),q(),Q(),Ae(),we())),nt.exports}var at,st={exports:{}};var ot,lt={exports:{}};var ut,ct={exports:{}};var dt,ft={exports:{}};function ht(){return dt||(dt=1,ft.exports=function(e){return function(){var t=e,r=t.lib.BlockCipher,n=t.algo;const i=16,a=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],s=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var o={pbox:[],sbox:[]};function l(e,t){let r=t>>24&255,n=t>>16&255,i=t>>8&255,a=255&t,s=e.sbox[0][r]+e.sbox[1][n];return s^=e.sbox[2][i],s+=e.sbox[3][a],s}function u(e,t,r){let n,a=t,s=r;for(let t=0;t<i;++t)a^=e.pbox[t],s=l(e,a)^s,n=a,a=s,s=n;return n=a,a=s,s=n,s^=e.pbox[i],a^=e.pbox[i+1],{left:a,right:s}}function c(e,t,r){let n,a=t,s=r;for(let t=i+1;t>1;--t)a^=e.pbox[t],s=l(e,a)^s,n=a,a=s,s=n;return n=a,a=s,s=n,s^=e.pbox[1],a^=e.pbox[0],{left:a,right:s}}function d(e,t,r){for(let t=0;t<4;t++){e.sbox[t]=[];for(let r=0;r<256;r++)e.sbox[t][r]=s[t][r]}let n=0;for(let s=0;s<i+2;s++)e.pbox[s]=a[s]^t[n],n++,n>=r&&(n=0);let o=0,l=0,c=0;for(let t=0;t<i+2;t+=2)c=u(e,o,l),o=c.left,l=c.right,e.pbox[t]=o,e.pbox[t+1]=l;for(let t=0;t<4;t++)for(let r=0;r<256;r+=2)c=u(e,o,l),o=c.left,l=c.right,e.sbox[t][r]=o,e.sbox[t][r+1]=l;return!0}var f=n.Blowfish=r.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4;d(o,t,r)}},encryptBlock:function(e,t){var r=u(o,e[t],e[t+1]);e[t]=r.left,e[t+1]=r.right},decryptBlock:function(e,t){var r=c(o,e[t],e[t+1]);e[t]=r.left,e[t+1]=r.right},blockSize:2,keySize:4,ivSize:2});t.Blowfish=r._createHelper(f)}(),e.Blowfish}(M(),q(),Q(),Ae(),we())),ft.exports}var gt;var pt=(gt||(gt=1,C.exports=function(e){return e}(M(),F(),Z(),$(),q(),z(),Q(),te(),ie(),ae||(ae=1,se.exports=function(e){return r=(t=e).lib.WordArray,n=t.algo,i=n.SHA256,a=n.SHA224=i.extend({_doReset:function(){this._hash=new r.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=i._doFinalize.call(this);return e.sigBytes-=4,e}}),t.SHA224=i._createHelper(a),t.HmacSHA224=i._createHmacHelper(a),e.SHA224;var t,r,n,i,a}(M(),ie())),ue(),ce||(ce=1,de.exports=function(e){return r=(t=e).x64,n=r.Word,i=r.WordArray,a=t.algo,s=a.SHA512,o=a.SHA384=s.extend({_doReset:function(){this._hash=new i.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var e=s._doFinalize.call(this);return e.sigBytes-=16,e}}),t.SHA384=s._createHelper(o),t.HmacSHA384=s._createHmacHelper(o),e.SHA384;var t,r,n,i,a,s,o}(M(),F(),ue())),ge(),pe||(pe=1,me.exports=function(e){
/** @preserve
			(c) 2012 by Cdric Mesnil. All rights reserved.

			Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

			    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
			    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.

			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
			*/
return function(){var t=e,r=t.lib,n=r.WordArray,i=r.Hasher,a=t.algo,s=n.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),o=n.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),l=n.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),u=n.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),c=n.create([0,1518500249,1859775393,2400959708,2840853838]),d=n.create([1352829926,1548603684,1836072691,2053994217,0]),f=a.RIPEMD160=i.extend({_doReset:function(){this._hash=n.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,i=e[n];e[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var a,f,E,T,_,S,b,A,I,R,w,D=this._hash.words,L=c.words,C=d.words,N=s.words,P=o.words,O=l.words,M=u.words;for(S=a=D[0],b=f=D[1],A=E=D[2],I=T=D[3],R=_=D[4],r=0;r<80;r+=1)w=a+e[t+N[r]]|0,w+=r<16?h(f,E,T)+L[0]:r<32?g(f,E,T)+L[1]:r<48?p(f,E,T)+L[2]:r<64?m(f,E,T)+L[3]:v(f,E,T)+L[4],w=(w=y(w|=0,O[r]))+_|0,a=_,_=T,T=y(E,10),E=f,f=w,w=S+e[t+P[r]]|0,w+=r<16?v(b,A,I)+C[0]:r<32?m(b,A,I)+C[1]:r<48?p(b,A,I)+C[2]:r<64?g(b,A,I)+C[3]:h(b,A,I)+C[4],w=(w=y(w|=0,M[r]))+R|0,S=R,R=I,I=y(A,10),A=b,b=w;w=D[1]+E+I|0,D[1]=D[2]+T+R|0,D[2]=D[3]+_+S|0,D[3]=D[4]+a+b|0,D[4]=D[0]+f+A|0,D[0]=w},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(t.length+1),this._process();for(var i=this._hash,a=i.words,s=0;s<5;s++){var o=a[s];a[s]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}return i},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t,r){return e^t^r}function g(e,t,r){return e&t|~e&r}function p(e,t,r){return(e|~t)^r}function m(e,t,r){return e&r|t&~r}function v(e,t,r){return e^(t|~r)}function y(e,t){return e<<t|e>>>32-t}t.RIPEMD160=i._createHelper(f),t.HmacRIPEMD160=i._createHmacHelper(f)}(),e.RIPEMD160}(M())),Ee(),Te||(Te=1,_e.exports=function(e){return n=(r=(t=e).lib).Base,i=r.WordArray,s=(a=t.algo).SHA256,o=a.HMAC,l=a.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:s,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=o.create(r.hasher,e),a=i.create(),s=i.create([1]),l=a.words,u=s.words,c=r.keySize,d=r.iterations;l.length<c;){var f=n.update(t).finalize(s);n.reset();for(var h=f.words,g=h.length,p=f,m=1;m<d;m++){p=n.finalize(p),n.reset();for(var v=p.words,y=0;y<g;y++)h[y]^=v[y]}a.concat(f),u[0]++}return a.sigBytes=4*c,a}}),t.PBKDF2=function(e,t,r){return l.create(r).compute(e,t)},e.PBKDF2;var t,r,n,i,a,s,o,l}(M(),ie(),Ee())),Ae(),we(),Ce(),Oe(),xe(),Ue(),Ze||(Ze=1,Ge.exports=function(e){return e.mode.ECB=((t=e.lib.BlockCipherMode.extend()).Encryptor=t.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),t.Decryptor=t.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),t),e.mode.ECB;var t}(M(),we())),He||(He=1,$e.exports=function(e){return e.pad.AnsiX923={pad:function(e,t){var r=e.sigBytes,n=4*t,i=n-r%n,a=r+i-1;e.clamp(),e.words[a>>>2]|=i<<24-a%4*8,e.sigBytes+=i},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Ansix923}(M(),we())),Ve||(Ve=1,Ke.exports=function(e){return e.pad.Iso10126={pad:function(t,r){var n=4*r,i=n-t.sigBytes%n;t.concat(e.lib.WordArray.random(i-1)).concat(e.lib.WordArray.create([i<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Iso10126}(M(),we())),qe||(qe=1,Ye.exports=function(e){return e.pad.Iso97971={pad:function(t,r){t.concat(e.lib.WordArray.create([2147483648],1)),e.pad.ZeroPadding.pad(t,r)},unpad:function(t){e.pad.ZeroPadding.unpad(t),t.sigBytes--}},e.pad.Iso97971}(M(),we())),je||(je=1,ze.exports=function(e){return e.pad.ZeroPadding={pad:function(e,t){var r=4*t;e.clamp(),e.sigBytes+=r-(e.sigBytes%r||r)},unpad:function(e){var t=e.words,r=e.sigBytes-1;for(r=e.sigBytes-1;r>=0;r--)if(t[r>>>2]>>>24-r%4*8&255){e.sigBytes=r+1;break}}},e.pad.ZeroPadding}(M(),we())),We||(We=1,Xe.exports=function(e){return e.pad.NoPadding={pad:function(){},unpad:function(){}},e.pad.NoPadding}(M(),we())),Qe||(Qe=1,Je.exports=function(e){return r=(t=e).lib.CipherParams,n=t.enc.Hex,t.format.Hex={stringify:function(e){return e.ciphertext.toString(n)},parse:function(e){var t=n.parse(e);return r.create({ciphertext:t})}},e.format.Hex;var t,r,n}(M(),we())),et||(et=1,tt.exports=function(e){return function(){var t=e,r=t.lib.BlockCipher,n=t.algo,i=[],a=[],s=[],o=[],l=[],u=[],c=[],d=[],f=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,n=0;for(t=0;t<256;t++){var g=n^n<<1^n<<2^n<<3^n<<4;g=g>>>8^255&g^99,i[r]=g,a[g]=r;var p=e[r],m=e[p],v=e[m],y=257*e[g]^16843008*g;s[r]=y<<24|y>>>8,o[r]=y<<16|y>>>16,l[r]=y<<8|y>>>24,u[r]=y,y=16843009*v^65537*m^257*p^16843008*r,c[g]=y<<24|y>>>8,d[g]=y<<16|y>>>16,f[g]=y<<8|y>>>24,h[g]=y,r?(r=p^e[e[e[v^p]]],n^=e[e[n]]):r=n=1}}();var g=[0,1,2,4,8,16,32,64,128,27,54],p=n.AES=r.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*((this._nRounds=r+6)+1),a=this._keySchedule=[],s=0;s<n;s++)s<r?a[s]=t[s]:(u=a[s-1],s%r?r>6&&s%r==4&&(u=i[u>>>24]<<24|i[u>>>16&255]<<16|i[u>>>8&255]<<8|i[255&u]):(u=i[(u=u<<8|u>>>24)>>>24]<<24|i[u>>>16&255]<<16|i[u>>>8&255]<<8|i[255&u],u^=g[s/r|0]<<24),a[s]=a[s-r]^u);for(var o=this._invKeySchedule=[],l=0;l<n;l++){if(s=n-l,l%4)var u=a[s];else u=a[s-4];o[l]=l<4||s<=4?u:c[i[u>>>24]]^d[i[u>>>16&255]]^f[i[u>>>8&255]]^h[i[255&u]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,o,l,u,i)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,c,d,f,h,a),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,i,a,s,o){for(var l=this._nRounds,u=e[t]^r[0],c=e[t+1]^r[1],d=e[t+2]^r[2],f=e[t+3]^r[3],h=4,g=1;g<l;g++){var p=n[u>>>24]^i[c>>>16&255]^a[d>>>8&255]^s[255&f]^r[h++],m=n[c>>>24]^i[d>>>16&255]^a[f>>>8&255]^s[255&u]^r[h++],v=n[d>>>24]^i[f>>>16&255]^a[u>>>8&255]^s[255&c]^r[h++],y=n[f>>>24]^i[u>>>16&255]^a[c>>>8&255]^s[255&d]^r[h++];u=p,c=m,d=v,f=y}p=(o[u>>>24]<<24|o[c>>>16&255]<<16|o[d>>>8&255]<<8|o[255&f])^r[h++],m=(o[c>>>24]<<24|o[d>>>16&255]<<16|o[f>>>8&255]<<8|o[255&u])^r[h++],v=(o[d>>>24]<<24|o[f>>>16&255]<<16|o[u>>>8&255]<<8|o[255&c])^r[h++],y=(o[f>>>24]<<24|o[u>>>16&255]<<16|o[c>>>8&255]<<8|o[255&d])^r[h++],e[t]=p,e[t+1]=m,e[t+2]=v,e[t+3]=y},keySize:8});t.AES=r._createHelper(p)}(),e.AES}(M(),q(),Q(),Ae(),we())),it(),at||(at=1,st.exports=function(e){return function(){var t=e,r=t.lib.StreamCipher,n=t.algo,i=n.RC4=r.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,n=this._S=[],i=0;i<256;i++)n[i]=i;i=0;for(var a=0;i<256;i++){var s=i%r,o=t[s>>>2]>>>24-s%4*8&255;a=(a+n[i]+o)%256;var l=n[i];n[i]=n[a],n[a]=l}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=a.call(this)},keySize:8,ivSize:0});function a(){for(var e=this._S,t=this._i,r=this._j,n=0,i=0;i<4;i++){r=(r+e[t=(t+1)%256])%256;var a=e[t];e[t]=e[r],e[r]=a,n|=e[(e[t]+e[r])%256]<<24-8*i}return this._i=t,this._j=r,n}t.RC4=r._createHelper(i);var s=n.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)a.call(this)}});t.RC4Drop=r._createHelper(s)}(),e.RC4}(M(),q(),Q(),Ae(),we())),ot||(ot=1,lt.exports=function(e){return function(){var t=e,r=t.lib.StreamCipher,n=t.algo,i=[],a=[],s=[],o=n.Rabbit=r.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,r=0;r<4;r++)e[r]=16711935&(e[r]<<8|e[r]>>>24)|4278255360&(e[r]<<24|e[r]>>>8);var n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,r=0;r<4;r++)l.call(this);for(r=0;r<8;r++)i[r]^=n[r+4&7];if(t){var a=t.words,s=a[0],o=a[1],u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),c=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),d=u>>>16|4294901760&c,f=c<<16|65535&u;for(i[0]^=u,i[1]^=d,i[2]^=c,i[3]^=f,i[4]^=u,i[5]^=d,i[6]^=c,i[7]^=f,r=0;r<4;r++)l.call(this)}},_doProcessBlock:function(e,t){var r=this._X;l.call(this),i[0]=r[0]^r[5]>>>16^r[3]<<16,i[1]=r[2]^r[7]>>>16^r[5]<<16,i[2]=r[4]^r[1]>>>16^r[7]<<16,i[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)i[n]=16711935&(i[n]<<8|i[n]>>>24)|4278255360&(i[n]<<24|i[n]>>>8),e[t+n]^=i[n]},blockSize:4,ivSize:2});function l(){for(var e=this._X,t=this._C,r=0;r<8;r++)a[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<a[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<a[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<a[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<a[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<a[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<a[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<a[6]>>>0?1:0)|0,this._b=t[7]>>>0<a[7]>>>0?1:0,r=0;r<8;r++){var n=e[r]+t[r],i=65535&n,o=n>>>16,l=((i*i>>>17)+i*o>>>15)+o*o,u=((4294901760&n)*n|0)+((65535&n)*n|0);s[r]=l^u}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}t.Rabbit=r._createHelper(o)}(),e.Rabbit}(M(),q(),Q(),Ae(),we())),ut||(ut=1,ct.exports=function(e){return function(){var t=e,r=t.lib.StreamCipher,n=t.algo,i=[],a=[],s=[],o=n.RabbitLegacy=r.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],n=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var i=0;i<4;i++)l.call(this);for(i=0;i<8;i++)n[i]^=r[i+4&7];if(t){var a=t.words,s=a[0],o=a[1],u=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),c=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),d=u>>>16|4294901760&c,f=c<<16|65535&u;for(n[0]^=u,n[1]^=d,n[2]^=c,n[3]^=f,n[4]^=u,n[5]^=d,n[6]^=c,n[7]^=f,i=0;i<4;i++)l.call(this)}},_doProcessBlock:function(e,t){var r=this._X;l.call(this),i[0]=r[0]^r[5]>>>16^r[3]<<16,i[1]=r[2]^r[7]>>>16^r[5]<<16,i[2]=r[4]^r[1]>>>16^r[7]<<16,i[3]=r[6]^r[3]>>>16^r[1]<<16;for(var n=0;n<4;n++)i[n]=16711935&(i[n]<<8|i[n]>>>24)|4278255360&(i[n]<<24|i[n]>>>8),e[t+n]^=i[n]},blockSize:4,ivSize:2});function l(){for(var e=this._X,t=this._C,r=0;r<8;r++)a[r]=t[r];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<a[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<a[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<a[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<a[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<a[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<a[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<a[6]>>>0?1:0)|0,this._b=t[7]>>>0<a[7]>>>0?1:0,r=0;r<8;r++){var n=e[r]+t[r],i=65535&n,o=n>>>16,l=((i*i>>>17)+i*o>>>15)+o*o,u=((4294901760&n)*n|0)+((65535&n)*n|0);s[r]=l^u}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}t.RabbitLegacy=r._createHelper(o)}(),e.RabbitLegacy}(M(),q(),Q(),Ae(),we())),ht())),C.exports),mt=D(pt);function vt(e){if(!e)return"";if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["B","kB","MB","GB"][t]}function yt(e,t,r,n=!1){if(!e)throw new Error("Must provide expires");if(!r)return"";const i=n&&t?e+" "+t+" "+r:e+" "+r,a=mt.MD5(i);return mt.enc.Base64.stringify(a).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Et(e){const t=r(()=>function(e,t=window.location.origin+"/api"){let r=e?.defaults?.baseURL||e?.url||t;return r.startsWith("//")?r=window.location.protocol+r:r.startsWith("/")?r=window.location.origin+r:r.startsWith("http://")||r.startsWith("https://")||(r=window.location.origin+(r.startsWith("/")?"":"/")+r),r}(e.api));return{getStreamUrl:r=>{if(!r)return null;if(r.startsWith("http://")||r.startsWith("https://"))return r;try{const n=e.streamSecret||"";let i=r;if(i.startsWith("/")&&(i=i.substring(1)),e.urlSchema){let r=e.urlSchema;try{r=decodeURIComponent(r)}catch(e){}let a=e.hostUrl||"";if(!a){a=(t.value||window.location.origin+"/api").replace("/api","")||window.location.origin}a.startsWith("http://")||a.startsWith("https://")||(a=window.location.origin),a=a.replace(/\/+$/,""),r=r.replace(/\{\{host_url\}\}/g,a);const s=r.includes("{{token}}"),o=r.includes("{{expires}}"),l=r.includes("{{item_field}}");if(l&&(r=r.replace(/\{\{item_field\}\}/g,i)),s||o)if(n){const t=e.includeIp??!1,i=t?"":null,a=e.expiresInMinutes??60,s=new Date(Date.now()+60*a*1e3).getTime(),o=String(Math.round(s/1e3)),l=yt(o,i,n,t);r=r.replace(/\{\{token\}\}/g,l).replace(/\{\{expires\}\}/g,o)}else r=r.replace(/\{\{token\}\}/g,"").replace(/\{\{expires\}\}/g,"");if(!l){const e=r.endsWith("/")?"":"/";return r+e+i}return r}let a=e.hostUrl||"";if(!a){a=(t.value||window.location.origin+"/api").replace("/api","")||window.location.origin}a.startsWith("http://")||a.startsWith("https://")||(a=window.location.origin);try{a=decodeURIComponent(a)}catch(e){}a=a.replace(/\/+$/,""),r.startsWith("/")||(r="/"+r);const s=a.includes("{{token}}"),o=a.includes("{{expires}}"),l=a.includes("{{item_field}}"),u=s||o||l;if(l){const e=r.startsWith("/")?r.substring(1):r;a=a.replace(/\{\{item_field\}\}/g,e)}if(u){if(!n&&(s||o)){const e=a.replace(/\{\{token\}\}/g,"").replace(/\{\{expires\}\}/g,"").replace(/\/+$/,"");return l?e:e+r}if(s||o){const t=e.includeIp??!1,r=t?"":null,i=e.expiresInMinutes??60,s=new Date(Date.now()+60*i*1e3).getTime(),o=String(Math.round(s/1e3)),l=yt(o,r,n,t);a=a.replace(/\{\{token\}\}/g,l).replace(/\{\{expires\}\}/g,o)}const t=a.replace(/\/+$/,"");return l?t:t+r}return a+r}catch(e){return console.error("Failed to construct stream URL:",e),`${window.location.origin}${r}`}},apiBaseUrl:t}}const Tt=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},_t=Number.isSafeInteger||function(e){return"number"==typeof e&&Math.abs(e)<=St},St=Number.MAX_SAFE_INTEGER||9007199254740991;let bt=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),At=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",e.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",e.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.ASSET_LIST_LOAD_ERROR="assetListLoadError",e.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",e.ASSET_LIST_PARSING_ERROR="assetListParsingError",e.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.ATTACH_MEDIA_ERROR="attachMediaError",e.UNKNOWN="unknown",e}({}),It=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.MEDIA_ENDED="hlsMediaEnded",e.STALL_RESOLVED="hlsStallResolved",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFERED_TO_END="hlsBufferedToEnd",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e.ASSET_LIST_LOADING="hlsAssetListLoading",e.ASSET_LIST_LOADED="hlsAssetListLoaded",e.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",e.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",e.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",e.INTERSTITIAL_STARTED="hlsInterstitialStarted",e.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",e.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",e.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",e.INTERSTITIAL_ENDED="hlsInterstitialEnded",e.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",e.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",e.EVENT_CUE_ENTER="hlsEventCueEnter",e}({});var Rt="manifest",wt="level",Dt="audioTrack",Lt="subtitleTrack",Ct="main",Nt="audio",Pt="subtitle";class Ot{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){const r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class Mt{constructor(e,t,r,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ot(e),this.fast_=new Ot(t),this.defaultTTFB_=n,this.ttfb_=new Ot(e)}update(e,t){const{slow_:r,fast_:n,ttfb_:i}=this;r.halfLife!==e&&(this.slow_=new Ot(e,r.getEstimate(),r.getTotalWeight())),n.halfLife!==t&&(this.fast_=new Ot(t,n.getEstimate(),n.getTotalWeight())),i.halfLife!==e&&(this.ttfb_=new Ot(e,i.getEstimate(),i.getTotalWeight()))}sample(e,t){const r=(e=Math.max(e,this.minDelayMs_))/1e3,n=8*t/r;this.fast_.sample(r,n),this.slow_.sample(r,n)}sampleTTFB(e){const t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function kt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xt(){return xt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},xt.apply(null,arguments)}function Ft(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Bt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ft(Object(r),!0).forEach(function(t){kt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ft(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}class Ut{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const r=`[${e}]:`;this.trace=Zt,this.debug=t.debug.bind(null,r),this.log=t.log.bind(null,r),this.warn=t.warn.bind(null,r),this.info=t.info.bind(null,r),this.error=t.error.bind(null,r)}}const Zt=function(){},Gt={trace:Zt,debug:Zt,log:Zt,warn:Zt,info:Zt,error:Zt};function Ht(){return xt({},Gt)}function $t(e,t,r){return t[e]?t[e].bind(t):function(e,t){const r=self.console[e];return r?r.bind(self.console,`${t?"["+t+"] ":""}[${e}] >`):Zt}(e,r)}const Vt=Ht();const Kt=Vt;function qt(e=!0){if("undefined"==typeof self)return;return(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function Yt(e,t){const r=Object.keys(e),n=Object.keys(t),i=r.length,a=n.length;return!i||!a||i===a&&!r.some(e=>-1===n.indexOf(e))}function jt(e,t=!1){if("undefined"!=typeof TextDecoder){const r=new TextDecoder("utf-8").decode(e);if(t){const e=r.indexOf("\0");return-1!==e?r.substring(0,e):r}return r.replace(/\0/g,"")}const r=e.length;let n,i,a,s="",o=0;for(;o<r;){if(n=e[o++],0===n&&t)return s;if(0!==n&&3!==n)switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=String.fromCharCode(n);break;case 12:case 13:i=e[o++],s+=String.fromCharCode((31&n)<<6|63&i);break;case 14:i=e[o++],a=e[o++],s+=String.fromCharCode((15&n)<<12|(63&i)<<6|63&a)}}return s}function zt(e){let t="";for(let r=0;r<e.length;r++){let n=e[r].toString(16);n.length<2&&(n="0"+n),t+=n}return t}function Wt(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function Xt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Qt,Jt={exports:{}};var er,tr,rr,nr,ir,ar=Qt?Jt.exports:(Qt=1,er=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,tr=/^(?=([^\/?#]*))\1([^]*)$/,rr=/(?:\/|^)\.(?=\/)/g,nr=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,Jt.exports=ir={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var n=ir.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=ir.normalizePath(n.path),ir.buildURLFromParts(n)}var i=ir.parseURL(t);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=ir.normalizePath(i.path),ir.buildURLFromParts(i)):t;var a=ir.parseURL(e);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var s=tr.exec(a.path);a.netLoc=s[1],a.path=s[2]}a.netLoc&&!a.path&&(a.path="/");var o={scheme:a.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(o.netLoc=a.netLoc,"/"!==i.path[0]))if(i.path){var l=a.path,u=l.substring(0,l.lastIndexOf("/")+1)+i.path;o.path=ir.normalizePath(u)}else o.path=a.path,i.params||(o.params=a.params,i.query||(o.query=a.query));return null===o.path&&(o.path=r.alwaysNormalize?ir.normalizePath(i.path):i.path),ir.buildURLFromParts(o)},parseURL:function(e){var t=er.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(rr,"");e.length!==(e=e.replace(nr,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}});class sr{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var or="audio",lr="video",ur="audiovideo";class cr{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,"string"==typeof e&&(e={url:e}),this.base=e,function(e,t){const r=gr(e,t);r&&(r.enumerable=!0,Object.defineProperty(e,t,r))}(this,"stats")}setByteRange(e,t){const r=e.split("@",2);let n;n=1===r.length?(null==t?void 0:t.byteRangeEndOffset)||0:parseInt(r[1]),this._byteRange=[n,parseInt(r[0])+n]}get baseurl(){return this.base.url}get byteRange(){return null===this._byteRange?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return null===this._streams&&(this._streams={[or]:null,[lr]:null,[ur]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return null!==this._stats}get hasStreams(){return null!==this._streams}get stats(){return null===this._stats&&(this._stats=new sr),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=ar.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[or]=null,e[lr]=null,e[ur]=null}}function dr(e){return"initSegment"!==e.sn}class fr extends cr{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Tt(e)&&Tt(t))return t-e}return null}get bitrate(){return this.byteLength?8*this.byteLength/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(null==(e=this._decryptdata)||!e.keyId){const e=Object.keys(t);if(1===e.length){const r=this._decryptdata=t[e[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(null===this.programDateTime)return null;const e=Tt(this.duration)?this.duration:0;return this.programDateTime+1e3*e}get encrypted(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t;const e=Object.keys(this.levelkeys),r=e.length;if(r>1||1===r&&null!=(t=this.levelkeys[e[0]])&&t.encrypted)return!0}return!1}get programDateTime(){return null===this._programDateTime&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){Tt(e)?this._programDateTime=e:this._programDateTime=this.rawProgramDateTime=null}get ref(){return dr(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var r;const n=t[e];!n||null!=(r=this._decryptdata)&&r.keyId||(this._decryptdata=n.getDecryptData(this.sn,t))}}abortRequests(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()}setElementaryStreamInfo(e,t,r,n,i,a=!1){const{elementaryStreams:s}=this,o=s[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,r),o.startDTS=Math.min(o.startDTS,n),o.endDTS=Math.max(o.endDTS,i)):s[e]={startPTS:t,endPTS:r,startDTS:n,endDTS:i,partial:a}}}class hr extends cr{constructor(e,t,r,n,i){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,i),i&&(this.fragOffset=i.fragOffset+i.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function gr(e,t){const r=Object.getPrototypeOf(e);if(r){const e=Object.getOwnPropertyDescriptor(r,t);return e||gr(r,t)}}const pr=Math.pow(2,32)-1,mr=[].push,vr={video:1,audio:2,id3:3,text:4};function yr(e){return String.fromCharCode.apply(null,e)}function Er(e,t){const r=e[t]<<8|e[t+1];return r<0?65536+r:r}function Tr(e,t){const r=Sr(e,t);return r<0?4294967296+r:r}function _r(e,t){let r=Tr(e,t);return r*=Math.pow(2,32),r+=Tr(e,t+4),r}function Sr(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function br(e,t){const r=[];if(!t.length)return r;const n=e.byteLength;for(let i=0;i<n;){const a=Tr(e,i),s=a>1?i+a:n;if(yr(e.subarray(i+4,i+8))===t[0])if(1===t.length)r.push(e.subarray(i+8,s));else{const n=br(e.subarray(i+8,s),t.slice(1));n.length&&mr.apply(r,n)}i=s}return r}function Ar(e){const t=[],r=e[0];let n=8;const i=Tr(e,n);n+=4;let a=0,s=0;0===r?(a=Tr(e,n),s=Tr(e,n+4),n+=8):(a=_r(e,n),s=_r(e,n+8),n+=16),n+=2;let o=e.length+s;const l=Er(e,n);n+=2;for(let r=0;r<l;r++){let r=n;const a=Tr(e,r);r+=4;const s=2147483647&a;if(1===(2147483648&a)>>>31)return Kt.warn("SIDX has hierarchical references (not supported)"),null;const l=Tr(e,r);r+=4,t.push({referenceSize:s,subsegmentDuration:l,info:{duration:l/i,start:o,end:o+s-1}}),o+=s,r+=4,n=r}return{earliestPresentationTime:a,timescale:i,version:r,referencesCount:l,references:t}}function Ir(e){const t=[],r=br(e,["moov","trak"]);for(let e=0;e<r.length;e++){const n=r[e],i=br(n,["tkhd"])[0];if(i){let e=i[0];const r=Tr(i,0===e?12:20),a=br(n,["mdia","mdhd"])[0];if(a){e=a[0];const i=Tr(a,0===e?12:20),s=br(n,["mdia","hdlr"])[0];if(s){const e=yr(s.subarray(8,12)),a={soun:or,vide:lr}[e],o=Rr(br(n,["mdia","minf","stbl","stsd"])[0]);a?(t[r]={timescale:i,type:a,stsd:o},t[a]=Bt({timescale:i,id:r},o)):t[r]={timescale:i,type:e,stsd:o}}}}}return br(e,["moov","mvex","trex"]).forEach(e=>{const r=Tr(e,4),n=t[r];n&&(n.default={duration:Tr(e,12),flags:Tr(e,20)})}),t}function Rr(e){const t=e.subarray(8),r=t.subarray(86),n=yr(t.subarray(4,8));let i,a=n;const s="enca"===n||"encv"===n;if(s){const e=br(t,[n])[0];br(e.subarray("enca"===n?28:78),["sinf"]).forEach(e=>{const t=br(e,["schm"])[0];if(t){const r=yr(t.subarray(4,8));if("cbcs"===r||"cenc"===r){const t=br(e,["frma"])[0];t&&(a=yr(t))}}})}const o=a;switch(a){case"avc1":case"avc2":case"avc3":case"avc4":{const e=br(r,["avcC"])[0];e&&e.length>3&&(a+="."+Lr(e[1])+Lr(e[2])+Lr(e[3]),i=wr("avc1"===o?"dva1":"dvav",r));break}case"mp4a":{const e=br(t,[n])[0],r=br(e.subarray(28),["esds"])[0];if(r&&r.length>7){let e=4;if(3!==r[e++])break;e=Dr(r,e),e+=2;const t=r[e++];if(128&t&&(e+=2),64&t&&(e+=r[e++]),4!==r[e++])break;e=Dr(r,e);const n=r[e++];if(64!==n)break;if(a+="."+Lr(n),e+=12,5!==r[e++])break;e=Dr(r,e);const i=r[e++];let s=(248&i)>>3;31===s&&(s+=1+((7&i)<<3)+((224&r[e])>>5)),a+="."+s}break}case"hvc1":case"hev1":{const e=br(r,["hvcC"])[0];if(e&&e.length>12){const t=e[1],r=["","A","B","C"][t>>6],n=31&t,i=Tr(e,2),s=(32&t)>>5?"H":"L",o=e[12],l=e.subarray(6,12);a+="."+r+n,a+="."+function(e){let t=0;for(let r=0;r<32;r++)t|=(e>>r&1)<<31-r;return t>>>0}(i).toString(16).toUpperCase(),a+="."+s+o;let u="";for(let e=l.length;e--;){const t=l[e];if(t||u){u="."+t.toString(16).toUpperCase()+u}}a+=u}i=wr("hev1"==o?"dvhe":"dvh1",r);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":a=wr(a,r)||a;break;case"vp09":{const e=br(r,["vpcC"])[0];if(e&&e.length>6){const t=e[4],r=e[5],n=e[6]>>4&15;a+="."+Cr(t)+"."+Cr(r)+"."+Cr(n)}break}case"av01":{const e=br(r,["av1C"])[0];if(e&&e.length>2){const t=e[1]>>>5,n=31&e[1],s=e[2]>>>7?"H":"M",o=(64&e[2])>>6,l=(32&e[2])>>5,u=2===t&&o?l?12:10:o?10:8,c=(16&e[2])>>4,d=(8&e[2])>>3,f=(4&e[2])>>2,h=3&e[2],g=1,p=1,m=1,v=0;a+="."+t+"."+Cr(n)+s+"."+Cr(u)+"."+c+"."+d+f+h+"."+Cr(g)+"."+Cr(p)+"."+Cr(m)+"."+v,i=wr("dav1",r)}break}}return{codec:a,encrypted:s,supplemental:i}}function wr(e,t){const r=br(t,["dvvC"]),n=r.length?r[0]:br(t,["dvcC"])[0];if(n){const t=n[2]>>1&127,r=n[2]<<5&32|n[3]>>3&31;return e+"."+Cr(t)+"."+Cr(r)}}function Dr(e,t){const r=t+5;for(;128&e[t++]&&t<r;);return t}function Lr(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function Cr(e){return(e<10?"0":"")+e}function Nr(e,t){br(e,["moov","trak"]).forEach(e=>{const r=br(e,["mdia","minf","stbl","stsd"])[0];if(!r)return;const n=r.subarray(8);let i=br(n,["enca"]);const a=i.length>0;a||(i=br(n,["encv"])),i.forEach(e=>{br(a?e.subarray(28):e.subarray(78),["sinf"]).forEach(e=>{const r=Pr(e);r&&t(r,a)})})})}function Pr(e){const t=br(e,["schm"])[0];if(t){const r=yr(t.subarray(4,8));if("cbcs"===r||"cenc"===r){const t=br(e,["schi","tenc"])[0];if(t)return t}}}function Or(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function Mr(e,t){const r=[],n=t.samples,i=t.timescale,a=t.id;let s=!1;return br(n,["moof"]).map(o=>{const l=o.byteOffset-8;br(o,["traf"]).map(o=>{const u=br(o,["tfdt"]).map(e=>{const t=e[0];let r=Tr(e,4);return 1===t&&(r*=Math.pow(2,32),r+=Tr(e,8)),r/i})[0];return void 0!==u&&(e=u),br(o,["tfhd"]).map(u=>{const c=Tr(u,4),d=16777215&Tr(u,0);let f=0;const h=!!(16&d);let g=0;const p=!!(32&d);let m=8;c===a&&(!!(1&d)&&(m+=8),!!(2&d)&&(m+=4),!!(8&d)&&(f=Tr(u,m),m+=4),h&&(g=Tr(u,m),m+=4),p&&(m+=4),"video"===t.type&&(s=kr(t.codec)),br(o,["trun"]).map(a=>{const o=a[0],u=16777215&Tr(a,0),c=!!(1&u);let d=0;const h=!!(4&u),p=!!(256&u);let m=0;const v=!!(512&u);let y=0;const E=!!(1024&u),T=!!(2048&u);let _=0;const S=Tr(a,4);let b=8;c&&(d=Tr(a,b),b+=4),h&&(b+=4);let A=d+l;for(let l=0;l<S;l++){if(p?(m=Tr(a,b),b+=4):m=f,v?(y=Tr(a,b),b+=4):y=g,E&&(b+=4),T&&(_=0===o?Tr(a,b):Sr(a,b),b+=4),t.type===lr){let t=0;for(;t<y;){const a=Tr(n,A);if(A+=4,xr(s,n[A])){Fr(n.subarray(A,A+a),s?2:1,e+_/i,r)}A+=a,t+=a+4}}e+=m/i}}))})})}),r}function kr(e){if(!e)return!1;const t=e.substring(0,4);return"hvc1"===t||"hev1"===t||"dvh1"===t||"dvhe"===t}function xr(e,t){if(e){const e=t>>1&63;return 39===e||40===e}return 6===(31&t)}function Fr(e,t,r,n){const i=Br(e);let a=0;a+=t;let s=0,o=0,l=0;for(;a<i.length;){s=0;do{if(a>=i.length)break;l=i[a++],s+=l}while(255===l);o=0;do{if(a>=i.length)break;l=i[a++],o+=l}while(255===l);const e=i.length-a;let t=a;if(o<e)a+=o;else if(o>e){Kt.error(`Malformed SEI payload. ${o} is too small, only ${e} bytes left to parse.`);break}if(4===s){if(181===i[t++]){const e=Er(i,t);if(t+=2,49===e){const e=Tr(i,t);if(t+=4,1195456820===e){const e=i[t++];if(3===e){const a=i[t++],o=64&a,l=o?2+3*(31&a):0,u=new Uint8Array(l);if(o){u[0]=a;for(let e=1;e<l;e++)u[e]=i[t++]}n.push({type:e,payloadType:s,pts:r,bytes:u})}}}}}else if(5===s&&o>16){const e=[];for(let r=0;r<16;r++){const n=i[t++].toString(16);e.push(1==n.length?"0"+n:n),3!==r&&5!==r&&7!==r&&9!==r||e.push("-")}const a=o-16,l=new Uint8Array(a);for(let e=0;e<a;e++)l[e]=i[t++];n.push({payloadType:s,pts:r,uuid:e.join(""),userData:jt(l),userDataBytes:l})}}}function Br(e){const t=e.byteLength,r=[];let n=1;for(;n<t-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(r.push(n+2),n+=2):n++;if(0===r.length)return e;const i=t-r.length,a=new Uint8Array(i);let s=0;for(n=0;n<i;s++,n++)s===r[0]&&(s++,r.shift()),a[n]=e[s];return a}function Ur(e,t,r){if(16!==e.byteLength)throw new RangeError("Invalid system id");let n,i,a;n=0,i=new Uint8Array,a=new Uint8Array;const s=new Uint8Array(4);return r.byteLength>0&&new DataView(s.buffer).setUint32(0,r.byteLength,!1),function(e,...t){const r=t.length;let n=8,i=r;for(;i--;)n+=t[i].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=255&n,a.set(e,4),i=0,n=8;i<r;i++)a.set(t[i],n),n+=t[i].byteLength;return a}([112,115,115,104],new Uint8Array([0,0,0,0]),e,a,i,s,r)}function Zr(e){const t=e.getUint32(0),r=e.byteOffset,n=e.byteLength;if(n<t)return{offset:r,size:n};if(1886614376!==e.getUint32(4))return{offset:r,size:t};const i=e.getUint32(8)>>>24;if(0!==i&&1!==i)return{offset:r,size:t};const a=e.buffer,s=zt(new Uint8Array(a,r+12,16));let o=null,l=null,u=0;if(0===i)u=28;else{const i=e.getUint32(28);if(!i||n<32+16*i)return{offset:r,size:t};o=[];for(let e=0;e<i;e++)o.push(new Uint8Array(a,r+32+16*e,16));u=32+16*i}if(!u)return{offset:r,size:t};const c=e.getUint32(u);return t-32<c?{offset:r,size:t}:(l=new Uint8Array(a,r+u+4,c),{version:i,systemId:s,kids:o,data:l,offset:r,size:t})}const Gr=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Hr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function $r(e,t){const r=Hr[t];return!!r&&!!r[e.slice(0,4)]}function Vr(e,t,r=!0){return!e.split(",").some(e=>!Kr(e,t,r))}function Kr(e,t,r=!0){var n;const i=qt(r);return null!=(n=null==i?void 0:i.isTypeSupported(qr(e,t)))&&n}function qr(e,t){return`${t}/mp4;codecs=${e}`}function Yr(e){if(e){const t=e.substring(0,4);return Hr.video[t]}return 2}function jr(e){const t=Gr();return e.split(",").reduce((e,r)=>{const n=t&&kr(r)?9:Hr.video[r];return n?(2*n+e)/(e?3:2):(Hr.audio[r]+e)/(e?2:1)},0)}const zr={};const Wr=/flac|opus|mp4a\.40\.34/i;function Xr(e,t=!0){return e.replace(Wr,e=>function(e,t=!0){if(zr[e])return zr[e];const r={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[e];for(let i=0;i<r.length;i++){var n;if(Kr(r[i],"audio",t))return zr[e]=r[i],r[i];if("mp3"===r[i]&&null!=(n=qt(t))&&n.isTypeSupported("audio/mpeg"))return""}return e}(e.toLowerCase(),t))}function Qr(e,t){if(e&&(e.length>4||-1!==["ac-3","ec-3","alac","fLaC","Opus"].indexOf(e))&&(Jr(e,"audio")||Jr(e,"video")))return e;if(t){const r=t.split(",");if(r.length>1){if(e)for(let t=r.length;t--;)if(r[t].substring(0,4)===e.substring(0,4))return r[t];return r[0]}}return t||e}function Jr(e,t){return $r(e,t)&&Kr(e,t)}function en(e){if(e.startsWith("av01.")){const t=e.split("."),r=["0","111","01","01","01","0"];for(let e=t.length;e>4&&e<10;e++)t[e]=r[e-4];return t.join(".")}return e}function tn(e){const t=qt(e)||{isTypeSupported:()=>!1};return{mpeg:t.isTypeSupported("audio/mpeg"),mp3:t.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:t.isTypeSupported('audio/mp4; codecs="ac-3"')}}function rn(e){return e.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const nn={supported:!1,smooth:!1,powerEfficient:!1},an={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function sn(e,t){return{supported:!1,configurations:t,decodingInfoResults:[nn],error:e}}function on(e,t,r,n,i,a){const s=e.videoCodec,o=e.audioCodec?e.audioGroups:null,l=null==a?void 0:a.audioCodec,u=null==a?void 0:a.channels,c=u?parseInt(u):l?1/0:2;let d=null;if(null!=o&&o.length)try{d=1===o.length&&o[0]?t.groups[o[0]].channels:o.reduce((e,r)=>{if(r){const n=t.groups[r];if(!n)throw new Error(`Audio track group ${r} not found`);Object.keys(n.channels).forEach(t=>{e[t]=(e[t]||0)+n.channels[t]})}return e},{2:0})}catch(e){return!0}return void 0!==s&&(s.split(",").some(e=>kr(e))||e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(n,30)||"SDR"!==e.videoRange&&e.videoRange!==r||e.bitrate>Math.max(i,8e6))||!!d&&Tt(c)&&Object.keys(d).some(e=>parseInt(e)>c)}function ln(e,t,r,n={}){const i=e.videoCodec;if(!i&&!e.audioCodec||!r)return Promise.resolve(an);const a=[],s=function(e){var t;const r=null==(t=e.videoCodec)?void 0:t.split(","),n=cn(e),i=e.width||640,a=e.height||480,s=e.frameRate||30,o=e.videoRange.toLowerCase();return r?r.map(e=>{const t={contentType:qr(en(e),"video"),width:i,height:a,bitrate:n,framerate:s};return"sdr"!==o&&(t.transferFunction=o),t}):[]}(e),o=s.length,l=function(e,t,r){var n;const i=null==(n=e.audioCodec)?void 0:n.split(","),a=cn(e);if(i&&e.audioGroups)return e.audioGroups.reduce((e,n)=>{var s;const o=n?null==(s=t.groups[n])?void 0:s.tracks:null;return o?o.reduce((e,t)=>{if(t.groupId===n){const n=parseFloat(t.channels||"");i.forEach(t=>{const i={contentType:qr(t,"audio"),bitrate:r?un(t,a):a};n&&(i.channels=""+n),e.push(i)})}return e},e):e},[]);return[]}(e,t,o>0),u=l.length;for(let e=o||1*u||1;e--;){const t={type:"media-source"};if(o&&(t.video=s[e%o]),u){t.audio=l[e%u];const r=t.audio.bitrate;t.video&&r&&(t.video.bitrate-=r)}a.push(t)}if(i){const e=navigator.userAgent;if(i.split(",").some(e=>kr(e))&&Gr())return Promise.resolve(sn(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${e})`),a))}return Promise.all(a.map(e=>{const t=function(e){let t="";const{audio:r,video:n}=e;if(n){t+=`${rn(n.contentType)}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(r){t+=`${n?"_":""}${rn(r.contentType)}_c${r.channels}`}return t}(e);return n[t]||(n[t]=r.decodingInfo(e))})).then(e=>({supported:!e.some(e=>!e.supported),configurations:a,decodingInfoResults:e})).catch(e=>({supported:!1,configurations:a,decodingInfoResults:[],error:e}))}function un(e,t){if(t<=1)return 1;let r=128e3;return"ec-3"===e?r=768e3:"ac-3"===e&&(r=64e4),Math.min(t/2,r)}function cn(e){return 1e3*Math.ceil(Math.max(.9*e.bitrate,e.averageBitrate)/1e3)||1}const dn=["NONE","TYPE-0","TYPE-1",null];const fn=["SDR","PQ","HLG"];var hn="",gn="YES",pn="v2";function mn(e){const{canSkipUntil:t,canSkipDateRanges:r,age:n}=e;return t&&n<t/2?r?pn:gn:hn}class vn{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){const t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class yn{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const r=null==(t=e.supplemental)?void 0:t.videoCodec;r&&r!==e.videoCodec&&(this.codecSet+=`,${r.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return En(this._audioGroups,e)}hasSubtitleGroup(e){return En(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t)if("audio"===e){let e=this._audioGroups;e||(e=this._audioGroups=[]),-1===e.indexOf(t)&&e.push(t)}else if("text"===e){let e=this._subtitleGroups;e||(e=this._subtitleGroups=[]),-1===e.indexOf(t)&&e.push(t)}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return null==(e=this.audioGroups)?void 0:e[0]}get textGroupId(){var e;return null==(e=this.subtitleGroups)?void 0:e[0]}addFallback(){}}function En(e,t){return!(!t||!e)&&-1!==e.indexOf(t)}function Tn(e,t){let r=!1,n=[];if(e&&(r="SDR"!==e,n=[e]),t){n=t.allowedVideoRanges||fn.slice(0);const e="SDR"!==n.join("")&&!t.videoCodec;r=void 0!==t.preferHDR?t.preferHDR:e&&function(){if("function"==typeof matchMedia){const e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return!0===e.matches}return!1}(),r||(n=["SDR"])}return{preferHDR:r,allowedVideoRanges:n}}const _n=(e,t)=>JSON.stringify(e,(e=>{const t=new WeakSet;return(r,n)=>{if(e&&(n=e(r,n)),"object"==typeof n&&null!==n){if(t.has(n))return;t.add(n)}return n}})(t));function Sn(e,t){Kt.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function bn(e){return e.reduce((e,t)=>{let r=e.groups[t.groupId];r||(r=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),r.tracks.push(t);const n=t.channels||"2";return r.channels[n]=(r.channels[n]||0)+1,r.hasDefault=r.hasDefault||t.default,r.hasAutoSelect=r.hasAutoSelect||t.autoselect,r.hasDefault&&(e.hasDefaultAudio=!0),r.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function An(e){if(!e)return e;const{lang:t,assocLang:r,characteristics:n,channels:i,audioCodec:a}=e;return{lang:t,assocLang:r,characteristics:n,channels:i,audioCodec:a}}function In(e,t,r){if("attrs"in e){const r=t.indexOf(e);if(-1!==r)return r}for(let n=0;n<t.length;n++){if(Rn(e,t[n],r))return n}return-1}function Rn(e,t,r){const{groupId:n,name:i,lang:a,assocLang:s,default:o}=e,l=e.forced;return(void 0===n||t.groupId===n)&&(void 0===i||t.name===i)&&(void 0===a||function(e,t="--"){if(e.length===t.length)return e===t;return e.startsWith(t)||t.startsWith(e)}(a,t.lang))&&(void 0===a||t.assocLang===s)&&(void 0===o||t.default===o)&&(void 0===l||t.forced===l)&&(!("characteristics"in e)||function(e,t=""){const r=e.split(","),n=t.split(",");return r.length===n.length&&!r.some(e=>-1===n.indexOf(e))}(e.characteristics||"",t.characteristics))&&(void 0===r||r(e,t))}function wn(e,t){const{audioCodec:r,channels:n}=e;return!(void 0!==r&&(t.audioCodec||"").substring(0,4)!==r.substring(0,4)||void 0!==n&&n!==(t.channels||"2"))}function Dn(e,t,r){for(let n=t;n>-1;n--)if(r(e[n]))return n;for(let n=t+1;n<e.length;n++)if(r(e[n]))return n;return-1}function Ln(e,t){var r;return!!e&&e!==(null==(r=t.loadLevelObj)?void 0:r.uri)}const Cn=function(e,t){let r=0,n=e.length-1,i=null,a=null;for(;r<=n;){i=(r+n)/2|0,a=e[i];const s=t(a);if(s>0)r=i+1;else{if(!(s<0))return a;n=i-1}}return null};function Nn(e,t,r=0,n=0,i=.005){let a=null;if(e){a=t[1+e.sn-t[0].sn]||null;const n=e.endDTS-r;n>0&&n<15e-7&&(r+=15e-7),a&&e.level!==a.level&&a.end<=e.end&&(a=t[2+e.sn-t[0].sn]||null)}else 0===r&&0===t[0].start&&(a=t[0]);if(a&&((!e||e.level===a.level)&&0===Pn(r,n,a)||function(e,t,r){if(t&&0===t.start&&t.level<e.level&&(t.endPTS||0)>0){const n=t.tagList.reduce((e,t)=>("INF"===t[0]&&(e+=parseFloat(t[1])),e),r);return e.start<=n}return!1}(a,e,Math.min(i,n))))return a;const s=Cn(t,Pn.bind(null,r,n));return!s||s===e&&a?a:s}function Pn(e=0,t=0,r){if(r.start<=e&&r.start+r.duration>e)return 0;const n=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-n<=e?1:r.start-n>e&&r.start?-1:0}function On(e,t,r){const n=1e3*Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return(r.endProgramDateTime||0)-n>e}function Mn(e,t,r){if(e&&e.startCC<=t&&e.endCC>=t){let n=e.fragments;const{fragmentHint:i}=e;let a;return i&&(n=n.concat(i)),Cn(n,e=>e.cc<t?1:e.cc>t?-1:(a=e,e.end<=r?1:e.start>r?-1:0)),a||null}return null}function kn(e){switch(e.details){case At.FRAG_LOAD_TIMEOUT:case At.KEY_LOAD_TIMEOUT:case At.LEVEL_LOAD_TIMEOUT:case At.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function xn(e){return e.details.startsWith("key")}function Fn(e){return xn(e)&&!!e.frag&&!e.frag.decryptdata}function Bn(e,t){const r=kn(t);return e.default[(r?"timeout":"error")+"Retry"]}function Un(e,t){const r="linear"===e.backoff?1:Math.pow(2,t);return Math.min(r*e.retryDelayMs,e.maxRetryDelayMs)}function Zn(e){return Bt(Bt({},e),{errorRetry:null,timeoutRetry:null})}function Gn(e,t,r,n){if(!e)return!1;const i=null==n?void 0:n.code,a=t<e.maxNumRetry&&(function(e){return Hn(e)||!!e&&(e<400||e>499)}(i)||!!r);return e.shouldRetry?e.shouldRetry(e,t,r,n,a):a}function Hn(e){return 0===e&&!1===navigator.onLine}var $n=0,Vn=2,Kn=3,qn=5,Yn=0,jn=1,zn=2,Wn=4;function Xn(e){const t={action:$n,flags:Yn};return e&&(t.resolved=!0),t}var Qn="NOT_LOADED",Jn="APPENDING",ei="PARTIAL",ti="OK";class ri{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.BUFFER_APPENDED,this.onBufferAppended,this),e.on(It.FRAG_BUFFERED,this.onFragBuffered,this),e.on(It.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.BUFFER_APPENDED,this.onBufferAppended,this),e.off(It.FRAG_BUFFERED,this.onFragBuffered,this),e.off(It.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const r=this.activePartLists[t];if(r)for(let t=r.length;t--;){const n=r[t];if(!n)break;if(n.start<=e&&e<=n.end&&n.loaded)return n}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,r){const{fragments:n}=this,i=Object.keys(n);for(let a=i.length;a--;){const s=n[i[a]];if((null==s?void 0:s.body.type)===t&&(!r||s.buffered)){const t=s.body;if(t.start<=e&&e<=t.end)return t}}return null}detectEvictedFragments(e,t,r,n,i){this.timeRanges&&(this.timeRanges[e]=t);const a=(null==n?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach(n=>{const s=this.fragments[n];if(!s)return;if(a>=s.body.sn)return;if(!s.buffered&&(!s.loaded||i))return void(s.body.type===r&&this.removeFragment(s.body));const o=s.range[e];o&&(0!==o.time.length?o.time.some(e=>{const r=!this.isTimeBuffered(e.startPTS,e.endPTS,t);return r&&this.removeFragment(s.body),r}):this.removeFragment(s.body))})}detectPartialFragments(e){const t=this.timeRanges;if(!t||"initSegment"===e.frag.sn)return;const r=e.frag,n=ii(r),i=this.fragments[n];if(!i||i.buffered&&r.gap)return;const a=!r.relurl;if(Object.keys(t).forEach(n=>{const s=r.elementaryStreams[n];if(!s)return;const o=t[n],l=a||!0===s.partial;i.range[n]=this.getBufferedTimes(r,e.part,l,o)}),i.loaded=null,Object.keys(i.range).length){i.buffered=!0;(i.body.endList=r.endList||i.body.endList)&&(this.endListFragments[i.body.type]=i),ni(i)||this.removeParts(r.sn-1,r.type)}else this.removeFragment(i.body)}removeParts(e,t){const r=this.activePartLists[t];r&&(this.activePartLists[t]=ai(r,t=>t.fragment.sn>=e))}fragBuffered(e,t){const r=ii(e);let n=this.fragments[r];!n&&t&&(n=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)}getBufferedTimes(e,t,r,n){const i={time:[],partial:r},a=e.start,s=e.end,o=e.minEndPTS||s,l=e.maxStartPTS||a;for(let e=0;e<n.length;e++){const t=n.start(e)-this.bufferPadding,r=n.end(e)+this.bufferPadding;if(l>=t&&o<=r){i.time.push({startPTS:Math.max(a,n.start(e)),endPTS:Math.min(s,n.end(e))});break}if(a<r&&s>t){const t=Math.max(a,n.start(e)),r=Math.min(s,n.end(e));r>t&&(i.partial=!0,i.time.push({startPTS:t,endPTS:r}))}else if(s<=t)break}return i}getPartialFragment(e){let t,r,n,i=null,a=0;const{bufferPadding:s,fragments:o}=this;return Object.keys(o).forEach(l=>{const u=o[l];u&&ni(u)&&(r=u.body.start-s,n=u.body.end+s,e>=r&&e<=n&&(t=Math.min(e-r,n-e),a<=t&&(i=u.body,a=t)))}),i}isEndListAppended(e){const t=this.endListFragments[e];return void 0!==t&&(t.buffered||ni(t))}getState(e){const t=ii(e),r=this.fragments[t];return r?r.buffered?ni(r)?ei:ti:Jn:Qn}isTimeBuffered(e,t,r){let n,i;for(let a=0;a<r.length;a++){if(n=r.start(a)-this.bufferPadding,i=r.end(a)+this.bufferPadding,e>=n&&t<=i)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if("initSegment"===t.frag.sn||t.frag.bitrateTest)return;const r=t.frag,n=t.part?null:t,i=ii(r);this.fragments[i]={body:r,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:r,part:n,timeRanges:i,type:a}=t;if("initSegment"===r.sn)return;const s=r.type;if(n){let e=this.activePartLists[s];e||(this.activePartLists[s]=e=[]),e.push(n)}this.timeRanges=i;const o=i[a];this.detectEvictedFragments(a,o,s,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=ii(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,r=Object.keys(t);if(!e)return r.length>0;for(let n=r.length;n--;){const i=t[r[n]];if((null==i?void 0:i.body.type)===e)return!0}return!1}hasParts(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)}removeFragmentsInRange(e,t,r,n,i){n&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const s=this.fragments[a];if(!s)return;const o=s.body;o.type!==r||n&&!o.gap||o.start<t&&o.end>e&&(s.buffered||i)&&this.removeFragment(o)})}removeFragment(e){const t=ii(e);e.clearElementaryStreamInfo();const r=this.activePartLists[e.type];if(r){const t=e.sn;this.activePartLists[e.type]=ai(r,e=>e.fragment.sn!==t)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=null==(e=this.hls)||null==(e=e.latestLevelDetails)?void 0:e.partList;t&&t.forEach(e=>e.clearElementaryStreamInfo())}}function ni(e){var t,r,n;return e.buffered&&!!(e.body.gap||null!=(t=e.range.video)&&t.partial||null!=(r=e.range.audio)&&r.partial||null!=(n=e.range.audiovideo)&&n.partial)}function ii(e){return`${e.type}_${e.level}_${e.sn}`}function ai(e,t){return e.filter(e=>{const r=t(e);return r||e.clearElementaryStreamInfo(),r})}var si=0,oi=1;class li{constructor(e,t,r){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=r}decrypt(e,t){switch(this.aesMode){case si:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case oi:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}class ui{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),r=new Uint32Array(4);for(let e=0;e<4;e++)r[e]=t.getUint32(4*e);return r}initTable(){const e=this.sBox,t=this.invSBox,r=this.subMix,n=r[0],i=r[1],a=r[2],s=r[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],d=o[3],f=new Uint32Array(256);let h=0,g=0,p=0;for(p=0;p<256;p++)f[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){let r=g^g<<1^g<<2^g<<3^g<<4;r=r>>>8^255&r^99,e[h]=r,t[r]=h;const o=f[h],p=f[o],m=f[p];let v=257*f[r]^16843008*r;n[h]=v<<24|v>>>8,i[h]=v<<16|v>>>16,a[h]=v<<8|v>>>24,s[h]=v,v=16843009*m^65537*p^257*o^16843008*h,l[r]=v<<24|v>>>8,u[r]=v<<16|v>>>16,c[r]=v<<8|v>>>24,d[r]=v,h?(h=o^f[f[f[m^o]]],g^=f[f[g]]):h=g=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let r=!0,n=0;for(;n<t.length&&r;)r=t[n]===this.key[n],n++;if(r)return;this.key=t;const i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);const a=this.ksRows=4*(i+6+1);let s,o;const l=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),c=this.sBox,d=this.rcon,f=this.invSubMix,h=f[0],g=f[1],p=f[2],m=f[3];let v,y;for(s=0;s<a;s++)s<i?v=l[s]=t[s]:(y=v,s%i===0?(y=y<<8|y>>>24,y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y],y^=d[s/i|0]<<24):i>6&&s%i===4&&(y=c[y>>>24]<<24|c[y>>>16&255]<<16|c[y>>>8&255]<<8|c[255&y]),l[s]=v=(l[s-i]^y)>>>0);for(o=0;o<a;o++)s=a-o,y=3&o?l[s]:l[s-4],u[o]=o<4||s<=4?y:h[c[y>>>24]]^g[c[y>>>16&255]]^p[c[y>>>8&255]]^m[c[255&y]],u[o]=u[o]>>>0}networkToHostOrderSwap(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}decrypt(e,t,r){const n=this.keySize+6,i=this.invKeySchedule,a=this.invSBox,s=this.invSubMix,o=s[0],l=s[1],u=s[2],c=s[3],d=this.uint8ArrayToUint32Array_(r);let f=d[0],h=d[1],g=d[2],p=d[3];const m=new Int32Array(e),v=new Int32Array(m.length);let y,E,T,_,S,b,A,I,R,w,D,L,C,N;const P=this.networkToHostOrderSwap;for(;t<m.length;){for(R=P(m[t]),w=P(m[t+1]),D=P(m[t+2]),L=P(m[t+3]),S=R^i[0],b=L^i[1],A=D^i[2],I=w^i[3],C=4,N=1;N<n;N++)y=o[S>>>24]^l[b>>16&255]^u[A>>8&255]^c[255&I]^i[C],E=o[b>>>24]^l[A>>16&255]^u[I>>8&255]^c[255&S]^i[C+1],T=o[A>>>24]^l[I>>16&255]^u[S>>8&255]^c[255&b]^i[C+2],_=o[I>>>24]^l[S>>16&255]^u[b>>8&255]^c[255&A]^i[C+3],S=y,b=E,A=T,I=_,C+=4;y=a[S>>>24]<<24^a[b>>16&255]<<16^a[A>>8&255]<<8^a[255&I]^i[C],E=a[b>>>24]<<24^a[A>>16&255]<<16^a[I>>8&255]<<8^a[255&S]^i[C+1],T=a[A>>>24]<<24^a[I>>16&255]<<16^a[S>>8&255]<<8^a[255&b]^i[C+2],_=a[I>>>24]<<24^a[S>>16&255]<<16^a[b>>8&255]<<8^a[255&A]^i[C+3],v[t]=P(y^f),v[t+1]=P(_^h),v[t+2]=P(T^g),v[t+3]=P(E^p),f=R,h=w,g=D,p=L,t+=4}return v.buffer}}class ci{constructor(e,t,r){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=r}expandKey(){const e=function(e){switch(e){case si:return"AES-CBC";case oi:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${e}`)}}(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}class di{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(e){}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?function(e){const t=e.byteLength,r=t&&new DataView(e.buffer).getUint8(t-1);return r?e.slice(0,t-r):e}(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r,n){return this.useSoftware?new Promise((i,a)=>{const s=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(s,t,r,n);const o=this.flush();o?i(o.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r,n)}softwareDecrypt(e,t,r,n){const{currentIV:i,currentResult:a,remainderData:s}=this;if(n!==si||16!==t.byteLength)return Kt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),s&&(e=Or(s,e),this.remainderData=null);const o=this.getValidChunk(e);if(!o.length)return null;i&&(r=i);let l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new ui),l.expandKey(t);const u=a;return this.currentResult=l.decrypt(o.buffer,0,r),this.currentIV=o.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,r,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,r,n));this.key=t,this.fastAesKey=new ci(this.subtle,t,n)}return this.fastAesKey.expandKey().then(t=>{if(!this.subtle)return Promise.reject(new Error("web crypto not initialized"));this.logOnce("WebCrypto AES decrypt");return new li(this.subtle,new Uint8Array(r),n).decrypt(e.buffer,t)}).catch(i=>(Kt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${i.name}: ${i.message}`),this.onWebCryptoError(e,t,r,n)))}onWebCryptoError(e,t,r,n){const i=this.enableSoftwareAES;if(i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r,n);const i=this.flush();if(i)return i.buffer}throw new Error("WebCrypto"+(i?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const r=e.length-e.length%16;return r!==e.length&&(t=e.slice(0,r),this.remainderData=e.slice(r)),t}logOnce(e){this.logEnabled&&(Kt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const fi=Math.pow(2,17);class hi{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const r=e.url;if(!r)return Promise.reject(new mi({type:bt.NETWORK_ERROR,details:At.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(r?"part list":"url")),networkDetails:null}));this.abort();const n=this.config,i=n.fLoader,a=n.loader;return new Promise((s,o)=>{if(this.loader&&this.loader.destroy(),e.gap){if(e.tagList.some(e=>"GAP"===e[0]))return void o(pi(e));e.gap=!1}const l=this.loader=i?new i(n):new a(n),u=gi(e);e.loader=l;const c=Zn(n.fragLoadPolicy.default),d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:fi};e.stats=l.stats;const f={onSuccess:(t,r,n,i)=>{this.resetLoader(e,l);let a=t.data;n.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(a.slice(0,16)),a=a.slice(16)),s({frag:e,part:null,payload:a,networkDetails:i})},onError:(t,n,i,a)=>{this.resetLoader(e,l),o(new mi({type:bt.NETWORK_ERROR,details:At.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Bt({url:r,data:void 0},t),error:new Error(`HTTP Error ${t.code} ${t.text}`),networkDetails:i,stats:a}))},onAbort:(t,r,n)=>{this.resetLoader(e,l),o(new mi({type:bt.NETWORK_ERROR,details:At.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:n,stats:t}))},onTimeout:(t,r,n)=>{this.resetLoader(e,l),o(new mi({type:bt.NETWORK_ERROR,details:At.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:n,stats:t}))}};t&&(f.onProgress=(r,n,i,a)=>t({frag:e,part:null,payload:i,networkDetails:a})),l.load(u,d,f)})}loadPart(e,t,r){this.abort();const n=this.config,i=n.fLoader,a=n.loader;return new Promise((s,o)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap)return void o(pi(e,t));const l=this.loader=i?new i(n):new a(n),u=gi(e,t);e.loader=l;const c=Zn(n.fragLoadPolicy.default),d={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:fi};t.stats=l.stats,l.load(u,d,{onSuccess:(n,i,a,o)=>{this.resetLoader(e,l),this.updateStatsFromPart(e,t);const u={frag:e,part:t,payload:n.data,networkDetails:o};r(u),s(u)},onError:(r,n,i,a)=>{this.resetLoader(e,l),o(new mi({type:bt.NETWORK_ERROR,details:At.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Bt({url:u.url,data:void 0},r),error:new Error(`HTTP Error ${r.code} ${r.text}`),networkDetails:i,stats:a}))},onAbort:(r,n,i)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,l),o(new mi({type:bt.NETWORK_ERROR,details:At.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:i,stats:r}))},onTimeout:(r,n,i)=>{this.resetLoader(e,l),o(new mi({type:bt.NETWORK_ERROR,details:At.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:i,stats:r}))}})})}updateStatsFromPart(e,t){const r=e.stats,n=t.stats,i=n.total;if(r.loaded+=n.loaded,i){const n=Math.round(e.duration/t.duration),a=Math.min(Math.round(r.loaded/i),n),s=(n-a)*Math.round(r.loaded/a);r.total=r.loaded+s}else r.total=Math.max(r.loaded,r.total);const a=r.loading,s=n.loading;a.start?a.first+=s.first-s.start:(a.start=s.start,a.first=s.first),a.end=s.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function gi(e,t=null){const r=t||e,n={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},i=r.byteRangeStartOffset,a=r.byteRangeEndOffset;if(Tt(i)&&Tt(a)){var s;let t=i,r=a;if("initSegment"===e.sn&&("AES-128"===(o=null==(s=e.decryptdata)?void 0:s.method)||"AES-256"===o)){const e=a-i;e%16&&(r=a+(16-e%16)),0!==i&&(n.resetIV=!0,t=i-16)}n.rangeStart=t,n.rangeEnd=r}var o;return n}function pi(e,t){const r=new Error(`GAP ${e.gap?"tag":"attribute"} found`),n={type:bt.MEDIA_ERROR,details:At.FRAG_GAP,fatal:!1,frag:e,error:r,networkDetails:null};return t&&(n.part=t),(t||e).stats.aborted=!0,new mi(n)}class mi extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class vi extends Ut{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)}clearNextTick(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)}tick(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class yi{constructor(e,t,r,n=0,i=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=e,this.sn=t,this.id=r,this.size=n,this.part=i,this.partial=a}}const Ei={length:0,start:()=>0,end:()=>0};class Ti{static isBuffered(e,t){if(e){const r=Ti.getBuffered(e);for(let e=r.length;e--;)if(t>=r.start(e)&&t<=r.end(e))return!0}return!1}static bufferedRanges(e){if(e){const t=Ti.getBuffered(e);return Ti.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}static bufferInfo(e,t,r){if(e){const n=Ti.bufferedRanges(e);if(n.length)return Ti.bufferedInfo(n,t,r)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,r){t=Math.max(0,t),e.length>1&&e.sort((e,t)=>e.start-t.start||t.end-e.end);let n=-1,i=[];if(r)for(let a=0;a<e.length;a++){t>=e[a].start&&t<=e[a].end&&(n=a);const s=i.length;if(s){const t=i[s-1].end;e[a].start-t<r?e[a].end>t&&(i[s-1].end=e[a].end):i.push(e[a])}else i.push(e[a])}else i=e;let a,s=0,o=t,l=t;for(let e=0;e<i.length;e++){const u=i[e].start,c=i[e].end;if(-1===n&&t>=u&&t<=c&&(n=e),t+r>=u&&t<c)o=u,l=c,s=l-t;else if(t+r<u){a=u;break}}return{len:s,start:o||0,end:l||0,nextStart:a,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||Ei}catch(e){return Kt.log("failed to get media.buffered",e),Ei}}}const _i=/\{\$([a-zA-Z0-9-_]+)\}/g;function Si(e){return _i.test(e)}function bi(e,t){if(null!==e.variableList||e.hasVariableRefs){const r=e.variableList;return t.replace(_i,t=>{const n=t.substring(2,t.length-1),i=null==r?void 0:r[n];return void 0===i?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),t):i})}return t}function Ai(e,t,r){let n,i,a=e.variableList;if(a||(e.variableList=a={}),"QUERYPARAM"in t){n=t.QUERYPARAM;try{const e=new self.URL(r).searchParams;if(!e.has(n))throw new Error(`"${n}" does not match any query parameter in URI: "${r}"`);i=e.get(n)}catch(t){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${t.message}`))}}else n=t.NAME,i=t.VALUE;n in a?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):a[n]=i||""}function Ii(e,t,r){const n=t.IMPORT;if(r&&n in r){let t=e.variableList;t||(e.variableList=t={}),t[n]=r[n]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const Ri=/^(\d+)x(\d+)$/,wi=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Di{constructor(e,t){"string"==typeof e&&(e=Di.parseAttrList(e,t)),xt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>"X-"===e.substring(0,2))}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;const r=new Uint8Array(t.length/2);for(let e=0;e<t.length/2;e++)r[e]=parseInt(t.slice(2*e,2*e+2),16);return r}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const r=this[e];return r?parseFloat(r):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const r=this[e];return(r?r.split(/[ ,]+/):[]).reduce((e,t)=>(e[t.toLowerCase()]=!0,e),t)}bool(e){return"YES"===this[e]}decimalResolution(e){const t=Ri.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let r;const n={};for(wi.lastIndex=0;null!==(r=wi.exec(e));){const i=r[1].trim();let a=r[2];const s=0===a.indexOf('"')&&a.lastIndexOf('"')===a.length-1;let o=!1;if(s)a=a.slice(1,-1);else switch(i){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":o=!0}if(t&&(s||o))a=bi(t,a);else if(!o&&!s)switch(i){case"CLOSED-CAPTIONS":if("NONE"===a)break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Kt.warn(`${e}: attribute ${i} is missing quotes`)}n[i]=a}return n}}function Li(e){return"ID"!==e&&"CLASS"!==e&&"CUE"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function Ci(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e||"SCTE35-CMD"===e}class Ni{constructor(e,t,r=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(null==t?void 0:t.tagAnchor)||null,this.tagOrder=null!=(n=null==t?void 0:t.tagOrder)?n:r,t){const r=t.attr;for(const t in r)if(Object.prototype.hasOwnProperty.call(e,t)&&e[t]!==r[t]){Kt.warn(`DATERANGE tag attribute: "${t}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=t;break}e=xt(new Di({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const e=(null==t?void 0:t.endDate)||new Date(this.attr["END-DATE"]);Tt(e.getTime())&&(this._endDate=e)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return void 0===e?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return null===e||null===e.programDateTime?(Kt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return null!==t?this._dateAtEnd=new Date(this._startDate.getTime()+1e3*t):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Tt(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return"com.apple.hls.interstitial"===this.class}get isValid(){return!!this.id&&!this._badValueForSameId&&Tt(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}class Pi{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e)return this.advanced=!0,void(this.updated=!0);const t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||0===t&&r>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let r=t.decryptdata;return r||(t.setKeyFormat(e.keyFormat),r=t.decryptdata),!!r&&e.matches(r)})}get hasProgramDateTime(){return!!this.fragments.length&&Tt(this.fragments[this.fragments.length-1].programDateTime)}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||10}get drift(){const e=this.driftEndTime-this.driftStartTime;if(e>0){return 1e3*(this.driftEnd-this.driftStart)/e}return 1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(-1!==t){for(let r=e.length;r--;)if(e[r].index>t)return e[r].index;return t}}return 0}get lastPartSn(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Oi(e,t){return e.length===t.length&&!e.some((e,r)=>e!==t[r])}function Mi(e,t){return!e&&!t||!(!e||!t)&&Oi(e,t)}function ki(e){return"AES-128"===e||"AES-256"===e||"AES-256-CTR"===e}function xi(e){switch(e){case"AES-128":case"AES-256":return si;case"AES-256-CTR":return oi;default:throw new Error(`invalid full segment method ${e}`)}}function Fi(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}function Bi(e){return Uint8Array.from(unescape(encodeURIComponent(e)),e=>e.charCodeAt(0))}function Ui(e){const t=function(e,t,r){const n=e[t];e[t]=e[r],e[r]=n};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function Zi(e){const t=e.split(":");let r=null;if("data"===t[0]&&2===t.length){const e=t[1].split(";"),n=e[e.length-1].split(",");if(2===n.length){const t="base64"===n[0],i=n[1];t?(e.splice(-1,1),r=Fi(i)):r=function(e){const t=Bi(e).subarray(0,16),r=new Uint8Array(16);return r.set(t,16-t.length),r}(i)}}return r}const Gi="undefined"!=typeof self?self:void 0;var Hi={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},$i="org.w3.clearkey",Vi="com.apple.streamingkeydelivery",Ki="com.microsoft.playready",qi="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";function Yi(e){switch(e){case Vi:return Hi.FAIRPLAY;case Ki:return Hi.PLAYREADY;case qi:return Hi.WIDEVINE;case $i:return Hi.CLEARKEY}}function ji(e){switch(e){case Hi.FAIRPLAY:return Vi;case Hi.PLAYREADY:return Ki;case Hi.WIDEVINE:return qi;case Hi.CLEARKEY:return $i}}function zi(e){const{drmSystems:t,widevineLicenseUrl:r}=e,n=t?[Hi.FAIRPLAY,Hi.WIDEVINE,Hi.PLAYREADY,Hi.CLEARKEY].filter(e=>!!t[e]):[];return!n[Hi.WIDEVINE]&&r&&n.push(Hi.WIDEVINE),n}const Wi=null!=Gi&&null!=(Xi=Gi.navigator)&&Xi.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;var Xi;function Qi(e){const t=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),r=String.fromCharCode.apply(null,Array.from(t)),n=r.substring(r.indexOf("<"),r.length),i=(new DOMParser).parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(i){const e=i.childNodes[0]?i.childNodes[0].nodeValue:i.getAttribute("VALUE");if(e){const t=Fi(e).subarray(0,16);return Ui(t),t}}return null}let Ji={};class ea{static clearKeyUriToKeyIdMap(){Ji={}}static setKeyIdForUri(e,t){Ji[e]=t}constructor(e,t,r,n=[1],i=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=r,this.keyFormatVersions=n,this.iv=i,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&!ki(e),null!=a&&a.startsWith("0x")&&(this.keyId=new Uint8Array(Wt(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Oi(e.keyFormatVersions,this.keyFormatVersions)&&Mi(e.iv,this.iv)&&Mi(e.keyId,this.keyId)}isSupported(){if(this.method){if(ki(this.method)||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method;switch(this.keyFormat){case Vi:case qi:case Ki:case $i:return-1!==["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(ki(this.method)){let t=this.iv;t||("number"!=typeof e&&(Kt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),t=function(e){const t=new Uint8Array(16);for(let r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}(e));return new ea(this.method,this.uri,"identity",this.keyFormatVersions,t)}if(this.keyId){const e=Ji[this.uri];if(e&&!Oi(this.keyId,e)&&ea.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const r=Zi(this.uri);if(r)switch(this.keyFormat){case qi:if(this.pssh=r,!this.keyId){const e=function(e){const t=[];if(e instanceof ArrayBuffer){const r=e.byteLength;let n=0;for(;n+32<r;){const r=Zr(new DataView(e,n));t.push(r),n+=r.size}}return t}(r.buffer);if(e.length){var n;const t=e[0];this.keyId=null!=(n=t.kids)&&n.length?t.kids[0]:null}}this.keyId||(this.keyId=ta(t));break;case Ki:{const e=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=Ur(e,0,r),this.keyId=Qi(r);break}default:{let e=r.subarray(0,16);if(16!==e.length){const t=new Uint8Array(16);t.set(e,16-e.length),e=t}this.keyId=e;break}}if(!this.keyId||16!==this.keyId.byteLength){let e;e=function(e){const t=null==e?void 0:e[qi];if(t)return t.keyId;return null}(t),e||(e=ta(t),e||(e=Ji[this.uri])),e&&(this.keyId=e,ea.setKeyIdForUri(this.uri,e))}return this}}function ta(e){const t=null==e?void 0:e[Ki];if(t){const e=Zi(t.uri);if(e)return Qi(e)}return null}const ra=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,na=/#EXT-X-MEDIA:(.*)/g,ia=/^#EXT(?:INF|-X-TARGETDURATION):/m,aa=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),sa=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class oa{static findGroup(e,t){for(let r=0;r<e.length;r++){const n=e[r];if(n.id===t)return n}}static resolve(e,t){return ar.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return ia.test(e)}static parseMasterPlaylist(e,t){const r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:Si(e)},n=[];if(ra.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let i;for(;null!=(i=ra.exec(e));)if(i[1]){var a;const e=new Di(i[1],r),s=bi(r,i[2]),o={attrs:e,bitrate:e.decimalInteger("BANDWIDTH")||e.decimalInteger("AVERAGE-BANDWIDTH"),name:e.NAME,url:oa.resolve(s,t)},l=e.decimalResolution("RESOLUTION");l&&(o.width=l.width,o.height=l.height),fa(e.CODECS,o);const u=e["SUPPLEMENTAL-CODECS"];u&&(o.supplemental={},fa(u,o.supplemental)),null!=(a=o.unknownCodecs)&&a.length||n.push(o),r.levels.push(o)}else if(i[3]){const e=i[3],n=i[4];switch(e){case"SESSION-DATA":{const e=new Di(n,r),t=e["DATA-ID"];t&&(null===r.sessionData&&(r.sessionData={}),r.sessionData[t]=e);break}case"SESSION-KEY":{const e=ca(n,t,r);e.encrypted&&e.isSupported()?(null===r.sessionKeys&&(r.sessionKeys=[]),r.sessionKeys.push(e)):Kt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${n}"`);break}case"DEFINE":Ai(r,new Di(n,r),t);break;case"CONTENT-STEERING":{const e=new Di(n,r);r.contentSteering={uri:oa.resolve(e["SERVER-URI"],t),pathwayId:e["PATHWAY-ID"]||"."};break}case"START":r.startTimeOffset=da(n)}}const s=n.length>0&&n.length<r.levels.length;return r.levels=s?n:r.levels,0===r.levels.length&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,r){let n;const i={},a=r.levels,s={AUDIO:a.map(e=>({id:e.attrs.AUDIO,audioCodec:e.audioCodec})),SUBTITLES:a.map(e=>({id:e.attrs.SUBTITLES,textCodec:e.textCodec})),"CLOSED-CAPTIONS":[]};let o=0;for(na.lastIndex=0;null!==(n=na.exec(e));){const e=new Di(n[1],r),a=e.TYPE;if(a){const r=s[a],n=i[a]||[];i[a]=n;const l=e.LANGUAGE,u=e["ASSOC-LANGUAGE"],c=e.CHANNELS,d=e.CHARACTERISTICS,f=e["INSTREAM-ID"],h={attrs:e,bitrate:0,id:o++,groupId:e["GROUP-ID"]||"",name:e.NAME||l||"",type:a,default:e.bool("DEFAULT"),autoselect:e.bool("AUTOSELECT"),forced:e.bool("FORCED"),lang:l,url:e.URI?oa.resolve(e.URI,t):""};if(u&&(h.assocLang=u),c&&(h.channels=c),d&&(h.characteristics=d),f&&(h.instreamId=f),null!=r&&r.length){const e=oa.findGroup(r,h.groupId)||r[0];ha(h,e,"audioCodec"),ha(h,e,"textCodec")}n.push(h)}}return i}static parseLevelPlaylist(e,t,r,n,i,a){var s;const o={url:t},l=new Pi(t),u=l.fragments,c=[];let d,f,h,g,p=null,m=0,v=0,y=0,E=0,T=0,_=null,S=new fr(n,o),b=-1,A=!1,I=null;if(aa.lastIndex=0,l.m3u8=e,l.hasVariableRefs=Si(e),"#EXTM3U"!==(null==(s=aa.exec(e))?void 0:s[0]))return l.playlistParsingError=new Error("Missing format identifier #EXTM3U"),l;for(;null!==(d=aa.exec(e));){A&&(A=!1,S=new fr(n,o),S.playlistOffset=y,S.setStart(y),S.sn=m,S.cc=E,T&&(S.bitrate=T),S.level=r,p&&(S.initSegment=p,p.rawProgramDateTime&&(S.rawProgramDateTime=p.rawProgramDateTime,p.rawProgramDateTime=null),I&&(S.setByteRange(I),I=null)));const e=d[1];if(e){S.duration=parseFloat(e);const t=(" "+d[2]).slice(1);S.title=t||null,S.tagList.push(t?["INF",e,t]:["INF",e])}else if(d[3]){if(Tt(S.duration)){S.playlistOffset=y,S.setStart(y),h&&ma(S,h,l),S.sn=m,S.level=r,S.cc=E,u.push(S);const e=(" "+d[3]).slice(1);S.relurl=bi(l,e),ga(S,_,c),_=S,y+=S.duration,m++,v=0,A=!0}}else{if(d=d[0].match(sa),!d){Kt.warn("No matches on slow regex match for level playlist!");continue}for(f=1;f<d.length&&void 0===d[f];f++);const e=(" "+d[f]).slice(1),i=(" "+d[f+1]).slice(1),s=d[f+2]?(" "+d[f+2]).slice(1):null;switch(e){case"BYTERANGE":_?S.setByteRange(i,_):S.setByteRange(i);break;case"PROGRAM-DATE-TIME":S.rawProgramDateTime=i,S.tagList.push(["PROGRAM-DATE-TIME",i]),-1===b&&(b=u.length);break;case"PLAYLIST-TYPE":l.type&&va(l,e,d),l.type=i.toUpperCase();break;case"MEDIA-SEQUENCE":0!==l.startSN?va(l,e,d):u.length>0&&ya(l,e,d),m=l.startSN=parseInt(i);break;case"SKIP":{l.skippedSegments&&va(l,e,d);const t=new Di(i,l),r=t.decimalInteger("SKIPPED-SEGMENTS");if(Tt(r)){l.skippedSegments+=r;for(let e=r;e--;)u.push(null);m+=r}const n=t.enumeratedString("RECENTLY-REMOVED-DATERANGES");n&&(l.recentlyRemovedDateranges=(l.recentlyRemovedDateranges||[]).concat(n.split("\t")));break}case"TARGETDURATION":0!==l.targetduration&&va(l,e,d),l.targetduration=Math.max(parseInt(i),1);break;case"VERSION":null!==l.version&&va(l,e,d),l.version=parseInt(i);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":l.live||va(l,e,d),l.live=!1;break;case"#":(i||s)&&S.tagList.push(s?[i,s]:[i]);break;case"DISCONTINUITY":E++,S.tagList.push(["DIS"]);break;case"GAP":S.gap=!0,S.tagList.push([e]);break;case"BITRATE":S.tagList.push([e,i]),T=1e3*parseInt(i),Tt(T)?S.bitrate=T:T=0;break;case"DATERANGE":{const e=new Di(i,l),t=new Ni(e,l.dateRanges[e.ID],l.dateRangeTagCount);l.dateRangeTagCount++,t.isValid||l.skippedSegments?l.dateRanges[t.id]=t:Kt.warn(`Ignoring invalid DATERANGE tag: "${i}"`),S.tagList.push(["EXT-X-DATERANGE",i]);break}case"DEFINE":{const e=new Di(i,l);"IMPORT"in e?Ii(l,e,a):Ai(l,e,t)}break;case"DISCONTINUITY-SEQUENCE":0!==l.startCC?va(l,e,d):u.length>0&&ya(l,e,d),l.startCC=E=parseInt(i);break;case"KEY":{const e=ca(i,t,l);if(e.isSupported()){if("NONE"===e.method){h=void 0;break}h||(h={});const t=h[e.keyFormat];null!=t&&t.matches(e)||(t&&(h=xt({},h)),h[e.keyFormat]=e)}else Kt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${i}"`);break}case"START":l.startTimeOffset=da(i);break;case"MAP":{const e=new Di(i,l);if(S.duration){const t=new fr(n,o);pa(t,e,r,h),p=t,S.initSegment=p,p.rawProgramDateTime&&!S.rawProgramDateTime&&(S.rawProgramDateTime=p.rawProgramDateTime)}else{const t=S.byteRangeEndOffset;if(t){const e=S.byteRangeStartOffset;I=`${t-e}@${e}`}else I=null;pa(S,e,r,h),p=S,A=!0}p.cc=E;break}case"SERVER-CONTROL":g&&va(l,e,d),g=new Di(i),l.canBlockReload=g.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=g.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&g.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=g.optionalFloat("PART-HOLD-BACK",0),l.holdBack=g.optionalFloat("HOLD-BACK",0);break;case"PART-INF":{l.partTarget&&va(l,e,d);const t=new Di(i);l.partTarget=t.decimalFloatingPoint("PART-TARGET");break}case"PART":{let e=l.partList;e||(e=l.partList=[]);const t=v>0?e[e.length-1]:void 0,r=v++,n=new Di(i,l),a=new hr(n,S,o,r,t);e.push(a),S.duration+=a.duration;break}case"PRELOAD-HINT":{const e=new Di(i,l);l.preloadHint=e;break}case"RENDITION-REPORT":{const e=new Di(i,l);l.renditionReports=l.renditionReports||[],l.renditionReports.push(e);break}default:Kt.warn(`line parsed but not handled: ${d}`)}}}_&&!_.relurl?(u.pop(),y-=_.duration,l.partList&&(l.fragmentHint=_)):l.partList&&(ga(S,_,c),S.cc=E,l.fragmentHint=S,h&&ma(S,h,l)),l.targetduration||(l.playlistParsingError=new Error("Missing Target Duration"));const R=u.length,w=u[0],D=u[R-1];if(y+=l.skippedSegments*l.targetduration,y>0&&R&&D){l.averagetargetduration=y/R;const e=D.sn;l.endSN="initSegment"!==e?e:0,l.live||(D.endList=!0),b>0&&(!function(e,t){let r=e[t];for(let n=t;n--;){const t=e[n];if(!t)return;t.programDateTime=r.programDateTime-1e3*t.duration,r=t}}(u,b),w&&c.unshift(w))}return l.fragmentHint&&(y+=l.fragmentHint.duration),l.totalduration=y,c.length&&l.dateRangeTagCount&&w&&la(c,l),l.endCC=E,l}}function la(e,t){let r=e.length;if(!r){if(!t.hasProgramDateTime)return;{const n=t.fragments[t.fragments.length-1];e.push(n),r++}}const n=e[r-1],i=t.live?1/0:t.totalduration,a=Object.keys(t.dateRanges);for(let o=a.length;o--;){const l=t.dateRanges[a[o]],u=l.startDate.getTime();l.tagAnchor=n.ref;for(let n=r;n--;){var s;if((null==(s=e[n])?void 0:s.sn)<t.startSN)break;const r=ua(t,u,e,n,i);if(-1!==r){l.tagAnchor=t.fragments[r].ref;break}}}}function ua(e,t,r,n,i){const a=r[n];if(a){const o=a.programDateTime;if(t>=o||0===n){var s;if(t<=o+1e3*(((null==(s=r[n+1])?void 0:s.start)||i)-a.start)){const i=r[n].sn-e.startSN;if(i<0)return-1;const a=e.fragments;if(a.length>r.length){for(let s=(r[n+1]||a[a.length-1]).sn-e.startSN;s>i;s--){const e=a[s].programDateTime;if(t>=e&&t<e+1e3*a[s].duration)return s}}return i}}}return-1}function ca(e,t,r){var n,i;const a=new Di(e,r),s=null!=(n=a.METHOD)?n:"",o=a.URI,l=a.hexadecimalInteger("IV"),u=a.KEYFORMATVERSIONS,c=null!=(i=a.KEYFORMAT)?i:"identity";o&&a.IV&&!l&&Kt.error(`Invalid IV: ${a.IV}`);const d=o?oa.resolve(o,t):"",f=(u||"1").split("/").map(Number).filter(Number.isFinite);return new ea(s,d,c,f,l,a.KEYID)}function da(e){const t=new Di(e).decimalFloatingPoint("TIME-OFFSET");return Tt(t)?t:null}function fa(e,t){let r=(e||"").split(/[ ,]+/).filter(e=>e);["video","audio","text"].forEach(e=>{const n=r.filter(t=>$r(t,e));n.length&&(t[`${e}Codec`]=n.map(e=>e.split("/")[0]).join(","),r=r.filter(e=>-1===n.indexOf(e)))}),t.unknownCodecs=r}function ha(e,t,r){const n=t[r];n&&(e[r]=n)}function ga(e,t,r){e.rawProgramDateTime?r.push(e):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime)}function pa(e,t,r,n){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=r,e.sn="initSegment",n&&(e.levelkeys=n),e.initSegment=null}function ma(e,t,r){e.levelkeys=t;const{encryptedFragments:n}=r;n.length&&n[n.length-1].levelkeys===t||!Object.keys(t).some(e=>t[e].isCommonEncryption)||n.push(e)}function va(e,t,r){e.playlistParsingError=new Error(`#EXT-X-${t} must not appear more than once (${r[0]})`)}function ya(e,t,r){e.playlistParsingError=new Error(`#EXT-X-${t} must appear before the first Media Segment (${r[0]})`)}function Ea(e,t){const r=t.startPTS;if(Tt(r)){let n,i=0;t.sn>e.sn?(i=r-e.start,n=e):(i=e.start-r,n=t),n.duration!==i&&n.setDuration(i)}else if(t.sn>e.sn){e.cc===t.cc&&e.minEndPTS?t.setStart(e.start+(e.minEndPTS-e.start)):t.setStart(e.start+e.duration)}else t.setStart(Math.max(e.start-t.duration,0))}function Ta(e,t,r,n,i,a,s){n-r<=0&&(s.warn("Fragment should have a positive duration",t),n=r+t.duration,a=i+t.duration);let o=r,l=n;const u=t.startPTS,c=t.endPTS;if(Tt(u)){const d=Math.abs(u-r);e&&d>e.totalduration?s.warn(`media timestamps and playlist times differ by ${d}s for level ${t.level} ${e.url}`):Tt(t.deltaPTS)?t.deltaPTS=Math.max(d,t.deltaPTS):t.deltaPTS=d,o=Math.max(r,u),r=Math.min(r,u),i=void 0!==t.startDTS?Math.min(i,t.startDTS):i,l=Math.min(n,c),n=Math.max(n,c),a=void 0!==t.endDTS?Math.max(a,t.endDTS):a}const d=r-t.start;0!==t.start&&t.setStart(r),t.setDuration(n-t.start),t.startPTS=r,t.maxStartPTS=o,t.startDTS=i,t.endPTS=n,t.minEndPTS=l,t.endDTS=a;const f=t.sn;if(!e||f<e.startSN||f>e.endSN)return 0;let h;const g=f-e.startSN,p=e.fragments;for(p[g]=t,h=g;h>0;h--)Ea(p[h],p[h-1]);for(h=g;h<p.length-1;h++)Ea(p[h],p[h+1]);return e.fragmentHint&&Ea(p[p.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function _a(e,t,r){if(e===t)return;let n=null;const i=e.fragments;for(let e=i.length-1;e>=0;e--){const t=i[e].initSegment;if(t){n=t;break}}let a;e.fragmentHint&&delete e.fragmentHint.endPTS,function(e,t,r){const n=t.skippedSegments,i=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(n?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let u=i;u<=a;u++){const i=l[s+u];let a=o[u];if(n&&!a&&i&&(a=t.fragments[u]=i),i&&a){r(i,a,u,o);const n=i.relurl,s=a.relurl;if(n&&Ca(n,s))return void(t.playlistParsingError=Sa(`media sequence mismatch ${a.sn}:`,e,t,i,a));if(i.cc!==a.cc)return void(t.playlistParsingError=Sa(`discontinuity sequence mismatch (${i.cc}!=${a.cc})`,e,t,i,a))}}}(e,t,(e,r,i,s)=>{if((!t.startCC||t.skippedSegments)&&r.cc!==e.cc){const n=e.cc-r.cc;for(let e=i;e<s.length;e++)s[e].cc+=n;t.endCC=s[s.length-1].cc}Tt(e.startPTS)&&Tt(e.endPTS)&&(r.setStart(r.startPTS=e.startPTS),r.startDTS=e.startDTS,r.maxStartPTS=e.maxStartPTS,r.endPTS=e.endPTS,r.endDTS=e.endDTS,r.minEndPTS=e.minEndPTS,r.setDuration(e.endPTS-e.startPTS),r.duration&&(a=r),t.PTSKnown=t.alignedSliding=!0),e.hasStreams&&(r.elementaryStreams=e.elementaryStreams),r.loader=e.loader,e.hasStats&&(r.stats=e.stats),e.initSegment&&(r.initSegment=e.initSegment,n=e.initSegment)});const s=t.fragments,o=t.fragmentHint?s.concat(t.fragmentHint):s;if(n&&o.forEach(e=>{var t;!e||e.initSegment&&e.initSegment.relurl!==(null==(t=n)?void 0:t.relurl)||(e.initSegment=n)}),t.skippedSegments){if(t.deltaUpdateFailed=s.some(e=>!e),t.deltaUpdateFailed){r.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let e=t.skippedSegments;e--;)s.shift();t.startSN=s[0].sn}else{t.canSkipDateRanges&&(t.dateRanges=function(e,t,r){const{dateRanges:n,recentlyRemovedDateranges:i}=t,a=xt({},e);i&&i.forEach(e=>{delete a[e]});const s=Object.keys(a).length;if(!s)return n;return Object.keys(n).forEach(e=>{const t=a[e],i=new Ni(n[e].attr,t);i.isValid?(a[e]=i,t||(i.tagOrder+=s)):r.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${_n(n[e].attr)}"`)}),a}(e.dateRanges,t,r));const n=e.fragments.filter(e=>e.rawProgramDateTime);if(e.hasProgramDateTime&&!t.hasProgramDateTime)for(let e=1;e<o.length;e++)null===o[e].programDateTime&&ga(o[e],o[e-1],n);la(n,t)}t.endCC=s[s.length-1].cc}if(!t.startCC){var l;const r=Ra(e,t.startSN-1);t.startCC=null!=(l=null==r?void 0:r.cc)?l:s[0].cc}!function(e,t,r){if(e&&t){let n=0;for(let i=0,a=e.length;i<=a;i++){const a=e[i],s=t[i+n];a&&s&&a.index===s.index&&a.fragment.sn===s.fragment.sn?r(a,s):n--}}}(e.partList,t.partList,(e,t)=>{t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),a?Ta(t,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS,r):ba(e,t),s.length&&(t.totalduration=t.edge-s[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;const u=t.advancedDateTime;if(t.advanced&&u){const e=t.edge;t.driftStart||(t.driftStartTime=u,t.driftStart=e),t.driftEndTime=u,t.driftEnd=e}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime;-1===t.requestScheduled&&(t.requestScheduled=e.requestScheduled)}function Sa(e,t,r,n,i){return new Error(`${e} ${i.url}\nPlaylist starting @${t.startSN}\n${t.m3u8}\n\nPlaylist starting @${r.startSN}\n${r.m3u8}`)}function ba(e,t,r=!0){const n=t.startSN+t.skippedSegments-e.startSN,i=e.fragments,a=n>=0;let s=0;if(a&&n<i.length)s=i[n].start;else if(a&&t.startSN===e.endSN+1)s=e.fragmentEnd;else if(a&&r)s=e.fragmentStart+n*t.levelTargetDuration;else{if(t.skippedSegments||0!==t.fragmentStart)return;s=e.fragmentStart}Aa(t,s)}function Aa(e,t){if(t){const r=e.fragments;for(let n=e.skippedSegments;n<r.length;n++)r[n].addStart(t);e.fragmentHint&&e.fragmentHint.addStart(t)}}function Ia(e,t=1/0){let r=1e3*e.targetduration;if(e.updated){const n=e.fragments,i=4;if(n.length&&r*i>t){const e=1e3*n[n.length-1].duration;e<r&&(r=e)}}else r/=2;return Math.round(r)}function Ra(e,t,r){if(!e)return null;let n=e.fragments[t-e.startSN];return n||(n=e.fragmentHint,n&&n.sn===t?n:t<e.startSN&&r&&r.sn===t?r:null)}function wa(e,t,r){return e?Da(e.partList,t,r):null}function Da(e,t,r){if(e)for(let n=e.length;n--;){const i=e[n];if(i.index===r&&i.fragment.sn===t)return i}return null}function La(e){e.forEach((e,t)=>{var r;null==(r=e.details)||r.fragments.forEach(e=>{e.level=t,e.initSegment&&(e.initSegment.level=t)})})}function Ca(e,t){return!(e===t||!t)&&Na(e)!==Na(t)}function Na(e){return e.replace(/\?[^?]*$/,"")}function Pa(e,t){for(let n=0,i=e.length;n<i;n++){var r;if((null==(r=e[n])?void 0:r.cc)===t)return e[n]}return null}function Oa(e,t){const r=e.start+t;e.startPTS=r,e.setStart(r),e.endPTS=r+e.duration}function Ma(e,t){const r=t.fragments;for(let t=0,n=r.length;t<n;t++)Oa(r[t],e);t.fragmentHint&&Oa(t.fragmentHint,e),t.alignedSliding=!0}function ka(e,t){if(!function(e,t){return!!(e&&t.startCC<e.endCC&&t.endCC>e.startCC)}(t,e))return;const r=Math.min(t.endCC,e.endCC),n=Pa(t.fragments,r),i=Pa(e.fragments,r);if(!n||!i)return;Kt.log(`Aligning playlist at start of dicontinuity sequence ${r}`);Ma(n.start-i.start,e)}function xa(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;const r=e.fragments,n=t.fragments;if(!r.length||!n.length)return;let i,a;const s=Math.min(t.endCC,e.endCC);t.startCC<s&&e.startCC<s&&(i=Pa(n,s),a=Pa(r,s)),i&&a||(i=n[Math.floor(n.length/2)],a=Pa(r,i.cc)||r[Math.floor(r.length/2)]);const o=i.programDateTime,l=a.programDateTime;if(!o||!l)return;Ma((l-o)/1e3-(a.start-i.start),e)}function Fa(e,t,r){Ba(e,t,r),e.addEventListener(t,r)}function Ba(e,t,r){e.removeEventListener(t,r)}const Ua=function(e){let t="";const r=e.length;for(let n=0;n<r;n++)t+=`[${e.start(n).toFixed(3)}-${e.end(n).toFixed(3)}]`;return t},Za="STOPPED",Ga="IDLE",Ha="KEY_LOADING",$a="FRAG_LOADING",Va="FRAG_LOADING_WAITING_RETRY",Ka="WAITING_TRACK",qa="PARSING",Ya="PARSED",ja="ENDED",za="ERROR",Wa="WAITING_INIT_PTS",Xa="WAITING_LEVEL";class Qa extends vi{constructor(e,t,r,n,i){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Za,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:e,fragCurrent:t,media:r,mediaBuffer:n,state:i}=this,a=r?r.currentTime:0,s=Ti.bufferInfo(n||r,a,e.maxBufferHole),o=!s.len;if(this.log(`Media seeking to ${Tt(a)?a.toFixed(3):a}, state: ${i}, ${o?"out of":"in"} buffer`),this.state===ja)this.resetLoadingState();else if(t){const r=e.maxFragLookUpTolerance,n=t.start-r,i=t.start+t.duration+r;if(o||i<s.start||n>s.end){const e=a>i;(a<n||e)&&(e&&t.loader&&(this.log(`Cancelling fragment load for seek (sn: ${t.sn})`),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(r){this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0);if(a>this.lastCurrentTime&&(this.lastCurrentTime=a),!this.loadingParts){const e=Math.max(s.end,a),t=this.shouldLoadParts(this.getLevelDetails(),e);t&&(this.log(`LL-Part loading ON after seeking to ${a.toFixed(2)} with buffer @${e.toFixed(2)}`),this.loadingParts=t)}}this.hls.hasEnoughToStart||(this.log(`Setting ${o?"startPosition":"nextLoadPosition"} to ${a} for seek without enough to start`),this.nextLoadPosition=a,o&&(this.startPosition=a)),o&&this.state===Ga&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=i,this.hls=e,this.fragmentLoader=new hi(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new di(e.config)}registerListeners(){const{hls:e}=this;e.on(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(It.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(It.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Za)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Za}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return-1===t&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const r=e.end||0,n=this.config.timelineOffset||0;if(r<=n)return!1;const i=e.buffered;this.config.maxBufferHole&&i&&i.length>1&&(e=Ti.bufferedInfo(i,e.start,0));const a=e.nextStart;if(a&&a>n&&a<t.edge)return!1;if(this.media.currentTime<e.start)return!1;const s=t.partList;if(null!=s&&s.length){const e=s[s.length-1];return Ti.isBuffered(this.media,e.start+e.duration/2)}const o=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&null!==this.levelLastLoaded)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;var t;return e?(null==(t=this.getLevelDetails())?void 0:t.appliedTimelineOffset)||e:0}onMediaAttached(e,t){const r=this.media=this.mediaBuffer=t.media;Fa(r,"seeking",this.onMediaSeeking),Fa(r,"ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===Za&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const r=!!t.transferMedia,n=this.media;if(null!==n){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Ba(n,"seeking",this.onMediaSeeking),Ba(n,"ended",this.onMediaEnded),this.keyLoader&&!r&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,r)return this.resetLoadingState(),void this.resetTransmuxer();this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Za,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this.startFragRequested=!0,this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){this._doFragLoad(e,t,r,e=>{const t=e.frag;if(this.fragContextChanged(t))return this.warn(`${t.type} sn: ${t.sn}${e.part?" part: "+e.part.index:""} of ${this.fragInfo(t,!1,e.part)}) was dropped during download.`),void this.fragmentTracker.removeFragment(t);t.stats.chunkCount++,this._handleFragmentLoadProgress(e)}).then(e=>{if(!e)return;const t=this.state,r=e.frag;this.fragContextChanged(r)?(t===$a||!this.fragCurrent&&t===qa)&&(this.fragmentTracker.removeFragment(r),this.state=Ga):("payload"in e&&(this.log(`Loaded ${r.type} sn: ${r.sn} of ${this.playlistLabel()} ${r.level}`),this.hls.trigger(It.FRAG_LOADED,e)),this._handleFragmentLoadComplete(e))}).catch(t=>{this.state!==Za&&this.state!==za&&(this.warn(`Frag error: ${(null==t?void 0:t.message)||t}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:r}=this;if(r.getState(e)===Jn){const t=e.type,n=this.getFwdBufferInfo(this.mediaBuffer,t),i=Math.max(e.duration,n?n.len:this.config.maxBufferLength),a=this.backtrackFragment;(1===(a?e.sn-a.sn:0)||this.reduceMaxBufferLength(i,e.duration))&&r.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===ei&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(null==t?void 0:t.live)&&"EVENT"!==t.type&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,r=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:r};this.hls.trigger(It.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(e=>{const t=null==e?void 0:e.frag;if(!t||this.fragContextChanged(t)||!this.levels)throw new Error("init load aborted");return e}).then(e=>{const{hls:t}=this,{frag:r,payload:n}=e,i=r.decryptdata;if(n&&n.byteLength>0&&null!=i&&i.key&&i.iv&&ki(i.method)){const a=self.performance.now();return this.decrypter.decrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer,xi(i.method)).catch(e=>{throw t.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:r}),e}).then(n=>{const i=self.performance.now();return t.trigger(It.FRAG_DECRYPTED,{frag:r,payload:n,stats:{tstart:a,tdecrypt:i}}),e.payload=n,this.completeInitSegmentLoad(e)})}return this.completeInitSegmentLoad(e)}).catch(t=>{this.state!==Za&&this.state!==za&&(this.warn(t),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const r=e.frag.stats;this.state!==Za&&(this.state=Ga),e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var r,n;const i=e.tracks;if(i&&!t.encrypted&&(null!=(r=i.audio)&&r.encrypted||null!=(n=i.video)&&n.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const e=this.media,r=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${e?"attached mediaKeys: "+e.mediaKeys:"detached"})`);return this.warn(r.message),!e||e.mediaKeys?!1:(this.hls.trigger(It.ERROR,{type:bt.KEY_SYSTEM_ERROR,details:At.KEY_SYSTEM_NO_KEYS,fatal:!1,error:r,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const r=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${r?Ua(Ti.getBuffered(r)):"(detached)"})`),dr(e)){var n;if(e.type!==Pt){const t=e.elementaryStreams;if(!Object.keys(t).some(e=>!!t[e]))return void(this.state=Ga)}const t=null==(n=this.levels)?void 0:n[e.level];null!=t&&t.fragmentError&&(this.log(`Resetting level fragment error count of ${t.fragmentError} on frag buffered`),t.fragmentError=0)}this.state=Ga}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:r,part:n,partsLoaded:i}=e,a=!i||0===i.length||i.some(e=>!e),s=new yi(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!a);t.flush(s)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,n){var i;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let s=null;if(!e.encrypted||null!=(i=e.decryptdata)&&i.key)e.encrypted||(s=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),s&&this.log("[eme] blocking frag load until media-keys acquired"));else if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Ha,this.fragCurrent=e,s=this.keyLoader.load(e).then(e=>{if(!this.fragContextChanged(e.frag))return this.hls.trigger(It.KEY_LOADED,e),this.state===Ha&&(this.state=Ga),e}),this.hls.trigger(It.KEY_LOADING,{frag:e}),null===this.fragCurrent)return this.log("context changed in KEY_LOADING"),Promise.resolve(null);const o=this.fragPrevious;if(dr(e)&&(!o||e.sn!==o.sn)){const r=this.shouldLoadParts(t.details,e.end);r!==this.loadingParts&&(this.log(`LL-Part loading ${r?"ON":"OFF"} loading sn ${null==o?void 0:o.sn}->${e.sn}`),this.loadingParts=r)}if(r=Math.max(e.start,r||0),this.loadingParts&&dr(e)){const i=a.partList;if(i&&n){r>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const o=this.getNextPart(i,e,r);if(o>-1){const l=i[o];let u;return e=this.fragCurrent=l.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${l.index} (${o}/${i.length-1}) of ${this.fragInfo(e,!1,l)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=l.start+l.duration,this.state=$a,u=s?s.then(r=>!r||this.fragContextChanged(r.frag)?null:this.doFragPartsLoad(e,l,t,n)).catch(e=>this.handleFragLoadError(e)):this.doFragPartsLoad(e,l,t,n).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(It.FRAG_LOADING,{frag:e,part:l,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):u}if(!e.url||this.loadedEndOfParts(i,r))return Promise.resolve(null)}}var l;if(dr(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${r.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${null==(l=a.partList)?void 0:l.filter(e=>e.loaded).map(e=>`[${e.start}-${e.end}]`)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(r.toFixed(3))}`),Tt(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=$a;const u=this.config.progressive;let c;return c=u&&s?s.then(t=>!t||this.fragContextChanged(t.frag)?null:this.fragmentLoader.load(e,n)).catch(e=>this.handleFragLoadError(e)):Promise.all([this.fragmentLoader.load(e,u?n:void 0),s]).then(([e])=>(!u&&n&&n(e),e)).catch(e=>this.handleFragLoadError(e)),this.hls.trigger(It.FRAG_LOADING,{frag:e,targetBufferTime:r}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,r,n){return new Promise((i,a)=>{var s;const o=[],l=null==(s=r.details)?void 0:s.partList,u=t=>{this.fragmentLoader.loadPart(e,t,n).then(n=>{o[t.index]=n;const a=n.part;this.hls.trigger(It.FRAG_LOADED,n);const s=wa(r.details,e.sn,t.index+1)||Da(l,e.sn,t.index+1);if(!s)return i({frag:e,part:a,partsLoaded:o});u(s)}).catch(a)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===At.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===bt.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(It.ERROR,t)}else this.hls.trigger(It.ERROR,{type:bt.OTHER_ERROR,details:At.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==qa)return void(this.fragCurrent||this.state===Za||this.state===za||(this.state=Ga));const{frag:r,part:n,level:i}=t,a=self.performance.now();r.stats.parsing.end=a,n&&(n.stats.parsing.end=a);const s=this.getLevelDetails(),o=s&&r.sn>s.endSN||this.shouldLoadParts(s,r.end);o!==this.loadingParts&&(this.log(`LL-Part loading ${o?"ON":"OFF"} after parsing segment ending @${r.end.toFixed(2)}`),this.loadingParts=o),this.updateLevelTiming(r,n,i,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var r;const i=e.partList[0];if(i.fragment.type===Pt)return!1;if(t>=i.end+((null==(r=e.fragmentHint)?void 0:r.duration)||0)){var n;if((this.hls.hasEnoughToStart?(null==(n=this.media)?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>i.start-i.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:r}=this,{level:n,sn:i,part:a}=e;if(null==t||!t[n])return this.warn(`Levels object was unset while buffering fragment ${i} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const s=t[n],o=s.details,l=a>-1?wa(o,i,a):null,u=l?l.fragment:Ra(o,i,r);return u?(r&&r!==u&&(u.stats=r.stats),{frag:u,part:l,level:s}):null}bufferFragmentData(e,t,r,n,i){if(this.state!==qa)return;const{data1:a,data2:s}=e;let o=a;if(s&&(o=Or(a,s)),!o.length)return;const l=this.initPTS[t.cc],u=l?-l.baseTime/l.timescale:void 0,c={type:e.type,frag:t,part:r,chunkMeta:n,offset:u,parent:t.type,data:o};if(this.hls.trigger(It.BUFFER_APPENDING,c),e.dropped&&e.independent&&!r){if(i)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ti.isBuffered(t,t.currentTime))return void this.flushMainBuffer(0,e.start);const r=t.currentTime,n=Ti.bufferInfo(t,r,0),i=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),s=Math.max(Math.min(e.start-a,n.end-a),r+a);e.start-s>a&&this.flushMainBuffer(s,e.start)}getFwdBufferInfo(e,t){var r;const n=this.getLoadPosition();if(!Tt(n))return null;const i=this.lastCurrentTime>n||null!=(r=this.media)&&r.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,i)}getFwdBufferInfoAtPos(e,t,r,n){const i=Ti.bufferInfo(e,t,n);if(0===i.len&&void 0!==i.nextStart){const a=this.fragmentTracker.getBufferedFrag(t,r);if(a&&(i.nextStart<=a.end||a.gap)){const r=Math.max(Math.min(i.nextStart,a.end)-t,n);return Ti.bufferInfo(e,t,r)}}return i}getMaxBufferLength(e){const{config:t}=this;let r;return r=e?Math.max(8*t.maxBufferSize/e,t.maxBufferLength):t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const r=this.config,n=Math.max(Math.min(e-t,r.maxBufferLength),t),i=Math.max(e-3*t,r.maxMaxBufferLength/2,n);return i>=n&&(r.maxMaxBufferLength=i,this.warn(`Reduce max buffer length to ${i}s`),!0)}getAppendedFrag(e,t=Ct){const r=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const r=t.fragments,n=r.length;if(!n)return null;const{config:i}=this,a=r[0].start,s=i.lowLatencyMode&&!!t.partList;let o=null;if(t.live){const r=i.initialLiveManifestSize;if(n<r)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${r})`),null;if(!t.PTSKnown&&!this.startFragRequested&&-1===this.startPosition||e<a){var l;s&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),o=this.getInitialLiveFragment(t);const r=this.hls.startPosition,n=this.hls.liveSyncPosition,i=o?(-1!==r&&r>=a?r:n)||o.start:e;this.log(`Setting startPosition to ${i} to match start frag at live edge. mainStart: ${r} liveSyncPosition: ${n} frag.start: ${null==(l=o)?void 0:l.start}`),this.startPosition=this.nextLoadPosition=i}}else e<=a&&(o=r[0]);if(!o){const r=this.loadingParts?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,r,t)}let u=this.filterReplacedPrimary(o,t);if(!u&&o){const e=o.sn-t.startSN;u=this.filterReplacedPrimary(r[e+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const r=this.fragmentTracker.getState(e);return(r===ti||r===ei&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,n,i){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&r.nextStart)){const e=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,n,0);if(null!==e&&r.len+e.len>=i){const e=a.sn;return this.loopSn!==e&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${e}`),this.loopSn=e),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(Ja(this.config)){var e;if(null==(e=this.hls.interstitialsManager)||null==(e=e.playingItem)?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Ja(this.config)&&e.type!==Pt){const r=this.hls.interstitialsManager,n=null==r?void 0:r.bufferingItem;if(n){const r=n.event;if(r){if(r.appendInPlace||Math.abs(e.start-n.start)>1||0===n.start)return null}else{if(e.end<=n.start&&!1===(null==t?void 0:t.live))return null;if(e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}}const i=null==r?void 0:r.playerQueue;if(i)for(let t=i.length;t--;){const r=i[t].interstitial;if(r.appendInPlace&&e.start>=r.startTime&&e.end<=r.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return null==e||!e.initSegment||e.initSegment.data||this.bitrateTest?e:e.initSegment}getNextPart(e,t,r){let n=-1,i=!1,a=!0;for(let s=0,o=e.length;s<o;s++){const o=e[s];if(a=a&&!o.independent,n>-1&&r<o.start)break;const l=o.loaded;l?n=-1:(i||(o.independent||a)&&o.fragment===t)&&(o.fragment!==t&&this.warn(`Need buffer at ${r} but next unloaded part starts at ${o.start}`),n=s),i=l}return n}loadedEndOfParts(e,t){let r;for(let n=e.length;n--;){if(r=e[n],!r.loaded)return!1;if(t>r.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,r=this.fragPrevious;let n=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),n=function(e,t,r){if(null===t||!Array.isArray(e)||!e.length||!Tt(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;for(let n=0;n<e.length;++n){const i=e[n];if(On(t,r,i))return i}return null}(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){const a=t[i-e.startSN];r.cc===a.cc&&(n=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=Mn(e,r.cc,r.end),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const t=this.hls.liveSyncPosition;null!==t&&(n=this.getFragmentAtPosition(t,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,r){const{config:n}=this;let{fragPrevious:i}=this,{fragments:a,endSN:s}=r;const{fragmentHint:o}=r,{maxFragLookUpTolerance:l}=n,u=r.partList,c=!!(this.loadingParts&&null!=u&&u.length&&o);let d;if(c&&!this.bitrateTest&&u[u.length-1].fragment.sn===o.sn&&(a=a.concat(o),s=o.sn),e<t){var f;d=Nn(i,a,e,e<this.lastCurrentTime||e>t-l||null!=(f=this.media)&&f.paused||!this.startFragRequested?0:l)}else d=a[a.length-1];if(d){const e=d.sn-r.startSN,t=this.fragmentTracker.getState(d);if((t===ti||t===ei&&d.gap)&&(i=d),i&&d.sn===i.sn&&(!c||u[0].fragment.sn>d.sn||!r.live)){if(d.level===i.level){const t=a[e+1];d=d.sn<s&&this.fragmentTracker.getState(t)!==ti?t:null}}}return d}alignPlaylists(e,t,r){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const i=e.fragmentStart,a=!t,s=e.alignedSliding&&Tt(i);if(a||!s&&!i){!function(e,t){e&&(ka(t,e),t.alignedSliding||xa(t,e),t.alignedSliding||t.skippedSegments||ba(e,t,!1))}(r,e);const i=e.fragmentStart;return this.log(`Live playlist sliding: ${i.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${n}`),i}return i}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,3*e.partTarget)}setStartPosition(e,t){let r=this.startPosition;r<t&&(r=-1);const n=this.timelineOffset;if(-1===r){const i=null!==this.startTimeOffset,a=i?this.startTimeOffset:e.startTimeOffset;null!==a&&Tt(a)?(r=t+a,a<0&&(r+=e.edge),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Setting startPosition to ${r} for start time offset ${a} found in ${i?"multivariant":"media"} playlist`),this.startPosition=r):e.live?(r=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${r}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=r=0),this.lastCurrentTime=r+n}this.nextLoadPosition=r+n}getLoadPosition(){var e;const{media:t}=this;let r=0;return null!=(e=this.hls)&&e.hasEnoughToStart&&t?r=t.currentTime:this.nextLoadPosition>=0&&(r=this.nextLoadPosition),r}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&dr(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Va)||(this.state=Ga)}onFragmentOrKeyLoadError(e,t){var r;if(t.chunkMeta&&!t.frag){const e=this.getCurrentContext(t.chunkMeta);e&&(t.frag=e.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;var i;if(this.fragContextChanged(n))return void this.warn(`Frag load error must match current frag to retry ${n.url} > ${null==(i=this.fragCurrent)?void 0:i.url}`);const a=t.details===At.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(n,!0);const s=t.errorAction;if(!s)return void(this.state=za);const{action:o,flags:l,retryCount:u=0,retryConfig:c}=s,d=!!c,f=d&&o===qn,h=d&&!s.resolved&&l===jn,g=null==(r=this.hls.latestLevelDetails)?void 0:r.live;if(!f&&h&&dr(n)&&!n.endList&&g&&!Fn(t))this.resetFragmentErrors(e),this.treatAsGap(n),s.resolved=!0;else if((f||h)&&u<c.maxNumRetry){var p;const r=Hn(null==(p=t.response)?void 0:p.code),i=Un(c,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+i,this.state=Va,s.resolved=!0,r)return this.log("Waiting for connection (offline)"),this.retryDate=1/0,void(t.reason="offline");this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${u+1}/${c.maxNumRetry} in ${i}ms`)}else if(c){if(this.resetFragmentErrors(e),!(u<c.maxNumRetry))return void this.warn(`${t.details} reached or exceeded max retry (${u})`);a||o===Kn||(s.resolved=!0)}else this.state=o===Vn?Xa:za;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,r=t===1/0;(!t||e>=t||r&&!Hn(0))&&(r&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=Ga)}reduceLengthAndFlushBuffer(e){if(this.state===qa||this.state===Ya){const t=e.frag,r=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,r),i=n&&n.len>.5;i&&this.reduceMaxBufferLength(n.len,(null==t?void 0:t.duration)||10);const a=!i;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${r} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===Nt&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Za&&(this.state=Ga)}afterBufferFlushed(e,t,r){if(!e)return;const n=Ti.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,r),this.state===ja&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Za&&(this.state=Ga)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;null!=t&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${-1===e.level?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,n){const i=r.details;if(!i)return void this.warn("level.details undefined");var a;if(!Object.keys(e.elementaryStreams).reduce((t,a)=>{const s=e.elementaryStreams[a];if(s){const o=s.endPTS-s.startPTS;if(o<=0)return this.warn(`Could not parse fragment ${e.sn} ${a} duration reliably (${o})`),t||!1;const l=n?0:Ta(i,e,s.startPTS,s.endPTS,s.startDTS,s.endDTS,this);return this.hls.trigger(It.LEVEL_PTS_UPDATED,{details:i,level:r,drift:l,type:a,frag:e,start:s.startPTS,end:s.endPTS}),!0}return t},!1)&&(0===r.fragmentError&&this.treatAsGap(e,r),null===(null==(a=this.transmuxer)?void 0:a.error))){const t=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(t.message),this.hls.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.FRAG_PARSING_ERROR,fatal:!1,error:t,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=Ya,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(It.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===Ct?"level":"track"}fragInfo(e,t=!0,r){var n,i;return`${this.playlistLabel()} ${e.level} (${r?"part":"frag"}:[${(null!=(n=t&&!r?e.startPTS:(r||e).start)?n:NaN).toFixed(3)}-${(null!=(i=t&&!r?e.endPTS:(r||e).end)?i:NaN).toFixed(3)}]${r&&"main"===e.type?"INDEPENDENT="+(r.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;null==(e=this.transmuxer)||e.reset()}recoverWorkerError(e){"demuxerWorker"===e.event&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Ja(e){return!!e.interstitialsController&&!1!==e.enableInterstitialPlayback}class es{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let r;return e.length?(r=1===e.length?e[0]:function(e,t){const r=new Uint8Array(t);let n=0;for(let t=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r}(e,t),this.reset(),r):new Uint8Array(0)}reset(){this.chunks.length=0,this.dataLength=0}}var ts,rs={exports:{}};var ns=(ts||(ts=1,function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,n,a,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var o=new i(n,a||e,s),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),o.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},o.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,s=new Array(a);i<a;i++)s[i]=n[i].fn;return s},o.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},o.prototype.emit=function(e,t,n,i,a,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,i),!0;case 5:return c.fn.call(c.context,t,n,i,a),!0;case 6:return c.fn.call(c.context,t,n,i,a,s),!0}for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var f,h=c.length;for(u=0;u<h;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),d){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,i);break;default:if(!l)for(f=1,l=new Array(d-1);f<d;f++)l[f-1]=arguments[f];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},o.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},o.prototype.removeListener=function(e,t,n,i){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||i&&!o.once||n&&o.context!==n||s(this,a);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||i&&!o[l].once||n&&o[l].context!==n)&&u.push(o[l]);u.length?this._events[a]=1===u.length?u[0]:u:s(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o}(rs)),rs.exports),is=Xt(ns);const as="1.6.14",ss={};function os(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function ls(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128}function us(e,t){let r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3],r}function cs(e,t){const r=t;let n=0;for(;ls(e,t);){n+=10;n+=us(e,t+6),os(e,t+10)&&(n+=10),t+=n}if(n>0)return e.subarray(r,r+n)}function ds(e,t){return 255===e[t]&&240==(246&e[t+1])}function fs(e,t){return 1&e[t+1]?7:9}function hs(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function gs(e,t){return t+1<e.length&&ds(e,t)}function ps(e,t){if(gs(e,t)){const r=fs(e,t);if(t+r>=e.length)return!1;const n=hs(e,t);if(n<=r)return!1;const i=t+n;return i===e.length||gs(e,i)}return!1}function ms(e,t,r,n,i){if(!e.samplerate){const a=function(e,t,r,n){const i=t[r+2],a=i>>2&15;if(a>12){const t=new Error(`invalid ADTS sampling index:${a}`);return void e.emit(It.ERROR,It.ERROR,{type:bt.MEDIA_ERROR,details:At.FRAG_PARSING_ERROR,fatal:!0,error:t,reason:t.message})}const s=1+(i>>6&3),o=t[r+3]>>6&3|(1&i)<<2,l="mp4a.40."+s,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][a];let c=a;5!==s&&29!==s||(c-=3);const d=[s<<3|(14&c)>>1,(1&c)<<7|o<<3];return Kt.log(`manifest codec:${n}, parsed codec:${l}, channels:${o}, rate:${u} (ADTS object type:${s} sampling index:${a})`),{config:d,samplerate:u,channelCount:o,codec:l,parsedCodec:l,manifestCodec:n}}(t,r,n,i);if(!a)return;xt(e,a)}}function vs(e){return 9216e4/e}function ys(e,t,r,n,i){const a=n+i*vs(e.samplerate),s=function(e,t){const r=fs(e,t);if(t+r<=e.length){const n=hs(e,t)-r;if(n>0)return{headerLength:r,frameLength:n}}}(t,r);let o;if(s){const{frameLength:n,headerLength:i}=s,l=i+n,u=Math.max(0,r+l-t.length);u?(o=new Uint8Array(l-i),o.set(t.subarray(r+i,t.length),0)):o=t.subarray(r+i,r+l);const c={unit:o,pts:a};return u||e.samples.push(c),{sample:c,length:l,missing:u}}const l=t.length-r;o=new Uint8Array(l),o.set(t.subarray(r,t.length),0);return{sample:{unit:o,pts:a},length:l,missing:-1}}function Es(e,t){return ls(e,t)&&us(e,t+6)+10<=e.length-t}function Ts(e,t=0,r=1/0){return function(e,t,r,n){const i=function(e){return e instanceof ArrayBuffer?e:e.buffer}(e);let a=1;"BYTES_PER_ELEMENT"in n&&(a=n.BYTES_PER_ELEMENT);const s=(d=e,d&&d.buffer instanceof ArrayBuffer&&void 0!==d.byteLength&&void 0!==d.byteOffset?e.byteOffset:0),o=(s+e.byteLength)/a,l=(s+t)/a,u=Math.floor(Math.max(0,Math.min(l,o))),c=Math.floor(Math.min(u+Math.max(r,0),o));var d;return new n(i,u,c-u)}(e,t,r,Uint8Array)}function _s(e){const t={key:e.type,description:"",data:"",mimeType:null,pictureType:null};if(e.size<2)return;if(3!==e.data[0])return void console.log("Ignore frame with unrecognized character encoding");const r=e.data.subarray(1).indexOf(0);if(-1===r)return;const n=jt(Ts(e.data,1,r)),i=e.data[2+r],a=e.data.subarray(3+r).indexOf(0);if(-1===a)return;const s=jt(Ts(e.data,3+r,a));let o;return o="--\x3e"===n?jt(Ts(e.data,4+r+a)):function(e){return e instanceof ArrayBuffer?e:0==e.byteOffset&&e.byteLength==e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer}(e.data.subarray(4+r+a)),t.mimeType=n,t.pictureType=i,t.description=s,t.data=o,t}function Ss(e){return"PRIV"===e.type?function(e){if(e.size<2)return;const t=jt(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}}(e):"W"===e.type[0]?function(e){if("WXXX"===e.type){if(e.size<2)return;let t=1;const r=jt(e.data.subarray(t),!0);t+=r.length+1;const n=jt(e.data.subarray(t));return{key:e.type,info:r,data:n}}const t=jt(e.data);return{key:e.type,info:"",data:t}}(e):"APIC"===e.type?_s(e):function(e){if(e.size<2)return;if("TXXX"===e.type){let t=1;const r=jt(e.data.subarray(t),!0);t+=r.length+1;const n=jt(e.data.subarray(t));return{key:e.type,info:r,data:n}}const t=jt(e.data.subarray(1));return{key:e.type,info:"",data:t}}(e)}function bs(e){const t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=us(e,4);return{type:t,size:r,data:e.subarray(10,10+r)}}function As(e){let t=0;const r=[];for(;ls(e,t);){const n=us(e,t+6);e[t+5]>>6&1&&(t+=10),t+=10;const i=t+n;for(;t+10<i;){const n=bs(e.subarray(t)),i=Ss(n);i&&r.push(i),t+=n.size+10}os(e,t)&&(t+=10)}return r}function Is(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info}function Rs(e){if(8===e.data.byteLength){const t=new Uint8Array(e.data),r=1&t[3];let n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,r&&(n+=47721858.84),Math.round(n)}}function ws(e){const t=As(e);for(let e=0;e<t.length;e++){const r=t[e];if(Is(r))return Rs(r)}}let Ds=function(e){return e.audioId3="org.id3",e.dateRange="com.apple.quicktime.HLS",e.emsg="https://aomedia.org/emsg/ID3",e.misbklv="urn:misb:KLV:bin:1910.1",e}({});function Ls(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}class Cs{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=Or(this.cachedData,e),this.cachedData=null);let r,n=cs(e,0),i=n?n.length:0;const a=this._audioTrack,s=this._id3Track,o=n?ws(n):void 0,l=e.length;for((null===this.basePTS||0===this.frameIndex&&Tt(o))&&(this.basePTS=Ns(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),n&&n.length>0&&s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Ds.audioId3,duration:Number.POSITIVE_INFINITY});i<l;){if(this.canParse(e,i)){const t=this.appendFrame(a,e,i);t?(this.frameIndex++,this.lastPTS=t.sample.pts,i+=t.length,r=i):i=l}else Es(e,i)?(n=cs(e,i),s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Ds.audioId3,duration:Number.POSITIVE_INFINITY}),i+=n.length,r=i):i++;if(i===l&&r!==l){const t=e.slice(r);this.cachedData?this.cachedData=Or(this.cachedData,t):this.cachedData=t}}return{audioTrack:a,videoTrack:Ls(),id3Track:s,textTrack:Ls()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Ls(),id3Track:this._id3Track,textTrack:Ls()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const Ns=(e,t,r)=>{if(Tt(e))return 90*e;return 9e4*t+(r?9e4*r.baseTime/r.timescale:0)};let Ps=null;const Os=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Ms=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],ks=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],xs=[0,1,1,4];function Fs(e,t,r,n,i){if(r+24>t.length)return;const a=Bs(t,r);if(a&&r+a.frameLength<=t.length){const s=n+i*(9e4*a.samplesPerFrame/a.sampleRate),o={unit:t.subarray(r,r+a.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}function Bs(e,t){const r=e[t+1]>>3&3,n=e[t+1]>>1&3,i=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==r&&0!==i&&15!==i&&3!==a){const s=e[t+2]>>1&1,o=e[t+3]>>6,l=1e3*Os[14*(3===r?3-n:3===n?3:4)+i-1],u=Ms[3*(3===r?0:2===r?1:2)+a],c=3===o?1:2,d=ks[r][n],f=xs[n],h=8*d*f,g=Math.floor(d*l/u+s)*f;if(null===Ps){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Ps=e?parseInt(e[1]):0}return!!Ps&&Ps<=87&&2===n&&l>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:u,channelCount:c,frameLength:g,samplesPerFrame:h}}}function Us(e,t){return!(255!==e[t]||224&~e[t+1]||!(6&e[t+1]))}function Zs(e,t){return t+1<e.length&&Us(e,t)}function Gs(e,t){if(t+1<e.length&&Us(e,t)){const r=4,n=Bs(e,t);let i=r;null!=n&&n.frameLength&&(i=n.frameLength);const a=t+i;return a===e.length||Zs(e,a)}return!1}const Hs=(e,t)=>{let r=0,n=5;t+=n;const i=new Uint32Array(1),a=new Uint32Array(1),s=new Uint8Array(1);for(;n>0;){s[0]=e[t];const o=Math.min(n,8),l=8-o;a[0]=4278190080>>>24+l<<l,i[0]=(s[0]&a[0])>>l,r=r?r<<o|i[0]:i[0],t+=1,n-=o}return r};class $s extends Cs{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){const n=Vs(e,t,r,this.basePTS,this.frameIndex);if(-1!==n){return{sample:e.samples[e.samples.length-1],length:n,missing:0}}}static probe(e){if(!e)return!1;const t=cs(e,0);if(!t)return!1;const r=t.length;return 11===e[r]&&119===e[r+1]&&void 0!==ws(t)&&Hs(e,r)<16}}function Vs(e,t,r,n,i){if(r+8>t.length)return-1;if(11!==t[r]||119!==t[r+1])return-1;const a=t[r+4]>>6;if(a>=3)return-1;const s=[48e3,44100,32e3][a],o=63&t[r+4],l=2*[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][3*o+a];if(r+l>t.length)return-1;const u=t[r+6]>>5;let c=0;2===u?c+=2:(1&u&&1!==u&&(c+=2),4&u&&(c+=2));const d=(t[r+6]<<8|t[r+7])>>12-c&1,f=[2,1,2,3,3,4,4,5][u]+d,h=t[r+5]>>3,g=7&t[r+5],p=new Uint8Array([a<<6|h<<1|g>>2,(3&g)<<6|u<<3|d<<2|o>>4,o<<4&224]),m=n+i*(1536/s*9e4),v=t.subarray(r,r+l);return e.config=p,e.channelCount=f,e.samplerate=s,e.samples.push({unit:v,pts:m}),l}const Ks=/\/emsg[-/]ID3/i;function qs(e,t){return Tt(e.presentationTime)?e.presentationTime/e.timeScale:t+e.presentationTimeDelta/e.timeScale}class Ys{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new di(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,si)}decryptAacSample(e,t,r){const n=e[t].unit;if(n.length<=16)return;const i=n.subarray(16,n.length-n.length%16),a=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(a).then(i=>{const a=new Uint8Array(i);n.set(a,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)}).catch(r)}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t);let n=0;for(let t=32;t<e.length-16;t+=160,n+=16)r.set(e.subarray(t,t+16),n);return r}getAvcDecryptedUnit(e,t){const r=new Uint8Array(t);let n=0;for(let t=32;t<e.length-16;t+=160,n+=16)e.set(r.subarray(n,n+16),t);return e}decryptAvcSample(e,t,r,n,i){const a=Br(i.data),s=this.getAvcEncryptedData(a);this.decryptBuffer(s.buffer).then(s=>{i.data=this.getAvcDecryptedUnit(a,s),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,n)}).catch(n)}decryptAvcSamples(e,t,r,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length)return void n();const i=e[t].units;for(;!(r>=i.length);r++){const a=i[r];if(!(a.data.length<=48||1!==a.type&&5!==a.type||(this.decryptAvcSample(e,t,r,n,a),this.decrypter.isSync())))return}}}}class js{constructor(){this.VideoSample=null}createVideoSample(e,t,r){return{key:e,frame:!1,pts:t,dts:r,units:[],length:0}}getLastNalUnit(e){var t;let r,n=this.VideoSample;if(n&&0!==n.units.length||(n=e[e.length-1]),null!=(t=n)&&t.units){const e=n.units;r=e[e.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){const r=t.samples,n=r.length;if(!n)return void t.dropped++;{const t=r[n-1];e.pts=t.pts,e.dts=t.dts}}t.samples.push(e)}}parseNALu(e,t,r){const n=t.byteLength;let i=e.naluState||0;const a=i,s=[];let o,l,u,c=0,d=-1,f=0;for(-1===i&&(d=0,f=this.getNALuType(t,0),i=0,c=1);c<n;)if(o=t[c++],i)if(1!==i)if(o)if(1===o){if(l=c-i-1,d>=0){const e={data:t.subarray(d,l),type:f};s.push(e)}else{const r=this.getLastNalUnit(e.samples);r&&(a&&c<=4-a&&r.state&&(r.data=r.data.subarray(0,r.data.byteLength-a)),l>0&&(r.data=Or(r.data,t.subarray(0,l)),r.state=0))}c<n?(u=this.getNALuType(t,c),d=c,f=u,i=0):i=-1}else i=0;else i=3;else i=o?0:2;else i=o?0:1;if(d>=0&&i>=0){const e={data:t.subarray(d,n),type:f,state:i};s.push(e)}if(0===s.length){const r=this.getLastNalUnit(e.samples);r&&(r.data=Or(r.data,t))}return e.naluState=i,s}}class zs{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,r=e.byteLength-t,n=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");n.set(e.subarray(r,r+i)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i}skipBits(e){let t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(t=(e-=this.bitsAvailable)>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const r=this.word>>>32-t;if(e>32&&Kt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return 1===this.readBits(1)}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Ws extends js{parsePES(e,t,r,n){const i=this.parseNALu(e,r.data,n);let a,s=this.VideoSample,o=!1;r.data=null,s&&i.length&&!e.audFound&&(this.pushAccessUnit(s,e),s=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(n=>{var i,l;switch(n.type){case 1:{let t=!1;a=!0;const i=n.data;if(o&&i.length>4){const e=this.readSliceType(i);2!==e&&4!==e&&7!==e&&9!==e||(t=!0)}var u;if(t)null!=(u=s)&&u.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null);s||(s=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),s.frame=!0,s.key=t;break}case 5:a=!0,null!=(i=s)&&i.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null),s||(s=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),s.key=!0,s.frame=!0;break;case 6:a=!0,Fr(n.data,1,r.pts,t.samples);break;case 7:{var c,d;a=!0,o=!0;const t=n.data,r=this.readSPS(t);if(!e.sps||e.width!==r.width||e.height!==r.height||(null==(c=e.pixelRatio)?void 0:c[0])!==r.pixelRatio[0]||(null==(d=e.pixelRatio)?void 0:d[1])!==r.pixelRatio[1]){e.width=r.width,e.height=r.height,e.pixelRatio=r.pixelRatio,e.sps=[t];const n=t.subarray(1,4);let i="avc1.";for(let e=0;e<3;e++){let t=n[e].toString(16);t.length<2&&(t="0"+t),i+=t}e.codec=i}break}case 8:a=!0,e.pps=[n.data];break;case 9:a=!0,e.audFound=!0,null!=(l=s)&&l.frame&&(this.pushAccessUnit(s,e),s=null),s||(s=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;case 12:a=!0;break;default:a=!1}if(s&&a){s.units.push(n)}}),n&&s&&(this.pushAccessUnit(s,e),this.VideoSample=null)}getNALuType(e,t){return 31&e[t]}readSliceType(e){const t=new zs(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let r,n=8,i=8;for(let a=0;a<e;a++)0!==i&&(r=t.readEG(),i=(n+r+256)%256),n=0===i?n:i}readSPS(e){const t=new zs(e);let r,n,i,a=0,s=0,o=0,l=0;const u=t.readUByte.bind(t),c=t.readBits.bind(t),d=t.readUEG.bind(t),f=t.readBoolean.bind(t),h=t.skipBits.bind(t),g=t.skipEG.bind(t),p=t.skipUEG.bind(t),m=this.skipScalingList.bind(this);u();const v=u();if(c(5),h(3),u(),p(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){const e=d();if(3===e&&h(1),p(),p(),h(1),f())for(n=3!==e?8:12,i=0;i<n;i++)f()&&m(i<6?16:64,t)}p();const y=d();if(0===y)d();else if(1===y)for(h(1),g(),g(),r=d(),i=0;i<r;i++)g();p(),h(1);const E=d(),T=d(),_=c(1);0===_&&h(1),h(1),f()&&(a=d(),s=d(),o=d(),l=d());let S=[1,1];if(f()&&f()){switch(u()){case 1:S=[1,1];break;case 2:S=[12,11];break;case 3:S=[10,11];break;case 4:S=[16,11];break;case 5:S=[40,33];break;case 6:S=[24,11];break;case 7:S=[20,11];break;case 8:S=[32,11];break;case 9:S=[80,33];break;case 10:S=[18,11];break;case 11:S=[15,11];break;case 12:S=[64,33];break;case 13:S=[160,99];break;case 14:S=[4,3];break;case 15:S=[3,2];break;case 16:S=[2,1];break;case 255:S=[u()<<8|u(),u()<<8|u()]}}return{width:Math.ceil(16*(E+1)-2*a-2*s),height:(2-_)*(T+1)*16-(_?2:4)*(o+l),pixelRatio:S}}}class Xs extends js{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,r,n){const i=this.parseNALu(e,r.data,n);let a,s=this.VideoSample,o=!1;r.data=null,s&&i.length&&!e.audFound&&(this.pushAccessUnit(s,e),s=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),i.forEach(n=>{var i,l;switch(n.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:s||(s=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts)),s.frame=!0,a=!0;break;case 16:case 17:case 18:case 21:var u;if(a=!0,o)null!=(u=s)&&u.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null);s||(s=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),s.key=!0,s.frame=!0;break;case 19:case 20:a=!0,null!=(i=s)&&i.frame&&!s.key&&(this.pushAccessUnit(s,e),s=this.VideoSample=null),s||(s=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),s.key=!0,s.frame=!0;break;case 39:a=!0,Fr(n.data,2,r.pts,t.samples);break;case 32:a=!0,e.vps||("object"!=typeof e.params&&(e.params={}),e.params=xt(e.params,this.readVPS(n.data)),this.initVPS=n.data),e.vps=[n.data];break;case 33:if(a=!0,o=!0,void 0===e.vps||e.vps[0]===this.initVPS||void 0===e.sps||this.matchSPS(e.sps[0],n.data)||(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const t=this.readSPS(n.data);e.width=t.width,e.height=t.height,e.pixelRatio=t.pixelRatio,e.codec=t.codecString,e.sps=[],"object"!=typeof e.params&&(e.params={});for(const r in t.params)e.params[r]=t.params[r]}this.pushParameterSet(e.sps,n.data,e.vps),s||(s=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts)),s.key=!0;break;case 34:if(a=!0,"object"==typeof e.params){if(!e.pps){e.pps=[];const t=this.readPPS(n.data);for(const r in t)e.params[r]=t[r]}this.pushParameterSet(e.pps,n.data,e.vps)}break;case 35:a=!0,e.audFound=!0,null!=(l=s)&&l.frame&&(this.pushAccessUnit(s,e),s=null),s||(s=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts));break;default:a=!1}if(s&&a){s.units.push(n)}}),n&&s&&(this.pushAccessUnit(s,e),this.VideoSample=null)}pushParameterSet(e,t,r){(r&&r[0]===this.initVPS||!r&&!e.length)&&e.push(t)}getNALuType(e,t){return(126&e[t])>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let r=0;for(let n=0;n<e.byteLength;n++)n>=2&&3===e[n]&&0===e[n-1]&&0===e[n-2]||(t[r]=e[n],r++);return new Uint8Array(t.buffer,0,r)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new zs(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);return{numTemporalLayers:t.readBits(3)+1,temporalIdNested:t.readBoolean()}}readSPS(e){const t=new zs(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const r=t.readBits(3);t.readBoolean();const n=t.readBits(2),i=t.readBoolean(),a=t.readBits(5),s=t.readUByte(),o=t.readUByte(),l=t.readUByte(),u=t.readUByte(),c=t.readUByte(),d=t.readUByte(),f=t.readUByte(),h=t.readUByte(),g=t.readUByte(),p=t.readUByte(),m=t.readUByte(),v=[],y=[];for(let e=0;e<r;e++)v.push(t.readBoolean()),y.push(t.readBoolean());if(r>0)for(let e=r;e<8;e++)t.readBits(2);for(let e=0;e<r;e++)v[e]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),y[e]&&t.readUByte();t.readUEG();const E=t.readUEG();3==E&&t.skipBits(1);const T=t.readUEG(),_=t.readUEG(),S=t.readBoolean();let b=0,A=0,I=0,R=0;S&&(b+=t.readUEG(),A+=t.readUEG(),I+=t.readUEG(),R+=t.readUEG());const w=t.readUEG(),D=t.readUEG(),L=t.readUEG();for(let e=t.readBoolean()?0:r;e<=r;e++)t.skipUEG(),t.skipUEG(),t.skipUEG();t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.readBoolean()){if(t.readBoolean())for(let e=0;e<4;e++)for(let r=0;r<(3===e?2:6);r++){if(t.readBoolean()){const r=Math.min(64,1<<4+(e<<1));e>1&&t.readEG();for(let e=0;e<r;e++)t.readEG()}else t.readUEG()}}t.readBoolean(),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const C=t.readUEG();let N=0;for(let e=0;e<C;e++){let r=!1;if(0!==e&&(r=t.readBoolean()),r){e===C&&t.readUEG(),t.readBoolean(),t.readUEG();let r=0;for(let e=0;e<=N;e++){const e=t.readBoolean();let n=!1;e||(n=t.readBoolean()),(e||n)&&r++}N=r}else{const e=t.readUEG(),r=t.readUEG();N=e+r;for(let r=0;r<e;r++)t.readUEG(),t.readBoolean();for(let e=0;e<r;e++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const e=t.readUEG();for(let r=0;r<e;r++){for(let e=0;e<L+4;e++)t.readBits(1);t.readBits(1)}}let P=0,O=1,M=1,k=!0,x=1,F=0;t.readBoolean(),t.readBoolean();let B=!1;if(t.readBoolean()){if(t.readBoolean()){const e=t.readUByte();e>0&&e<16?(O=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][e-1],M=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][e-1]):255===e&&(O=t.readBits(16),M=t.readBits(16))}t.readBoolean()&&t.readBoolean();if(t.readBoolean()){t.readBits(3),t.readBoolean();t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())}t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),B=t.readBoolean(),B&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG());if(t.readBoolean()){x=t.readBits(32),F=t.readBits(32);t.readBoolean()&&t.readUEG();if(t.readBoolean()){const e=t.readBoolean(),n=t.readBoolean();let i=!1;(e||n)&&(i=t.readBoolean(),i&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),i&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let a=0;a<=r;a++){k=t.readBoolean();let r=!1;k||t.readBoolean()?t.readEG():r=t.readBoolean();const a=r?1:t.readUEG()+1;if(e)for(let e=0;e<a;e++)t.readUEG(),t.readUEG(),i&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(n)for(let e=0;e<a;e++)t.readUEG(),t.readUEG(),i&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let U=T,Z=_;if(S){let e=1,t=1;1===E?e=t=2:2==E&&(e=2),U=T-e*A-e*b,Z=_-t*R-t*I}const G=n?["A","B","C"][n]:"",H=s<<24|o<<16|l<<8|u;let $=0;for(let e=0;e<32;e++)$=($|(H>>e&1)<<31-e)>>>0;let V=$.toString(16);1===a&&"2"===V&&(V="6");return{codecString:`hvc1.${G}${a}.${V}.${i?"H":"L"}${m}.B0`,params:{general_tier_flag:i,general_profile_idc:a,general_profile_space:n,general_profile_compatibility_flags:[s,o,l,u],general_constraint_indicator_flags:[c,d,f,h,g,p],general_level_idc:m,bit_depth:w+8,bit_depth_luma_minus8:w,bit_depth_chroma_minus8:D,min_spatial_segmentation_idc:P,chroma_format_idc:E,frame_rate:{fixed:k,fps:F/x}},width:U,height:Z,pixelRatio:[O,M]}}readPPS(e){const t=new zs(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2);t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),n=t.readBoolean();let i=1;return n&&r?i=0:n?i=3:r&&(i=2),{parallelismType:i}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Qs=188;class Js{constructor(e,t,r,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.logger=n,this.videoParser=null}static probe(e,t){const r=Js.syncOffset(e);return r>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),-1!==r}static syncOffset(e){const t=e.length;let r=Math.min(940,t-Qs)+1,n=0;for(;n<r;){let i=!1,a=-1,s=0;for(let o=n;o<t;o+=Qs){if(71!==e[o]||t-o!==Qs&&71!==e[o+Qs]){if(s)return-1;break}if(s++,-1===a&&(a=o,0!==a&&(r=Math.min(a+18612,e.length-Qs)+1)),i||(i=0===eo(e,o)),i&&s>1&&(0===a&&s>2||o+Qs>r))return a}n++}return-1}static createTrack(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:vr[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}}resetInitSegment(e,t,r,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Js.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=Js.createTrack("audio",n),this._id3Track=Js.createTrack("id3"),this._txtTrack=Js.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=r}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:r}=this;e&&(e.pesData=null),t&&(t.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,r=!1,n=!1){let i;r||(this.sampleAes=null);const a=this._videoTrack,s=this._audioTrack,o=this._id3Track,l=this._txtTrack;let u=a.pid,c=a.pesData,d=s.pid,f=o.pid,h=s.pesData,g=o.pesData,p=null,m=this.pmtParsed,v=this._pmtId,y=e.length;if(this.remainderData&&(y=(e=Or(this.remainderData,e)).length,this.remainderData=null),y<Qs&&!n)return this.remainderData=e,{audioTrack:s,videoTrack:a,id3Track:o,textTrack:l};const E=Math.max(0,Js.syncOffset(e));y-=(y-E)%Qs,y<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,y,e.buffer.byteLength-y));let T=0;for(let t=E;t<y;t+=Qs)if(71===e[t]){const n=!!(64&e[t+1]),y=eo(e,t);let T;if((48&e[t+3])>>4>1){if(T=t+5+e[t+4],T===t+Qs)continue}else T=t+4;switch(y){case u:n&&(c&&(i=ao(c,this.logger))&&(this.readyVideoParser(a.segmentCodec),null!==this.videoParser&&this.videoParser.parsePES(a,l,i,!1)),c={data:[],size:0}),c&&(c.data.push(e.subarray(T,t+Qs)),c.size+=t+Qs-T);break;case d:if(n){if(h&&(i=ao(h,this.logger)))switch(s.segmentCodec){case"aac":this.parseAACPES(s,i);break;case"mp3":this.parseMPEGPES(s,i);break;case"ac3":this.parseAC3PES(s,i)}h={data:[],size:0}}h&&(h.data.push(e.subarray(T,t+Qs)),h.size+=t+Qs-T);break;case f:n&&(g&&(i=ao(g,this.logger))&&this.parseID3PES(o,i),g={data:[],size:0}),g&&(g.data.push(e.subarray(T,t+Qs)),g.size+=t+Qs-T);break;case 0:n&&(T+=e[T]+1),v=this._pmtId=to(e,T);break;case v:{n&&(T+=e[T]+1);const i=ro(e,T,this.typeSupported,r,this.observer,this.logger);u=i.videoPid,u>0&&(a.pid=u,a.segmentCodec=i.segmentVideoCodec),d=i.audioPid,d>0&&(s.pid=d,s.segmentCodec=i.segmentAudioCodec),f=i.id3Pid,f>0&&(o.pid=f),null===p||m||(this.logger.warn(`MPEG-TS PMT found at ${t} after unknown PID '${p}'. Backtracking to sync byte @${E} to parse all TS packets.`),p=null,t=E-188),m=this.pmtParsed=!0;break}case 17:case 8191:break;default:p=y}}else T++;T>0&&no(this.observer,new Error(`Found ${T} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=c,s.pesData=h,o.pesData=g;const _={audioTrack:s,videoTrack:a,id3Track:o,textTrack:l};return n&&this.extractRemainingSamples(_),_}flush(){const{remainderData:e}=this;let t;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:r,id3Track:n,textTrack:i}=e,a=r.pesData,s=t.pesData,o=n.pesData;let l;if(a&&(l=ao(a,this.logger))?(this.readyVideoParser(r.segmentCodec),null!==this.videoParser&&(this.videoParser.parsePES(r,i,l,!0),r.pesData=null)):r.pesData=a,s&&(l=ao(s,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,l);break;case"mp3":this.parseMPEGPES(t,l);break;case"ac3":this.parseAC3PES(t,l)}t.pesData=null}else null!=s&&s.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=s;o&&(l=ao(o,this.logger))?(this.parseID3PES(n,l),n.pesData=null):n.pesData=o}demuxSampleAes(e,t,r){const n=this.demux(e,r,!0,!this.config.progressive),i=this.sampleAes=new Ys(this.observer,this.config,t);return this.decrypt(n,i)}readyVideoParser(e){null===this.videoParser&&("avc"===e?this.videoParser=new Ws:"hevc"===e&&(this.videoParser=new Xs))}decrypt(e,t){return new Promise(r=>{const{audioTrack:n,videoTrack:i}=e;n.samples&&"aac"===n.segmentCodec?t.decryptAacSamples(n.samples,0,()=>{i.samples?t.decryptAvcSamples(i.samples,0,0,()=>{r(e)}):r(e)}):i.samples&&t.decryptAvcSamples(i.samples,0,0,()=>{r(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let r=0;const n=this.aacOverFlow;let i,a,s,o=t.data;if(n){this.aacOverFlow=null;const t=n.missing,i=n.sample.unit.byteLength;if(-1===t)o=Or(n.sample.unit,o);else{const a=i-t;n.sample.unit.set(o.subarray(0,t),a),e.samples.push(n.sample),r=n.missing}}for(i=r,a=o.length;i<a-1&&!gs(o,i);i++);if(i!==r){let e;const t=i<a-1;if(e=t?`AAC PES did not start with ADTS header,offset:${i}`:"No ADTS header found in AAC PES",no(this.observer,new Error(e),t,this.logger),!t)return}if(ms(e,this.observer,o,i,this.audioCodec),void 0!==t.pts)s=t.pts;else{if(!n)return void this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");{const t=vs(e.samplerate);s=n.sample.pts+t}}let l,u=0;for(;i<a;){if(l=ys(e,o,i,s,u),i+=l.length,l.missing){this.aacOverFlow=l;break}for(u++;i<a-1&&!gs(o,i);i++);}}parseMPEGPES(e,t){const r=t.data,n=r.length;let i=0,a=0;const s=t.pts;if(void 0!==s)for(;a<n;)if(Zs(r,a)){const t=Fs(e,r,a,s,i);if(!t)break;a+=t.length,i++}else a++;else this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")}parseAC3PES(e,t){{const r=t.data,n=t.pts;if(void 0===n)return void this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");const i=r.length;let a,s=0,o=0;for(;o<i&&(a=Vs(e,r,o,n,s++))>0;)o+=a}}parseID3PES(e,t){if(void 0===t.pts)return void this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");const r=xt({},t,{type:this._videoTrack?Ds.emsg:Ds.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(r)}}function eo(e,t){return((31&e[t+1])<<8)+e[t+2]}function to(e,t){return(31&e[t+10])<<8|e[t+11]}function ro(e,t,r,n,i,a){const s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=t+3+((15&e[t+1])<<8|e[t+2])-4;for(t+=12+((15&e[t+10])<<8|e[t+11]);t<o;){const o=eo(e,t),l=(15&e[t+3])<<8|e[t+4];switch(e[t]){case 207:if(!n){io("ADTS AAC",a);break}case 15:-1===s.audioPid&&(s.audioPid=o);break;case 21:-1===s.id3Pid&&(s.id3Pid=o);break;case 219:if(!n){io("H.264",a);break}case 27:-1===s.videoPid&&(s.videoPid=o);break;case 3:case 4:r.mpeg||r.mp3?-1===s.audioPid&&(s.audioPid=o,s.segmentAudioCodec="mp3"):a.log("MPEG audio found, not supported in this browser");break;case 193:if(!n){io("AC-3",a);break}case 129:r.ac3?-1===s.audioPid&&(s.audioPid=o,s.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(-1===s.audioPid&&l>0){let n=t+5,i=l;for(;i>2;){if(106===e[n])!0!==r.ac3?a.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=o,s.segmentAudioCodec="ac3");const t=e[n+1]+2;n+=t,i-=t}}break;case 194:case 135:return no(i,new Error("Unsupported EC-3 in M2TS found"),void 0,a),s;case 36:-1===s.videoPid&&(s.videoPid=o,s.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"))}t+=l+5}return s}function no(e,t,r,n){n.warn(`parsing error: ${t.message}`),e.emit(It.ERROR,It.ERROR,{type:bt.MEDIA_ERROR,details:At.FRAG_PARSING_ERROR,fatal:!1,levelRetry:r,error:t,reason:t.message})}function io(e,t){t.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function ao(e,t){let r,n,i,a,s,o=0;const l=e.data;if(!e||0===e.size)return null;for(;l[0].length<19&&l.length>1;)l[0]=Or(l[0],l[1]),l.splice(1,1);r=l[0];if(1===(r[0]<<16)+(r[1]<<8)+r[2]){if(n=(r[4]<<8)+r[5],n&&n>e.size-6)return null;const u=r[7];192&u&&(a=536870912*(14&r[9])+4194304*(255&r[10])+16384*(254&r[11])+128*(255&r[12])+(254&r[13])/2,64&u?(s=536870912*(14&r[14])+4194304*(255&r[15])+16384*(254&r[16])+128*(255&r[17])+(254&r[18])/2,a-s>54e5&&(t.warn(`${Math.round((a-s)/9e4)}s delta between PTS and DTS, align them`),a=s)):s=a),i=r[8];let c=i+9;if(e.size<=c)return null;e.size-=c;const d=new Uint8Array(e.size);for(let e=0,t=l.length;e<t;e++){r=l[e];let t=r.byteLength;if(c){if(c>t){c-=t;continue}r=r.subarray(c),t-=c,c=0}d.set(r,o),o+=t}return n&&(n-=i+3),{data:d,pts:a,dts:s,len:n}}return null}class so{static getSilentFrame(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}}}const oo=Math.pow(2,32)-1;class lo{static init(){let e;for(e in lo.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},lo.types)lo.types.hasOwnProperty(e)&&(lo.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);lo.HDLR_TYPES={video:t,audio:r};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i=new Uint8Array([0,0,0,0,0,0,0,0]);lo.STTS=lo.STSC=lo.STCO=i,lo.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),lo.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),lo.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),lo.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),s=new Uint8Array([97,118,99,49]),o=new Uint8Array([0,0,0,1]);lo.FTYP=lo.box(lo.types.ftyp,a,o,a,s),lo.DINF=lo.box(lo.types.dinf,lo.box(lo.types.dref,n))}static box(e,...t){let r=8,n=t.length;const i=n;for(;n--;)r+=t[n].byteLength;const a=new Uint8Array(r);for(a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=255&r,a.set(e,4),n=0,r=8;n<i;n++)a.set(t[n],r),r+=t[n].byteLength;return a}static hdlr(e){return lo.box(lo.types.hdlr,lo.HDLR_TYPES[e])}static mdat(e){return lo.box(lo.types.mdat,e)}static mdhd(e,t){t*=e;const r=Math.floor(t/(oo+1)),n=Math.floor(t%(oo+1));return lo.box(lo.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}static mdia(e){return lo.box(lo.types.mdia,lo.mdhd(e.timescale||0,e.duration||0),lo.hdlr(e.type),lo.minf(e))}static mfhd(e){return lo.box(lo.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}static minf(e){return"audio"===e.type?lo.box(lo.types.minf,lo.box(lo.types.smhd,lo.SMHD),lo.DINF,lo.stbl(e)):lo.box(lo.types.minf,lo.box(lo.types.vmhd,lo.VMHD),lo.DINF,lo.stbl(e))}static moof(e,t,r){return lo.box(lo.types.moof,lo.mfhd(e),lo.traf(r,t))}static moov(e){let t=e.length;const r=[];for(;t--;)r[t]=lo.trak(e[t]);return lo.box.apply(null,[lo.types.moov,lo.mvhd(e[0].timescale||0,e[0].duration||0)].concat(r).concat(lo.mvex(e)))}static mvex(e){let t=e.length;const r=[];for(;t--;)r[t]=lo.trex(e[t]);return lo.box.apply(null,[lo.types.mvex,...r])}static mvhd(e,t){t*=e;const r=Math.floor(t/(oo+1)),n=Math.floor(t%(oo+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return lo.box(lo.types.mvhd,i)}static sdtp(e){const t=e.samples||[],r=new Uint8Array(4+t.length);let n,i;for(n=0;n<t.length;n++)i=t[n].flags,r[n+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return lo.box(lo.types.sdtp,r)}static stbl(e){return lo.box(lo.types.stbl,lo.stsd(e),lo.box(lo.types.stts,lo.STTS),lo.box(lo.types.stsc,lo.STSC),lo.box(lo.types.stsz,lo.STSZ),lo.box(lo.types.stco,lo.STCO))}static avc1(e){let t,r,n,i=[],a=[];for(t=0;t<e.sps.length;t++)r=e.sps[t],n=r.byteLength,i.push(n>>>8&255),i.push(255&n),i=i.concat(Array.prototype.slice.call(r));for(t=0;t<e.pps.length;t++)r=e.pps[t],n=r.byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(r));const s=lo.box(lo.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|e.sps.length].concat(i).concat([e.pps.length]).concat(a))),o=e.width,l=e.height,u=e.pixelRatio[0],c=e.pixelRatio[1];return lo.box(lo.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),s,lo.box(lo.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),lo.box(lo.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,c>>24,c>>16&255,c>>8&255,255&c])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,255&t,0,0])}static mp4a(e){return lo.box(lo.types.mp4a,lo.audioStsd(e),lo.box(lo.types.esds,lo.esds(e)))}static mp3(e){return lo.box(lo.types[".mp3"],lo.audioStsd(e))}static ac3(e){return lo.box(lo.types["ac-3"],lo.audioStsd(e),lo.box(lo.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if("audio"===e.type){if("aac"===t)return lo.box(lo.types.stsd,lo.STSD,lo.mp4a(e));if("ac3"===t&&e.config)return lo.box(lo.types.stsd,lo.STSD,lo.ac3(e));if("mp3"===t&&"mp3"===e.codec)return lo.box(lo.types.stsd,lo.STSD,lo.mp3(e))}else{if(!e.pps||!e.sps)throw new Error("video track missing pps or sps");if("avc"===t)return lo.box(lo.types.stsd,lo.STSD,lo.avc1(e));if("hevc"===t&&e.vps)return lo.box(lo.types.stsd,lo.STSD,lo.hvc1(e))}throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,r=(e.duration||0)*(e.timescale||0),n=e.width||0,i=e.height||0,a=Math.floor(r/(oo+1)),s=Math.floor(r%(oo+1));return lo.box(lo.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,i>>8&255,255&i,0,0]))}static traf(e,t){const r=lo.sdtp(e),n=e.id,i=Math.floor(t/(oo+1)),a=Math.floor(t%(oo+1));return lo.box(lo.types.traf,lo.box(lo.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),lo.box(lo.types.tfdt,new Uint8Array([1,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a])),lo.trun(e,r.length+16+20+8+16+8+8),r)}static trak(e){return e.duration=e.duration||4294967295,lo.box(lo.types.trak,lo.tkhd(e),lo.mdia(e))}static trex(e){const t=e.id;return lo.box(lo.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const r=e.samples||[],n=r.length,i=12+16*n,a=new Uint8Array(i);let s,o,l,u,c,d;for(t+=8+i,a.set(["video"===e.type?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,t>>>24&255,t>>>16&255,t>>>8&255,255&t],0),s=0;s<n;s++)o=r[s],l=o.duration,u=o.size,c=o.flags,d=o.cts,a.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,u>>>24&255,u>>>16&255,u>>>8&255,255&u,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,d>>>24&255,d>>>16&255,d>>>8&255,255&d],12+16*s);return lo.box(lo.types.trun,a)}static initSegment(e){lo.types||lo.init();const t=lo.moov(e);return Or(lo.FTYP,t)}static hvc1(e){const t=e.params,r=[e.vps,e.sps,e.pps],n=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),3|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),r.length]);let i=n.length;for(let e=0;e<r.length;e+=1){i+=3;for(let t=0;t<r[e].length;t+=1)i+=2+r[e][t].length}const a=new Uint8Array(i);a.set(n,0),i=n.length;const s=r.length-1;for(let e=0;e<r.length;e+=1){a.set(new Uint8Array([32+e|(e===s?128:0),0,r[e].length]),i),i+=3;for(let t=0;t<r[e].length;t+=1)a.set(new Uint8Array([r[e][t].length>>8,255&r[e][t].length]),i),i+=2,a.set(r[e][t],i),i+=r[e][t].length}const o=lo.box(lo.types.hvcC,a),l=e.width,u=e.height,c=e.pixelRatio[0],d=e.pixelRatio[1];return lo.box(lo.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,lo.box(lo.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),lo.box(lo.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,d>>24,d>>16&255,d>>8&255,255&d])))}}lo.types=void 0,lo.HDLR_TYPES=void 0,lo.STTS=void 0,lo.STSC=void 0,lo.STCO=void 0,lo.STSZ=void 0,lo.VMHD=void 0,lo.SMHD=void 0,lo.STSD=void 0,lo.FTYP=void 0,lo.DINF=void 0;function uo(e,t,r=1,n=!1){const i=e*t*r;return n?Math.round(i):i}function co(e,t=!1){return uo(e,1e3,1/9e4,t)}function fo(e){const{baseTime:t,timescale:r,trackId:n}=e;return`${t/r} (${t}/${r}) trackId: ${n}`}let ho,go=null,po=null;function mo(e,t,r,n){return{duration:t,size:r,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}}class vo extends Ut{constructor(e,t,r,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,null===go){const e=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);go=e?parseInt(e[1]):0}if(null===po){const e=navigator.userAgent.match(/Safari\/(\d+)/i);po=e?parseInt(e[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;t&&e&&e.trackId===t.trackId&&e.baseTime===t.baseTime&&e.timescale===t.timescale||this.log(`Reset initPTS: ${t?fo(t):t} > ${e?fo(e):e}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const r=e[0].pts,n=e.reduce((e,n)=>{let i=n.pts,a=i-e;return a<-4294967296&&(t=!0,i=yo(i,r),a=i-e),a>0?e:i},r);return t&&this.debug("PTS rollover detected"),n}remux(e,t,r,n,i,a,s,o){let l,u,c,d,f,h,g=i,p=i;const m=e.pid>-1,v=t.pid>-1,y=t.samples.length,E=e.samples.length>0,T=s&&y>0||y>1;if((!m||E)&&(!v||T)||this.ISGenerated||s){if(this.ISGenerated){var _,S,b,A;const e=this.videoTrackConfig;(e&&(t.width!==e.width||t.height!==e.height||(null==(_=t.pixelRatio)?void 0:_[0])!==(null==(S=e.pixelRatio)?void 0:S[0])||(null==(b=t.pixelRatio)?void 0:b[1])!==(null==(A=e.pixelRatio)?void 0:A[1]))||!e&&T||null===this.nextAudioTs&&E)&&this.resetInitSegment()}this.ISGenerated||(c=this.generateIS(e,t,i,a));const r=this.isVideoContiguous;let n,s=-1;if(T&&(s=function(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}(t.samples),!r&&this.config.forceKeyFrameOnDiscontinuity))if(h=!0,s>0){this.warn(`Dropped ${s} out of ${y} video samples due to a missing keyframe`);const e=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(s),t.dropped+=s,p+=(t.samples[0].pts-e)/t.inputTimeScale,n=p}else-1===s&&(this.warn(`No keyframe found out of ${y} video samples`),h=!1);if(this.ISGenerated){if(E&&T){const r=this.getVideoStartPts(t.samples),n=(yo(e.samples[0].pts,r)-r)/t.inputTimeScale;g+=Math.max(0,n),p+=Math.max(0,-n)}if(E){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),c=this.generateIS(e,t,i,a)),u=this.remuxAudio(e,g,this.isAudioContiguous,a,v||T||o===Nt?p:void 0),T){const n=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),c=this.generateIS(e,t,i,a)),l=this.remuxVideo(t,p,r,n)}}else T&&(l=this.remuxVideo(t,p,r,0));l&&(l.firstKeyFrame=s,l.independent=-1!==s,l.firstKeyFramePTS=n)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(f=Eo(r,i,this._initPTS,this._initDTS)),n.samples.length&&(d=To(n,i,this._initPTS))),{audio:u,video:l,initSegment:c,independent:h,text:d,id3:f}}computeInitPts(e,t,r,n){const i=Math.round(r*t);let a=yo(e,i);if(a<i+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(i-a)/t} ${n}`);a<i+t;)a+=8589934592;return a-i}generateIS(e,t,r,n){const i=e.samples,a=t.samples,s=this.typeSupported,o={},l=this._initPTS;let u,c,d,f=!l||n,h="audio/mp4",g=-1;if(f&&(u=c=1/0),e.config&&i.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":s.mpeg?(h="audio/mpeg",e.codec=""):s.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3"}o.audio={id:"audio",container:h,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&s.mpeg?new Uint8Array(0):lo.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(g=e.id,d=e.inputTimeScale,l&&d===l.timescale?f=!1:u=c=this.computeInitPts(i[0].pts,d,r,"audio"))}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,o.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:lo.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(g=t.id,d=t.inputTimeScale,l&&d===l.timescale)f=!1;else{const e=this.getVideoStartPts(a),t=yo(a[0].dts,e),n=this.computeInitPts(t,d,r,"video"),i=this.computeInitPts(e,d,r,"video");c=Math.min(c,n),u=Math.min(u,i)}this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(o).length)return this.ISGenerated=!0,f?(l&&this.warn(`Timestamps at playlist time: ${n?"":"~"}${r} ${u/d} != initPTS: ${l.baseTime/l.timescale} (${l.baseTime}/${l.timescale}) trackId: ${l.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${u/d} (${u}/${d}) trackId: ${g}`),this._initPTS={baseTime:u,timescale:d,trackId:g},this._initDTS={baseTime:c,timescale:d,trackId:g}):u=d=void 0,{tracks:o,initPTS:u,timescale:d,trackId:g}}remuxVideo(e,t,r,n){const i=e.inputTimeScale,a=e.samples,s=[],o=a.length,l=this._initPTS,u=l.baseTime*i/l.timescale;let c,d,f=this.nextVideoTs,h=8,g=this.videoSampleDuration,p=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,v=!1;if(!r||null===f){const e=u+t*i,n=a[0].pts-yo(a[0].dts,a[0].pts);go&&null!==f&&Math.abs(e-n-(f+u))<15e3?r=!0:f=e-n-u}const y=f+u;for(let e=0;e<o;e++){const t=a[e];t.pts=yo(t.pts,y),t.dts=yo(t.dts,y),t.dts<a[e>0?e-1:e].dts&&(v=!0)}v&&a.sort(function(e,t){const r=e.dts-t.dts,n=e.pts-t.pts;return r||n}),c=a[0].dts,d=a[a.length-1].dts;const E=d-c,T=E?Math.round(E/(o-1)):g||e.inputTimeScale/30;if(r){const r=c-y,n=r>T,i=r<-1;if((n||i)&&(n?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${co(r,!0)} ms (${r}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${co(-r,!0)} ms (${r}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!i||y>=a[0].pts||go)){c=y;const e=a[0].pts-r;if(n)a[0].dts=c,a[0].pts=e;else{let t=!0;for(let n=0;n<a.length&&!(a[n].dts>e&&t);n++){const e=a[n].pts;if(a[n].dts-=r,a[n].pts-=r,n<a.length-1){const r=a[n+1].pts;t=r<=a[n].pts==r<=e}}}this.log(`Video: Initial PTS/DTS adjusted: ${co(e,!0)}/${co(c,!0)}, delta: ${co(r,!0)} ms`)}}c=Math.max(0,c);let _=0,S=0,b=c;for(let e=0;e<o;e++){const t=a[e],r=t.units,n=r.length;let i=0;for(let e=0;e<n;e++)i+=r[e].data.length;S+=i,_+=n,t.length=i,t.dts<b?(t.dts=b,b+=T/4|0||1):b=t.dts,p=Math.min(t.pts,p),m=Math.max(t.pts,m)}d=a[o-1].dts;const A=S+4*_+8;let I;try{I=new Uint8Array(A)}catch(e){return void this.observer.emit(It.ERROR,It.ERROR,{type:bt.MUX_ERROR,details:At.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:A,reason:`fail allocating video mdat ${A}`})}const R=new DataView(I.buffer);R.setUint32(0,A),I.set(lo.types.mdat,4);let w=!1,D=Number.POSITIVE_INFINITY,L=Number.POSITIVE_INFINITY,C=Number.NEGATIVE_INFINITY,N=Number.NEGATIVE_INFINITY;for(let e=0;e<o;e++){const t=a[e],r=t.units;let l,c=0;for(let e=0,t=r.length;e<t;e++){const t=r[e],n=t.data,i=t.data.byteLength;R.setUint32(h,i),h+=4,I.set(n,h),h+=i,c+=4+i}if(e<o-1)g=a[e+1].dts-t.dts,l=a[e+1].pts-t.pts;else{const r=this.config,s=e>0?t.dts-a[e-1].dts:T;if(l=e>0?t.pts-a[e-1].pts:T,r.stretchShortVideoTrack&&null!==this.nextAudioTs){const e=Math.floor(r.maxBufferHole*i),a=(n?p+n*i:this.nextAudioTs+u)-t.pts;a>e?(g=a-s,g<0?g=s:w=!0,this.log(`It is approximately ${a/90} ms to the next segment; using duration ${g/90} ms for the last video frame.`)):g=s}else g=s}const d=Math.round(t.pts-t.dts);D=Math.min(D,g),C=Math.max(C,g),L=Math.min(L,l),N=Math.max(N,l),s.push(mo(t.key,g,c,d))}if(s.length)if(go){if(go<70){const e=s[0].flags;e.dependsOn=2,e.isNonSync=0}}else if(po&&N-L<C-D&&T/C<.025&&0===s[0].cts){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let e=c;for(let t=0,r=s.length;t<r;t++){const n=e+s[t].duration,i=e+s[t].cts;if(t<r-1){const e=n+s[t+1].cts;s[t].duration=e-i}else s[t].duration=t?s[t-1].duration:T;s[t].cts=0,e=n}}g=w||!g?T:g;const P=d+g;this.nextVideoTs=f=P-u,this.videoSampleDuration=g,this.isVideoContiguous=!0;const O={data1:lo.moof(e.sequenceNumber++,c,xt(e,{samples:s})),data2:I,startPTS:(p-u)/i,endPTS:(m+g-u)/i,startDTS:(c-u)/i,endDTS:f/i,type:"video",hasAudio:!1,hasVideo:!0,nb:s.length,dropped:e.dropped};return e.samples=[],e.dropped=0,O}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return 1152;case"ac3":return 1536;default:return 1024}}remuxAudio(e,t,r,n,i){const a=e.inputTimeScale,s=a/(e.samplerate?e.samplerate:a),o=this.getSamplesPerFrame(e),l=o*s,u=this._initPTS,c="mp3"===e.segmentCodec&&this.typeSupported.mpeg,d=[],f=void 0!==i;let h=e.samples,g=c?0:8,p=this.nextAudioTs||-1;const m=u.baseTime*a/u.timescale,v=m+t*a;if(this.isAudioContiguous=r=r||h.length&&p>0&&(n&&Math.abs(v-(p+m))<9e3||Math.abs(yo(h[0].pts,v)-(p+m))<20*l),h.forEach(function(e){e.pts=yo(e.pts,v)}),!r||p<0){const e=h.length;if(h=h.filter(e=>e.pts>=0),e!==h.length&&this.warn(`Removed ${h.length-e} of ${e} samples (initPTS ${m} / ${a})`),!h.length)return;p=0===i?0:n&&!f?Math.max(0,v-m):h[0].pts-m}if("aac"===e.segmentCodec){const t=this.config.maxAudioFramesDrift;for(let r=0,n=p+m;r<h.length;r++){const i=h[r],s=i.pts,o=s-n,u=Math.abs(1e3*o/a);if(o<=-t*l&&f)0===r&&(this.warn(`Audio frame @ ${(s/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*o/a)} ms.`),this.nextAudioTs=p=s-m,n=s);else if(o>=t*l&&u<1e4&&f){let t=Math.round(o/l);for(n=s-t*l;n<0&&t&&l;)t--,n+=l;0===r&&(this.nextAudioTs=p=n-m),this.warn(`Injecting ${t} audio frames @ ${((n-m)/a).toFixed(3)}s due to ${Math.round(1e3*o/a)} ms gap.`);for(let a=0;a<t;a++){let t=so.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);t||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),t=i.unit.subarray()),h.splice(r,0,{unit:t,pts:n}),n+=l,r++}}i.pts=n,n+=l}}let y,E=null,T=null,_=0,S=h.length;for(;S--;)_+=h[S].unit.byteLength;for(let t=0,n=h.length;t<n;t++){const n=h[t],i=n.unit;let a=n.pts;if(null!==T){d[t-1].duration=Math.round((a-T)/s)}else{if(r&&"aac"===e.segmentCodec&&(a=p+m),E=a,!(_>0))return;_+=g;try{y=new Uint8Array(_)}catch(e){return void this.observer.emit(It.ERROR,It.ERROR,{type:bt.MUX_ERROR,details:At.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:_,reason:`fail allocating audio mdat ${_}`})}if(!c){new DataView(y.buffer).setUint32(0,_),y.set(lo.types.mdat,4)}}y.set(i,g);const l=i.byteLength;g+=l,d.push(mo(!0,o,l,0)),T=a}const b=d.length;if(!b)return;const A=d[d.length-1];p=T-m,this.nextAudioTs=p+s*A.duration;const I=c?new Uint8Array(0):lo.moof(e.sequenceNumber++,E/s,xt({},e,{samples:d}));e.samples=[];const R=(E-m)/a,w=p/a,D={data1:I,data2:y,startPTS:R,endPTS:w,startDTS:R,endDTS:w,type:"audio",hasAudio:!0,hasVideo:!1,nb:b};return this.isAudioContiguous=!0,D}}function yo(e,t){let r;if(null===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}function Eo(e,t,r,n){const i=e.samples.length;if(!i)return;const a=e.inputTimeScale;for(let s=0;s<i;s++){const i=e.samples[s];i.pts=yo(i.pts-r.baseTime*a/r.timescale,t*a)/a,i.dts=yo(i.dts-n.baseTime*a/n.timescale,t*a)/a}const s=e.samples;return e.samples=[],{samples:s}}function To(e,t,r){const n=e.samples.length;if(!n)return;const i=e.inputTimeScale;for(let a=0;a<n;a++){const n=e.samples[a];n.pts=yo(n.pts-r.baseTime*i/r.timescale,t*i)/i}e.samples.sort((e,t)=>e.pts-t.pts);const a=e.samples;return e.samples=[],{samples:a}}function _o(e,t,r=!1){return void 0!==(null==e?void 0:e.start)?(e.start+(r?e.duration:0))/e.timescale:t}function So(e,t,r){const n=e.codec;if(n&&n.length>4)return n;if(t===or){if("ec-3"===n||"ac-3"===n||"alac"===n)return n;if("fLaC"===n||"Opus"===n){return Xr(n,!1)}return r.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"}return r.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1"}try{ho=self.performance.now.bind(self.performance)}catch(e){ho=Date.now}const bo=[{demux:class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,n){const i=this.videoTrack=Ls("video",1),a=this.audioTrack=Ls("audio",1),s=this.txtTrack=Ls("text",1);if(this.id3Track=Ls("id3",1),this.timeOffset=0,null==e||!e.byteLength)return;const o=Ir(e);if(o.video){const{id:e,timescale:t,codec:r,supplemental:n}=o.video;i.id=e,i.timescale=s.timescale=t,i.codec=r,i.supplemental=n}if(o.audio){const{id:e,timescale:t,codec:r}=o.audio;a.id=e,a.timescale=t,a.codec=r}s.id=vr.text,i.sampleDuration=0,i.duration=a.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return function(e){const t=e.byteLength;for(let r=0;r<t;){const n=Tr(e,r);if(n>8&&109===e[r+4]&&111===e[r+5]&&111===e[r+6]&&102===e[r+7])return!0;r=n>1?r+n:t}return!1}(e)}demux(e,t){this.timeOffset=t;let r=e;const n=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=Or(this.remainderData,e));const t=function(e){const t={valid:null,remainder:null},r=br(e,["moof"]);if(r.length<2)return t.remainder=e,t;const n=r[r.length-1];return t.valid=e.slice(0,n.byteOffset-8),t.remainder=e.slice(n.byteOffset-8),t}(r);this.remainderData=t.remainder,n.samples=t.valid||new Uint8Array}else n.samples=r;const a=this.extractID3Track(n,t);return i.samples=Mr(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return r.samples=Mr(e,t),{videoTrack:t,audioTrack:Ls(),id3Track:n,textTrack:Ls()}}extractID3Track(e,t){const r=this.id3Track;if(e.samples.length){const n=br(e.samples,["emsg"]);n&&n.forEach(e=>{const n=function(e){const t=e[0];let r="",n="",i=0,a=0,s=0,o=0,l=0,u=0;if(0===t){for(;"\0"!==yr(e.subarray(u,u+1));)r+=yr(e.subarray(u,u+1)),u+=1;for(r+=yr(e.subarray(u,u+1)),u+=1;"\0"!==yr(e.subarray(u,u+1));)n+=yr(e.subarray(u,u+1)),u+=1;n+=yr(e.subarray(u,u+1)),u+=1,i=Tr(e,12),a=Tr(e,16),o=Tr(e,20),l=Tr(e,24),u=28}else if(1===t){u+=4,i=Tr(e,u),u+=4;const t=Tr(e,u);u+=4;const a=Tr(e,u);for(u+=4,s=2**32*t+a,_t(s)||(s=Number.MAX_SAFE_INTEGER,Kt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=Tr(e,u),u+=4,l=Tr(e,u),u+=4;"\0"!==yr(e.subarray(u,u+1));)r+=yr(e.subarray(u,u+1)),u+=1;for(r+=yr(e.subarray(u,u+1)),u+=1;"\0"!==yr(e.subarray(u,u+1));)n+=yr(e.subarray(u,u+1)),u+=1;n+=yr(e.subarray(u,u+1)),u+=1}return{schemeIdUri:r,value:n,timeScale:i,presentationTime:s,presentationTimeDelta:a,eventDuration:o,id:l,payload:e.subarray(u,e.byteLength)}}(e);if(Ks.test(n.schemeIdUri)){const e=qs(n,t);let i=4294967295===n.eventDuration?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;i<=.001&&(i=Number.POSITIVE_INFINITY);const a=n.payload;r.samples.push({data:a,len:a.byteLength,dts:e,pts:e,type:Ds.emsg,duration:i})}else if(this.config.enableEmsgKLVMetadata&&n.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const e=qs(n,t);r.samples.push({data:n.payload,len:n.payload.byteLength,dts:e,pts:e,type:Ds.misbklv,duration:Number.POSITIVE_INFINITY})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}},remux:class extends Ut{constructor(e,t,r,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,r,n){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(e,n),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:r,videoCodec:n}=this;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);const{audio:i,video:a}=this.initData=Ir(e);if(t)!function(e,t){if(!e||!t)return;const r=t.keyId;r&&t.isCommonEncryption&&Nr(e,(e,t)=>{const n=e.subarray(8,24);n.some(e=>0!==e)||(Kt.log(`[eme] Patching keyId in 'enc${t?"a":"v"}>sinf>>tenc' box: ${zt(n)} -> ${zt(r)}`),e.set(r,8))})}(e,t);else{const e=i||a;null!=e&&e.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${e.codec}")!`)}i&&(r=So(i,or,this)),a&&(n=So(a,lr,this));const s={};i&&a?s.audiovideo={container:"video/mp4",codec:r+","+n,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:i?s.audio={container:"audio/mp4",codec:r,encrypted:i.encrypted,initSegment:e,id:"audio"}:a?s.video={container:"video/mp4",codec:n,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(e,t,r,n,i,a){var s,o;let{initPTS:l,lastEndTime:u}=this;const c={audio:void 0,video:void 0,text:n,id3:r,initSegment:void 0};Tt(u)||(u=this.lastEndTime=i||0);const d=t.samples;if(!d.length)return c;const f={initPTS:void 0,timescale:void 0,trackId:void 0};let h=this.initData;if(null!=(s=h)&&s.length||(this.generateInitSegment(d),h=this.initData),null==(o=h)||!o.length)return this.warn("Failed to generate initSegment."),c;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1);const g=function(e,t,r){const n={},i=br(e,["moof","traf"]);for(let e=0;e<i.length;e++){const a=i[e],s=br(a,["tfhd"])[0],o=Tr(s,4),l=t[o];if(!l)continue;n[o]||(n[o]={start:NaN,duration:0,sampleCount:0,timescale:l.timescale,type:l.type});const u=n[o],c=br(a,["tfdt"])[0];if(c){const e=c[0];let t=Tr(c,4);1===e&&(t===pr?r.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(t*=pr+1,t+=Tr(c,8))),Tt(t)&&(!Tt(u.start)||t<u.start)&&(u.start=t)}const d=l.default,f=Tr(s,0)|(null==d?void 0:d.flags);let h=(null==d?void 0:d.duration)||0;8&f&&(h=Tr(s,2&f?12:8));const g=br(a,["trun"]);let p=u.start||0,m=0,v=h;for(let e=0;e<g.length;e++){const t=g[e],r=Tr(t,4),n=u.sampleCount;u.sampleCount+=r;const i=1&t[3],a=4&t[3],s=1&t[2],o=2&t[2],l=4&t[2],c=8&t[2];let d=8,f=r;for(i&&(d+=4),a&&r&&(1&t[d+1]||void 0!==u.keyFrameIndex||(u.keyFrameIndex=n),d+=4,s?(v=Tr(t,d),d+=4):v=h,o&&(d+=4),c&&(d+=4),p+=v,m+=v,f--);f--;)s?(v=Tr(t,d),d+=4):v=h,o&&(d+=4),l&&(1&t[d+1]||void 0===u.keyFrameIndex&&(u.keyFrameIndex=u.sampleCount-(f+1),u.keyFrameStart=p),d+=4),c&&(d+=4),p+=v,m+=v;!m&&h&&(m+=h*r)}u.duration+=m}if(!Object.keys(n).some(e=>n[e].duration)){let t=1/0,r=0;const i=br(e,["sidx"]);for(let e=0;e<i.length;e++){const n=Ar(i[e]);if(null!=n&&n.references){t=Math.min(t,n.earliestPresentationTime/n.timescale);const e=n.references.reduce((e,t)=>e+t.info.duration||0,0);r=Math.max(r,e+n.earliestPresentationTime/n.timescale)}}r&&Tt(r)&&Object.keys(n).forEach(e=>{n[e].duration||(n[e].duration=r*n[e].timescale-n[e].start)})}return n}(d,h,this),p=h.audio?g[h.audio.id]:null,m=h.video?g[h.video.id]:null,v=_o(m,1/0),y=_o(p,1/0),E=_o(m,0,!0),T=_o(p,0,!0);let _=i,S=0;const b=p&&(!m||!l&&y<v||l&&l.trackId===h.audio.id),A=b?p:m;if(A){const e=A.timescale,t=A.start-i*e,r=b?h.audio.id:h.video.id;_=A.start/e,S=b?T-y:E-v,!a&&l||!function(e,t,r,n){if(null===e)return!0;const i=Math.max(n,1),a=t-e.baseTime/e.timescale;return Math.abs(a-r)>i}(l,_,i,S)&&e===l.timescale||(l&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${i} ${t/e} != initPTS: ${l.baseTime/l.timescale} (${l.baseTime}/${l.timescale}) trackId: ${l.trackId}`),this.log(`Found initPTS at playlist time: ${i} offset: ${_-i} (${t}/${e}) trackId: ${r}`),l=null,f.initPTS=t,f.timescale=e,f.trackId=r)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${i}`);l?(f.initPTS=l.baseTime,f.timescale=l.timescale,f.trackId=l.trackId):(f.timescale&&void 0!==f.trackId&&void 0!==f.initPTS||(this.warn("Could not set initPTS"),f.initPTS=_,f.timescale=1,f.trackId=-1),this.initPTS=l={baseTime:f.initPTS,timescale:f.timescale,trackId:f.trackId});const I=_-l.baseTime/l.timescale,R=I+S;S>0?this.lastEndTime=R:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const w=!!h.audio,D=!!h.video;let L="";w&&(L+="audio"),D&&(L+="video");const C={data1:d,startPTS:I,startDTS:I,endPTS:R,endDTS:R,type:L,hasAudio:w,hasVideo:D,nb:1,dropped:0,encrypted:!!h.audio&&h.audio.encrypted||!!h.video&&h.video.encrypted};c.audio=w&&!D?C:void 0,c.video=D?C:void 0;const N=null==m?void 0:m.sampleCount;if(N){const e=m.keyFrameIndex,t=-1!==e;C.nb=N,C.dropped=0===e||this.isVideoContiguous?0:t?e:N,C.independent=t,C.firstKeyFrame=e,t&&m.keyFrameStart&&(C.firstKeyFramePTS=(m.keyFrameStart-l.baseTime)/l.timescale),this.isVideoContiguous||(c.independent=t),this.isVideoContiguous||(this.isVideoContiguous=t),C.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${e}/${N} dropped: ${C.dropped} start: ${C.firstKeyFramePTS||"NA"}`)}return c.initSegment=f,c.id3=Eo(r,i,l,l),n.samples.length&&(c.text=To(n,i,l)),c}}},{demux:Js,remux:vo},{demux:class extends Cs{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const r=cs(e,0);let n=(null==r?void 0:r.length)||0;if(Gs(e,n))return!1;for(let r=e.length;n<r;n++)if(ps(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return function(e,t){return t+5<e.length}(e,t)&&ds(e,t)&&hs(e,t)<=e.length-t}(e,t)}appendFrame(e,t,r){ms(e,this.observer,t,r,e.manifestCodec);const n=ys(e,t,r,this.basePTS,this.frameIndex);if(n&&0===n.missing)return n}},remux:vo},{demux:class extends Cs{resetInitSegment(e,t,r,n){super.resetInitSegment(e,t,r,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=cs(e,0);let r=(null==t?void 0:t.length)||0;if(t&&11===e[r]&&119===e[r+1]&&void 0!==ws(t)&&Hs(e,r)<=16)return!1;for(let t=e.length;r<t;r++)if(Gs(e,r))return Kt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return function(e,t){return Us(e,t)&&4<=e.length-t}(e,t)}appendFrame(e,t,r){if(null!==this.basePTS)return Fs(e,t,r,this.basePTS,this.frameIndex)}},remux:vo}];bo.splice(2,0,{demux:$s,remux:vo});class Ao{constructor(e,t,r,n,i,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.id=i,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,n){const i=r.transmuxing;i.executeStart=ho();let a=new Uint8Array(e);const{currentTransmuxState:s,transmuxConfig:o}=this;n&&(this.currentTransmuxState=n);const{contiguous:l,discontinuity:u,trackSwitch:c,accurateTimeOffset:d,timeOffset:f,initSegmentChange:h}=n||s,{audioCodec:g,videoCodec:p,defaultInitPts:m,duration:v,initSegmentData:y}=o,E=function(e,t){let r=null;e.byteLength>0&&null!=(null==t?void 0:t.key)&&null!==t.iv&&null!=t.method&&(r=t);return r}(a,t);if(E&&ki(E.method)){const e=this.getDecrypter(),t=xi(E.method);if(!e.isSync())return this.asyncResult=!0,this.decryptionPromise=e.webCryptoDecrypt(a,E.key.buffer,E.iv.buffer,t).then(e=>{const t=this.push(e,null,r);return this.decryptionPromise=null,t}),this.decryptionPromise;{let n=e.softwareDecrypt(a,E.key.buffer,E.iv.buffer,t);if(r.part>-1){const t=e.flush();n=t?t.buffer:t}if(!n)return i.executeEnd=ho(),Io(r);a=new Uint8Array(n)}}const T=this.needsProbing(u,c);if(T){const e=this.configureTransmuxer(a);if(e)return this.logger.warn(`[transmuxer] ${e.message}`),this.observer.emit(It.ERROR,It.ERROR,{type:bt.MEDIA_ERROR,details:At.FRAG_PARSING_ERROR,fatal:!1,error:e,reason:e.message}),i.executeEnd=ho(),Io(r)}(u||c||h||T)&&this.resetInitSegment(y,g,p,v,t),(u||h||T)&&this.resetInitialTimestamp(m),l||this.resetContiguity();const _=this.transmux(a,E,f,d,r);this.asyncResult=Ro(_);const S=this.currentTransmuxState;return S.contiguous=!0,S.discontinuity=!1,S.trackSwitch=!1,i.executeEnd=ho(),_}flush(e){const t=e.transmuxing;t.executeStart=ho();const{decrypter:r,currentTransmuxState:n,decryptionPromise:i}=this;if(i)return this.asyncResult=!0,i.then(()=>this.flush(e));const a=[],{timeOffset:s}=n;if(r){const t=r.flush();t&&a.push(this.push(t.buffer,null,e))}const{demuxer:o,remuxer:l}=this;if(!o||!l){t.executeEnd=ho();const r=[Io(e)];return this.asyncResult?Promise.resolve(r):r}const u=o.flush(s);return Ro(u)?(this.asyncResult=!0,u.then(t=>(this.flushRemux(a,t,e),a))):(this.flushRemux(a,u,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,r){const{audioTrack:n,videoTrack:i,id3Track:a,textTrack:s}=t,{accurateTimeOffset:o,timeOffset:l}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${r.sn}${r.part>-1?" part: "+r.part:""} of ${this.id===Ct?"level":"track"} ${r.level}`);const u=this.remuxer.remux(n,i,a,s,l,o,!0,this.id);e.push({remuxResult:u,chunkMeta:r}),r.transmuxing.executeEnd=ho()}resetInitialTimestamp(e){const{demuxer:t,remuxer:r}=this;t&&r&&(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,n,i){const{demuxer:a,remuxer:s}=this;a&&s&&(a.resetInitSegment(e,t,r,n),s.resetInitSegment(e,t,r,i))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,n,i){let a;return a=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,r,n,i):this.transmuxUnencrypted(e,r,n,i),a}transmuxUnencrypted(e,t,r,n){const{audioTrack:i,videoTrack:a,id3Track:s,textTrack:o}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(i,a,s,o,t,r,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,r,n,i){return this.demuxer.demuxSampleAes(e,t,r).then(e=>({remuxResult:this.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,r,n,!1,this.id),chunkMeta:i}))}configureTransmuxer(e){const{config:t,observer:r,typeSupported:n}=this;let i;for(let t=0,r=bo.length;t<r;t++){var a;if(null!=(a=bo[t].demux)&&a.probe(e,this.logger)){i=bo[t];break}}if(!i)return new Error("Failed to find demuxer by probing fragment data");const s=this.demuxer,o=this.remuxer,l=i.remux,u=i.demux;o&&o instanceof l||(this.remuxer=new l(r,t,n,this.logger)),s&&s instanceof u||(this.demuxer=new u(r,t,n,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new di(this.config)),e}}const Io=e=>({remuxResult:{},chunkMeta:e});function Ro(e){return"then"in e&&e.then instanceof Function}class wo{constructor(e,t,r,n,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=n,this.defaultInitPts=i||null}}class Do{constructor(e,t,r,n,i,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=n,this.timeOffset=i,this.initSegmentChange=a}}let Lo=0;class Co{constructor(e,t,r,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Lo++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=e=>{const t=e.data,r=this.hls;if(r&&null!=t&&t.event&&t.instanceNo===this.instanceNo)switch(t.event){case"init":{var n;const e=null==(n=this.workerContext)?void 0:n.objectURL;e&&self.URL.revokeObjectURL(e);break}case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":r.logger[t.data.logType]&&r.logger[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.part=this.part,t.data.id=this.id,r.trigger(t.event,t.data)}},this.onWorkerError=e=>{if(!this.hls)return;const t=new Error(`${e.message}  (${e.filename}:${e.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(It.ERROR,{type:bt.OTHER_ERROR,details:At.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:t})};const i=e.config;this.hls=e,this.id=t,this.useWorker=!!i.enableWorker,this.onTransmuxComplete=r,this.onFlush=n;const a=(e,t)=>{(t=t||{}).frag=this.frag||void 0,e===It.ERROR&&(t.parent=this.id,t.part=this.part,this.error=t.error),this.hls.trigger(e,t)};this.observer=new is,this.observer.on(It.FRAG_DECRYPTED,a),this.observer.on(It.ERROR,a);const s=tn(i.preferManagedMediaSource);if(this.useWorker&&"undefined"!=typeof Worker){const r=this.hls.logger;if(i.workerPath||"function"==typeof __HLS_WORKER_BUNDLE__){try{i.workerPath?(r.log(`loading Web Worker ${i.workerPath} for "${t}"`),this.workerContext=function(e){const t=ss[e];if(t)return t.clientCount++,t;const r=new self.URL(e,self.location.href).href,n={worker:new self.Worker(r),scriptURL:r,clientCount:1};return ss[e]=n,n}(i.workerPath)):(r.log(`injecting Web Worker for "${t}"`),this.workerContext=function(){const e=ss[as];if(e)return e.clientCount++,e;const t=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),r=self.URL.createObjectURL(t),n={worker:new self.Worker(r),objectURL:r,clientCount:1};return ss[as]=n,n}());const{worker:e}=this.workerContext;e.addEventListener("message",this.onWorkerMessage),e.addEventListener("error",this.onWorkerError),e.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:s,id:t,config:_n(i)})}catch(n){r.warn(`Error setting up "${t}" Web Worker, fallback to inline`,n),this.terminateWorker(),this.error=null,this.transmuxer=new Ao(this.observer,s,i,"",t,e.logger)}return}}this.transmuxer=new Ao(this.observer,s,i,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Lo++;const t=this.hls.config,r=tn(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:r,id:this.id,config:_n(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),function(e){const t=ss[e||as];if(t&&1===t.clientCount--){const{worker:r,objectURL:n}=t;delete ss[e||as],n&&self.URL.revokeObjectURL(n),r.terminate()}}(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,r,n,i,a,s,o,l,u){var c,d;l.transmuxing.start=self.performance.now();const{instanceNo:f,transmuxer:h}=this,g=a?a.start:i.start,p=i.decryptdata,m=this.frag,v=!(m&&i.cc===m.cc),y=!(m&&l.level===m.level),E=m?l.sn-m.sn:-1,T=this.part?l.part-this.part.index:-1,_=0===E&&l.id>1&&l.id===(null==m?void 0:m.stats.chunkCount),S=!y&&(1===E||0===E&&(1===T||_&&T<=0)),b=self.performance.now();(y||E||0===i.stats.parsing.start)&&(i.stats.parsing.start=b),!a||!T&&S||(a.stats.parsing.start=b);const A=!(m&&(null==(c=i.initSegment)?void 0:c.url)===(null==(d=m.initSegment)?void 0:d.url)),I=new Do(v,S,o,y,g,A);if(!S||v||A){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${i.type} sn: ${l.sn}${l.part>-1?" part: "+l.part:""} ${this.id===Ct?"level":"track"}: ${l.level} id: ${l.id}\n        discontinuity: ${v}\n        trackSwitch: ${y}\n        contiguous: ${S}\n        accurateTimeOffset: ${o}\n        timeOffset: ${g}\n        initSegmentChange: ${A}`);const e=new wo(r,n,t,s,u);this.configureTransmuxer(e)}if(this.frag=i,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:f,cmd:"demux",data:e,decryptdata:p,chunkMeta:l,state:I},e instanceof ArrayBuffer?[e]:[]);else if(h){const t=h.push(e,p,l,I);Ro(t)?t.then(e=>{this.handleTransmuxComplete(e)}).catch(e=>{this.transmuxerError(e,l,"transmuxer-interface push error")}):this.handleTransmuxComplete(t)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:r}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(r){const t=r.flush(e);Ro(t)?t.then(t=>{this.handleFlushResult(t,e)}).catch(t=>{this.transmuxerError(t,e,"transmuxer-interface flush error")}):this.handleFlushResult(t,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(e=>{this.handleTransmuxComplete(e)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:r}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):r&&r.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}class No extends Ut{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){-1!==this.timer&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){const n=null==t?void 0:t.renditionReports;if(n){let i=-1;for(let r=0;r<n.length;r++){const a=n[r];let s;try{s=new self.URL(a.URI,t.url).href}catch(e){this.warn(`Could not construct new URL for Rendition Report: ${e}`),s=a.URI||""}if(s===e){i=r;break}s===e.substring(0,s.length)&&(i=r)}if(-1!==i){const e=n[i],a=parseInt(e["LAST-MSN"])||t.lastPartSn;let s=parseInt(e["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const e=Math.min(t.age-t.partTarget,t.targetduration);s>=0&&e>t.partTarget&&(s+=1)}const o=r&&mn(r);return new vn(a,s>=0?s:void 0,o)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(e){this.warn(`Could not construct new URL with HLS Delivery Directives: ${e}`)}return e}playlistLoaded(e,t,r){const{details:n,stats:i}=t,a=self.performance.now(),s=i.loading.first?Math.max(0,a-i.loading.first):0;n.advancedDateTime=Date.now()-s;const o=this.hls.config.timelineOffset;if(o!==n.appliedTimelineOffset){const e=Math.max(o||0,0);n.appliedTimelineOffset=e,n.fragments.forEach(t=>{t.setStart(t.playlistOffset+e)})}if(n.live||null!=r&&r.live){const o="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(r),r&&n.fragments.length>0){_a(r,n,this);const e=n.playlistParsingError;if(e){this.warn(e);const r=this.hls;if(!r.config.ignorePlaylistParsingErrors){var l;const{networkDetails:a}=t;return void r.trigger(It.ERROR,{type:bt.NETWORK_ERROR,details:At.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:e,reason:e.message,level:t.level||void 0,parent:null==(l=n.fragments[0])?void 0:l.type,networkDetails:a,stats:i})}n.playlistParsingError=null}}-1===n.requestScheduled&&(n.requestScheduled=i.loading.start);const u=this.hls.mainForwardBufferInfo,c=u?u.end-u.len:0,d=Ia(n,1e3*(n.edge-c));if(n.requestScheduled+d<a?n.requestScheduled=a:n.requestScheduled+=d,this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let f,h,g;if(n.canBlockReload&&n.endSN&&n.advanced){const e=this.hls.config.lowLatencyMode,i=n.lastPartSn,s=n.endSN,l=n.lastPartIndex,u=i===s;-1!==l?u?(h=s+1,g=e?0:l):(h=i,g=e?l+1:n.maxPartIndex):h=s+1;const c=n.age,d=c+n.ageHeader;let p=Math.min(d-n.partTarget,1.5*n.targetduration);if(p>0){if(d>3*n.targetduration)this.log(`Playlist last advanced ${c.toFixed(2)}s ago. Omitting segment and part directives.`),h=void 0,g=void 0;else if(null!=r&&r.tuneInGoal&&d-n.partTarget>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${p} with playlist age: ${n.age}`),p=0;else{const e=Math.floor(p/n.targetduration);if(h+=e,void 0!==g){g+=Math.round(p%n.targetduration/n.partTarget)}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${c.toFixed(2)}s goal: ${p} skip sn ${e} to part ${g}`)}n.tuneInGoal=p}if(f=this.getDeliveryDirectives(n,t.deliveryDirectives,h,g),e||!u)return n.requestScheduled=a,void this.loadingPlaylist(o,f)}else(n.canBlockReload||n.canSkipUntil)&&(f=this.getDeliveryDirectives(n,t.deliveryDirectives,h,g));f&&void 0!==h&&n.canBlockReload&&(n.requestScheduled=i.loading.first+Math.max(d-2*s,d/2)),this.scheduleLoading(o,f,n)}else this.clearTimer()}scheduleLoading(e,t,r){const n=r||e.details;if(!n)return void this.loadingPlaylist(e,t);const i=self.performance.now(),a=n.requestScheduled;if(i>=a)return void this.loadingPlaylist(e,t);const s=a-i;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(s)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),s)}getDeliveryDirectives(e,t,r,n){let i=mn(e);return null!=t&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,n=t.part,i=hn),new vn(r,n,i)}checkRetry(e){const t=e.details,r=kn(e),n=e.errorAction,{action:i,retryCount:a=0,retryConfig:s}=n||{},o=!!n&&!!s&&(i===qn||!n.resolved&&i===Vn);if(o){var l;if(a>=s.maxNumRetry)return!1;if(r&&null!=(l=e.context)&&l.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${s.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const e=Un(s,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),e),this.warn(`Retrying playlist loading ${a+1}/${s.maxNumRetry} after "${t}" in ${e}ms`)}e.levelRetry=!0,n.resolved=!0}return o}}function Po(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Oo(e[r].attrs,t[r].attrs))return!1;return!0}function Oo(e,t,r){const n=e["STABLE-RENDITION-ID"];return n&&!r?n===t["STABLE-RENDITION-ID"]:!(r||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>e[r]!==t[r])}function Mo(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}class ko{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,r){if(null===this.queues||null===this.tracks)return;const n=this.queues[t];n.push(e),1!==n.length||r||this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const r={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(r,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const r={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(r)}})}removeBlockers(){null!==this.queues&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const r=null==(t=e[0])?void 0:t.label;"async-blocker"!==r&&"async-blocker-prepend"!==r||(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(null===this.queues)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(null===this.queues||null===this.tracks)return;const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(t){var r;if(n.onError(t),null===this.queues||null===this.tracks)return;const i=null==(r=this.tracks[e])?void 0:r.buffer;null!=i&&i.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){null!==this.queues&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return(null==(t=this.queues)?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return null===e||null===t?"<destroyed>":`\n${this.list("video")}\n${this.list("audio")}\n${this.list("audiovideo")}}`}list(e){var t,r;return null!=(t=this.queues)&&t[e]||null!=(r=this.tracks)&&r[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const r=null==(t=this.tracks)?void 0:t[e],n=null==r?void 0:r.buffer;return n?`SourceBuffer${n.updating?" updating":""}${r.ended?" ended":""}${r.ending?" ending":""}`:"none"}listOps(e){var t;return(null==(t=this.queues)?void 0:t[e].map(e=>e.label).join(", "))||""}}const xo=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Fo="HlsJsTrackRemovedError";class Bo extends Error{constructor(e){super(e),this.name=Fo}}function Uo(e){const t=e.querySelectorAll("source");[].slice.call(t).forEach(t=>{e.removeChild(t)})}function Zo(e){return"audio"===e?1:0}class Go{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(It.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(It.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(It.MANIFEST_PARSED,this.onManifestParsed,this),e.on(It.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(It.BUFFER_CODECS,this.onBufferCodecs,this),e.on(It.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(It.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(It.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(It.MANIFEST_PARSED,this.onManifestParsed,this),e.off(It.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(It.BUFFER_CODECS,this.onBufferCodecs,this),e.off(It.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Tt(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0)return void(this.clientRect=null);const e=this.hls.levels;if(e.length){const t=this.hls,r=this.getMaxLevel(e.length-1);r!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${r}: ${e[r].height}p@${e[r].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=r,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const r=t.filter((t,r)=>this.isLevelAllowed(t)&&r<=e);return this.clientRect=null,Go.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.width||t.height||(t.width=r.right-r.left||e.width||0,t.height=r.bottom-r.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(e){}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(t=>e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height)}static getMaxLevelByMediaSize(e,t,r){if(null==e||!e.length)return-1;const n=(e,t)=>!t||(e.width!==t.width||e.height!==t.height);let i=e.length-1;const a=Math.max(t,r);for(let t=0;t<e.length;t+=1){const r=e[t];if((r.width>=a||r.height>=a)&&n(r,e[t+1])){i=t;break}}return i}}const Ho={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},$o={HLS:"h"};class Vo{constructor(e,t){Array.isArray(e)&&(e=e.map(e=>e instanceof Vo?e:new Vo(e))),this.value=e,this.params=t}}function Ko(e,t,r,n){return new Error(`failed to ${e} "${i=t,Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":"object"==typeof i?JSON.stringify(i):String(i)}" as ${r}`,{cause:n});var i}function qo(e,t,r){return Ko("serialize",e,t,r)}class Yo{constructor(e){this.description=e}}const jo="Bare Item";function zo(e){if(!1===ArrayBuffer.isView(e))throw qo(e,"Byte Sequence");return`:${t=e,btoa(String.fromCharCode(...t))}:`;var t}function Wo(e){if(function(e){return e<-999999999999999||999999999999999<e}(e))throw qo(e,"Integer");return e.toString()}function Xo(e,t){if(e<0)return-Xo(-e,t);const r=Math.pow(10,t);if(Math.abs(e*r%1-.5)<Number.EPSILON){const t=Math.floor(e*r);return(t%2==0?t:t+1)/r}return Math.round(e*r)/r}function Qo(e){const t=Xo(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw qo(e,"Decimal");const r=t.toString();return r.includes(".")?r:`${r}.0`}const Jo=/[\x00-\x1f\x7f]+/;function el(e){const t=(r=e).description||r.toString().slice(7,-1);var r;if(!1===/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t))throw qo(t,"Token");return t}function tl(e){switch(typeof e){case"number":if(!Tt(e))throw qo(e,jo);return Number.isInteger(e)?Wo(e):Qo(e);case"string":return function(e){if(Jo.test(e))throw qo(e,"String");return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}(e);case"symbol":return el(e);case"boolean":return function(e){if("boolean"!=typeof e)throw qo(e,"Boolean");return e?"?1":"?0"}(e);case"object":if(e instanceof Date)return function(e){return`@${Wo(e.getTime()/1e3)}`}(e);if(e instanceof Uint8Array)return zo(e);if(e instanceof Yo)return el(e);default:throw qo(e,jo)}}function rl(e){if(!1===/^[a-z*][a-z0-9\-_.*]*$/.test(e))throw qo(e,"Key");return e}function nl(e){return null==e?"":Object.entries(e).map(([e,t])=>!0===t?`;${rl(e)}`:`;${rl(e)}=${tl(t)}`).join("")}function il(e){return e instanceof Vo?`${tl(e.value)}${nl(e.params)}`:tl(e)}function al(e,t={whitespace:!0}){if("object"!=typeof e||null==e)throw qo(e,"Dict");const r=e instanceof Map?e.entries():Object.entries(e),n=(null==t?void 0:t.whitespace)?" ":"";return Array.from(r).map(([e,t])=>{t instanceof Vo==!1&&(t=new Vo(t));let r=rl(e);var n;return!0===t.value?r+=nl(t.params):(r+="=",Array.isArray(t.value)?r+=`(${(n=t).value.map(il).join(" ")})${nl(n.params)}`:r+=il(t)),r}).join(`,${n}`)}function sl(e,t){return al(e,t)}const ol="CMCD-Object",ll="CMCD-Request",ul="CMCD-Session",cl="CMCD-Status",dl={br:ol,ab:ol,d:ol,ot:ol,tb:ol,tpb:ol,lb:ol,tab:ol,lab:ol,url:ol,pb:ll,bl:ll,tbl:ll,dl:ll,ltc:ll,mtp:ll,nor:ll,nrr:ll,rc:ll,sn:ll,sta:ll,su:ll,ttfb:ll,ttfbb:ll,ttlb:ll,cmsdd:ll,cmsds:ll,smrt:ll,df:ll,cs:ll,ts:ll,cid:ul,pr:ul,sf:ul,sid:ul,st:ul,v:ul,msd:ul,bs:cl,bsd:cl,cdn:cl,rtp:cl,bg:cl,pt:cl,ec:cl,e:cl},fl=ll;function hl(e,t){const r={};if(!e)return r;const n=Object.keys(e),i=t?(a=t,Object.keys(a).reduce((e,t)=>{var r;return null===(r=a[t])||void 0===r||r.forEach(r=>e[r]=t),e},{})):{};var a;return n.reduce((t,r)=>{var n;const a=dl[r]||i[r]||fl;return(null!==(n=t[a])&&void 0!==n?n:t[a]={})[r]=e[r],t},r)}const gl="event";const pl=e=>Math.round(e),ml=(e,t)=>Array.isArray(e)?e.map(e=>ml(e,t)):e instanceof Vo&&"string"==typeof e.value?new Vo(ml(e.value,t),e.params):(t.baseUrl&&(e=function(e,t){const r=new URL(e),n=new URL(t);if(r.origin!==n.origin)return e;const i=r.pathname.split("/").slice(1),a=n.pathname.split("/").slice(1,-1);for(;i[0]===a[0];)i.shift(),a.shift();for(;a.length;)a.shift(),i.unshift("..");return i.join("/")+r.search+r.hash}(e,t.baseUrl)),1===t.version?encodeURIComponent(e):e),vl=e=>100*pl(e/100),yl={br:pl,d:pl,bl:vl,dl:vl,mtp:vl,nor:(e,t)=>{let r=e;return t.version>=2&&(e instanceof Vo&&"string"==typeof e.value?r=new Vo([e]):"string"==typeof e&&(r=[e])),ml(r,t)},rtp:vl,tb:pl},El="request",Tl="response",_l=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],Sl=["e"],bl=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Al(e){return bl.test(e)}const Il=["d","dl","nor","ot","rtp","su"];const Rl=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];const wl=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function Dl(e){return wl.includes(e)||Al(e)}const Ll={[Tl]:function(e){return _l.includes(e)||Il.includes(e)||Rl.includes(e)||Al(e)},[gl]:function(e){return _l.includes(e)||Sl.includes(e)||Al(e)},[El]:function(e){return _l.includes(e)||Il.includes(e)||Al(e)}};function Cl(e,t={}){const r={};if(null==e||"object"!=typeof e)return r;const n=t.version||e.v||1,i=t.reportingMode||El,a=1===n?Dl:Ll[i];let s=Object.keys(e).filter(a);const o=t.filter;"function"==typeof o&&(s=s.filter(o));const l=i===Tl||i===gl;l&&!s.includes("ts")&&s.push("ts"),n>1&&!s.includes("v")&&s.push("v");const u=xt({},yl,t.formatters),c={version:n,reportingMode:i,baseUrl:t.baseUrl};return s.sort().forEach(t=>{let i=e[t];const a=u[t];if("function"==typeof a&&(i=a(i,c)),"v"===t){if(1===n)return;i=n}"pr"==t&&1===i||(l&&"ts"===t&&!Tt(i)&&(i=Date.now()),function(e){return"number"==typeof e?Tt(e):null!=e&&""!==e&&!1!==e}(i)&&(function(e){return["ot","sf","st","e","sta"].includes(e)}(t)&&"string"==typeof i&&(i=new Yo(i)),r[t]=i))}),r}function Nl(e,t,r){return xt(e,function(e,t={}){const r={};if(!e)return r;const n=hl(Cl(e,t),null==t?void 0:t.customHeaderMap);return Object.entries(n).reduce((e,[t,r])=>{const n=sl(r,{whitespace:!1});return n&&(e[t]=n),e},r)}(t,r))}function Pl(e,t={}){if(!e)return"";const r=function(e,t={}){return e?sl(Cl(e,t),{whitespace:!1}):""}(e,t);return encodeURIComponent(r)}const Ol=/CMCD=[^&#]+/;function Ml(e,t,r){const n=function(e,t={}){return e?`CMCD=${Pl(e,t)}`:""}(t,r);if(!n)return e;if(Ol.test(e))return e.replace(Ol,n);const i=e.includes("?")?"&":"?";return`${e}${i}${n}`}function kl(e,t,r,n){e&&Object.keys(t).forEach(i=>{const a=e.filter(e=>e.groupId===i).map(e=>{const a=xt({},e);return a.details=void 0,a.attrs=new Di(a.attrs),a.url=a.attrs.URI=xl(e.url,e.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),a.groupId=a.attrs["GROUP-ID"]=t[i],a.attrs["PATHWAY-ID"]=n,a});e.push(...a)})}function xl(e,t,r,n){const{HOST:i,PARAMS:a,[r]:s}=n;let o;t&&(o=null==s?void 0:s[t],o&&(e=o));const l=new self.URL(e);return i&&!o&&(l.host=i),a&&Object.keys(a).sort().forEach(e=>{e&&l.searchParams.set(e,a[e])}),l.href}class Fl extends Ut{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Fl.CDMCleanupPromise?[Fl.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=e=>{const{initDataType:t,initData:r}=e,n=`"${e.type}" event: init data type: "${t}"`;if(this.debug(n),null!==r){if(!this.keyFormatPromise){let e=Object.keys(this.keySystemAccessPromises);e.length||(e=zi(this.config));const t=e.map(ji).filter(e=>!!e);this.keyFormatPromise=this.getKeyFormatPromise(t)}this.keyFormatPromise.then(i=>{const a=Yi(i);if("sinf"!==t||a!==Hi.FAIRPLAY)return void this.log(`Ignoring "${e.type}" event with init data type: "${t}" for selected key-system ${a}`);let s;try{const e=yr(new Uint8Array(r)),t=Pr(Fi(JSON.parse(e).sinf));if(!t)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");s=new Uint8Array(t.subarray(8,24))}catch(e){return void this.warn(`${n} Failed to parse sinf: ${e}`)}const o=zt(s),{keyIdToKeySessionPromise:l,mediaKeySessions:u}=this;let c=l[o];for(let e=0;e<u.length;e++){const n=u[e],i=n.decryptdata;if(!i.keyId)continue;const a=zt(i.keyId);if(Oi(s,i.keyId)||-1!==i.uri.replace(/-/g,"").indexOf(o)){if(c=l[a],!c)continue;if(i.pssh)break;delete l[a],i.pssh=new Uint8Array(r),i.keyId=s,c=l[o]=c.then(()=>this.generateRequestWithPreferredKeySession(n,t,r,"encrypted-event-key-match")),c.catch(e=>this.handleError(e));break}}c||this.handleError(new Error(`Key ID ${o} not encountered in playlist. Key-system sessions ${u.length}.`))}).catch(e=>this.handleError(e))}},this.onWaitingForKey=e=>{this.log(`"${e.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(It.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(It.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(It.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(It.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(It.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(It.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(It.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(It.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(It.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(It.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:r}=this.config,n=null==t?void 0:t[e];return n?n.licenseUrl:e===Hi.WIDEVINE&&r?r:void 0}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(void 0===t)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,r=null==t?void 0:t[e];if(r)return r.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,r=(e,t,r)=>!!e&&r.indexOf(e)===t,n=t.map(e=>e.audioCodec).filter(r),i=t.map(e=>e.videoCodec).filter(r);return n.length+i.length===0&&i.push("avc1.42e01e"),new Promise((t,r)=>{const a=e=>{const s=e.shift();this.getMediaKeysPromise(s,n,i).then(e=>t({keySystem:s,mediaKeys:e})).catch(t=>{e.length?a(e):r(t instanceof Zl?t:new Zl({type:bt.KEY_SYSTEM_ERROR,details:At.KEY_SYSTEM_NO_ACCESS,error:t,fatal:!0},t.message))})};a(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:r}=this.config;if("function"!=typeof r){let e=`Configured requestMediaKeySystemAccess is not a function ${r}`;return null===Wi&&"http:"===self.location.protocol&&(e=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(e))}return r(e,t)}getMediaKeysPromise(e,t,r){var n;const i=function(e,t,r,n){let i;switch(e){case Hi.FAIRPLAY:i=["cenc","sinf"];break;case Hi.WIDEVINE:case Hi.PLAYREADY:i=["cenc"];break;case Hi.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return function(e,t,r,n){return[{initDataTypes:e,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:t.map(e=>({contentType:`audio/mp4; codecs=${e}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:r.map(e=>({contentType:`video/mp4; codecs=${e}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}(i,t,r,n)}(e,t,r,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],s=null==(n=a)?void 0:n.keySystemAccess;if(!s){this.log(`Requesting encrypted media "${e}" key-system access with config: ${_n(i)}`),s=this.requestMediaKeySystemAccess(e,i);const t=a=this.keySystemAccessPromises[e]={keySystemAccess:s};return s.catch(t=>{this.log(`Failed to obtain access to key-system "${e}": ${t}`)}),s.then(r=>{this.log(`Access for key-system "${r.keySystem}" obtained`);const n=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const i=t.mediaKeys=r.createMediaKeys().then(r=>(this.log(`Media-keys created for "${e}"`),t.hasMediaKeys=!0,n.then(t=>t?this.setMediaKeysServerCertificate(r,e,t):r)));return i.catch(t=>{this.error(`Failed to create media-keys for "${e}"}: ${t}`)}),i})}return s.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:r}){this.log(`Creating key-system session "${t}" keyId: ${zt(e.keyId||[])} keyUri: ${e.uri}`);const n=r.createSession(),i={decryptdata:e,keySystem:t,mediaKeys:r,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(i),i}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const r=this.createMediaKeySessionContext(e),n=Bl(t),i="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(r,i,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyId ${zt(e.decryptdata.keyId||[])}\n      } (data length: ${t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>ji(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:e,mediaKeys:t})=>this.attemptSetMediaKeys(e,t))}selectKeySystem(e){return new Promise((t,r)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:e})=>{const n=ji(e);n?t(n):r(new Error(`Unable to find format for key-system "${e}"`))}).catch(r)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=zi(this.config),r=e.map(Yi).filter(e=>!!e&&-1!==t.indexOf(e));return this.selectKeySystem(r)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let r=0;r<t.length;r++){const n=Ul(e,t[r]);if(n)return n}}loadKey(e){const t=e.keyInfo.decryptdata,r=Bl(t),n=this.bannedKeyIds[r];if(n||"internal-error"===this.getKeyStatus(t)){const r=Gl(n||"internal-error",t);return this.handleError(r,e.frag),Promise.reject(r)}const i=`(keyId: ${r} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${i}`);const a=this.keyIdToKeySessionPromise[r];if(!a){const n=this.getKeySystemForKeyPromise(t).then(({keySystem:r,mediaKeys:n})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${i}`),this.attemptSetMediaKeys(r,n).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:r,mediaKeys:n,decryptdata:t}))))).then(e=>{const r=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(e,"cenc",r,"playlist-key")});return n.catch(t=>this.handleError(t,e.frag)),this.keyIdToKeySessionPromise[r]=n,n}return a.catch(r=>{if(r instanceof Zl){const n=Bt({},r.data);"internal-error"===this.getKeyStatus(t)&&(n.decryptdata=t);const i=new Zl(n,r.message);this.handleError(i,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Zl){t&&(e.data.frag=t);const r=e.data.decryptdata;this.error(`${e.message}${r?` (${zt(r.keyId||[])})`:""}`),this.hls.trigger(It.ERROR,e.data)}else this.error(e.message),this.hls.trigger(It.ERROR,{type:bt.KEY_SYSTEM_ERROR,details:At.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Bl(e),r=this.keyIdToKeySessionPromise[t];if(!r){const t=Yi(e.keyFormat),r=t?[t]:zi(this.config);return this.attemptKeySystemAccess(r)}return r}getKeySystemSelectionPromise(e){if(e.length||(e=zi(this.config)),0===e.length)throw new Zl({type:bt.KEY_SYSTEM_ERROR,details:At.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${_n({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const r=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(r).then(()=>this.media?this.media.setMediaKeys(t):new Promise((e,r)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return r(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(e).catch(r)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),r.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(e=>-1===r.indexOf(e))})}generateRequestWithPreferredKeySession(e,t,r,n){var i;const a=null==(i=this.config.drmSystems)||null==(i=i[e.keySystem])?void 0:i.generateRequest;if(a)try{const n=a.call(this.hls,t,r,e);if(!n)throw new Error("Invalid response from configured generateRequest filter");t=n.initDataType,r=n.initData?n.initData:null,e.decryptdata.pssh=r?new Uint8Array(r):null}catch(e){if(this.warn(e.message),this.hls&&this.hls.config.debug)throw e}if(null===r)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const s=Bl(e.decryptdata),o=e.decryptdata.uri;this.log(`Generating key-session request for "${n}" keyId: ${s} URI: ${o} (init data type: ${t} length: ${r.byteLength})`);const l=new is,u=e._onmessage=t=>{const r=e.mediaKeysSession;if(!r)return void l.emit("error",new Error("invalid state"));const{messageType:n,message:i}=t;this.log(`"${n}" message event for session "${r.sessionId}" message size: ${i.byteLength}`),"license-request"===n||"license-renewal"===n?this.renewLicense(e,i).catch(e=>{l.eventNames().length?l.emit("error",e):this.handleError(e)}):"license-release"===n?e.keySystem===Hi.FAIRPLAY&&this.updateKeySession(e,Bi("acknowledged")).then(()=>this.removeSession(e)).catch(e=>this.handleError(e)):this.warn(`unhandled media key message type "${n}"`)},c=(e,t)=>{let r;t.keyStatus=e,e.startsWith("usable")?l.emit("resolved"):"internal-error"===e||"output-restricted"===e||"output-downscaled"===e?r=Gl(e,t.decryptdata):"expired"===e?r=new Error(`key expired (keyId: ${s})`):"released"===e?r=new Error("key released"):"status-pending"===e||this.warn(`unhandled key status change "${e}" (keyId: ${s})`),r&&(l.eventNames().length?l.emit("error",r):this.handleError(r))},d=e._onkeystatuseschange=t=>{if(!e.mediaKeysSession)return void l.emit("error",new Error("invalid state"));const r=this.getKeyStatuses(e);if(!Object.keys(r).some(e=>"status-pending"!==r[e]))return;if("expired"===r[s])return this.log(`Expired key ${_n(r)} in key-session "${e.mediaKeysSession.sessionId}"`),void this.renewKeySession(e);let n=r[s];if(n)c(n,e);else{var i;const t=1e3;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(i=e.keyStatusTimeouts)[s]||(i[s]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const r=this.getKeyStatus(e.decryptdata);if(r&&"status-pending"!==r)return this.log(`No status for keyId ${s} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${r} from other session.`),c(r,e);this.log(`key status for ${s} in key-session "${e.mediaKeysSession.sessionId}" timed out after ${t}ms`),n="internal-error",c(n,e)},t)),this.log(`No status for keyId ${s} (${_n(r)}).`)}};Fa(e.mediaKeysSession,"message",u),Fa(e.mediaKeysSession,"keystatuseschange",d);const f=new Promise((e,t)=>{l.on("error",t),l.on("resolved",e)});return e.mediaKeysSession.generateRequest(t,r).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${s} URI: ${o}`)}).catch(t=>{throw new Zl({type:bt.KEY_SYSTEM_ERROR,details:At.KEY_SYSTEM_NO_SESSION,error:t,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${t}`)}).then(()=>f).catch(t=>(l.removeAllListeners(),this.removeSession(e).then(()=>{throw t}))).then(()=>(l.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((r,n)=>{if("string"==typeof n&&"object"==typeof r){const e=n;n=r,r=e}const i="buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);e.keySystem===Hi.PLAYREADY&&16===i.length&&Ui(i);const a=zt(i);"internal-error"===r&&(this.bannedKeyIds[a]=r),this.log(`key status change "${r}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=r}),t}fetchServerCertificate(e){const t=this.config,r=new(0,t.loader)(t),n=this.getServerCertificateUrl(e);return n?(this.log(`Fetching server certificate for "${e}"`),new Promise((i,a)=>{const s={responseType:"arraybuffer",url:n},o=t.certLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(e,t,r,n)=>{i(e.data)},onError:(t,r,i,o)=>{a(new Zl({type:bt.KEY_SYSTEM_ERROR,details:At.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:Bt({url:s.url,data:void 0},t)},`"${e}" certificate request failed (${n}). Status: ${t.code} (${t.text})`))},onTimeout:(t,r,i)=>{a(new Zl({type:bt.KEY_SYSTEM_ERROR,details:At.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:i,response:{url:s.url,data:void 0}},`"${e}" certificate request timed out (${n})`))},onAbort:(e,t,r)=>{a(new Error("aborted"))}};r.load(s,l,u)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,r){return new Promise((n,i)=>{e.setServerCertificate(r).then(i=>{this.log(`setServerCertificate ${i?"success":"not supported by CDM"} (${r.byteLength}) on "${t}"`),n(e)}).catch(e=>{i(new Zl({type:bt.KEY_SYSTEM_ERROR,details:At.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:e,fatal:!0},e.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(t=>this.updateKeySession(e,new Uint8Array(t)).catch(t=>{throw new Zl({type:bt.KEY_SYSTEM_ERROR,details:At.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:t,fatal:!1},t.message)}))}unpackPlayReadyKeyMessage(e,t){const r=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!r.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=(new DOMParser).parseFromString(r,"application/xml"),i=n.querySelectorAll("HttpHeader");if(i.length>0){let t;for(let r=0,n=i.length;r<n;r++){var a,s;t=i[r];const n=null==(a=t.querySelector("name"))?void 0:a.textContent,o=null==(s=t.querySelector("value"))?void 0:s.textContent;n&&o&&e.setRequestHeader(n,o)}}const o=n.querySelector("Challenge"),l=null==o?void 0:o.textContent;if(!l)throw new Error("Cannot find <Challenge> in key message");return Bi(atob(l))}setupLicenseXHR(e,t,r,n){const i=this.config.licenseXhrSetup;return i?Promise.resolve().then(()=>{if(!r.decryptdata)throw new Error("Key removed");return i.call(this.hls,e,t,r,n)}).catch(a=>{if(!r.decryptdata)throw a;return e.open("POST",t,!0),i.call(this.hls,e,t,r,n)}).then(r=>{e.readyState||e.open("POST",t,!0);return{xhr:e,licenseChallenge:r||n}}):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const r=this.config.keyLoadPolicy.default;return new Promise((n,i)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const s=new XMLHttpRequest;s.responseType="arraybuffer",s.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return i(new Error("invalid state"));if(4===s.readyState)if(200===s.status){this._requestLicenseFailureCount=0;let t=s.response;this.log(`License received ${t instanceof ArrayBuffer?t.byteLength:t}`);const r=this.config.licenseResponseCallback;if(r)try{t=r.call(this.hls,s,a,e)}catch(e){this.error(e)}n(t)}else{const o=r.errorRetry,l=o?o.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>l||s.status>=400&&s.status<500)i(new Zl({type:bt.KEY_SYSTEM_ERROR,details:At.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:s,response:{url:a,data:void 0,code:s.status,text:s.statusText}},`License Request XHR failed (${a}). Status: ${s.status} (${s.statusText})`));else{const r=l-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${r} attempts left`),this.requestLicense(e,t).then(n,i)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=s,this.setupLicenseXHR(s,a,e,t).then(({xhr:t,licenseChallenge:r})=>{e.keySystem==Hi.PLAYREADY&&(r=this.unpackPlayReadyKeyMessage(t,r)),t.send(r)}).catch(i)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const r=t.media;this.media=r,Fa(r,"encrypted",this.onMediaEncrypted),Fa(r,"waitingforkey",this.onWaitingForKey);const n=this.mediaResolved;n?n():this.mediaKeys=r.mediaKeys}onMediaDetached(){const e=this.media;e&&(Ba(e,"encrypted",this.onMediaEncrypted),Ba(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const r=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ea.clearKeyUriToKeyIdMap();const i=n.length;Fl.CDMCleanupPromise=Promise.all(n.map(e=>this.removeSession(e)).concat((null==r||null==(e=r.setMediaKeys(null))?void 0:e.catch(e=>{this.log(`Could not clear media keys: ${e}`),this.hls&&this.hls.trigger(It.ERROR,{type:bt.OTHER_ERROR,details:At.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${e}`)})}))||Promise.resolve())).catch(e=>{this.log(`Could not close sessions and clear media keys: ${e}`),this.hls&&this.hls.trigger(It.ERROR,{type:bt.OTHER_ERROR,details:At.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${e}`)})}).then(()=>{i&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(t&&this.config.emeEnabled&&!this.keyFormatPromise){const e=t.reduce((e,t)=>(-1===e.indexOf(t.keyFormat)&&e.push(t.keyFormat),e),[]);this.log(`Selecting key-system from session-keys ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:r,decryptdata:n}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${zt((null==n?void 0:n.keyId)||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),r&&r.readyState!==XMLHttpRequest.DONE&&r.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const i=this.mediaKeySessions.indexOf(e);i>-1&&this.mediaKeySessions.splice(i,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(e=>self.clearTimeout(a[e]));const{drmSystemOptions:s}=this.config,o=function(e){var t;return!(!e||"persistent-license"!==e.sessionType&&(null==(t=e.sessionTypes)||!t.some(e=>"persistent-license"===e)))}(s)?new Promise((e,r)=>{self.setTimeout(()=>r(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(e).catch(r)}):Promise.resolve();return o.catch(e=>{this.log(`Could not remove session: ${e}`),this.hls&&this.hls.trigger(It.ERROR,{type:bt.OTHER_ERROR,details:At.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${e}`)})}).then(()=>t.close()).catch(e=>{this.log(`Could not close session: ${e}`),this.hls&&this.hls.trigger(It.ERROR,{type:bt.OTHER_ERROR,details:At.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${e}`)})})}return Promise.resolve()}}function Bl(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(null===e.keyId)throw new Error("keyId is null");return zt(e.keyId)}function Ul(e,t){return e.keyId&&t.mediaKeysSession.keyStatuses.has(e.keyId)?t.mediaKeysSession.keyStatuses.get(e.keyId):e.matches(t.decryptdata)?t.keyStatus:void 0}Fl.CDMCleanupPromise=void 0;class Zl extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Gl(e,t){const r="output-restricted"===e,n=r?At.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:At.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Zl({type:bt.KEY_SYSTEM_ERROR,details:n,fatal:!1,decryptdata:t},r?"HDCP level output restricted":`key status changed to "${e}"`)}function Hl(e,t){let r;try{r=new Event("addtrack")}catch(e){r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function $l(e,t){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(r){Kt.debug(`[texttrack-utils]: ${r}`);try{const r=new self.TextTrackCue(t.startTime,t.endTime,t.text);r.id=t.id,e.addCue(r)}catch(e){Kt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${e}`)}}"disabled"===r&&(e.mode=r)}function Vl(e,t){const r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues)for(let r=e.cues.length;r--;)t&&e.cues[r].removeEventListener("enter",t),e.removeCue(e.cues[r]);"disabled"===r&&(e.mode=r)}function Kl(e,t,r,n){const i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&e.cues.length>0){const i=function(e,t,r){const n=[],i=function(e,t){if(t<=e[0].startTime)return 0;const r=e.length-1;if(t>e[r].endTime)return-1;let n,i=0,a=r;for(;i<=a;)if(n=Math.floor((a+i)/2),t<e[n].startTime)a=n-1;else{if(!(t>e[n].startTime&&i<r))return n;i=n+1}return e[i].startTime-t<t-e[a].startTime?i:a}(e,t);if(i>-1)for(let a=i,s=e.length;a<s;a++){const i=e[a];if(i.startTime>=t&&i.endTime<=r)n.push(i);else if(i.startTime>r)return n}return n}(e.cues,t,r);for(let t=0;t<i.length;t++)n&&!n(i[t])||e.removeCue(i[t])}"disabled"===i&&(e.mode=i)}function ql(e){const t=[];for(let r=0;r<e.length;r++){const n=e[r];"subtitles"!==n.kind&&"captions"!==n.kind||!n.label||t.push(e[r])}return t}function Yl(e){let t=5381,r=e.length;for(;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()}const jl=.025;let zl=function(e){return e[e.Point=0]="Point",e[e.Range=1]="Range",e}({});function Wl(e,t,r){return`${e.identifier}-${r+1}-${Yl(t)}`}class Xl{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,null==(e=this.assetListLoader)||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const r=this.playoutLimit;if(e<=0||isNaN(r))return!1;if(0===r)return!0;return((null==(t=this.assetList[e])?void 0:t.startOffset)||0)>r}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Ql(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(0===this.startTime||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime;return t-Ql(t,e)<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Tt(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Ql(e,t)}return e}get appendInPlace(){return!!this.appendInPlaceStarted||!this.appendInPlaceDisabled&&!(this.cue.once||this.cue.pre||!this.startIsAligned||!(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<jl))}set appendInPlace(e){this.appendInPlaceStarted?this.resetOnResume=!e:this.appendInPlaceDisabled=!e}get timelineStart(){return null!==this._timelineStart?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return t=null!==this._duration?this._duration:this.dateRange.duration?this.dateRange.duration:this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return"RANGE"===this.dateRange.attr["X-TIMELINE-OCCUPIES"]?zl.Range:zl.Point}get supplementsPrimary(){return"PRIMARY"===this.dateRange.attr["X-TIMELINE-STYLE"]}get contentMayVary(){return"NO"!==this.dateRange.attr["X-CONTENT-MAY-VARY"]}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||null!==this.assetListResponse}toString(){return`["${(e=this).identifier}" ${e.cue.pre?"<pre>":e.cue.post?"<post>":""}${e.timelineStart.toFixed(2)}-${e.resumeTime.toFixed(2)}]`;var e}}function Ql(e,t){return e-t.start<t.duration/2&&!(Math.abs(e-(t.start+t.duration))<jl)?t.start:t.start+t.duration}function Jl(e,t,r){const n=new self.URL(e,r);return"data:"!==n.protocol&&n.searchParams.set("_HLS_primary_id",t),n}function eu(e,t){for(;null!=(r=e.assetList[++t])&&r.error;)var r;return t}function tu(e){const t=e.timelineStart,r=e.duration||0;return`["${e.identifier}" ${t.toFixed(2)}-${(t+r).toFixed(2)}]`}class ru{constructor(e,t,r,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(It.PLAYOUT_LIMIT_REACHED,{})};const i=this.hls=new e(t);this.interstitial=r,this.assetItem=n;const a=()=>{this.hasDetails=!0};i.once(It.LEVEL_LOADED,a),i.once(It.AUDIO_TRACK_LOADED,a),i.once(It.SUBTITLE_TRACK_LOADED,a),i.on(It.MEDIA_ATTACHING,(e,{media:t})=>{this.removeMediaListeners(),this.mediaAttached=t;this.interstitial.playoutLimit&&(t.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&i.on(It.BUFFER_APPENDED,()=>{const e=this.bufferedEnd;this.reachedPlayout(e)&&(this._bufferedEosTime=e,i.trigger(It.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=Jl(t,e.config.primarySessionId||"").href}catch(e){}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if(null!=(t=this.hls)&&t.bufferedToEnd)return!0;if(!e)return!1;const r=Math.min(this._bufferedEosTime||1/0,this.duration),n=this.timelineOffset,i=Ti.bufferInfo(e,n,0);return this.getAssetTime(i.end)>=r-.02}reachedPlayout(e){const t=this.interstitial.playoutLimit;return this.startOffset+e>=t}get destroyed(){var e;return!(null!=(e=this.hls)&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return(null==(e=this.hls)?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ti.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const r=t-this.startOffset;if(r>0&&r<e)return r}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return(null==(e=this.hls)?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const r=e-t;if(Math.abs(r)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,r=this.duration;return Math.min(Math.max(0,e-t),r)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){var e;this.mediaAttached&&(null!=(e=this.hls)&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd))}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),null==(t=this.hls)||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,null==(e=this.hls)||e.detachMedia()}resumeBuffering(){var e;null==(e=this.hls)||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.hls)||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),(null==(e=this.hls)?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=e=>delete e.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,r){var n;null==(n=this.hls)||n.on(e,t)}once(e,t,r){var n;null==(n=this.hls)||n.once(e,t)}off(e,t,r){var n;null==(n=this.hls)||n.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${tu(this.assetItem)} ${null==(e=this.hls)?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}class nu extends Ut{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((r,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,r+1):r,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let r=-1;e.nextEvent?r=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(r=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[r]||(void 0===t&&(t=e.start),r=this.findItemIndexAtTime(t));r>=0&&null!=(i=n[r])&&i.event;){var i;r--}return r}findItemIndexAtTime(e,t){const r=this.items;if(r)for(let n=0;n<r.length;n++){let i=r[n];if(t&&"primary"!==t&&(i=i[t]),e===i.start||e>i.start&&e<i.end)return n}return-1}findJumpRestrictedIndex(e,t){const r=this.items;if(r)for(let n=e;n<=t&&r[n];n++){const e=r[n].event;if(null!=e&&e.restrictions.jump&&!e.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var r;if((null==(r=t[n].event)?void 0:r.identifier)===e)return n}return-1}findAssetIndex(e,t){const r=e.assetList,n=r.length;if(n>1)for(let e=0;e<n;e++){const i=r[e];if(!i.error){const r=i.timelineStart;if(t===r||t>r&&(t<r+(i.duration||0)||e===n-1))return e}}return 0}get assetIdAtEnd(){var e;const t=null==(e=this.items)||null==(e=e[this.length-1])?void 0:e.event;if(t){const e=t.assetList,r=e[e.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const r=e.main.details,{dateRanges:n}=r,i=this.events,a=this.parseDateRanges(n,{url:r.url},t),s=Object.keys(n),o=i?i.filter(e=>!s.includes(e.identifier)):[];a.length&&a.sort((e,t)=>{const r=e.cue.pre,n=e.cue.post,i=t.cue.pre,a=t.cue.post;if(r&&!i)return-1;if(i&&!r)return 1;if(n&&!a)return 1;if(a&&!n)return-1;if(!(r||i||n||a)){const r=e.startTime,n=t.startTime;if(r!==n)return r-n}return e.dateRange.tagOrder-t.dateRange.tagOrder}),this.events=a,o.forEach(e=>{this.removeEvent(e)}),this.updateSchedule(e,o)}updateSchedule(e,t=[],r=!1){const n=this.events||[];if(n.length||t.length||this.length<2){const i=this.items,a=this.parseSchedule(n,e);(r||t.length||(null==i?void 0:i.length)!==a.length||a.some((e,t)=>Math.abs(e.playout.start-i[t].playout.start)>.005||Math.abs(e.playout.end-i[t].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,i))}}parseDateRanges(e,t,r){const n=[],i=Object.keys(e);for(let a=0;a<i.length;a++){const s=i[a],o=e[s];if(o.isInterstitial){let e=this.eventMap[s];e?e.setDateRange(o):(e=new Xl(o,t),this.eventMap[s]=e,!1===r&&(e.appendInPlace=r)),n.push(e)}}return n}parseSchedule(e,t){const r=[],n=t.main.details,i=n.live?1/0:n.edge;let a=0;if((e=e.filter(e=>!(e.error||e.cue.once&&e.hasPlayed))).length){this.resolveOffsets(e,t);let n=0,o=0;if(e.forEach((t,s)=>{const l=t.cue.pre,u=t.cue.post,c=e[s-1]||null,d=t.appendInPlace,f=u?i:t.startOffset,h=t.duration,g=t.timelineOccupancy===zl.Range?h:0,p=t.resumptionOffset,m=(null==c?void 0:c.startTime)===f,v=f+t.cumulativeDuration;let y=d?v+h:f+p;if(l||!u&&f<=0){const e=o;o+=g,t.timelineStart=v;const n=a;a+=h,r.push({event:t,start:v,end:y,playout:{start:n,end:a},integrated:{start:e,end:o}})}else{if(!(f<=i))return;{if(!m){const i=f-n;if(i>.033){const l=n,u=o;o+=i;const c=a;a+=i;const d={previousEvent:e[s-1]||null,nextEvent:t,start:l,end:l+i,playout:{start:c,end:a},integrated:{start:u,end:o}};r.push(d)}else i>0&&c&&(c.cumulativeDuration+=i,r[r.length-1].end=f)}u&&(y=v),t.timelineStart=v;const i=o;o+=g;const l=a;a+=h,r.push({event:t,start:v,end:y,playout:{start:l,end:a},integrated:{start:i,end:o}})}}const E=t.resumeTime;n=u||E>i?i:E}),n<i){var s;const e=n,t=o,l=i-n;o+=l;const u=a;a+=l,r.push({previousEvent:(null==(s=r[r.length-1])?void 0:s.event)||null,nextEvent:null,start:n,end:e+l,playout:{start:u,end:a},integrated:{start:t,end:o}})}this.setDurations(i,a,o)}else{const e=0;r.push({previousEvent:null,nextEvent:null,start:e,end:i,playout:{start:e,end:i},integrated:{start:e,end:i}}),this.setDurations(i,i,i)}return r}setDurations(e,t,r){this.durations={primary:e,playout:t,integrated:r}}resolveOffsets(e,t){const r=t.main.details,n=r.live?1/0:r.edge;let i=0,a=-1;e.forEach((s,o)=>{const l=s.cue.pre,u=s.cue.post,c=l?0:u?n:s.startTime;this.updateAssetDurations(s);if(a===c?s.cumulativeDuration=i:(i=0,a=c),!u&&s.snapOptions.in&&(s.resumeAnchor=Nn(null,r.fragments,s.startOffset+s.resumptionOffset,0,0)||void 0),s.appendInPlace&&!s.appendInPlaceStarted){this.primaryCanResumeInPlaceAt(s,t)||(s.appendInPlace=!1)}if(!s.appendInPlace&&o+1<e.length){e[o+1].startTime-e[o].resumeTime<.033&&(e[o+1].appendInPlace=!1,e[o+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${s}`))}const d=Tt(s.resumeOffset)?s.resumeOffset:s.duration;i+=d})}primaryCanResumeInPlaceAt(e,t){const r=e.resumeTime,n=e.startTime+e.resumptionOffset;if(Math.abs(r-n)>jl)return this.log(`"${e.identifier}" resumption ${r} not aligned with estimated timeline end ${n}`),!1;return!Object.keys(t).some(n=>{const i=t[n].details,a=i.edge;if(r>=a)return this.log(`"${e.identifier}" resumption ${r} past ${n} playlist end ${a}`),!1;const s=Nn(null,i.fragments,r);if(!s)return this.log(`"${e.identifier}" resumption ${r} does not align with any fragments in ${n} playlist (${i.fragStart}-${i.fragmentEnd})`),!0;const o="audio"===n?.175:0;return!(Math.abs(s.start-r)<jl+o||Math.abs(s.end-r)<jl+o)&&(this.log(`"${e.identifier}" resumption ${r} not aligned with ${n} fragment bounds (${s.start}-${s.end} sn: ${s.sn} cc: ${s.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let r=0,n=!1,i=!1;for(let a=0;a<e.assetList.length;a++){const s=e.assetList[a],o=t+r;s.startOffset=r,s.timelineStart=o,n||(n=null===s.duration),i||(i=!!s.error);r+=s.error?0:s.duration||0}e.duration=n&&!i?Math.max(r,e.duration):r}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function iu(e){return`[${e.event?'"'+e.event.identifier+'"':"primary"}: ${e.start.toFixed(2)}-${e.end.toFixed(2)}]`}class au{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const r=e.assetListUrl;let n;try{n=Jl(r,this.hls.sessionId,e.baseUrl)}catch(t){const n=this.assignAssetListError(e,At.ASSET_LIST_LOAD_ERROR,t,r);return void this.hls.trigger(It.ERROR,n)}t&&"data:"!==n.protocol&&n.searchParams.set("_HLS_start_offset",""+t);const i=this.hls.config,a=new(0,i.loader)(i),s={responseType:"json",url:n.href},o=i.interstitialAssetListLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(t,r,n,i)=>{const a=t.data,s=null==a?void 0:a.ASSETS;if(!Array.isArray(s)){const t=this.assignAssetListError(e,At.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),n.url,r,i);return void this.hls.trigger(It.ERROR,t)}e.assetListResponse=a,this.hls.trigger(It.ASSET_LIST_LOADED,{event:e,assetListResponse:a,networkDetails:i})},onError:(t,r,n,i)=>{const a=this.assignAssetListError(e,At.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${t.code} ${t.text} (${r.url})`),r.url,i,n);this.hls.trigger(It.ERROR,a)},onTimeout:(t,r,n)=>{const i=this.assignAssetListError(e,At.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${r.url})`),r.url,t,n);this.hls.trigger(It.ERROR,i)}};return a.load(s,l,u),this.hls.trigger(It.ASSET_LIST_LOADING,{event:e}),a}assignAssetListError(e,t,r,n,i,a){return e.error=r,{type:bt.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:r,networkDetails:a,stats:i}}}function su(e){var t;null==e||null==(t=e.play())||t.catch(()=>{})}function ou(e,t){return`[${e}] Advancing timeline position to ${t}`}class lu{constructor(e){this.buffered=void 0;const t=(t,r,n)=>{if((r>>>=0)>n-1)throw new DOMException(`Failed to execute '${t}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${n})`);return e[r][t]};this.buffered={get length(){return e.length},end:r=>t("end",r,e.length),start:r=>t("start",r,e.length)}}}const uu={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},cu=e=>String.fromCharCode(uu[e]||e),du=15,fu=100,hu={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},gu={17:2,18:4,21:6,22:8,23:10,19:13,20:15},pu={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},mu={25:2,26:4,29:6,30:8,31:10,27:13,28:15},vu=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class yu{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const r="function"==typeof t?t():t;Kt.log(`${this.time} [${e}] ${r}`)}}}const Eu=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t};class Tu{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){const n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class _u{constructor(){this.uchar=" ",this.penState=new Tu}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return" "===this.uchar&&this.penState.isDefault()}}class Su{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Tu,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<fu;e++)this.chars.push(new _u);this.logger=e}equals(e){for(let t=0;t<fu;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<fu;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<fu;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>fu&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=fu)}moveCursor(e){const t=this.pos+e;if(e>1)for(let e=this.pos+1;e<t+1;e++)this.chars[e].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=cu(e);this.pos>=fu?this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))}clearFromPos(e){let t;for(t=e;t<fu;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let r=0;r<fu;r++){const n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e);this.chars[this.pos].setPenState(this.currPenState)}}class bu{constructor(e){this.rows=[],this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<du;t++)this.rows.push(new Su(e));this.logger=e}reset(){for(let e=0;e<du;e++)this.rows[e].clear();this.currRow=14}equals(e){let t=!0;for(let r=0;r<du;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<du;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<du;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e);this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+_n(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let e=0;e<du;e++)this.rows[e].clear();const e=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){const n=r.rows[e].cueStartTime,i=this.logger.time;if(null!==n&&null!==i&&n<i)for(let n=0;n<this.nrRollUpRows;n++)this.rows[t-this.nrRollUpRows+n+1].copy(r.rows[e+n])}}this.currRow=t;const r=this.rows[this.currRow];if(null!==e.indent){const t=e.indent,n=Math.max(t-1,0);r.setCursor(e.indent),e.color=r.chars[n].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+_n(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(null===this.nrRollUpRows)return void this.logger.log(3,"roll_up but nrRollUpRows not set yet");this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let r="",n=-1;for(let r=0;r<du;r++){const i=this.rows[r].getTextString();i&&(n=r+1,e?t.push("Row "+n+": '"+i+"'"):t.push(i.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r}getTextAndFormat(){return this.rows}}class Au{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new bu(r),this.nonDisplayedMemory=new bu(r),this.lastOutputScreen=new bu(r),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{const r=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[r]}this.logger.log(2,"MIDROW: "+_n(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Iu{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory={a:null,b:null},this.logger=void 0;const n=this.logger=new yu;this.channels=[null,new Au(e,t,n),new Au(e+1,r,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let e=0;e<t.length;e+=2){const r=127&t[e],n=127&t[e+1];let i=!1,a=null;if(0===r&&0===n)continue;this.logger.log(3,()=>"["+Eu([t[e],t[e+1]])+"] -> ("+Eu([r,n])+")");const s=this.cmdHistory;if(r>=16&&r<=31){if(wu(r,n,s)){Ru(null,null,s),this.logger.log(3,()=>"Repeated command ("+Eu([r,n])+") is dropped");continue}Ru(r,n,this.cmdHistory),i=this.parseCmd(r,n),i||(i=this.parseMidrow(r,n)),i||(i=this.parsePAC(r,n)),i||(i=this.parseBackgroundAttributes(r,n))}else Ru(null,null,s);if(!i&&(a=this.parseChars(r,n),a)){const e=this.currentChannel;if(e&&e>0){this.channels[e].insertChars(a)}else this.logger.log(2,"No channel found yet. TEXT-MODE?")}i||a||this.logger.log(2,()=>"Couldn't parse cleaned data "+Eu([r,n])+" orig: "+Eu([t[e],t[e+1]]))}}parseCmd(e,t){if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;const r=20===e||21===e||23===e?1:2,n=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let r=0;if((17===e||25===e)&&t>=32&&t<=47){if(r=17===e?1:2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[r];return!!n&&(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Eu([e,t])+")"),!0)}return!1}parsePAC(e,t){let r;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;const n=e<=23?1:2;r=t>=64&&t<=95?1===n?hu[e]:pu[e]:1===n?gu[e]:mu[e];const i=this.channels[n];return!!i&&(i.setPAC(this.interpretPAC(r,t)),this.currentChannel=n,!0)}interpretPAC(e,t){let r;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,n.underline=!(1&~r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n}parseChars(e,t){let r,n=null,i=null;if(e>=25?(r=2,i=e-8):(r=1,i=e),i>=17&&i<=19){let e;e=17===i?t+80:18===i?t+112:t+144,this.logger.log(2,()=>"Special char '"+cu(e)+"' in channel "+r),n=[e]}else e>=32&&e<=127&&(n=0===t?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+Eu(n).join(",")),n}parseBackgroundAttributes(e,t){if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;let r;const n={};16===e||24===e?(r=Math.floor((t-32)/2),n.background=vu[r],t%2==1&&(n.background=n.background+"_semi")):45===t?n.background="transparent":(n.foreground="black",47===t&&(n.underline=!0));const i=e<=23?1:2;return this.channels[i].setBkgData(n),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Ru(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const r=this.channels[t];r&&r.cueSplitAtTime(e)}}}function Ru(e,t,r){r.a=e,r.b=t}function wu(e,t,r){return r.a===e&&r.b===t}var Du=function(){if(null!=Gi&&Gi.VTTCue)return self.VTTCue;const e=["","lr","rl"],t=["start","middle","end","left","right"];function r(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;const r=t.toLowerCase();return!!~e.indexOf(r)&&r}function n(e){return r(t,e)}function i(e,...t){let r=1;for(;r<arguments.length;r++){const t=arguments[r];for(const r in t)e[r]=t[r]}return e}function a(t,a,s){const o=this,l={enumerable:!0};o.hasBeenReset=!1;let u="",c=!1,d=t,f=a,h=s,g=null,p="",m=!0,v="auto",y="start",E=50,T="middle",_=50,S="middle";Object.defineProperty(o,"id",i({},l,{get:function(){return u},set:function(e){u=""+e}})),Object.defineProperty(o,"pauseOnExit",i({},l,{get:function(){return c},set:function(e){c=!!e}})),Object.defineProperty(o,"startTime",i({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},l,{get:function(){return f},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");f=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},l,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},l,{get:function(){return g},set:function(e){g=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},l,{get:function(){return p},set:function(t){const n=function(t){return r(e,t)}(t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");p=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},l,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},l,{get:function(){return v},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},l,{get:function(){return y},set:function(e){const t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},l,{get:function(){return E},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");E=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},l,{get:function(){return T},set:function(e){const t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");T=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},l,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},l,{get:function(){return S},set:function(e){const t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),o.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}();class Lu{decode(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Cu(e){function t(e,t,r,n){return 3600*(0|e)+60*(0|t)+(0|r)+parseFloat(n||0)}const r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}class Nu{constructor(){this.values=Object.create(null)}set(e,t){this.get(e)||""===t||(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let n=0;n<r.length;++n)if(t===r[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}}function Pu(e,t,r,n){const i=n?e.split(n):[e];for(const e in i){if("string"!=typeof i[e])continue;const n=i[e].split(r);if(2!==n.length)continue;t(n[0],n[1])}}const Ou=new Du(0,0,""),Mu="middle"===Ou.align?"middle":"center";function ku(e,t,r){const n=e;function i(){const t=Cu(e);if(null===t)throw new Error("Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=i(),a(),"--\x3e"!==e.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.slice(3),a(),t.endTime=i(),a(),function(e,t){const n=new Nu;Pu(e,function(e,t){let i;switch(e){case"region":for(let i=r.length-1;i>=0;i--)if(r[i].id===t){n.set(e,r[i].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":i=t.split(","),n.integer(e,i[0]),n.percent(e,i[0])&&n.set("snapToLines",!1),n.alt(e,i[0],["auto"]),2===i.length&&n.alt("lineAlign",i[1],["start",Mu,"end"]);break;case"position":i=t.split(","),n.percent(e,i[0]),2===i.length&&n.alt("positionAlign",i[1],["start",Mu,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",Mu,"end","left","right"])}},/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");let i=n.get("line","auto");"auto"===i&&-1===Ou.line&&(i=-1),t.line=i,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",Mu);let a=n.get("position","auto");"auto"===a&&50===Ou.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}function xu(e){return e.replace(/<br(?: \/)?>/gi,"\n")}class Fu{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new Lu,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;function r(){let e=t.buffer,r=0;for(e=xu(e);r<e.length&&"\r"!==e[r]&&"\n"!==e[r];)++r;const n=e.slice(0,r);return"\r"===e[r]&&++r,"\n"===e[r]&&++r,t.buffer=e.slice(r),n}function n(e){Pu(e,function(e,t){},/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{let e="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;e=r();const n=e.match(/^()?WEBVTT([ \t].*)?$/);if(null==n||!n[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let i=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(i?i=!1:e=r(),t.state){case"HEADER":/:/.test(e)?n(e):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new Du(0,0,""),t.state="CUE",-1===e.indexOf("--\x3e")){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{ku(e,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const r=-1!==e.indexOf("--\x3e");if(!e||r&&(i=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=e}continue;case"BADCUE":e||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state||"BADWEBVTT"===e.state)throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const Bu=/\r\n|\n\r|\n|\r/g,Uu=function(e,t,r=0){return e.slice(r,r+t.length)===t};function Zu(e,t,r){return Yl(e.toString())+Yl(t.toString())+Yl(r)}function Gu(e,t,r,n,i,a,s){const o=new Fu,l=jt(new Uint8Array(e)).trim().replace(Bu,"\n").split("\n"),u=[],c=t?function(e,t=1){return uo(e,9e4,1/t)}(t.baseTime,t.timescale):0;let d,f="00:00.000",h=0,g=0,p=!0;o.oncue=function(e){const a=r[n];let s=r.ccOffset;const o=(h-c)/9e4;if(null!=a&&a.new&&(void 0!==g?s=r.ccOffset=a.start:function(e,t,r){let n=e[t],i=e[n.prevCC];if(!i||!i.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;null!=(a=i)&&a.new;){var a;e.ccOffset+=n.start-i.start,n.new=!1,n=i,i=e[n.prevCC]}e.presentationOffset=r}(r,n,o)),o){if(!t)return void(d=new Error("Missing initPTS for VTT MPEGTS"));s=o-r.presentationOffset}const l=e.endTime-e.startTime,f=yo(9e4*(e.startTime+s-g),9e4*i)/9e4;e.startTime=Math.max(f,0),e.endTime=Math.max(f+l,0);const p=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(p)),e.id||(e.id=Zu(e.startTime,e.endTime,p)),e.endTime>0&&u.push(e)},o.onparsingerror=function(e){d=e},o.onflush=function(){d?s(d):a(u)},l.forEach(e=>{if(p){if(Uu(e,"X-TIMESTAMP-MAP=")){p=!1,e.slice(16).split(",").forEach(e=>{Uu(e,"LOCAL:")?f=e.slice(6):Uu(e,"MPEGTS:")&&(h=parseInt(e.slice(7)))});try{g=function(e){let t=parseInt(e.slice(-3));const r=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),i=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!(Tt(t)&&Tt(r)&&Tt(n)&&Tt(i)))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=6e4*n,t+=36e5*i,t}(f)/1e3}catch(e){d=e}return}""===e&&(p=!1)}o.parse(e+"\n")}),o.flush()}const Hu="stpp.ttml.im1t",$u=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Vu=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Ku={left:"start",center:"center",right:"end",start:"start",end:"end"};function qu(e,t,r,n){const i=br(new Uint8Array(e),["mdat"]);if(0===i.length)return void n(new Error("Could not parse IMSC1 mdat"));const a=i.map(e=>jt(e)),s=function(e,t,r=1,n=!1){return uo(e,t,1/r,n)}(t.baseTime,1,t.timescale);try{a.forEach(e=>r(function(e,t){const r=(new DOMParser).parseFromString(e,"text/xml"),n=r.getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const i={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(i).reduce((e,t)=>(e[t]=n.getAttribute(`ttp:${t}`)||i[t],e),{}),s="preserve"!==n.getAttribute("xml:space"),o=ju(Yu(n,"styling","style")),l=ju(Yu(n,"layout","region")),u=Yu(n,"body","[begin]");return[].map.call(u,e=>{const r=zu(e,s);if(!r||!e.hasAttribute("begin"))return null;const n=Qu(e.getAttribute("begin"),a),i=Qu(e.getAttribute("dur"),a);let u=Qu(e.getAttribute("end"),a);if(null===n)throw Xu(e);if(null===u){if(null===i)throw Xu(e);u=n+i}const c=new Du(n-t,u-t,r);c.id=Zu(c.startTime,c.endTime,c.text);const d=function(e,t,r){const n="http://www.w3.org/ns/ttml#styling";let i=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],s=null!=e&&e.hasAttribute("style")?e.getAttribute("style"):null;s&&r.hasOwnProperty(s)&&(i=r[s]);return a.reduce((r,a)=>{const s=Wu(t,n,a)||Wu(e,n,a)||Wu(i,n,a);return s&&(r[a]=s),r},{})}(l[e.getAttribute("region")],o[e.getAttribute("style")],o),{textAlign:f}=d;if(f){const e=Ku[f];e&&(c.lineAlign=e),c.align=f}return xt(c,d),c}).filter(e=>null!==e)}(e,s)))}catch(e){n(e)}}function Yu(e,t,r){const n=e.getElementsByTagName(t)[0];return n?[].slice.call(n.querySelectorAll(r)):[]}function ju(e){return e.reduce((e,t)=>{const r=t.getAttribute("xml:id");return r&&(e[r]=t),e},{})}function zu(e,t){return[].slice.call(e.childNodes).reduce((e,r,n)=>{var i;return"br"===r.nodeName&&n?e+"\n":null!=(i=r.childNodes)&&i.length?zu(r,t):t?e+r.textContent.trim().replace(/\s+/g," "):e+r.textContent},"")}function Wu(e,t,r){return e&&e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function Xu(e){return new Error(`Could not parse ttml timestamp ${e}`)}function Qu(e,t){if(!e)return null;let r=Cu(e);return null===r&&($u.test(e)?r=function(e,t){const r=$u.exec(e),n=(0|r[4])+(0|r[5])/t.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+n/t.frameRate}(e,t):Vu.test(e)&&(r=function(e,t){const r=Vu.exec(e),n=Number(r[1]);switch(r[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/t.frameRate;case"t":return n/t.tickRate}return n}(e,t))),r}class Ju{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}function ec(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function tc(e,t){return!!e&&e.kind===ec(t)&&Mo(t,e)}function rc(e,t,r,n){return Math.min(t,n)-Math.max(e,r)}const nc=/\s/,ic={newCue(e,t,r,n){const i=[];let a,s,o,l,u;const c=self.VTTCue||self.TextTrackCue;for(let f=0;f<n.rows.length;f++)if(a=n.rows[f],o=!0,l=0,u="",!a.isEmpty()){var d;for(let e=0;e<a.chars.length;e++)nc.test(a.chars[e].uchar)&&o?l++:(u+=a.chars[e].uchar,o=!1);a.cueStartTime=t,t===r&&(r+=1e-4),l>=16?l--:l++;const n=xu(u.trim()),h=Zu(t,r,n);null!=e&&null!=(d=e.cues)&&d.getCueById(h)||(s=new c(t,r,n),s.id=h,s.line=f+1,s.align="left",s.position=10+Math.min(80,10*Math.floor(8*l/32)),i.push(s))}return e&&i.length&&(i.sort((e,t)=>"auto"===e.line||"auto"===t.line?0:e.line>8&&t.line>8?t.line-e.line:e.line-t.line),i.forEach(t=>$l(e,t))),i}};const ac=/(\d+)-(\d+)\/(\d+)/;class sc{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||oc,this.controller=new self.AbortController,this.stats=new sr}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const i=function(e,t){const r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(xt({},e.headers))};e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1));return r}(e,this.controller.signal),a="arraybuffer"===e.responseType,s=a?"byteLength":"length",{maxTimeToFirstByteMs:o,maxLoadTimeMs:l}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=o&&Tt(o)?o:l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout);(Ro(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(r=>{var i;this.response=this.loader=r;const s=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=l,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},l-(s-n.loading.start)),!r.ok){const{status:e,statusText:t}=r;throw new lc(t||"fetch, bad network response",e,r)}n.loading.first=s,n.total=function(e){const t=e.get("Content-Range");if(t){const e=function(e){const t=ac.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}(t);if(Tt(e))return e}const r=e.get("Content-Length");if(r)return parseInt(r)}(r.headers)||n.total;const o=null==(i=this.callbacks)?void 0:i.onProgress;return o&&Tt(t.highWaterMark)?this.loadProgressively(r,n,e,t.highWaterMark,o):a?r.arrayBuffer():"json"===e.responseType?r.json():r.text()}).then(r=>{var i,a;const o=this.response;if(!o)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const l=r[s];l&&(n.loaded=n.total=l);const u={url:o.url,data:r,code:o.status},c=null==(i=this.callbacks)?void 0:i.onProgress;c&&!Tt(t.highWaterMark)&&c(n,e,r,o),null==(a=this.callbacks)||a.onSuccess(u,n,e,o)}).catch(t=>{var r;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const i=t&&t.code||0,a=t?t.message:null;null==(r=this.callbacks)||r.onError({code:i,text:a},e,t?t.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,n=0,i){const a=new es,s=e.body.getReader(),o=()=>s.read().then(s=>{if(s.done)return a.dataLength&&i(t,r,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const l=s.value,u=l.length;return t.loaded+=u,u<n||a.dataLength?(a.push(l),a.dataLength>=n&&i(t,r,a.flush().buffer,e)):i(t,r,l.buffer,e),o()}).catch(()=>Promise.reject());return o()}}function oc(e,t){return new self.Request(e.url,t)}class lc extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}}const uc=/^age:\s*[\d.]+\s*$/im;class cc{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new sr,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const r=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const i=this.xhrSetup;i?Promise.resolve().then(()=>{if(this.loader===r&&!this.stats.aborted)return i(r,t.url)}).catch(e=>{if(this.loader===r&&!this.stats.aborted)return r.open("GET",t.url,!0),i(r,t.url)}).then(()=>{this.loader!==r||this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(e=>{var i;null==(i=this.callbacks)||i.onError({code:r.status,text:e.message},t,r,n)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:i,maxLoadTimeMs:a}=r.loadPolicy;if(n)for(const t in n)e.setRequestHeader(t,n[t]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=i&&Tt(i)?i:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:r}=this;if(!e||!t)return;const n=t.readyState,i=this.config;if(!r.aborted&&n>=2&&(0===r.loading.first&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),i.timeout!==i.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),i.timeout=i.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===n)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const n=t.status,l="text"===t.responseType?t.responseText:null;if(n>=200&&n<300){const i=null!=l?l:t.response;if(null!=i){var a,s;r.loading.end=Math.max(self.performance.now(),r.loading.first);const o="arraybuffer"===t.responseType?i.byteLength:i.length;r.loaded=r.total=o,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first);const l=null==(a=this.callbacks)?void 0:a.onProgress;l&&l(r,e,i,t);const u={url:t.responseURL,data:i,code:n};return void(null==(s=this.callbacks)||s.onSuccess(u,r,e,t))}}const u=i.loadPolicy.errorRetry;var o;if(Gn(u,r.retry,!1,{url:e.url,data:void 0,code:n}))this.retry(u);else Kt.error(`${n} while loading ${e.url}`),null==(o=this.callbacks)||o.onError({code:n,text:t.statusText},e,t,r)}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry;if(Gn(e,this.stats.retry,!0))this.retry(e);else{var t;Kt.warn(`timeout while loading ${null==(t=this.context)?void 0:t.url}`);const e=this.callbacks;e&&(this.abortInternal(),e.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:r}=this;this.retryDelay=Un(e,r.retry),r.retry++,Kt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${null==t?void 0:t.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&uc.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const dc=Bt(Bt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:6e7,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:cc,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:class extends Ut{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=e=>{var t;const{fragCurrent:r,partCurrent:n,hls:i}=this,{autoLevelEnabled:a,media:s}=i;if(!r||!s)return;const o=performance.now(),l=n?n.stats:r.stats,u=n?n.duration:r.duration,c=o-l.loading.start,d=i.minAutoLevel,f=r.level,h=this._nextAutoLevel;if(l.aborted||l.loaded&&l.loaded===l.total||f<=d)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!a)return;const g=h>-1&&h!==f,p=!!e||g;if(!p&&(s.paused||!s.playbackRate||!s.readyState))return;const m=i.mainForwardBufferInfo;if(!p&&null===m)return;const v=this.bwEstimator.getEstimateTTFB(),y=Math.abs(s.playbackRate);if(c<=Math.max(v,u/(2*y)*1e3))return;const E=m?m.len/y:0,T=l.loading.first?l.loading.first-l.loading.start:-1,_=l.loaded&&T>-1,S=this.getBwEstimate(),b=i.levels,A=b[f],I=Math.max(l.loaded,Math.round(u*(r.bitrate||A.averageBitrate)/8));let R=_?c-T:c;R<1&&_&&(R=Math.min(c,8*l.loaded/S));const w=_?1e3*l.loaded/R:0,D=v/1e3,L=w?(I-l.loaded)/w:8*I/S+D;if(L<=E)return;const C=w?8*w:S,N=!0===(null==(t=(null==e?void 0:e.details)||this.hls.latestLevelDetails)?void 0:t.live),P=this.hls.config.abrBandWidthUpFactor;let O,M=Number.POSITIVE_INFINITY;for(O=f-1;O>d;O--){const e=b[O].maxBitrate,t=!b[O].details||N;if(M=this.getTimeToLoadFrag(D,C,u*e,t),M<Math.min(E,u+D))break}if(M>=L)return;if(M>10*u)return;_?this.bwEstimator.sample(c-Math.min(v,T),l.loaded):this.bwEstimator.sampleTTFB(c);const k=b[O].maxBitrate;this.getBwEstimate()*P>k&&this.resetEstimator(k);const x=this.findBestLevel(k,d,O,0,E,1,1);x>-1&&(O=x),this.warn(`Fragment ${r.sn}${n?" part "+n.index:""} of level ${f} is loading too slowly;\n      Fragment duration: ${r.duration.toFixed(3)}\n      Time to underbuffer: ${E.toFixed(3)} s\n      Estimated load time for current fragment: ${L.toFixed(3)} s\n      Estimated load time for down switch fragment: ${M.toFixed(3)} s\n      TTFB estimate: ${0|T} ms\n      Current BW estimate: ${Tt(S)?0|S:"Unknown"} bps\n      New BW estimate: ${0|this.getBwEstimate()} bps\n      Switching to level ${O} @ ${0|k} bps`),i.nextLoadLevel=i.nextAutoLevel=O,this.clearTimer();const F=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===O&&O>0){const e=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${O>0?"and switching down":""}\n      Fragment duration: ${r.duration.toFixed(3)} s\n      Time to underbuffer: ${e.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,O>d){let t=this.findBestLevel(this.hls.levels[d].bitrate,d,O,0,e,1,1);-1===t&&(t=d),this.hls.nextLoadLevel=this.hls.nextAutoLevel=t,this.resetEstimator(this.hls.levels[t].bitrate)}}};g||L>2*M?F():this.timer=self.setInterval(F,1e3*M),i.trigger(It.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:n,stats:l})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new Mt(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.FRAG_LOADING,this.onFragLoading,this),e.on(It.FRAG_LOADED,this.onFragLoaded,this),e.on(It.FRAG_BUFFERED,this.onFragBuffered,this),e.on(It.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(It.LEVEL_LOADED,this.onLevelLoaded,this),e.on(It.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(It.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(It.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.FRAG_LOADING,this.onFragLoading,this),e.off(It.FRAG_LOADED,this.onFragLoaded,this),e.off(It.FRAG_BUFFERED,this.onFragBuffered,this),e.off(It.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(It.LEVEL_LOADED,this.onLevelLoaded,this),e.off(It.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(It.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(It.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const r=t.frag;if(!this.ignoreFragment(r)){var n;if(!r.bitrateTest)this.fragCurrent=r,this.partCurrent=null!=(n=t.part)?n:null;this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case At.BUFFER_ADD_CODEC_ERROR:case At.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case At.FRAG_LOAD_TIMEOUT:{const e=t.frag,{fragCurrent:r,partCurrent:n}=this;if(e&&r&&e.sn===r.sn&&e.level===r.level){const t=performance.now(),r=n?n.stats:e.stats,i=t-r.loading.start,a=r.loading.first?r.loading.first-r.loading.start:-1;if(r.loaded&&a>-1){const e=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(i-Math.min(e,a),r.loaded)}else this.bwEstimator.sampleTTFB(i)}break}}}getTimeToLoadFrag(e,t,r,n){return e+r/t+(n?e+this.lastLevelLoadSec:0)}onLevelLoaded(e,t){const r=this.hls.config,{loading:n}=t.stats,i=n.end-n.first;Tt(i)&&(this.lastLevelLoadSec=i/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:r}){const n=r?r.stats:t.stats;if(t.type===Ct&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const e=r?r.duration:t.duration,i=this.hls.levels[t.level],a=(i.loaded?i.loaded.bytes:0)+n.loaded,s=(i.loaded?i.loaded.duration:0)+e;i.loaded={bytes:a,duration:s},i.realBitrate=Math.round(8*a/s)}if(t.bitrateTest){const e={stats:n,frag:t,part:r,id:t.type};this.onFragBuffered(It.FRAG_BUFFERED,e),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:r,part:n}=t,i=null!=n&&n.stats.loaded?n.stats:r.stats;if(i.aborted)return;if(this.ignoreFragment(r))return;const a=i.parsing.end-i.loading.start-Math.min(i.loading.first-i.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,i.loaded),i.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Ct||"initSegment"===e.sn}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,i=this.findBestLevel(r,t,e,0,n,1,1);if(i>-1)return i;const a=this.hls.firstLevel,s=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${s}`),s}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(!(-1===e||t&&r&&this.nextAutoLevelKey!==this.getAutoLevelKey()))return e;const n=t&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(-1!==e){const t=this.hls.levels;if(t.length>Math.max(e,n)&&t[e].loadError<=t[n].loadError)return e}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:r}=this;if(r.levels.length<=1)return r.loadLevel;const{maxAutoLevel:n,config:i,minAutoLevel:a}=r,s=t?t.duration:e?e.duration:0,o=this.getBwEstimate(),l=this.getStarvationDelay();let u=i.abrBandWidthFactor,c=i.abrBandWidthUpFactor;if(l){const e=this.findBestLevel(o,a,n,l,0,u,c);if(e>=0)return this.rebufferNotice=-1,e}let d=s?Math.min(s,i.maxStarvationDelay):i.maxStarvationDelay;if(!l){const e=this.bitrateTestDelay;if(e){d=(s?Math.min(s,i.maxLoadingDelay):i.maxLoadingDelay)-e,this.info(`bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*d)} ms`),u=c=1}}const f=this.findBestLevel(o,a,n,l,d,u,c);if(this.rebufferNotice!==f&&(this.rebufferNotice=f,this.info(`${l?"rebuffering expected":"buffer is empty"}, optimal quality level ${f}`)),f>-1)return f;const h=r.levels[a],g=r.loadLevelObj;return g&&(null==h?void 0:h.bitrate)<g.bitrate?a:r.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const r=t&&0!==t.playbackRate?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,n,i,a,s){var o;const l=n+i,u=this.lastLoadedFragLevel,c=-1===u?this.hls.firstLevel:u,{fragCurrent:d,partCurrent:f}=this,{levels:h,allAudioTracks:g,loadLevel:p,config:m}=this.hls;if(1===h.length)return 0;const v=h[c],y=!(null==(o=this.hls.latestLevelDetails)||!o.live),E=-1===p||-1===u;let T,_="SDR",S=(null==v?void 0:v.frameRate)||0;const{audioPreference:b,videoPreference:A}=m,I=this.audioTracksByGroup||(this.audioTracksByGroup=bn(g));let R=-1;if(E){if(-1!==this.firstSelection)return this.firstSelection;const n=this.codecTiers||(this.codecTiers=function(e,t,r,n){return e.slice(r,n+1).reduce((e,r,n)=>{if(!r.codecSet)return e;const i=r.audioGroups;let a=e[r.codecSet];a||(e[r.codecSet]=a={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:n,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!i,fragmentError:0}),a.minBitrate=Math.min(a.minBitrate,r.bitrate);const s=Math.min(r.height,r.width);return a.minHeight=Math.min(a.minHeight,s),a.minFramerate=Math.min(a.minFramerate,r.frameRate),a.minIndex=Math.min(a.minIndex,n),a.maxScore=Math.max(a.maxScore,r.score),a.fragmentError+=r.fragmentError,a.videoRanges[r.videoRange]=(a.videoRanges[r.videoRange]||0)+1,i&&i.forEach(e=>{if(!e)return;const r=t.groups[e];r&&(a.hasDefaultAudio=a.hasDefaultAudio||t.hasDefaultAudio?r.hasDefault:r.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(r.channels).forEach(e=>{a.channels[e]=(a.channels[e]||0)+r.channels[e]}))}),e},{})}(h,I,t,r)),i=function(e,t,r,n,i){const a=Object.keys(e),s=null==n?void 0:n.channels,o=null==n?void 0:n.audioCodec,l=null==i?void 0:i.videoCodec,u=s&&2===parseInt(s);let c=!1,d=!1,f=1/0,h=1/0,g=1/0,p=1/0,m=0,v=[];const{preferHDR:y,allowedVideoRanges:E}=Tn(t,i);for(let t=a.length;t--;){const r=e[a[t]];c||(c=r.channels[2]>0),f=Math.min(f,r.minHeight),h=Math.min(h,r.minFramerate),g=Math.min(g,r.minBitrate),E.filter(e=>r.videoRanges[e]>0).length>0&&(d=!0)}f=Tt(f)?f:0,h=Tt(h)?h:0;const T=Math.max(1080,f),_=Math.max(30,h);g=Tt(g)?g:r,r=Math.max(g,r),d||(t=void 0);const S=a.length>1;return{codecSet:a.reduce((t,n)=>{const i=e[n];if(n===t)return t;if(v=d?E.filter(e=>i.videoRanges[e]>0):[],S){if(i.minBitrate>r)return Sn(n,`min bitrate of ${i.minBitrate} > current estimate of ${r}`),t;if(!i.hasDefaultAudio)return Sn(n,"no renditions with default or auto-select sound found"),t;if(o&&n.indexOf(o.substring(0,4))%5!=0)return Sn(n,`audio codec preference "${o}" not found`),t;if(s&&!u){if(!i.channels[s])return Sn(n,`no renditions with ${s} channel sound found (channels options: ${Object.keys(i.channels)})`),t}else if((!o||u)&&c&&0===i.channels[2])return Sn(n,"no renditions with stereo sound found"),t;if(i.minHeight>T)return Sn(n,`min resolution of ${i.minHeight} > maximum of ${T}`),t;if(i.minFramerate>_)return Sn(n,`min framerate of ${i.minFramerate} > maximum of ${_}`),t;if(!v.some(e=>i.videoRanges[e]>0))return Sn(n,`no variants with VIDEO-RANGE of ${_n(v)} found`),t;if(l&&n.indexOf(l.substring(0,4))%5!=0)return Sn(n,`video codec preference "${l}" not found`),t;if(i.maxScore<m)return Sn(n,`max score of ${i.maxScore} < selected max of ${m}`),t}return t&&(jr(n)>=jr(t)||i.fragmentError>e[t].fragmentError)?t:(p=i.minIndex,m=i.maxScore,n)},void 0),videoRanges:v,preferHDR:y,minFramerate:h,minBitrate:g,minIndex:p}}(n,_,e,b,A),{codecSet:a,videoRanges:s,minFramerate:o,minBitrate:l,minIndex:u,preferHDR:c}=i;R=u,T=a,_=c?s[s.length-1]:s[0],S=o,e=Math.max(e,l),this.log(`picked start tier ${_n(i)}`)}else T=null==v?void 0:v.codecSet,_=null==v?void 0:v.videoRange;const w=f?f.duration:d?d.duration:0,D=this.bwEstimator.getEstimateTTFB()/1e3,L=[];for(let o=r;o>=t;o--){var C;const t=h[o],d=o>c;if(!t)continue;if(m.useMediaCapabilities&&!t.supportedResult&&!t.supportedPromise){const r=navigator.mediaCapabilities;"function"==typeof(null==r?void 0:r.decodingInfo)&&on(t,I,_,S,e,b)?(t.supportedPromise=ln(t,I,r,this.supportedCache),t.supportedPromise.then(e=>{if(!this.hls)return;t.supportedResult=e;const r=this.hls.levels,n=r.indexOf(t);e.error?this.warn(`MediaCapabilities decodingInfo error: "${e.error}" for level ${n} ${_n(e)}`):e.supported?e.decodingInfoResults.some(e=>!1===e.smooth||!1===e.powerEfficient)&&this.log(`MediaCapabilities decodingInfo for level ${n} not smooth or powerEfficient: ${_n(e)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${n} ${_n(e)}`),n>-1&&r.length>1&&(this.log(`Removing unsupported level ${n}`),this.hls.removeLevel(n),-1===this.hls.loadLevel&&(this.hls.nextLoadLevel=0)))}).catch(e=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${e}`)})):t.supportedResult=an}if((T&&t.codecSet!==T||_&&t.videoRange!==_||d&&S>t.frameRate||!d&&S>0&&S<t.frameRate||null!=(C=t.supportedResult)&&null!=(C=C.decodingInfoResults)&&C.some(e=>!1===e.smooth))&&(!E||o!==R)){L.push(o);continue}const g=t.details,v=(f?null==g?void 0:g.partTarget:null==g?void 0:g.averagetargetduration)||w;let A;A=d?s*e:a*e;const N=w&&n>=2*w&&0===i?t.averageBitrate:t.maxBitrate,P=this.getTimeToLoadFrag(D,A,N*v,void 0===g);if(A>=N&&(o===u||0===t.loadError&&0===t.fragmentError)&&(P<=D||!Tt(P)||y&&!this.bitrateTestDelay||P<l)){const e=this.forcedAutoLevel;return o===p||-1!==e&&e===p||(L.length&&this.trace(`Skipped level(s) ${L.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${h[L[0]].codecs}" ${h[L[0]].videoRange}; not compatible with "${T}" ${_}`),this.info(`switch candidate:${c}->${o} adjustedbw(${Math.round(A)})-bitrate=${Math.round(A-N)} ttfb:${D.toFixed(1)} avgDuration:${v.toFixed(1)} maxFetchDuration:${l.toFixed(1)} fetchDuration:${P.toFixed(1)} firstSelection:${E} codecSet:${t.codecSet} videoRange:${t.videoRange} hls.loadLevel:${p}`)),E&&(this.firstSelection=o),o}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:r}=this.hls;return Math.min(Math.max(e,r),t)}},bufferController:class extends Ut{constructor(e,t){var r;super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=e=>{var t;this.hls&&"open"===(null==(t=this.mediaSource)?void 0:t.readyState)&&this.hls.pauseBuffering()},this._onStartStreaming=e=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=e=>{const{media:t,mediaSource:r}=this;e&&this.log("Media source opened"),t&&r&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(It.MEDIA_ATTACHED,{media:t,mediaSource:r}),null!==this.mediaSource&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:e,_objectUrl:t}=this;e!==t&&this.error(`Media element src was set while attaching MediaSource (${t} > ${e})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=(r=qt(e.config.preferManagedMediaSource),"undefined"!=typeof self&&r===self.ManagedMediaSource),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(It.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.MANIFEST_PARSED,this.onManifestParsed,this),e.on(It.BUFFER_RESET,this.onBufferReset,this),e.on(It.BUFFER_APPENDING,this.onBufferAppending,this),e.on(It.BUFFER_CODECS,this.onBufferCodecs,this),e.on(It.BUFFER_EOS,this.onBufferEos,this),e.on(It.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(It.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(It.FRAG_PARSED,this.onFragParsed,this),e.on(It.FRAG_CHANGED,this.onFragChanged,this),e.on(It.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(It.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.MANIFEST_PARSED,this.onManifestParsed,this),e.off(It.BUFFER_RESET,this.onBufferReset,this),e.off(It.BUFFER_APPENDING,this.onBufferAppending,this),e.off(It.BUFFER_CODECS,this.onBufferCodecs,this),e.off(It.BUFFER_EOS,this.onBufferEos,this),e.off(It.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(It.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(It.FRAG_PARSED,this.onFragParsed,this),e.off(It.FRAG_CHANGED,this.onFragChanged,this),e.off(It.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const r={};if(this.operationQueue){const e=this.isUpdating();e||this.operationQueue.removeBlockers();const t=this.isQueued();(e||t)&&this.warn(`Transfering MediaSource with${t?" operations in queue":""}${e?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?xt(r,n.tracks):this.sourceBuffers.forEach(e=>{const[t]=e;t&&(r[t]=xt({},this.tracks[t]),this.removeBuffer(t)),e[0]=e[1]=null}),{media:e,mediaSource:t,tracks:r}}initTracks(){this.sourceBuffers=[[null,null],[null,null]],this.tracks={},this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var r;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),null!=(r=this.transferData)&&r.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const r=this.media=t.media;this.transferData=this.overrides=void 0;const n=qt(this.appendSource);if(n){const e=!!t.mediaSource;(e||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const i=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(i),e)this._objectUrl=r.src,this.attachTransferred();else{const e=this._objectUrl=self.URL.createObjectURL(i);if(this.appendSource)try{r.removeAttribute("src");const t=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||t&&i instanceof t,Uo(r),function(e,t){const r=self.document.createElement("source");r.type="video/mp4",r.src=t,e.appendChild(r)}(r,e),r.load()}catch(t){r.src=e}else r.src=e}r.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,r;this.log(`${(null==(t=this.transferData)?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${null==(r=e.constructor)?void 0:r.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const r=this.tracks,n=t.tracks,i=n?Object.keys(n):null,a=i?i.length:0,s=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(n&&i&&a){if(!this.tracksReady)return this.hls.config.startFragPrefetch=!0,void this.log("attachTransferred: waiting for SourceBuffer track info");if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})\nrequired tracks: ${_n(r,(e,t)=>"initSegment"===e?void 0:t)};\ntransfer tracks: ${_n(n,(e,t)=>"initSegment"===e?void 0:t)}}`),!Yt(n,r)){t.mediaSource=null,t.tracks=void 0;const i=e.currentTime,a=this.details,s=Math.max(i,(null==a?void 0:a.fragments[0].start)||0);return s-i>1?void this.log(`attachTransferred: waiting for playback to reach new tracks start time ${i} -> ${s}`):(this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(r)}") start time: ${s} currentTime: ${i}`),this.onMediaDetaching(It.MEDIA_DETACHING,{}),this.onMediaAttaching(It.MEDIA_ATTACHING,t),void(e.currentTime=s))}this.transferData=void 0,i.forEach(e=>{const t=e,r=n[t];if(r){const e=r.buffer;if(e){const n=this.fragmentTracker,i=r.id;if(n.hasFragments(i)||n.hasParts(i)){const r=Ti.getBuffered(e);n.detectEvictedFragments(t,r,i,null,!0)}const a=Zo(t),s=[t,e];this.sourceBuffers[a]=s,e.updating&&this.operationQueue&&this.operationQueue.prependBlocker(t),this.trackSourceBuffer(t,r)}}}),s(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),s()}get mediaSourceOpenOrEnded(){var e;const t=null==(e=this.mediaSource)?void 0:e.readyState;return"open"===t||"ended"===t}onMediaDetaching(e,t){const r=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:i,_objectUrl:a}=this;if(i){if(this.log("media source "+(r?"transferring":"detaching")),r)this.sourceBuffers.forEach(([e])=>{e&&this.removeBuffer(e)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const e="open"===i.readyState;try{const t=i.sourceBuffers;for(let r=t.length;r--;)e&&t[r].abort(),i.removeSourceBuffer(t[r]);e&&i.endOfStream()}catch(e){this.warn(`onMediaDetaching: ${e.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}i.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("sourceended",this._onMediaSourceEnded),i.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(i.removeEventListener("startstreaming",this._onStartStreaming),i.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),r||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(n.removeAttribute("src"),this.appendSource&&Uo(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(It.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const r=null==(t=this.tracks[e])?void 0:t.buffer;if(this.removeBuffer(e),r)try{var n;null!=(n=this.mediaSource)&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(r)}catch(t){this.warn(`onBufferReset ${e}`,t)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Zo(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new ko(this.tracks)}onBufferCodecs(e,t){var r;const n=this.tracks,i=Object.keys(t);this.log(`BUFFER_CODECS: "${i}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),s=!a&&this.sourceBufferCount&&this.media&&i.some(e=>!n[e]);a||s?this.warn(`Unsupported transition between "${Object.keys(n)}" and "${i}" SourceBuffers`):(i.forEach(e=>{var r,i;const a=t[e],{id:s,codec:o,levelCodec:l,container:u,metadata:c,supplemental:d}=a;let f=n[e];const h=null==(r=this.transferData)||null==(r=r.tracks)?void 0:r[e],g=null!=h&&h.buffer?h:f,p=(null==g?void 0:g.pendingCodec)||(null==g?void 0:g.codec),m=null==g?void 0:g.levelCodec;f||(f=n[e]={buffer:void 0,listeners:[],codec:o,supplemental:d,container:u,levelCodec:l,metadata:c,id:s});const v=Qr(p,m),y=null==v?void 0:v.replace(xo,"$1");let E=Qr(o,l);const T=null==(i=E)?void 0:i.replace(xo,"$1");E&&v&&y!==T&&("audio"===e.slice(0,5)&&(E=Xr(E,this.appendSource)),this.log(`switching codec ${p} to ${E}`),E!==(f.pendingCodec||f.codec)&&(f.pendingCodec=E),f.container=u,this.appendChangeType(e,u,E))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),this.sourceBufferCount||(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&"main"===(null==(r=t.audio)?void 0:r.id)&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks()))}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const r=this.tracks[t];return e[t]={id:r.id,container:r.container,codec:r.codec,levelCodec:r.levelCodec},e},{})}appendChangeType(e,t,r){const n=`${t};codecs=${r}`,i={label:`change-type=${n}`,execute:()=>{const i=this.tracks[e];if(i){const a=i.buffer;null!=a&&a.changeType&&(this.log(`changing ${e} sourceBuffer type to ${n}`),a.changeType(n),i.codec=r,i.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:t=>{this.warn(`Failed to change ${e} SourceBuffer type`,t)}};this.append(i,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const r=e.start,n=r+.05*e.duration;if(!0===(null==(t=this.fragmentTracker.getAppendedFrag(r,Ct))?void 0:t.gap))return;const i={label:"block-audio",execute:()=>{var e;const t=this.tracks.video;(this.lastVideoAppendEnd>n||null!=t&&t.buffer&&Ti.isBuffered(t.buffer,n)||!0===(null==(e=this.fragmentTracker.getAppendedFrag(n,Ct))?void 0:e.gap))&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:e=>{this.warn("Error executing block-audio operation",e)}};this.blockedAudioAppend={op:i,frag:e},this.append(i,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:r}=this,{data:n,type:i,parent:a,frag:s,part:o,chunkMeta:l,offset:u}=t,c=l.buffering[i],{sn:d,cc:f}=s,h=self.performance.now();c.start=h;const g=s.stats.buffering,p=o?o.stats.buffering:null;0===g.start&&(g.start=h),p&&0===p.start&&(p.start=h);const m=r.audio;let v=!1;"audio"===i&&"audio/mpeg"===(null==m?void 0:m.container)&&(v=!this.lastMpegAudioChunk||1===l.id||this.lastMpegAudioChunk.sn!==l.sn,this.lastMpegAudioChunk=l);const y=r.video,E=null==y?void 0:y.buffer;if(E&&"initSegment"!==d){const e=o||s,t=this.blockedAudioAppend;if("audio"!==i||"main"===a||this.blockedAudioAppend||y.ending||y.ended){if("video"===i){const r=e.end;if(t){const e=t.frag.start;(r>e||r<this.lastVideoAppendEnd||Ti.isBuffered(E,e))&&this.unblockAudio()}this.lastVideoAppendEnd=r}}else{const t=e.start+.05*e.duration,r=E.buffered,n=this.currentOp("video");r.length||n?!n&&!Ti.isBuffered(E,t)&&this.lastVideoAppendEnd<t&&this.blockAudio(e):this.blockAudio(e)}}const T=(o||s).start,_={label:`append-${i}`,execute:()=>{var e;c.executeStart=self.performance.now();const t=null==(e=this.tracks[i])?void 0:e.buffer;t&&(v?this.updateTimestampOffset(t,T,.1,i,d,f):void 0!==u&&Tt(u)&&this.updateTimestampOffset(t,u,1e-6,i,d,f)),this.appendExecutor(n,i)},onStart:()=>{},onComplete:()=>{const e=self.performance.now();c.executeEnd=c.end=e,0===g.first&&(g.first=e),p&&0===p.first&&(p.first=e);const t={};this.sourceBuffers.forEach(([e,r])=>{e&&(t[e]=Ti.getBuffered(r))}),this.appendErrors[i]=0,"audio"===i||"video"===i?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(It.BUFFER_APPENDED,{type:i,frag:s,part:o,chunkMeta:l,parent:s.type,timeRanges:t})},onError:e=>{var t;const r={type:bt.MEDIA_ERROR,parent:s.type,details:At.BUFFER_APPEND_ERROR,sourceBufferName:i,frag:s,part:o,chunkMeta:l,error:e,err:e,fatal:!1},n=null==(t=this.media)?void 0:t.error;if(e.code===DOMException.QUOTA_EXCEEDED_ERR||"QuotaExceededError"==e.name||"quota"in e)r.details=At.BUFFER_FULL_ERROR;else if(e.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!n)r.errorAction=Xn(!0);else if(e.name===Fo&&0===this.sourceBufferCount)r.errorAction=Xn(!0);else{const e=++this.appendErrors[i];this.warn(`Failed ${e}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${i}" sourceBuffer (${n||"no media error"})`),(e>=this.hls.config.appendErrorMaxRetry||n)&&(r.fatal=!0)}this.hls.trigger(It.ERROR,r)}};this.log(`queuing "${i}" append sn: ${d}${o?" p: "+o.index:""} of ${s.type===Ct?"level":"track"} ${s.level} cc: ${f}`),this.append(_,i,this.isPending(this.tracks[i]))}getFlushOp(e,t,r){return this.log(`queuing "${e}" remove ${t}-${r}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,r)},onStart:()=>{},onComplete:()=>{this.hls.trigger(It.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn(`Failed to remove ${t}-${r} from "${e}" SourceBuffer`,n)}}}onBufferFlushing(e,t){const{type:r,startOffset:n,endOffset:i}=t;r?this.append(this.getFlushOp(r,n,i),r):this.sourceBuffers.forEach(([e])=>{e&&this.append(this.getFlushOp(e,n,i),e)})}onFragParsed(e,t){const{frag:r,part:n}=t,i=[],a=n?n.elementaryStreams:r.elementaryStreams;a[ur]?i.push("audiovideo"):(a[or]&&i.push("audio"),a[lr]&&i.push("video"));0===i.length&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(()=>{const e=self.performance.now();r.stats.buffering.end=e,n&&(n.stats.buffering.end=e);const t=n?n.stats:r.stats;this.hls.trigger(It.FRAG_BUFFERED,{frag:r,part:n,stats:t,id:r.type})},i).catch(e=>{this.warn(`Fragment buffered callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var r;this.sourceBuffers.forEach(([e])=>{if(e){const r=this.tracks[e];t.type&&t.type!==e||(r.ending=!0,r.ended||(r.ended=!0,this.log(`${e} buffer reached EOS`)))}});const n=!1!==(null==(r=this.overrides)?void 0:r.endOfStream);this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t;return e&&!(null!=(t=this.tracks[e])&&t.ended)})?n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:e}=this;e&&"open"===e.readyState?(this.log("Calling mediaSource.endOfStream()"),e.endOfStream(),this.hls.trigger(It.BUFFERED_TO_END,void 0)):e&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${e.readyState}`)})):(this.tracksEnded(),this.hls.trigger(It.BUFFERED_TO_END,void 0)):"video"===t.type&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(null!==e){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===At.BUFFER_APPEND_ERROR&&t.frag){var r;const e=null==(r=t.errorAction)?void 0:r.nextAutoLevel;Tt(e)&&e!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:r}=this;if(!r||null===t)return;if(!this.sourceBufferCount)return;const n=e.config,i=r.currentTime,a=t.levelTargetDuration,s=t.live&&null!==n.liveBackBufferLength?n.liveBackBufferLength:n.backBufferLength;if(Tt(s)&&s>=0){const e=Math.max(s,a),t=Math.floor(i/a)*a-e;this.flushBackBuffer(i,a,t)}const o=n.frontBufferFlushThreshold;if(Tt(o)&&o>0){const e=Math.max(n.maxBufferLength,o),t=Math.max(e,a),r=Math.floor(i/a)*a+t;this.flushFrontBuffer(i,a,r)}}flushBackBuffer(e,t,r){this.sourceBuffers.forEach(([e,t])=>{if(t){const i=Ti.getBuffered(t);if(i.length>0&&r>i.start(0)){var n;this.hls.trigger(It.BACK_BUFFER_REACHED,{bufferEnd:r});const t=this.tracks[e];if(null!=(n=this.details)&&n.live)this.hls.trigger(It.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(null!=t&&t.ended)return void this.log(`Cannot flush ${e} back buffer while SourceBuffer is in ended state`);this.hls.trigger(It.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:e})}}})}flushFrontBuffer(e,t,r){this.sourceBuffers.forEach(([t,n])=>{if(n){const i=Ti.getBuffered(n),a=i.length;if(a<2)return;const s=i.start(a-1),o=i.end(a-1);if(r>s||e>=s&&e<=o)return;this.hls.trigger(It.BUFFER_FLUSHING,{startOffset:s,endOffset:1/0,type:t})}})}getDurationAndRange(){var e;const{details:t,mediaSource:r}=this;if(!t||!this.media||"open"!==(null==r?void 0:r.readyState))return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&r.setLiveSeekableRange){const e=Math.max(0,t.fragmentStart);return{duration:1/0,start:e,end:Math.max(e,n)}}return{duration:1/0}}const i=null==(e=this.overrides)?void 0:e.duration;if(i)return Tt(i)?{duration:i}:null;const a=this.media.duration;return n>(Tt(r.duration)?r.duration:0)&&n>a||!Tt(a)?{duration:n}:null}updateMediaSource({duration:e,start:t,end:r}){const n=this.mediaSource;this.media&&n&&"open"===n.readyState&&(n.duration!==e&&(Tt(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),n.duration=e),void 0!==t&&void 0!==r&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${t}-${r}.`),n.setLiveSeekableRange(t,r)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:r}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${_n(r)}`),this.tracksReady){var n;const e=null==(n=this.transferData)?void 0:n.tracks;e&&Object.keys(e).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,r])=>{if(t){const n=this.tracks[t];e[t]={buffer:r,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(It.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([e])=>{this.executeNext(e)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:r}=this;if(!r)throw new Error("createSourceBuffers called when mediaSource was null");for(const i in e){const a=i,s=e[a];if(this.isPending(s)){const e=this.getTrackCodec(s,a),i=`${s.container};codecs=${e}`;s.codec=e,this.log(`creating sourceBuffer(${i})${this.currentOp(a)?" Queued":""} ${_n(s)}`);try{const e=r.addSourceBuffer(i),n=Zo(a),o=[a,e];t[n]=o,s.buffer=e}catch(e){var n;return this.error(`error while trying to add sourceBuffer: ${e.message}`),this.shiftAndExecuteNext(a),null==(n=this.operationQueue)||n.removeBlockers(),delete this.tracks[a],void this.hls.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,sourceBufferName:a,mimeType:i,parent:s.id})}this.trackSourceBuffer(a,s)}}this.bufferCreated()}getTrackCodec(e,t){const r=e.supplemental;let n=e.codec;r&&("video"===t||"audiovideo"===t)&&Vr(r,"video")&&(n=function(e,t){const r=[];if(e){const t=e.split(",");for(let e=0;e<t.length;e++)$r(t[e],"video")||r.push(t[e])}return t&&r.push(t),r.join(",")}(n,r));const i=Qr(n,e.levelCodec);return i?"audio"===t.slice(0,5)?Xr(i,this.appendSource):i:""}trackSourceBuffer(e,t){const r=t.buffer;if(!r)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:r,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(e,t)=>{const r=t.removedRanges;null!=r&&r.length&&this.hls.trigger(It.BUFFER_FLUSHED,{type:e})})}get mediaSrc(){var e,t;const r=(null==(e=this.media)||null==(t=e.querySelector)?void 0:t.call(e,"source"))||this.media;return null==r?void 0:r.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if("closed"===(null==(t=this.mediaSource)?void 0:t.readyState))return void this.resetBuffer(e);const r=this.currentOp(e);r&&(r.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var r;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${null==(r=this.mediaSource)?void 0:r.readyState}`);this.error(`${n}`,t),this.hls.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const i=this.currentOp(e);i&&i.onError(n)}updateTimestampOffset(e,t,r,n,i,a){const s=t-e.timestampOffset;Math.abs(s)>=r&&(this.log(`Updating ${n} SourceBuffer timestampOffset to ${t} (sn: ${i} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,r){const{media:n,mediaSource:i}=this,a=this.tracks[e],s=null==a?void 0:a.buffer;if(!n||!i||!s)return this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),void this.shiftAndExecuteNext(e);const o=Tt(n.duration)?n.duration:1/0,l=Tt(i.duration)?i.duration:1/0,u=Math.max(0,t),c=Math.min(r,o,l);c>u&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${u},${c}] from the ${e} SourceBuffer`),s.remove(u,c)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const r=this.tracks[t],n=null==r?void 0:r.buffer;if(!n)throw new Bo(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);r.ending=!1,r.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(e=>{this.warn(`SourceBuffer blocked callback ${e}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(e){this.warn(`Callback run without blocking ${this.operationQueue} ${e}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:r}=this,n=t.map(e=>this.appendBlocker(e));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(t=>{r===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(e=>{var t;const r=null==(t=this.tracks[e])?void 0:t.buffer;r&&!r.updating&&this.shiftAndExecuteNext(e)})}append(e,t,r){this.operationQueue&&this.operationQueue.append(e,t,r)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,r){const n=this.tracks[e];if(!n)return;const i=n.buffer;if(!i)return;const a=r.bind(this,e);n.listeners.push({event:t,listener:a}),i.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const r=t.buffer;r&&(t.listeners.forEach(e=>{r.removeEventListener(e.event,e.listener)}),t.listeners.length=0)}},capLevelController:Go,errorController:class extends Ut{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(It.ERROR,this.onError,this),e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(It.ERROR,this.onError,this),e.off(It.ERROR,this.onErrorOut,this),e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(null==e?void 0:e.type)===Ct?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,r=t.currentLevel;return null!=(e=t.loadLevelObj)&&e.details||-1===r?t.loadLevel:r}variantHasKey(e,t){if(e){var r;if(null!=(r=e.details)&&r.hasKey(t))return!0;const n=e.audioGroups;if(n){return this.hls.allAudioTracks.filter(e=>n.indexOf(e.groupId)>=0).some(e=>{var r;return null==(r=e.details)?void 0:r.hasKey(t)})}}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var r;if(t.fatal)return;const n=this.hls,i=t.context;switch(t.details){case At.FRAG_LOAD_ERROR:case At.FRAG_LOAD_TIMEOUT:case At.KEY_LOAD_ERROR:case At.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case At.FRAG_PARSING_ERROR:if(null!=(r=t.frag)&&r.gap)return void(t.errorAction=Xn());case At.FRAG_GAP:case At.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=Vn);case At.LEVEL_EMPTY_ERROR:case At.LEVEL_PARSING_ERROR:{var a;const e=t.parent===Ct?t.level:n.loadLevel;t.details===At.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(a=a.levelDetails)&&a.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,e):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,e))}return;case At.LEVEL_LOAD_ERROR:case At.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==i?void 0:i.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level)));case At.AUDIO_TRACK_LOAD_ERROR:case At.AUDIO_TRACK_LOAD_TIMEOUT:case At.SUBTITLE_LOAD_ERROR:case At.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){const e=n.loadLevelObj;if(e&&(i.type===Dt&&e.hasAudioGroup(i.groupId)||i.type===Lt&&e.hasSubtitleGroup(i.groupId)))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=Vn,void(t.errorAction.flags=jn)}return;case At.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:return void(t.errorAction={action:Vn,flags:zn});case At.KEY_SYSTEM_SESSION_UPDATE_FAILED:case At.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case At.KEY_SYSTEM_NO_SESSION:return void(t.errorAction={action:Vn,flags:Wn});case At.BUFFER_ADD_CODEC_ERROR:case At.REMUX_ALLOC_ERROR:case At.BUFFER_APPEND_ERROR:var s;if(!t.errorAction)t.errorAction=this.getLevelSwitchAction(t,null!=(s=t.level)?s:n.loadLevel);return;case At.INTERNAL_EXCEPTION:case At.BUFFER_APPENDING_ERROR:case At.BUFFER_FULL_ERROR:case At.LEVEL_SWITCH_ERROR:case At.BUFFER_STALLED_ERROR:case At.BUFFER_SEEK_OVER_HOLE:case At.BUFFER_NUDGE_ON_STALL:return void(t.errorAction=Xn())}t.type===bt.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Xn())}getPlaylistRetryOrSwitchAction(e,t){const r=Bn(this.hls.config.playlistLoadPolicy,e),n=this.playlistError++;if(Gn(r,n,kn(e),e.response))return{action:qn,flags:Yn,retryConfig:r,retryCount:n};const i=this.getLevelSwitchAction(e,t);return r&&(i.retryConfig=r,i.retryCount=n),i}getFragRetryOrSwitchAction(e){const t=this.hls,r=this.getVariantLevelIndex(e.frag),n=t.levels[r],{fragLoadPolicy:i,keyLoadPolicy:a}=t.config,s=Bn(xn(e)?a:i,e),o=t.levels.reduce((e,t)=>e+t.fragmentError,0);if(n&&(e.details!==At.FRAG_GAP&&n.fragmentError++,!Fn(e))){if(Gn(s,o,kn(e),e.response))return{action:qn,flags:Yn,retryConfig:s,retryCount:o}}const l=this.getLevelSwitchAction(e,r);return s&&(l.retryConfig=s,l.retryCount=o),l}getLevelSwitchAction(e,t){const r=this.hls;null==t&&(t=r.loadLevel);const n=this.hls.levels[t];if(n){var i,a;const t=e.details;n.loadError++,t===At.BUFFER_APPEND_ERROR&&n.fragmentError++;let l=-1;const{levels:u,loadLevel:c,minAutoLevel:d,maxAutoLevel:f}=r;r.autoLevelEnabled||r.config.preserveManualLevelOnError||(r.loadLevel=-1);const h=null==(i=e.frag)?void 0:i.type,g=(h===Nt&&t===At.FRAG_PARSING_ERROR||"audio"===e.sourceBufferName&&(t===At.BUFFER_ADD_CODEC_ERROR||t===At.BUFFER_APPEND_ERROR))&&u.some(({audioCodec:e})=>n.audioCodec!==e),p="video"===e.sourceBufferName&&(t===At.BUFFER_ADD_CODEC_ERROR||t===At.BUFFER_APPEND_ERROR)&&u.some(({codecSet:e,audioCodec:t})=>n.codecSet!==e&&n.audioCodec===t),{type:m,groupId:v}=null!=(a=e.context)?a:{};for(let r=u.length;r--;){const i=(r+c)%u.length;if(i!==c&&i>=d&&i<=f&&0===u[i].loadError){var s,o;const r=u[i];if(t===At.FRAG_GAP&&h===Ct&&e.frag){const t=u[i].details;if(t){const r=Nn(e.frag,t.fragments,e.frag.start);if(null!=r&&r.gap)continue}}else{if(m===Dt&&r.hasAudioGroup(v)||m===Lt&&r.hasSubtitleGroup(v))continue;if(h===Nt&&null!=(s=n.audioGroups)&&s.some(e=>r.hasAudioGroup(e))||h===Pt&&null!=(o=n.subtitleGroups)&&o.some(e=>r.hasSubtitleGroup(e))||g&&n.audioCodec===r.audioCodec||p&&n.codecSet===r.codecSet||!g&&n.codecSet!==r.codecSet)continue}l=i;break}}if(l>-1&&r.loadLevel!==l)return e.levelRetry=!0,this.playlistError=0,{action:Vn,flags:Yn,nextAutoLevel:l}}return{action:Vn,flags:jn}}onErrorOut(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case $n:break;case Vn:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===At.FRAG_GAP?/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError()):t.fatal=!0}t.fatal&&this.hls.stopLoad()}sendAlternateToPenaltyBox(e){const t=this.hls,r=e.errorAction;if(!r)return;const{flags:n}=r,i=r.nextAutoLevel;switch(n){case Yn:this.switchLevel(e,i);break;case zn:{const n=this.getVariantLevelIndex(e.frag),i=t.levels[n],a=null==i?void 0:i.attrs["HDCP-LEVEL"];if(r.hdcpLevel=a,"NONE"===a)this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(a){t.maxHdcpLevel=dn[dn.indexOf(a)-1],r.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Wn:{const t=e.decryptdata;if(t){const n=this.hls.levels,i=n.length;for(let r=i;r--;){var a,s;if(this.variantHasKey(n[r],t))this.log(`Banned key found in level ${r} (${n[r].bitrate}bps) or audio group "${null==(a=n[r].audioGroups)?void 0:a.join(",")}" (${null==(s=e.frag)?void 0:s.type} fragment) ${zt(t.keyId||[])}`),n[r].fragmentError++,n[r].loadError++,this.log(`Removing level ${r} with key error (${e.error})`),this.hls.removeLevel(r)}const o=e.frag;if(this.hls.levels.length<i)r.resolved=!0;else if(o&&o.type!==Ct){const e=o.decryptdata;e&&!t.matches(e)&&(r.resolved=!0)}}break}}r.resolved||this.switchLevel(e,i)}switchLevel(e,t){if(void 0!==t&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===At.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&"audiovideo"!==e.sourceBufferName)){const t=rn(e.mimeType),r=this.hls.levels;for(let n=r.length;n--;)r[n][`${e.sourceBufferName}Codec`]===t&&(this.log(`Removing level ${n} for ${e.details} ("${t}" not supported)`),this.hls.removeLevel(n))}}},fpsController:class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(It.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(It.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(It.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(It.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const r=this.hls.config;if(r.capLevelOnFPSDrop){const e=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=e,e&&"function"==typeof e.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,r){const n=performance.now();if(t){if(this.lastTime){const e=n-this.lastTime,i=r-this.lastDroppedFrames,a=t-this.lastDecodedFrames,s=1e3*i/e,o=this.hls;if(o.trigger(It.FPS_DROP,{currentDropped:i,currentDecoded:a,totalDroppedFrames:r}),s>0&&i>o.config.fpsDroppedMonitoringThreshold*a){let e=o.currentLevel;o.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(-1===o.autoLevelCapping||o.autoLevelCapping>=e)&&(e-=1,o.trigger(It.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:o.currentLevel}),o.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Wi,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null}},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},{cueHandler:ic,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:class extends Qa{constructor(e,t,r){super(e,t,r,"subtitle-stream-controller",Pt),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(It.LEVEL_LOADED,this.onLevelLoaded,this),e.on(It.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(It.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(It.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(It.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(It.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(It.LEVEL_LOADED,this.onLevelLoaded,this),e.off(It.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(It.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(It.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(It.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(It.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=Ga,this.setInterval(500),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:r,success:n}=t;if(this.fragContextChanged(r)||(dr(r)&&(this.fragPrevious=r),this.state=Ga),!n)return;const i=this.tracksBuffered[this.currentTrackId];if(!i)return;let a;const s=r.start;for(let e=0;e<i.length;e++)if(s>=i[e].start&&s<=i[e].end){a=i[e];break}const o=r.start+r.duration;a?a.end=o:(a={start:s,end:o},i.push(a)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:r,endOffset:n}=t;if(0===r&&n!==Number.POSITIVE_INFINITY){const e=n-1;if(e<=0)return;t.endOffsetSubtitles=Math.max(0,e),this.tracksBuffered.forEach(t=>{for(let r=0;r<t.length;)if(t[r].end<=e)t.shift();else{if(!(t[r].start<e))break;t[r].start=e,r++}}),this.fragmentTracker.removeFragmentsInRange(r,e,Pt)}}onError(e,t){const r=t.frag;(null==r?void 0:r.type)===Pt&&(t.details===At.FRAG_GAP&&this.fragmentTracker.fragBuffered(r,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Za&&(this.state=Ga))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){this.levels&&Po(this.levels,t)?this.levels=t.map(e=>new yn(e)):(this.tracksBuffered=[],this.levels=t.map(e=>{const t=new yn(e);return this.tracksBuffered[t.id]=[],t}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Pt),this.fragPrevious=null,this.mediaBuffer=null)}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,null==(r=this.levels)||!r.length||-1===this.currentTrackId)return void this.clearInterval();const n=this.levels[this.currentTrackId];null!=n&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==Za&&this.setInterval(500)}onSubtitleTrackLoaded(e,t){var r;const{currentTrackId:n,levels:i}=this,{details:a,id:s}=t;if(!i)return void this.warn(`Subtitle tracks were reset while loading level ${s}`);const o=i[s];if(s>=i.length||!o)return;this.log(`Subtitle track ${s} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let l=0;if(a.live||null!=(r=o.details)&&r.live){if(a.deltaUpdateFailed)return;const e=this.mainDetails;if(!e)return void(this.startFragRequested=!1);const t=e.fragments[0];var u;if(o.details)l=this.alignPlaylists(a,o.details,null==(u=this.levelLastLoaded)?void 0:u.details),0===l&&t&&(l=t.start,Aa(a,l));else a.hasProgramDateTime&&e.hasProgramDateTime?(xa(a,e),l=a.fragmentStart):t&&(l=t.start,Aa(a,l));e&&!this.startFragRequested&&this.setStartPosition(e,l)}if(o.details=a,this.levelLastLoaded=o,s===n&&(this.hls.trigger(It.SUBTITLE_TRACK_UPDATED,{details:a,id:s,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===Ga)){Nn(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}_handleFragmentLoadComplete(e){const{frag:t,payload:r}=e,n=t.decryptdata,i=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&null!=n&&n.key&&n.iv&&ki(n.method)){const e=performance.now();this.decrypter.decrypt(new Uint8Array(r),n.key.buffer,n.iv.buffer,xi(n.method)).catch(e=>{throw i.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.FRAG_DECRYPT_ERROR,fatal:!1,error:e,reason:e.message,frag:t}),e}).then(r=>{const n=performance.now();i.trigger(It.FRAG_DECRYPTED,{frag:t,payload:r,stats:{tstart:e,tdecrypt:n}})}).catch(e=>{this.warn(`${e.name}: ${e.message}`),this.state=Ga})}}doTick(){if(this.media){if(this.state===Ga){const{currentTrackId:e,levels:t}=this,r=null==t?void 0:t[e];if(!r||!t.length||!r.details)return;if(this.waitForLive(r))return;const{config:n}=this,i=this.getLoadPosition(),a=Ti.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],i,n.maxBufferHole),{end:s,len:o}=a,l=r.details;if(o>this.hls.maxBufferLength+l.levelTargetDuration)return;const u=l.fragments,c=u.length,d=l.edge;let f=null;const h=this.fragPrevious;if(s<d){const e=n.maxFragLookUpTolerance,t=s>d-e?0:e;f=Nn(h,u,Math.max(u[0].start,s),t),!f&&h&&h.start<u[0].start&&(f=u[0])}else f=u[c-1];if(f=this.filterReplacedPrimary(f,r.details),!f)return;const g=u[f.sn-l.startSN-1];if(g&&g.cc===f.cc&&this.fragmentTracker.getState(g)===Qn&&(f=g),this.fragmentTracker.getState(f)===Qn){const e=this.mapToInitFragWhenRequired(f);e&&this.loadFragment(e,r,s)}}}else this.state=Ga}loadFragment(e,t,r){dr(e)?super.loadFragment(e,t,r):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new lu(this.tracksBuffered[this.currentTrackId]||[])}},subtitleTrackController:class extends No{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const t=ql(this.media.textTracks);for(let r=0;r<t.length;r++)if("hidden"===t[r].mode)e=t[r];else if("showing"===t[r].mode){e=t[r];break}const r=this.findTrackForTextTrack(e);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.MANIFEST_PARSED,this.onManifestParsed,this),e.on(It.LEVEL_LOADING,this.onLevelLoading,this),e.on(It.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(It.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(It.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.MANIFEST_PARSED,this.onManifestParsed,this),e.off(It.LEVEL_LOADING,this.onLevelLoading,this),e.off(It.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(It.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(It.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const r=this.media;if(!r)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||r.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;ql(r.textTracks).forEach(e=>{Vl(e)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:r,groupId:n,details:i}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==n)return void this.warn(`Subtitle track with id:${r} and group:${n} not found in active group ${null==a?void 0:a.groupId}`);const s=a.details;a.details=t.details,this.log(`Subtitle track ${r} "${a.name}" lang:${a.lang} group:${n} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,s)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.subtitleGroups||null,n=this.groupIds;let i=this.currentTrack;if(!r||(null==n?void 0:n.length)!==(null==r?void 0:r.length)||null!=r&&r.some(e=>-1===(null==n?void 0:n.indexOf(e)))){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!r||-1!==r.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.subtitlePreference;if(!i&&t){this.selectDefaultTrack=!1;const r=In(t,e);if(r>-1)i=e[r];else{const e=In(t,this.tracks);i=this.tracks[e]}}let n=this.findTrackId(i);-1===n&&i&&(n=this.findTrackId(null));const a={subtitleTracks:e};this.log(`Updating subtitle tracks, ${e.length} track(s) found in "${null==r?void 0:r.join(",")}" group-id`),this.hls.trigger(It.SUBTITLE_TRACKS_UPDATED,a),-1!==n&&-1===this.trackId&&this.setSubtitleTrack(n)}}findTrackId(e){const t=this.tracksInGroup,r=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const i=t[n];if((!r||i.default)&&(r||e)&&(!e||Rn(i,e)))return n}if(e){for(let r=0;r<t.length;r++){const n=t[r];if(Oo(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const n=t[r];if(Oo(e.attrs,n.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){if(Mo(t[r],e))return r}}return-1}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Lt||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(-1===e.id)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const r=this.currentTrack;if(r&&Rn(e,r))return r;const n=In(e,this.tracksInGroup);if(n>-1){const e=this.tracksInGroup[n];return this.setSubtitleTrack(n),e}if(r)return null;{const r=In(e,t);if(r>-1)return t[r]}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,n=e.groupId,i=this.getUrlWithDirectives(e.url,t),a=e.details,s=null==a?void 0:a.age;this.log(`Loading subtitle ${r} "${e.name}" lang:${e.lang} group:${n}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${s&&a.live?" age "+s.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(It.SUBTITLE_TRACK_LOADING,{url:i,id:r,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=ql(e.textTracks),r=this.currentTrack;let n;if(r&&(n=t.filter(e=>Mo(r,e))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(e=>{"disabled"!==e.mode&&e!==n&&(e.mode="disabled")}),n){const e=this.subtitleDisplay?"showing":"hidden";n.mode!==e&&(n.mode=e)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media)return void(this.queuedDefaultTrack=e);if(e<-1||e>=t.length||!Tt(e))return void this.warn(`Invalid subtitle track id: ${e}`);this.selectDefaultTrack=!1;const r=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n)return void this.hls.trigger(It.SUBTITLE_TRACK_SWITCH,{id:e});const i=!!n.details&&!n.details.live;if(e===this.trackId&&n===r&&i)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:a,groupId:s="",name:o,type:l,url:u}=n;this.hls.trigger(It.SUBTITLE_TRACK_SWITCH,{id:a,groupId:s,name:o,type:l,url:u});const c=this.switchParams(n.url,null==r?void 0:r.details,n.details);this.loadPlaylist(c)}},timelineController:class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(It.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(It.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(It.FRAG_LOADING,this.onFragLoading,this),e.on(It.FRAG_LOADED,this.onFragLoaded,this),e.on(It.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(It.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(It.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(It.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(It.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(It.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(It.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(It.FRAG_LOADING,this.onFragLoading,this),e.off(It.FRAG_LOADED,this.onFragLoaded,this),e.off(It.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(It.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(It.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(It.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(It.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Ju(this,"textTrack1"),t=new Ju(this,"textTrack2"),r=new Ju(this,"textTrack3"),n=new Ju(this,"textTrack4");this.cea608Parser1=new Iu(1,e,t),this.cea608Parser2=new Iu(3,r,n)}addCues(e,t,r,n,i){let a=!1;for(let e=i.length;e--;){const n=i[e],s=rc(n[0],n[1],t,r);if(s>=0&&(n[0]=Math.min(n[0],t),n[1]=Math.max(n[1],r),a=!0,s/(r-t)>.5))return}if(a||i.push([t,r]),this.config.renderTextTracksNatively){const i=this.captionsTracks[e];this.Cues.newCue(i,t,r,n)}else{const i=this.Cues.newCue(null,t,r,n);this.hls.trigger(It.CUES_PARSED,{type:"captions",cues:i,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:n,timescale:i,trackId:a}){const{unparsedVttFrags:s}=this;r===Ct&&(this.initPTS[t.cc]={baseTime:n,timescale:i,trackId:a}),s.length&&(this.unparsedVttFrags=[],s.forEach(e=>{this.initPTS[e.frag.cc]?this.onFragLoaded(It.FRAG_LOADED,e):this.hls.trigger(It.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:r}=this;if(r)for(let n=0;n<r.textTracks.length;n++){const i=r.textTracks[n];if(tc(i,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return i}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:r,media:n}=this,{label:i,languageCode:a}=t[e],s=this.getExistingTrack(i,a);if(s)r[e]=s,Vl(r[e]),Hl(r[e],n);else{const t=this.createTextTrack("captions",i,a);t&&(t[e]=!0,r[e]=t)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const r={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(It.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,r){const n=this.media;if(n)return n.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const r=!!t.transferMedia;if(this.media=null,r)return;const{captionsTracks:n}=this;Object.keys(n).forEach(e=>{Vl(n[e]),delete n[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let e=0;e<t.length;e++)Vl(t[e])}onSubtitleTracksUpdated(e,t){const r=t.subtitleTracks||[],n=r.some(e=>e.textCodec===Hu);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(Po(this.tracks,r))return void(this.tracks=r);if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){const e=this.media,t=e?ql(e.textTracks):null;if(this.tracks.forEach((e,r)=>{let n;if(t){let r=null;for(let n=0;n<t.length;n++)if(t[n]&&tc(t[n],e)){r=t[n],t[n]=null;break}r&&(n=r)}if(n)Vl(n);else{const t=ec(e);n=this.createTextTrack(t,e.name,e.lang),n&&(n.mode="disabled")}n&&this.textTracks.push(n)}),null!=t&&t.length){const e=t.filter(e=>null!==e).map(e=>e.label);e.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${e.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const e=this.tracks.map(e=>({label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}));this.hls.trigger(It.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:e})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(e=>{const t=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(!t)return;const r=`textTrack${t[1]}`,n=this.captionsProperties[r];n&&(n.label=e.name,e.lang&&(n.languageCode=e.lang),n.media=e)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return null==t?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===Ct){var r,n;const{cea608Parser1:e,cea608Parser2:i,lastSn:a}=this,{cc:s,sn:o}=t.frag,l=null!=(r=null==(n=t.part)?void 0:n.index)?r:-1;e&&i&&(o!==a+1||o===a&&l!==this.lastPartIndex+1||s!==this.lastCc)&&(e.reset(),i.reset()),this.lastCc=s,this.lastSn=o,this.lastPartIndex=l}}onFragLoaded(e,t){const{frag:r,payload:n}=t;if(r.type===Pt)if(n.byteLength){const e=r.decryptdata,i="stats"in t;if(null==e||!e.encrypted||i){const e=this.tracks[r.level],i=this.vttCCs;i[r.cc]||(i[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),e&&e.textCodec===Hu?this._parseIMSC1(r,n):this._parseVTTs(t)}}else this.hls.trigger(It.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const r=this.hls;qu(t,this.initPTS[e.cc],t=>{this._appendCues(t,e.level),r.trigger(It.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},t=>{r.logger.log(`Failed to parse IMSC1: ${t}`),r.trigger(It.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:t})})}_parseVTTs(e){var t;const{frag:r,payload:n}=e,{initPTS:i,unparsedVttFrags:a}=this,s=i.length-1;if(!i[r.cc]&&-1===s)return void a.push(e);const o=this.hls;Gu(null!=(t=r.initSegment)&&t.data?Or(r.initSegment.data,new Uint8Array(n)).buffer:n,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,e=>{this._appendCues(e,r.level),o.trigger(It.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},t=>{const i="Missing initPTS for VTT MPEGTS"===t.message;i?a.push(e):this._fallbackToIMSC1(r,n),o.logger.log(`Failed to parse VTT cue: ${t}`),i&&s>r.cc||o.trigger(It.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:t})})}_fallbackToIMSC1(e,t){const r=this.tracks[e.level];r.textCodec||qu(t,this.initPTS[e.cc],()=>{r.textCodec=Hu,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){const r=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||"disabled"===r.mode)return;e.forEach(e=>$l(r,e))}else{const n=this.tracks[t];if(!n)return;const i=n.default?"default":"subtitles"+t;r.trigger(It.CUES_PARSED,{type:"subtitles",cues:e,track:i})}}onFragDecrypted(e,t){const{frag:r}=t;r.type===Pt&&this.onFragLoaded(It.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:r,samples:n}=t;if(r.type!==Ct||"NONE"!==this.closedCaptionsForLevel(r))for(let e=0;e<n.length;e++){const t=n[e].bytes;if(t){this.cea608Parser1||this.initCea608Parsers();const r=this.extractCea608Data(t);this.cea608Parser1.addData(n[e].pts,r[0]),this.cea608Parser2.addData(n[e].pts,r[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:n,type:i}){const{media:a}=this;if(a&&!(a.currentTime<r)){if(!i||"video"===i){const{captionsTracks:e}=this;Object.keys(e).forEach(n=>Kl(e[n],t,r))}if(this.config.renderTextTracksNatively&&0===t&&void 0!==n){const{textTracks:e}=this;Object.keys(e).forEach(r=>Kl(e[r],t,n))}}}extractCea608Data(e){const t=[[],[]],r=31&e[0];let n=2;for(let i=0;i<r;i++){const r=e[n++],i=127&e[n++],a=127&e[n++];if(0===i&&0===a)continue;if(!!(4&r)){const e=3&r;0!==e&&1!==e||(t[e].push(i),t[e].push(a))}}return t}},audioStreamController:class extends Qa{constructor(e,t,r){super(e,t,r,"audio-stream-controller",Nt),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(It.LEVEL_LOADED,this.onLevelLoaded,this),e.on(It.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(It.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(It.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(It.BUFFER_RESET,this.onBufferReset,this),e.on(It.BUFFER_CREATED,this.onBufferCreated,this),e.on(It.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(It.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(It.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(It.FRAG_LOADING,this.onFragLoading,this),e.on(It.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(It.LEVEL_LOADED,this.onLevelLoaded,this),e.off(It.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(It.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(It.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(It.BUFFER_RESET,this.onBufferReset,this),e.off(It.BUFFER_CREATED,this.onBufferCreated,this),e.off(It.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(It.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(It.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(It.FRAG_LOADING,this.onFragLoading,this),e.off(It.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:r,initPTS:n,timescale:i,trackId:a}){if(r===Ct){const e=t.cc,r=this.fragCurrent;if(this.initPTS[e]={baseTime:n,timescale:i,trackId:a},this.log(`InitPTS for cc: ${e} found from main: ${n/i} (${n}/${i}) trackId: ${a}`),this.mainAnchor=t,this.state===Wa){const r=this.waitingData;(!r&&!this.loadingParts||r&&r.frag.cc!==e)&&this.syncWithAnchor(t,null==r?void 0:r.frag)}else!this.hls.hasEnoughToStart&&r&&r.cc!==e?(r.abortRequests(),this.syncWithAnchor(t,r)):this.state===Ga&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var r;const n=(null==(r=this.mainFragLoading)?void 0:r.frag)||null;if(t&&(null==n?void 0:n.cc)===t.cc)return;const i=(n||e).cc,a=Mn(this.getLevelDetails(),i,this.getLoadPosition());a&&(this.log(`Syncing with main frag at ${a.start} cc ${a.cc}`),this.startFragRequested=!1,this.nextLoadPosition=a.start,this.resetLoadingState(),this.state===Ga&&this.doTickIdle())}startLoad(e,t){if(!this.levels)return this.startPosition=e,void(this.state=Za);const r=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),r>0&&-1===e?(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r,this.state=Ga):this.state=Ka,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case Ga:this.doTickIdle();break;case Ka:{const{levels:e,trackId:t}=this,r=null==e?void 0:e[t],n=null==r?void 0:r.details;if(n&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(n))break;this.state=Wa}break}case Va:this.checkRetryDate();break;case Wa:{const e=this.waitingData;if(e){const{frag:t,part:r,cache:n,complete:i}=e,a=this.mainAnchor;if(void 0!==this.initPTS[t.cc]){this.waitingData=null,this.state=$a;const e={frag:t,part:r,payload:n.flush().buffer,networkDetails:null};this._handleFragmentLoadProgress(e),i&&super._handleFragmentLoadComplete(e)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=Ga}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;null!=e&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:r,media:n,trackId:i}=this,a=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||null==r||!r[i])return;const s=r[i],o=s.details;if(!o||this.waitForLive(s)||this.waitForCdnTuneIn(o))return this.state=Ka,void(this.startFragRequested=!1);const l=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&l&&(this.bufferFlushed=!1,this.afterBufferFlushed(l,or,Nt));const u=this.getFwdBufferInfo(l,Nt);if(null===u)return;if(!this.switchingTrack&&this._streamEnded(u,o))return t.trigger(It.BUFFER_EOS,{type:"audio"}),void(this.state=ja);const c=u.len,d=t.maxBufferLength,f=o.fragments,h=f[0].start,g=this.getLoadPosition(),p=this.flushing?g:u.end;if(this.switchingTrack&&n){const e=g;o.PTSKnown&&e<h&&(u.end>h||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=h+.05)}if(c>=d&&!this.switchingTrack&&p<f[f.length-1].start)return;let m=this.getNextFragment(p,o);if(m&&this.isLoopLoading(m,p)&&(m=this.getNextFragmentLoopLoading(m,o,u,Ct,d)),!m)return void(this.bufferFlushed=!0);let v=(null==(e=this.mainFragLoading)?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&v&&dr(m)&&!m.endList&&(!o.live||!this.loadingParts&&p<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(v)===ti&&(this.mainFragLoading=v=null),v&&dr(v))){if(m.start>v.end){const e=this.fragmentTracker.getFragAtPos(p,Ct);e&&e.end>v.end&&(v=e,this.mainFragLoading={frag:e,targetBufferTime:null})}if(m.start>v.end)return}this.loadFragment(m,s,p)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(e=>new yn(e))}onAudioTrackSwitching(e,t){const r=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),r?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==Za&&(this.setInterval(100),this.state=Ga,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const r=this.cachedTrackLoadedData;r&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(It.AUDIO_TRACK_LOADED,r))}onAudioTrackLoaded(e,t){var r;const{levels:n}=this,{details:i,id:a,groupId:s,track:o}=t;if(!n)return void this.warn(`Audio tracks reset while loading track ${a} "${o.name}" of "${s}"`);const l=this.mainDetails;if(!l||i.endCC>l.endCC||l.expired)return this.cachedTrackLoadedData=t,void(this.state!==Za&&(this.state=Ka));this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${o.name}" of "${s}" loaded [${i.startSN},${i.endSN}]${i.lastPartSn?`[part-${i.lastPartSn}-${i.lastPartIndex}]`:""},duration:${i.totalduration}`);const u=n[a];let c=0;if(i.live||null!=(r=u.details)&&r.live){if(this.checkLiveUpdate(i),i.deltaUpdateFailed)return;var d;if(u.details)c=this.alignPlaylists(i,u.details,null==(d=this.levelLastLoaded)?void 0:d.details);i.alignedSliding||(ka(i,l),i.alignedSliding||xa(i,l),c=i.fragmentStart)}u.details=i,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(l,c),this.hls.trigger(It.AUDIO_TRACK_UPDATED,{details:i,id:a,groupId:t.groupId}),this.state!==Ka||this.waitForCdnTuneIn(i)||(this.state=Ga),this.tick()}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:n,payload:i}=e,{config:a,trackId:s,levels:o}=this;if(!o)return void this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const l=o[s];if(!l)return void this.warn("Audio track is undefined on fragment load progress");const u=l.details;if(!u)return this.warn("Audio track details undefined on fragment load progress"),void this.removeUnbufferedFrags(r.start);const c=a.defaultAudioCodec||l.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new Co(this.hls,Nt,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const f=this.initPTS[r.cc],h=null==(t=r.initSegment)?void 0:t.data;if(void 0!==f){const e=!1,t=n?n.index:-1,a=-1!==t,s=new yi(r.level,r.sn,r.stats.chunkCount,i.byteLength,t,a);d.push(i,h,c,"",r,n,u.totalduration,e,s,f)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${u.startSN} ,${u.endSN}],track ${s}`);const{cache:e}=this.waitingData=this.waitingData||{frag:r,part:n,cache:new es,complete:!1};e.push(new Uint8Array(i)),this.state!==Za&&(this.state=Wa)}}_handleFragmentLoadComplete(e){this.waitingData?this.waitingData.complete=!0:super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===Ct&&dr(t.frag)&&(this.mainFragLoading=t,this.state===Ga&&this.tick())}onFragBuffered(e,t){const{frag:r,part:n}=t;if(r.type===Nt)if(this.fragContextChanged(r))this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);else{if(dr(r)){this.fragPrevious=r;const e=this.switchingTrack;e&&(this.bufferedTrack=e,this.switchingTrack=null,this.hls.trigger(It.AUDIO_TRACK_SWITCHED,Bt({},e)))}this.fragBufferedComplete(r,n),this.media&&this.tick()}else this.audioOnly||r.type!==Ct||r.elementaryStreams.video||r.elementaryStreams.audiovideo||(this.audioOnly=!0,this.mainFragLoading=null)}onError(e,t){var r;if(t.fatal)this.state=za;else switch(t.details){case At.FRAG_GAP:case At.FRAG_PARSING_ERROR:case At.FRAG_DECRYPT_ERROR:case At.FRAG_LOAD_ERROR:case At.FRAG_LOAD_TIMEOUT:case At.KEY_LOAD_ERROR:case At.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Nt,t);break;case At.AUDIO_TRACK_LOAD_ERROR:case At.AUDIO_TRACK_LOAD_TIMEOUT:case At.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Ka||(null==(r=t.context)?void 0:r.type)!==Dt||(this.state=Ga);break;case At.BUFFER_ADD_CODEC_ERROR:case At.BUFFER_APPEND_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case At.BUFFER_FULL_ERROR:if("audio"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case At.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onBufferFlushing(e,{type:t}){t!==lr&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==lr){this.flushing=!1,this.bufferFlushed=!0,this.state===ja&&(this.state=Ga);const e=this.mediaBuffer||this.media;e&&(this.afterBufferFlushed(e,t,Nt),this.tick())}}_handleTransmuxComplete(e){var t;const r="audio",{hls:n}=this,{remuxResult:i,chunkMeta:a}=e,s=this.getCurrentContext(a);if(!s)return void this.resetWhenMissingContext(a);const{frag:o,part:l,level:u}=s,{details:c}=u,{audio:d,text:f,id3:h,initSegment:g}=i;if(!this.fragContextChanged(o)&&c){if(this.state=qa,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),null!=g&&g.tracks){const e=o.initSegment||o;if(this.unhandledEncryptionError(g,o))return;this._bufferInitSegment(u,g.tracks,e,a),n.trigger(It.FRAG_PARSING_INIT_SEGMENT,{frag:e,id:r,tracks:g.tracks})}if(d){const{startPTS:e,endPTS:t,startDTS:r,endDTS:n}=d;l&&(l.elementaryStreams[or]={startPTS:e,endPTS:t,startDTS:r,endDTS:n}),o.setElementaryStreamInfo(or,e,t,r,n),this.bufferFragmentData(d,o,l,a)}if(null!=h&&null!=(t=h.samples)&&t.length){const e=xt({id:r,frag:o,details:c},h);n.trigger(It.FRAG_PARSING_METADATA,e)}if(f){const e=xt({id:r,frag:o,details:c},f);n.trigger(It.FRAG_PARSING_USERDATA,e)}}else this.fragmentTracker.removeFragment(o)}_bufferInitSegment(e,t,r,n){if(this.state!==qa)return;if(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio)return;const i=t.audio;i.id=Nt;const a=e.audioCodec;this.log(`Init audio buffer, container:${i.container}, codecs[level/parsed]=[${a}/${i.codec}]`),a&&1===a.split(",").length&&(i.levelCodec=a),this.hls.trigger(It.BUFFER_CODECS,t);const s=i.initSegment;if(null!=s&&s.byteLength){const e={type:"audio",frag:r,part:null,chunkMeta:n,parent:r.type,data:s};this.hls.trigger(It.BUFFER_APPENDING,e)}this.tickImmediate()}loadFragment(e,t,r){const n=this.fragmentTracker.getState(e);var i;if(this.switchingTrack||n===Qn||n===ei)if(dr(e))if(null!=(i=t.details)&&i.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Wa;const r=this.mainDetails;r&&r.fragmentStart!==t.details.fragmentStart&&xa(t.details,r)}else super.loadFragment(e,t,r);else this._loadInitSegment(e,t);else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:r,assocLang:n,characteristics:i,audioCodec:a,channels:s}=this.bufferedTrack;Rn({name:t,lang:r,assocLang:n,characteristics:i,audioCodec:a,channels:s},e,wn)||(Ln(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(It.AUDIO_TRACK_SWITCHED,Bt({},e))}},audioTrackController:class extends No{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.MANIFEST_PARSED,this.onManifestParsed,this),e.on(It.LEVEL_LOADING,this.onLevelLoading,this),e.on(It.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(It.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(It.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.MANIFEST_PARSED,this.onManifestParsed,this),e.off(It.LEVEL_LOADING,this.onLevelLoading,this),e.off(It.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(It.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(It.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:r,groupId:n,details:i}=t,a=this.tracksInGroup[r];if(!a||a.groupId!==n)return void this.warn(`Audio track with id:${r} and group:${n} not found in active group ${null==a?void 0:a.groupId}`);const s=a.details;a.details=t.details,this.log(`Audio track ${r} "${a.name}" lang:${a.lang} group:${n} loaded [${i.startSN}-${i.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,s)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const r=t.audioGroups||null,n=this.groupIds;let i=this.currentTrack;if(!r||(null==n?void 0:n.length)!==(null==r?void 0:r.length)||null!=r&&r.some(e=>-1===(null==n?void 0:n.indexOf(e)))){this.groupIds=r,this.trackId=-1,this.currentTrack=null;const e=this.tracks.filter(e=>!r||-1!==r.indexOf(e.groupId));if(e.length)this.selectDefaultTrack&&!e.some(e=>e.default)&&(this.selectDefaultTrack=!1),e.forEach((e,t)=>{e.id=t});else if(!i&&!this.tracksInGroup.length)return;this.tracksInGroup=e;const t=this.hls.config.audioPreference;if(!i&&t){const r=In(t,e,wn);if(r>-1)i=e[r];else{const e=In(t,this.tracks);i=this.tracks[e]}}let n=this.findTrackId(i);-1===n&&i&&(n=this.findTrackId(null));const s={audioTracks:e};this.log(`Updating audio tracks, ${e.length} track(s) found in group(s): ${null==r?void 0:r.join(",")}`),this.hls.trigger(It.AUDIO_TRACKS_UPDATED,s);const o=this.trackId;if(-1!==n&&-1===o)this.setAudioTrack(n);else if(e.length&&-1===o){var a;const t=new Error(`No audio track selected for current audio group-ID(s): ${null==(a=this.groupIds)?void 0:a.join(",")} track count: ${e.length}`);this.warn(t.message),this.hls.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:t})}}}onError(e,t){!t.fatal&&t.context&&(t.context.type!==Dt||t.context.id!==this.trackId||this.groupIds&&-1===this.groupIds.indexOf(t.context.groupId)||this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){const n=this.currentTrack;if(n&&Rn(e,n,wn))return n;const i=In(e,this.tracksInGroup,wn);if(i>-1){const e=this.tracksInGroup[i];return this.setAudioTrack(i),e}if(n){let n=t.loadLevel;-1===n&&(n=t.firstAutoLevel);const i=function(e,t,r,n,i){const a=t[n],s=t.reduce((e,t,r)=>{const n=t.uri;return(e[n]||(e[n]=[])).push(r),e},{}),o=s[a.uri];o.length>1&&(n=Math.max.apply(Math,o));const l=a.videoRange,u=a.frameRate,c=a.codecSet.substring(0,4),d=Dn(t,n,t=>{if(t.videoRange!==l||t.frameRate!==u||t.codecSet.substring(0,4)!==c)return!1;const n=t.audioGroups,a=r.filter(e=>!n||-1!==n.indexOf(e.groupId));return In(e,a,i)>-1});return d>-1?d:Dn(t,n,t=>{const n=t.audioGroups,a=r.filter(e=>!n||-1!==n.indexOf(e.groupId));return In(e,a,i)>-1})}(e,t.levels,r,n,wn);if(-1===i)return null;t.nextLoadLevel=i}if(e.channels||e.audioCodec){const t=In(e,r);if(t>-1)return r[t]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length)return void this.warn(`Invalid audio track id: ${e}`);this.selectDefaultTrack=!1;const r=this.currentTrack,n=t[e],i=n.details&&!n.details.live;if(e===this.trackId&&n===r&&i)return;if(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(It.AUDIO_TRACK_SWITCHING,Bt({},n)),i)return;const a=this.switchParams(n.url,null==r?void 0:r.details,n.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let r=0;r<t.length;r++){const n=t[r];if((!this.selectDefaultTrack||n.default)&&(!e||Rn(e,n,wn)))return r}if(e){const{name:r,lang:n,assocLang:i,characteristics:a,audioCodec:s,channels:o}=e;for(let e=0;e<t.length;e++){if(Rn({name:r,lang:n,assocLang:i,characteristics:a,audioCodec:s,channels:o},t[e],wn))return e}for(let r=0;r<t.length;r++){const n=t[r];if(Oo(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const n=t[r];if(Oo(e.attrs,n.attrs,["LANGUAGE"]))return r}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Ln(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=e.id,n=e.groupId,i=this.getUrlWithDirectives(e.url,t),a=e.details,s=null==a?void 0:a.age;this.log(`Loading audio-track ${r} "${e.name}" lang:${e.lang} group:${n}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${s&&a.live?" age "+s.toFixed(1)+(a.type&&" "+a.type||""):""} ${i}`),this.hls.trigger(It.AUDIO_TRACK_LOADING,{url:i,id:r,groupId:n,deliveryDirectives:t||null,track:e})}},emeController:Fl,cmcdController:class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=e=>{try{this.apply(e,{ot:Ho.MANIFEST,su:!this.initialized})}catch(e){this.hls.logger.warn("Could not generate manifest CMCD data.",e)}},this.applyFragmentData=e=>{try{const{frag:t,part:r}=e,n=this.hls.levels[t.level],i=this.getObjectType(t),a={d:1e3*(r||t).duration,ot:i};i!==Ho.VIDEO&&i!==Ho.AUDIO&&i!=Ho.MUXED||(a.br=n.bitrate/1e3,a.tb=this.getTopBandwidth(i)/1e3,a.bl=this.getBufferLength(i));const s=r?this.getNextPart(r):this.getNextFrag(t);null!=s&&s.url&&s.url!==t.url&&(a.nor=s.url),this.apply(e,a)}catch(e){this.hls.logger.warn("Could not generate segment CMCD data.",e)}},this.hls=e;const t=this.config=e.config,{cmcd:r}=t;null!=r&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||e.sessionId,this.cid=r.contentId,this.useHeaders=!0===r.useHeaders,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(It.MEDIA_DETACHED,this.onMediaDetached,this),e.on(It.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(It.MEDIA_DETACHED,this.onMediaDetached,this),e.off(It.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,n;this.audioBuffer=null==(r=t.tracks.audio)?void 0:r.buffer,this.videoBuffer=null==(n=t.tracks.video)?void 0:n.buffer}createData(){var e;return{v:1,sf:$o.HLS,sid:this.sid,cid:this.cid,pr:null==(e=this.media)?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){xt(t,this.createData());const r=t.ot===Ho.INIT||t.ot===Ho.VIDEO||t.ot===Ho.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),null==t.su&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((e,r)=>(n.includes(r)&&(e[r]=t[r]),e),{}));const i={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Nl(e.headers,t,i)):e.url=Ml(e.url,t,i)}getNextFrag(e){var t;const r=null==(t=this.hls.levels[e.level])?void 0:t.details;if(r){const t=e.sn-r.startSN;return r.fragments[t+1]}}getNextPart(e){var t;const{index:r,fragment:n}=e,i=null==(t=this.hls.levels[n.level])||null==(t=t.details)?void 0:t.partList;if(i){const{sn:e}=n;for(let t=i.length-1;t>=0;t--){const n=i[t];if(n.index===r&&n.fragment.sn===e)return i[t+1]}}}getObjectType(e){const{type:t}=e;return"subtitle"===t?Ho.TIMED_TEXT:"initSegment"===e.sn?Ho.INIT:"audio"===t?Ho.AUDIO:"main"===t?this.hls.audioTracks.length?Ho.VIDEO:Ho.MUXED:void 0}getTopBandwidth(e){let t,r=0;const n=this.hls;if(e===Ho.AUDIO)t=n.audioTracks;else{const e=n.maxAutoLevel,r=e>-1?e+1:n.levels.length;t=n.levels.slice(0,r)}return t.forEach(e=>{e.bitrate>r&&(r=e.bitrate)}),r>0?r:NaN}getBufferLength(e){const t=this.media,r=e===Ho.AUDIO?this.audioBuffer:this.videoBuffer;if(!r||!t)return NaN;return 1e3*Ti.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new r(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,r,n){t(e),this.loader.load(e,r,n)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(e){this.loader=void 0,this.loader=new r(e)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(e,r,n){t(e),this.loader.load(e,r,n)}}}},contentSteeringController:class extends Ut{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(It.MANIFEST_PARSED,this.onManifestParsed,this),e.on(It.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(It.MANIFEST_PARSED,this.onManifestParsed,this),e.off(It.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(-1===e.indexOf(t.pathwayId)&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=1e3*this.timeToLoad-(performance.now()-this.updated);if(e>0)return void this.scheduleRefresh(this.uri,e)}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){-1!==this.reloadTimer&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(t=>t!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:r}=t;null!==r&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:r}=t;if((null==r?void 0:r.action)===Vn&&r.flags===jn){const e=this.levels;let n=this._pathwayPriority,i=this.pathwayId;if(t.context){const{groupId:r,pathwayId:n,type:a}=t.context;r&&e?i=this.getPathwayForGroupId(r,a,i):n&&(i=n)}i in this.penalizedPathways||(this.penalizedPathways[i]=performance.now()),!n&&e&&(n=this.pathways()),n&&n.length>1&&(this.updatePathwayPriority(n),r.resolved=this.pathwayId!==i),t.details!==At.BUFFER_APPEND_ERROR||t.fatal?r.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${i} levels: ${e?e.length:e} priorities: ${_n(n)} penalized: ${_n(this.penalizedPathways)}`):r.resolved=!0}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(0===t.length){const r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return null===this.levels?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){let t;this._pathwayPriority=e;const r=this.penalizedPathways,n=performance.now();Object.keys(r).forEach(e=>{n-r[e]>3e5&&delete r[e]});for(let n=0;n<e.length;n++){const i=e[n];if(i in r)continue;if(i===this.pathwayId)return;const a=this.hls.nextLoadLevel,s=this.hls.levels[a];if(t=this.getLevelsForPathway(i),t.length>0){this.log(`Setting Pathway to "${i}"`),this.pathwayId=i,La(t),this.hls.trigger(It.LEVELS_UPDATED,{levels:t});const e=this.hls.levels[a];s&&e&&this.levels&&(e.attrs["STABLE-VARIANT-ID"]!==s.attrs["STABLE-VARIANT-ID"]&&e.bitrate!==s.bitrate&&this.log(`Unstable Pathways change from bitrate ${s.bitrate} to ${e.bitrate}`),this.hls.nextLoadLevel=a);break}}}getPathwayForGroupId(e,t,r){const n=this.getLevelsForPathway(r).concat(this.levels||[]);for(let r=0;r<n.length;r++)if(t===Dt&&n[r].hasAudioGroup(e)||t===Lt&&n[r].hasSubtitleGroup(e))return n[r].pathwayId;return r}clonePathways(e){const t=this.levels;if(!t)return;const r={},n={};e.forEach(e=>{const{ID:i,"BASE-ID":a,"URI-REPLACEMENT":s}=e;if(t.some(e=>e.pathwayId===i))return;const o=this.getLevelsForPathway(a).map(e=>{const t=new Di(e.attrs);t["PATHWAY-ID"]=i;const a=t.AUDIO&&`${t.AUDIO}_clone_${i}`,o=t.SUBTITLES&&`${t.SUBTITLES}_clone_${i}`;a&&(r[t.AUDIO]=a,t.AUDIO=a),o&&(n[t.SUBTITLES]=o,t.SUBTITLES=o);const l=xl(e.uri,t["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",s),u=new yn({attrs:t,audioCodec:e.audioCodec,bitrate:e.bitrate,height:e.height,name:e.name,url:l,videoCodec:e.videoCodec,width:e.width});if(e.audioGroups)for(let t=1;t<e.audioGroups.length;t++)u.addGroupId("audio",`${e.audioGroups[t]}_clone_${i}`);if(e.subtitleGroups)for(let t=1;t<e.subtitleGroups.length;t++)u.addGroupId("text",`${e.subtitleGroups[t]}_clone_${i}`);return u});t.push(...o),kl(this.audioTracks,r,s,i),kl(this.subtitleTracks,n,s,i)})}loadSteeringManifest(e){const t=this.hls.config,r=t.loader;let n;this.loader&&this.loader.destroy(),this.loader=new r(t);try{n=new self.URL(e)}catch(t){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest URI: ${e}`)}if("data:"!==n.protocol){const e=0|(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate);n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+e)}const i={responseType:"json",url:n.href},a=t.steeringManifestLoadPolicy.default,s=a.errorRetry||a.timeoutRetry||{},o={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:s.maxNumRetry||0,retryDelay:s.retryDelayMs||0,maxRetryDelay:s.maxRetryDelayMs||0},l={onSuccess:(e,t,r,i)=>{this.log(`Loaded steering manifest: "${n}"`);const a=e.data;if(1!==(null==a?void 0:a.VERSION))return void this.log(`Steering VERSION ${a.VERSION} not supported!`);this.updated=performance.now(),this.timeToLoad=a.TTL;const{"RELOAD-URI":s,"PATHWAY-CLONES":o,"PATHWAY-PRIORITY":l}=a;if(s)try{this.uri=new self.URL(s,n).href}catch(e){return this.enabled=!1,void this.log(`Failed to parse Steering Manifest RELOAD-URI: ${s}`)}this.scheduleRefresh(this.uri||r.url),o&&this.clonePathways(o);const u={steeringManifest:a,url:n.toString()};this.hls.trigger(It.STEERING_MANIFEST_LOADED,u),l&&this.updatePathwayPriority(l)},onError:(e,t,r,n)=>{if(this.log(`Error loading steering manifest: ${e.code} ${e.text} (${t.url})`),this.stopLoad(),410===e.code)return this.enabled=!1,void this.log(`Steering manifest ${t.url} no longer available`);let i=1e3*this.timeToLoad;if(429===e.code){const e=this.loader;if("function"==typeof(null==e?void 0:e.getResponseHeader)){const t=e.getResponseHeader("Retry-After");t&&(i=1e3*parseFloat(t))}return void this.log(`Steering manifest ${t.url} rate limited`)}this.scheduleRefresh(this.uri||t.url,i)},onTimeout:(e,t,r)=>{this.log(`Timeout loading steering manifest (${t.url})`),this.scheduleRefresh(this.uri||t.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(i,o,l)}scheduleRefresh(e,t=1e3*this.timeToLoad){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var t;const r=null==(t=this.hls)?void 0:t.media;!r||r.ended?this.scheduleRefresh(e,1e3*this.timeToLoad):this.loadSteeringManifest(e)},t)}},interstitialsController:class extends Ut{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled||!this.schedule)return;const t=e-this.timelinePos;if(Math.abs(t)<1/7056e5)return;const r=t<=-.01;this.timelinePos=e,this.bufferedPos=e;const n=this.playingItem;if(!n)return void this.checkBuffer();if(r){this.schedule.resetErrorsInRange(e,e-t)&&this.updateSchedule(!0)}if(this.checkBuffer(),r&&e<n.start||e>=n.end){var i;const t=this.findItemIndex(n);let a=this.schedule.findItemIndexAtTime(e);if(-1===a&&(a=t+(r?-1:1),this.log(`seeked ${r?"back ":""}to position not covered by schedule ${e} (resolving from ${t} to ${a})`)),!this.isInterstitial(n)&&null!=(i=this.media)&&i.paused&&(this.shouldPlay=!1),!r&&a>t){const e=this.schedule.findJumpRestrictedIndex(t+1,a);if(e>t)return void this.setSchedulePosition(e)}return void this.setSchedulePosition(a)}const a=this.playingAsset;if(!a){if(this.playingLastItem&&this.isInterstitial(n)){const t=n.event.assetList[0];t&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(e,t))}return}const s=a.timelineStart,o=a.duration||0;var l;(r&&e<s||e>=s+o)&&(null!=(l=n.event)&&l.appendInPlace&&(this.clearInterstitial(n.event,n),this.flushFrontBuffer(e)),this.setScheduleToAssetAtTime(e,a))},this.onTimeupdate=()=>{const e=this.currentTime;if(void 0===e||this.playbackDisabled)return;if(!(e>this.timelinePos))return;this.timelinePos=e,e>this.bufferedPos&&this.checkBuffer();const t=this.playingItem;if(!t||this.playingLastItem)return;if(e>=t.end){this.timelinePos=t.end;const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}const r=this.playingAsset;if(!r)return;e>=r.timelineStart+(r.duration||0)&&this.setScheduleToAssetAtTime(e,r)},this.onScheduleUpdate=(e,t)=>{const r=this.schedule;if(!r)return;const n=this.playingItem,i=r.events||[],a=r.items||[],s=r.durations,o=e.map(e=>e.identifier),l=!(!i.length&&!o.length);(l||t)&&this.log(`INTERSTITIALS_UPDATED (${i.length}): ${i}\nSchedule: ${a.map(e=>iu(e))} pos: ${this.timelinePos}`),o.length&&this.log(`Removed events ${o}`);let u=null,c=null;n&&(u=this.updateItem(n,this.timelinePos),this.itemsMatch(n,u)?this.playingItem=u:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const d=this.bufferingItem;if(d&&(c=this.updateItem(d,this.bufferedPos),this.itemsMatch(d,c)?this.bufferingItem=c:d.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(d.event,null))),e.forEach(e=>{e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,null)})}),this.playerQueue.forEach(e=>{if(e.interstitial.appendInPlace){const t=e.assetItem.timelineStart,r=e.timelineOffset-t;if(r)try{e.timelineOffset=t}catch(n){Math.abs(r)>jl&&this.warn(`${n} ("${e.assetId}" ${e.timelineOffset}->${t})`)}}}),l||t){if(this.hls.trigger(It.INTERSTITIALS_UPDATED,{events:i.slice(0),schedule:a.slice(0),durations:s,removedIds:o}),this.isInterstitial(n)&&o.includes(n.event.identifier))return this.warn(`Interstitial "${n.event.identifier}" removed while playing`),void this.primaryFallback(n.event);n&&this.trimInPlace(u,n),d&&c!==u&&this.trimInPlace(c,d),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new au(e),this.schedule=new nu(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(It.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(It.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(It.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(It.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(It.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(It.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(It.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(It.BUFFER_APPENDED,this.onBufferAppended,this),e.on(It.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(It.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(It.MEDIA_ENDED,this.onMediaEnded,this),e.on(It.ERROR,this.onError,this),e.on(It.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(It.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(It.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(It.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(It.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(It.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(It.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(It.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(It.BUFFER_CODECS,this.onBufferCodecs,this),e.off(It.BUFFER_APPENDED,this.onBufferAppended,this),e.off(It.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(It.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(It.MEDIA_ENDED,this.onMediaEnded,this),e.off(It.ERROR,this.onError,this),e.off(It.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;null==(e=this.getBufferingPlayer())||e.resumeBuffering()}pauseBuffering(){var e;null==(e=this.getBufferingPlayer())||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Ba(e,"play",this.onPlay),Ba(e,"pause",this.onPause),Ba(e,"seeking",this.onSeeking),Ba(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const r=this.media=t.media;Fa(r,"seeking",this.onSeeking),Fa(r,"timeupdate",this.onTimeupdate),Fa(r,"play",this.onPlay),Fa(r,"pause",this.onPause)}onMediaAttached(e,t){const r=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,null===r)this.checkStart();else if(!n){this.clearScheduleState();const e=this.findItemIndex(r);this.setSchedulePosition(e)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const r=!!t.transferMedia,n=this.media;if(this.media=null,!r&&(n&&this.removeMediaListeners(n),this.detachedData)){const e=this.getBufferingPlayer();e&&(this.log(`Removing schedule state for detachedData and ${e}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,e.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,r=t=>t?e.getAssetPlayer(t.identifier):t,n=(t,n,a,s,o)=>{if(t){let l=t[n].start;const u=t.event;if(u){if("playout"===n||u.timelineOccupancy!==zl.Point){const e=r(a);(null==e?void 0:e.interstitial)===u&&(l+=e.assetItem.startOffset+e[o])}}else{l+=("bufferedPos"===s?i():e[s])-t.start}return l}return 0},i=()=>{const t=e.bufferedPos;return t===Number.MAX_VALUE?a("primary"):Math.max(t,0)},a=t=>{var r,n;return null!=(r=e.primaryDetails)&&r.live?e.primaryDetails.edge:(null==(n=e.schedule)?void 0:n.durations[t])||0},s=(t,i)=>{var a,s;const o=e.effectivePlayingItem;if(null!=o&&null!=(a=o.event)&&a.restrictions.skip||!e.schedule)return;e.log(`seek to ${t} "${i}"`);const l=e.effectivePlayingItem,u=e.schedule.findItemIndexAtTime(t,i),c=null==(s=e.schedule.items)?void 0:s[u],d=e.getBufferingPlayer(),f=null==d?void 0:d.interstitial,h=null==f?void 0:f.appendInPlace,g=l&&e.itemsMatch(l,c);if(l&&(h||g)){const a=r(e.playingAsset),s=(null==a?void 0:a.media)||e.primaryMedia;if(s){const r="primary"===i?s.currentTime:n(l,i,e.playingAsset,"timelinePos","currentTime"),o=t-r,u=(h?r:s.currentTime)+o;if(u>=0&&(!a||h||u<=a.duration))return void(s.currentTime=u)}}if(c){let r=t;if("primary"!==i){const e=t-c[i].start;r=c.start+e}const n=!e.isInterstitial(c);if(e.isInterstitial(l)&&!l.event.appendInPlace||!n&&!c.event.appendInPlace){if(l){const a=e.findItemIndex(l);if(u>a){const t=e.schedule.findJumpRestrictedIndex(a+1,u);if(t>a)return void e.setSchedulePosition(t)}let s=0;if(n)e.timelinePos=r,e.checkBuffer();else{const e=c.event.assetList,r=t-(c[i]||c).start;for(let t=e.length;t--;){const n=e[t];if(n.duration&&r>=n.startOffset&&r<n.startOffset+n.duration){s=t;break}}}e.setSchedulePosition(u,s)}}else{const t=e.media||(h?null==d?void 0:d.media:null);t&&(t.currentTime=r)}}},o=()=>{const r=e.effectivePlayingItem;if(e.isInterstitial(r))return r;const n=t();return e.isInterstitial(n)?n:null},l={get bufferedEnd(){const r=t(),i=e.bufferingItem;var a;return i&&i===r&&(n(i,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-i.playout.start||(null==(a=e.bufferingAsset)?void 0:a.startOffset))||0},get currentTime(){const t=o(),r=e.effectivePlayingItem;return r&&r===t?n(r,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-r.playout.start:0},set currentTime(t){const r=o(),n=e.effectivePlayingItem;n&&n===r&&s(t+n.playout.start,"playout")},get duration(){const e=o();return e?e.playout.end-e.playout.start:0},get assetPlayers(){var t;const r=null==(t=o())?void 0:t.event.assetList;return r?r.map(t=>e.getAssetPlayer(t.identifier)):[]},get playingIndex(){var t;const r=null==(t=o())?void 0:t.event;return r&&e.effectivePlayingAsset?r.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return o()}};return this.manager={get events(){var t;return(null==(t=e.schedule)||null==(t=t.events)?void 0:t.slice(0))||[]},get schedule(){var t;return(null==(t=e.schedule)||null==(t=t.items)?void 0:t.slice(0))||[]},get interstitialPlayer(){return o()?l:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const r=t();return e.findItemIndex(r)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const t=e.effectivePlayingItem;return e.findItemIndex(t)},primary:{get bufferedEnd(){return i()},get currentTime(){const t=e.timelinePos;return t>0?t:0},set currentTime(e){s(e,"primary")},get duration(){return a("primary")},get seekableStart(){var t;return(null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(e){s(e,"integrated")},get duration(){return a("integrated")},get seekableStart(){var t;return((t,r)=>{var n;if(0!==t&&"primary"!==r&&null!=(n=e.schedule)&&n.length){var i;const n=e.schedule.findItemIndexAtTime(t),a=null==(i=e.schedule.items)?void 0:i[n];if(a)return t+(a[r].start-a.start)}return t})((null==(t=e.primaryDetails)?void 0:t.fragmentStart)||0,"integrated")}},skip:()=>{const t=e.effectivePlayingItem,r=null==t?void 0:t.event;if(r&&!r.restrictions.skip){const n=e.findItemIndex(t);if(r.appendInPlace){const e=t.playout.start+t.event.duration;s(e+.001,"playout")}else e.advanceAfterAssetEnded(r,n,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,r=null==(e=this.schedule)?void 0:e.items;return!!(this.playbackStarted&&t&&r)&&this.findItemIndex(t)===r.length-1}get playbackStarted(){return null!==this.effectivePlayingItem}get currentTime(){var e,t;if(null===this.mediaSelection)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let n=this.media;!n&&null!=(e=this.bufferingItem)&&null!=(e=e.event)&&e.appendInPlace&&(n=this.primaryMedia);const i=null==(t=n)?void 0:t.currentTime;return void 0!==i&&Tt(i)?i:void 0}get primaryMedia(){var e;return this.media||(null==(e=this.detachedData)?void 0:e.media)||null}isInterstitial(e){return!(null==e||!e.event)}retreiveMediaSource(e,t){const r=this.getAssetPlayer(e);r&&this.transferMediaFromPlayer(r,t)}transferMediaFromPlayer(e,t){const r=e.interstitial.appendInPlace,n=e.media;if(r&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n)return void(this.detachedData={media:n});const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${_n(r)}`),this.detachedData=r}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var r,n;if(e.media===t)return;let i=null;const a=this.hls,s=e!==a,o=s&&e.interstitial.appendInPlace,l=null==(r=this.detachedData)?void 0:r.mediaSource;let u;if(a.media)o&&(i=a.transferMedia(),this.detachedData=i),u="Primary";else if(l){const e=this.getBufferingPlayer();e?(i=e.transferMedia(),u=`${e}`):u="detached MediaSource"}else u="detached media";if(!i)if(l)i=this.detachedData,this.log(`using detachedData: MediaSource ${_n(i)}`);else if(!this.detachedData||a.media===t){const e=this.playerQueue;e.length>1&&e.forEach(e=>{if(s&&e.interstitial.appendInPlace!==o){const t=e.interstitial;this.clearInterstitial(e.interstitial,null),t.appendInPlace=!1,t.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${t}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}const c=i&&"mediaSource"in i&&"closed"!==(null==(n=i.mediaSource)?void 0:n.readyState),d=c&&i?i:t;this.log(`${c?"transfering MediaSource":"attaching media"} to ${s?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const f=this.schedule;if(d===i&&f){const t=s&&e.assetId===f.assetIdAtEnd;d.overrides={duration:f.duration,endOfStream:!s||t,cueRemoval:!s}}e.attachMedia(d)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=null==e?void 0:e.events;if(!t||this.playbackDisabled||!this.media)return;-1===this.bufferedPos&&(this.bufferedPos=0);const r=this.timelinePos,n=this.effectivePlayingItem;if(-1===r){const r=this.hls.startPosition;if(this.log(ou("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){const r=e.findEventIndex(t[0].identifier);this.setSchedulePosition(r)}else if(r>=0||!this.primaryLive){const t=this.timelinePos=r>0?r:0,n=e.findItemIndexAtTime(t);this.setSchedulePosition(n)}}else if(n&&!this.playingItem){const t=e.findItemIndex(n);this.setSchedulePosition(t)}}advanceAssetBuffering(e,t){const r=e.event,n=r.findAssetIndex(t),i=eu(r,n);if(r.isAssetPastPlayoutLimit(i)){if(this.schedule){var a;const t=null==(a=this.schedule.items)?void 0:a[this.findItemIndex(e)+1];t&&this.bufferedToItem(t)}}else this.bufferedToEvent(e,i)}advanceAfterAssetEnded(e,t,r){const n=eu(e,r);if(e.isAssetPastPlayoutLimit(n)){if(this.schedule){const r=this.schedule.items;if(r){const n=t+1;if(n>=r.length)return void this.setSchedulePosition(-1);const i=e.resumeTime;this.timelinePos<i&&(this.log(ou("advanceAfterAssetEnded",i)),this.timelinePos=i,e.appendInPlace&&this.advanceInPlace(i),this.checkBuffer(this.bufferedPos<i)),this.setSchedulePosition(n)}}}else{if(e.appendInPlace){const t=e.assetList[n];t&&this.advanceInPlace(t.timelineStart)}this.setSchedulePosition(t,n)}}setScheduleToAssetAtTime(e,t){const r=this.schedule;if(!r)return;const n=t.parentIdentifier,i=r.getEvent(n);if(i){const t=r.findEventIndex(n),a=r.findAssetIndex(i,e);this.advanceAfterAssetEnded(i,t,a-1)}}setSchedulePosition(e,t){var r;const n=null==(r=this.schedule)?void 0:r.items;if(!n||this.playbackDisabled)return;const i=e>=0?n[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${i?iu(i):i}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,s=this.playingLastItem;if(this.isInterstitial(a)){const r=a.event,u=this.playingAsset,c=null==u?void 0:u.identifier,d=c?this.getAssetPlayer(c):null;if(d&&c&&(!this.eventItemsMatch(a,i)||void 0!==t&&c!==r.assetList[t].identifier)){var o;const t=r.findAssetIndex(u);if(this.log(`INTERSTITIAL_ASSET_ENDED ${t+1}/${r.assetList.length} ${tu(u)}`),this.endedAsset=u,this.playingAsset=null,this.hls.trigger(It.INTERSTITIAL_ASSET_ENDED,{asset:u,assetListIndex:t,event:r,schedule:n.slice(0),scheduleIndex:e,player:d}),a!==this.playingItem)return void(this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(r,this.findItemIndex(this.playingItem),t));this.retreiveMediaSource(c,i),!d.media||null!=(o=this.detachedData)&&o.mediaSource||d.detachMedia()}if(!this.eventItemsMatch(a,i)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${r} ${iu(a)}`),r.hasPlayed=!0,this.hls.trigger(It.INTERSTITIAL_ENDED,{event:r,schedule:n.slice(0),scheduleIndex:e}),r.cue.once)){var l;this.updateSchedule();const e=null==(l=this.schedule)?void 0:l.items;if(i&&e){const r=this.findItemIndex(i);this.advanceSchedule(r,e,t,a,s)}return}}this.advanceSchedule(e,n,t,a,s)}advanceSchedule(e,t,r,n,i){const a=this.schedule;if(!a)return;const s=t[e]||null,o=this.primaryMedia,l=this.playerQueue;if(l.length&&l.forEach(t=>{const r=t.interstitial,n=a.findEventIndex(r.identifier);(n<e||n>e+1)&&this.clearInterstitial(r,s)}),this.isInterstitial(s)){this.timelinePos=Math.min(Math.max(this.timelinePos,s.start),s.end);const i=s.event;if(void 0===r){const t=eu(i,(r=a.findAssetIndex(i,this.timelinePos))-1);if(i.isAssetPastPlayoutLimit(t)||i.appendInPlace&&this.timelinePos===s.end)return void this.advanceAfterAssetEnded(i,e,r);r=t}const l=this.waitingItem;this.assetsBuffered(s,o)||this.setBufferingItem(s);let u=this.preloadAssets(i,r);if(this.eventItemsMatch(s,l||n)||(this.waitingItem=s,this.log(`INTERSTITIAL_STARTED ${iu(s)} ${i.appendInPlace?"append in place":""}`),this.hls.trigger(It.INTERSTITIAL_STARTED,{event:i,schedule:t.slice(0),scheduleIndex:e})),!i.assetListLoaded)return void this.log(`Waiting for ASSET-LIST to complete loading ${i}`);if(i.assetListLoader&&(i.assetListLoader.destroy(),i.assetListLoader=void 0),!o)return void this.log(`Waiting for attachMedia to start Interstitial ${i}`);this.waitingItem=this.endedItem=null,this.playingItem=s;const c=i.assetList[r];if(!c)return void this.advanceAfterAssetEnded(i,e,r||0);if(u||(u=this.getAssetPlayer(c.identifier)),null===u||u.destroyed){const e=i.assetList.length;this.warn(`asset ${r+1}/${e} player destroyed ${i}`),u=this.createAssetPlayer(i,c,r),u.loadSource()}if(!this.eventItemsMatch(s,this.bufferingItem)&&i.appendInPlace&&this.isAssetBuffered(c))return;this.startAssetPlayer(u,r,t,e,o),this.shouldPlay&&su(u.media)}else s?(this.resumePrimary(s,e,n),this.shouldPlay&&su(this.hls.media)):i&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return!1===this.hls.config.enableInterstitialPlayback}get primaryDetails(){var e;return null==(e=this.mediaSelection)?void 0:e.main.details}get primaryLive(){var e;return!(null==(e=this.primaryDetails)||!e.live)}resumePrimary(e,t,r){var n,i;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${iu(e)}`),null==(n=this.detachedData)||!n.mediaSource){let r=this.timelinePos;(r<e.start||r>=e.end)&&(r=this.getPrimaryResumption(e,t),this.log(ou("resumePrimary",r)),this.timelinePos=r),this.attachPrimary(r,e)}if(!r)return;const a=null==(i=this.schedule)?void 0:i.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${iu(e)}`),this.hls.trigger(It.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const r=e.start;if(this.primaryLive){const e=this.primaryDetails;if(0===t)return this.hls.startPosition;if(e&&(r<e.fragmentStart||r>e.edge))return this.hls.liveSyncPosition||-1}return r}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);if(null!=t&&t.hls)return t.hls.bufferedToEnd;return Ti.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,r){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const i=this.hls;i.media?this.checkBuffer():(this.transferMediaTo(i,n),r&&this.startLoadingPrimaryAt(e,r)),r||(this.log(ou("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,r))}startLoadingPrimaryAt(e,t){var r;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs(((null==(r=n.mainForwardBufferInfo)?void 0:r.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),null==(e=this.schedule)||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(It.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(It.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(-1===t.level||!this.schedule)return;const r=this.hls.levels[t.level];if(!r.details)return;const n=Bt(Bt({},this.mediaSelection||this.altSelection),{},{main:r});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const r=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n)return void(this.altSelection=Bt(Bt({},this.altSelection),{},{audio:r}));const i=Bt(Bt({},n),{},{audio:r});this.mediaSelection=i}onSubtitleTrackUpdated(e,t){const r=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n)return void(this.altSelection=Bt(Bt({},this.altSelection),{},{subtitles:r}));const i=Bt(Bt({},n),{},{subtitles:r});this.mediaSelection=i}onAudioTrackSwitching(e,t){const r=An(t);this.playerQueue.forEach(({hls:e})=>e&&(e.setAudioOption(t)||e.setAudioOption(r)))}onSubtitleTrackSwitch(e,t){const r=An(t);this.playerQueue.forEach(({hls:e})=>e&&(e.setSubtitleOption(t)||-1!==t.id&&e.setSubtitleOption(r)))}onBufferCodecs(e,t){const r=t.tracks;r&&(this.requiredTracks=r)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const r=this.playingItem;if(r&&!this.itemsMatch(r,this.bufferingItem)&&!this.isInterstitial(r)){const e=this.timelinePos;this.bufferedPos=e,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let e=0;e<t.length;e++){const n=t[e];if(n.cue.post){var r;const e=this.schedule.findEventIndex(n.identifier),t=null==(r=this.schedule.items)?void 0:r[e];this.isInterstitial(t)&&this.eventItemsMatch(t,this.bufferingItem)&&this.bufferedToItem(t,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const e=this.findItemIndex(t);this.setSchedulePosition(e+1)}else this.shouldPlay=!1}updateItem(e,t){var r;const n=null==(r=this.schedule)?void 0:r.items;if(e&&n){return n[this.findItemIndex(e,t)]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((t,r)=>{e.event.isAssetPastPlayoutLimit(r)&&this.clearAssetPlayer(t.identifier,null)});const r=e.end+.25,n=Ti.bufferInfo(this.primaryMedia,r,0);if(n.end>r||(n.nextStart||0)>r){this.log(`trim buffered interstitial ${iu(e)} (was ${iu(t)})`);const n=!0;this.attachPrimary(r,null,n),this.flushFrontBuffer(r)}}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var r;return!!t&&(e===t||e.event.identifier===(null==(r=t.event)?void 0:r.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const r=this.mediaSelection;r&&(null==(t=this.schedule)||t.updateSchedule(r,[],e))}checkBuffer(e){var t;const r=null==(t=this.schedule)?void 0:t.items;if(!r)return;const n=Ti.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,r,e)}updateBufferedPos(e,t,r){const n=this.schedule,i=this.bufferingItem;if(this.bufferedPos>e||!n)return;if(1===t.length&&this.itemsMatch(t[0],i))return void(this.bufferedPos=e);const a=this.playingItem,s=this.findItemIndex(a);let o=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var l;const r=this.findItemIndex(i),n=Math.min(r+1,t.length-1),a=t[n];if((-1===o&&i&&e>=i.end||null!=(l=a.event)&&l.appendInPlace&&e+.01>=a.start)&&(o=n),this.isInterstitial(i)){const e=i.event;if(n-s>1&&!1===e.appendInPlace)return;if(0===e.assetList.length&&e.assetListLoader)return}if(this.bufferedPos=e,o>r&&o>s)this.bufferedToItem(a);else{const t=this.primaryDetails;this.primaryLive&&t&&e>t.edge-t.targetduration&&a.start<t.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(a)&&this.preloadAssets(a.event,0)}}else r&&a&&!this.itemsMatch(a,i)&&(o===s?this.bufferedToItem(a):o===s+1&&this.bufferedToItem(t[o]))}assetsBuffered(e,t){return 0!==e.event.assetList.length&&!e.event.assetList.some(e=>{const r=this.getAssetPlayer(e.identifier);return!(null!=r&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,r=this.schedule;if(!this.itemsMatch(e,t)&&r){const{items:n,events:i}=r;if(!n||!i)return t;const a=this.isInterstitial(e),s=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const o=s?s.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${iu(e)}`+(t?` (${o.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const t=r.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((e,r)=>{const n=this.getAssetPlayer(e.identifier);n&&(r===t&&n.loadSource(),n.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(e=>e.pauseBuffering());this.hls.trigger(It.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:i.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const r=this.setBufferingItem(e);if(!this.playbackDisabled)if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(null!==r){this.bufferingAsset=null;const t=this.detachedData;if(t)if(t.mediaSource){const t=!0;this.attachPrimary(e.start,e,t)}else this.preloadPrimary(e);else this.preloadPrimary(e)}}preloadPrimary(e){const t=this.findItemIndex(e),r=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(r)}bufferedToEvent(e,t){const r=e.event,n=0===r.assetList.length&&!r.assetListLoader,i=r.cue.once;if(n||!i){const e=this.preloadAssets(r,t);if(null!=e&&e.interstitial.appendInPlace){const t=this.primaryMedia;t&&this.bufferAssetPlayer(e,t)}}}preloadAssets(e,t){const r=e.assetUrl,n=e.assetList.length,i=0===n&&!e.assetListLoader,a=e.cue.once;if(i){const i=e.timelineStart;if(e.appendInPlace){var s;const t=this.playingItem;this.isInterstitial(t)||(null==t||null==(s=t.nextEvent)?void 0:s.identifier)!==e.identifier||this.flushFrontBuffer(i+.25)}let a,o=0;if(!this.playingItem&&this.primaryLive&&(o=this.hls.startPosition,-1===o&&(o=this.hls.liveSyncPosition||0)),o&&!e.cue.pre&&!e.cue.post){const e=o-i;e>0&&(a=Math.round(1e3*e)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${r?1:n} ${e}${a?` live-start: ${o} start-offset: ${a}`:""}`),r)return this.createAsset(e,0,0,i,e.duration,r);const l=this.assetListLoader.loadAssetList(e,a);l&&(e.assetListLoader=l)}else if(!a&&n){for(let r=t;r<n;r++){const t=e.assetList[r],n=this.getAssetPlayerQueueIndex(t.identifier);-1!==n&&!this.playerQueue[n].destroyed||t.error||this.createAssetPlayer(e,t,r)}const r=e.assetList[t];if(r){const e=this.getAssetPlayer(r.identifier);return e&&e.loadSource(),e}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`);Object.keys(t).forEach(t=>{this.hls.trigger(It.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:t})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let r=0;r<t.length;r++)if(e===t[r].assetId)return r;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t)for(let r=0;r<e.length;r++)if(e[r].media===t)return e[r];return null}createAsset(e,t,r,n,i,a){const s={parentIdentifier:e.identifier,identifier:Wl(e,a,t),duration:i,startOffset:r,timelineStart:n,uri:a};return this.createAssetPlayer(e,s,t)}createAssetPlayer(e,t,r){const n=this.hls,i=n.userConfig;let a=i.videoPreference;const s=n.loadLevelObj||n.levels[n.currentLevel];(a||s)&&(a=xt({},a),s.videoCodec&&(a.videoCodec=s.videoCodec),s.videoRange&&(a.allowedVideoRanges=[s.videoRange]));const o=n.audioTracks[n.audioTrack],l=n.subtitleTracks[n.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const e=this.timelinePos-t.timelineStart;if(e>1){const r=t.duration;r&&e<r&&(u=e)}}const c=t.identifier,d=Bt(Bt({},i),{},{maxMaxBufferLength:Math.min(180,n.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:c,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:o||i.audioPreference,subtitlePreference:l||i.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(d.timelineOffset=t.timelineStart));const f=d.cmcd;null!=f&&f.sessionId&&f.contentId&&(d.cmcd=xt({},f,{contentId:Yl(t.uri)})),this.getAssetPlayer(c)&&this.warn(`Duplicate date range identifier ${e} and asset ${c}`);const h=new ru(this.HlsPlayerClass,d,e,t);this.playerQueue.push(h),e.assetList[r]=t;let g=!0;const p=n=>{if(n.live){var i;const t=new Error(`Interstitials MUST be VOD assets ${e}`),n={fatal:!0,type:bt.OTHER_ERROR,details:At.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},a=(null==(i=this.schedule)?void 0:i.findEventIndex(e.identifier))||-1;return void this.handleAssetItemError(n,e,a,r,t.message)}const a=n.edge-n.fragmentStart,s=t.duration;(g||null===s||a>s)&&(g=!1,this.log(`Interstitial asset "${c}" duration change ${s} > ${a}`),t.duration=a,this.updateSchedule())};h.on(It.LEVEL_UPDATED,(e,{details:t})=>p(t)),h.on(It.LEVEL_PTS_UPDATED,(e,{details:t})=>p(t)),h.on(It.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const m=(e,t)=>{const r=this.getAssetPlayer(c);if(r&&t.tracks){r.off(It.BUFFER_CODECS,m),r.tracks=t.tracks;const e=this.primaryMedia;this.bufferingAsset===r.assetItem&&e&&!r.media&&this.bufferAssetPlayer(r,e)}};h.on(It.BUFFER_CODECS,m);h.on(It.BUFFERED_TO_END,()=>{var r;const n=this.getAssetPlayer(c);if(this.log(`buffered to end of asset ${n}`),!n||!this.schedule)return;const i=this.schedule.findEventIndex(e.identifier),a=null==(r=this.schedule.items)?void 0:r[i];this.isInterstitial(a)&&this.advanceAssetBuffering(a,t)});const v=t=>()=>{if(!this.getAssetPlayer(c)||!this.schedule)return;this.shouldPlay=!0;const r=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,r,t)};return h.once(It.MEDIA_ENDED,v(r)),h.once(It.PLAYOUT_LIMIT_REACHED,v(1/0)),h.on(It.ERROR,(t,n)=>{if(!this.schedule)return;const i=this.getAssetPlayer(c);if(n.details===At.BUFFER_STALLED_ERROR)return null!=i&&i.appendInPlace?void this.handleInPlaceStall(e):(this.onTimeupdate(),void this.checkBuffer(!0));this.handleAssetItemError(n,e,this.schedule.findEventIndex(e.identifier),r,`Asset player error ${n.error} ${e}`)}),h.on(It.DESTROYING,()=>{if(!this.getAssetPlayer(c)||!this.schedule)return;const t=new Error(`Asset player destroyed unexpectedly ${c}`),n={fatal:!0,type:bt.OTHER_ERROR,details:At.INTERSTITIAL_ASSET_ITEM_ERROR,error:t};this.handleAssetItemError(n,e,this.schedule.findEventIndex(e.identifier),r,t.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${tu(t)}`),this.hls.trigger(It.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:r,event:e,player:h}),h}clearInterstitial(e,t){e.assetList.forEach(e=>{this.clearAssetPlayer(e.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(-1!==t){this.log(`reset asset player "${e}" after error`);const r=this.playerQueue[t];this.transferMediaFromPlayer(r,null),r.resetDetails()}}clearAssetPlayer(e,t){const r=this.getAssetPlayerQueueIndex(e);if(-1!==r){const e=this.playerQueue[r];this.log(`clear ${e} toSegment: ${t?iu(t):t}`),this.transferMediaFromPlayer(e,t),this.playerQueue.splice(r,1),e.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,r,n,i){const{interstitial:a,assetItem:s,assetId:o}=e,l=a.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=s,u&&u.identifier===o||(u&&(this.clearAssetPlayer(u.identifier,r[n]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${l} ${tu(s)}`),this.hls.trigger(It.INTERSTITIAL_ASSET_STARTED,{asset:s,assetListIndex:t,event:a,schedule:r.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,i)}bufferAssetPlayer(e,t){var r,n;if(!this.schedule)return;const{interstitial:i,assetItem:a}=e,s=this.schedule.findEventIndex(i.identifier),o=null==(r=this.schedule.items)?void 0:r[s];if(!o)return;e.loadSource(),this.setBufferingItem(o),this.bufferingAsset=a;const l=this.getBufferingPlayer();if(l===e)return;const u=i.appendInPlace;if(u&&!1===(null==l?void 0:l.interstitial.appendInPlace))return;const c=(null==l?void 0:l.tracks)||(null==(n=this.detachedData)?void 0:n.tracks)||this.requiredTracks;if(u&&a!==this.playingAsset){if(!e.tracks)return void this.log(`Waiting for track info before buffering ${e}`);if(c&&!Yt(c,e.tracks)){const t=new Error(`Asset ${tu(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(c)}')`),r={fatal:!0,type:bt.OTHER_ERROR,details:At.INTERSTITIAL_ASSET_ITEM_ERROR,error:t},n=i.findAssetIndex(a);return void this.handleAssetItemError(r,i,s,n,t.message)}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,r=this.primaryMedia;if(!t||!r)return;const n=r.currentTime,i=t.findAssetIndex(e,n),a=e.assetList[i];if(a){const s=this.getAssetPlayer(a.identifier);if(s){const o=s.currentTime||n-a.timelineStart,l=s.duration-o;if(this.warn(`Stalled at ${o} of ${o+l} in ${s} ${e} (media.currentTime: ${n})`),o&&(l/r.playbackRate<.5||s.bufferedInPlaceToEnd(r))&&s.hls){const r=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,r,i)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,r,n,i){if(e.details===At.BUFFER_STALLED_ERROR)return;const a=t.assetList[n]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a?tu(a):a} ${e.error}`),!this.schedule)return;const s=(null==a?void 0:a.identifier)||"",o=this.getAssetPlayerQueueIndex(s),l=this.playerQueue[o]||null,u=this.schedule.items,c=xt({},e,{fatal:!1,errorAction:Xn(!0),asset:a,assetListIndex:n,event:t,schedule:u,scheduleIndex:r,player:l});if(this.hls.trigger(It.INTERSTITIAL_ASSET_ERROR,c),!e.fatal)return;const d=this.playingAsset,f=this.bufferingAsset,h=new Error(i);if(a&&(this.clearAssetPlayer(s,null),a.error=h),t.assetList.some(e=>!e.error))for(let e=n;e<t.assetList.length;e++)this.resetAssetPlayer(t.assetList[e].identifier);else t.error=h;this.updateSchedule(!0),t.error?this.primaryFallback(t):d&&d.identifier===s?this.advanceAfterAssetEnded(t,r,n):f&&f.identifier===s&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,f)}primaryFallback(e){const t=e.timelineStart,r=this.effectivePlayingItem;if(r){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${iu(r)} error: ${e.error}`);let n=this.timelinePos;-1===n&&(n=this.hls.startPosition);const i=this.updateItem(r,n);if(this.itemsMatch(r,i)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t)),!this.schedule)return;const a=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(a)}else this.checkStart()}onAssetListLoaded(e,t){var r,n;const i=t.event,a=i.identifier,s=t.assetListResponse.ASSETS;if(null==(r=this.schedule)||!r.hasEvent(a))return;const o=i.timelineStart,l=i.duration;let u=0;s.forEach((e,t)=>{const r=parseFloat(e.DURATION);this.createAsset(i,t,u,o+u,r,e.URI),u+=r}),i.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${l}) ${i}`);const c=this.waitingItem,d=(null==c?void 0:c.event.identifier)===a;this.updateSchedule();const f=null==(n=this.bufferingItem)?void 0:n.event;if(d){var h;const e=this.schedule.findEventIndex(a),t=null==(h=this.schedule.items)?void 0:h[e];if(t){if(!this.playingItem&&this.timelinePos>t.end){if(this.schedule.findItemIndexAtTime(this.timelinePos)!==e)return i.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${i}`),this.updateSchedule(!0),void this.primaryFallback(i)}this.setBufferingItem(t)}this.setSchedulePosition(e)}else if((null==f?void 0:f.identifier)===a){const e=i.assetList[0];if(e){const t=this.getAssetPlayer(e.identifier);if(f.appendInPlace){const e=this.primaryMedia;t&&e&&this.bufferAssetPlayer(t,e)}else t&&t.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case At.ASSET_LIST_PARSING_ERROR:case At.ASSET_LIST_LOAD_ERROR:case At.ASSET_LIST_LOAD_TIMEOUT:{const e=t.interstitial;e&&(this.updateSchedule(!0),this.primaryFallback(e));break}case At.BUFFER_STALLED_ERROR:{const e=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(e)&&e.event.appendInPlace)return void this.handleInPlaceStall(e.event);this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}});function fc(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(fc):Object.keys(e).reduce((t,r)=>(t[r]=fc(e[r]),t),{}):e}function hc(e,t){const r=e.loader;if(r!==sc&&r!==cc)t.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{(function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1})()&&(e.loader=sc,e.progressive=!0,e.enableSoftwareAES=!0,t.log("[config]: Progressive streaming enabled, using FetchLoader"))}}class gc extends vi{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var e;null!=(e=this.media)&&e.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{var e;this.hls&&(this.ended=(null==(e=this.media)?void 0:e.currentTime)||1,this.hls.trigger(It.MEDIA_ENDED,{stalled:!1}))},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(It.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(It.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(100),this.mediaSource=t.mediaSource;const r=this.media=t.media;Fa(r,"playing",this.onMediaPlaying),Fa(r,"waiting",this.onMediaWaiting),Fa(r,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:r}=this;r&&(Ba(r,"playing",this.onMediaPlaying),Ba(r,"waiting",this.onMediaWaiting),Ba(r,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(null==(e=this.media)||!e.readyState||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var r,n;const i=null==(r=this.hls)?void 0:r.config;if(!i)return;const a=this.media;if(!a)return;const{seeking:s}=a,o=this.seeking&&!s,l=!this.seeking&&s,u=a.paused&&!s||a.ended||0===a.playbackRate;if(this.seeking=s,e!==t)return t&&(this.ended=0),this.moved=!0,s||(this.nudgeRetry=0,i.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),void(0===this.waiting&&this.stallResolved(e));if(l||o)return void(o&&this.stallResolved(e));if(u)return this.nudgeRetry=0,this.stallResolved(e),void(!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(It.MEDIA_ENDED,{stalled:!1})));if(!Ti.getBuffered(a).length)return void(this.nudgeRetry=0);const c=Ti.bufferInfo(a,e,0),d=c.nextStart||0,f=this.fragmentTracker;if(s&&f&&this.hls){const t=pc(this.hls.inFlightFragments,e),r=c.len>2,n=!d||t||d-e>2&&!f.getPartialFragment(e);if(r||n)return;this.moved=!1}const h=null==(n=this.hls)?void 0:n.latestLevelDetails;if(!this.moved&&null!==this.stalled&&f){if(!(c.len>0)&&!d)return;const t=Math.max(d,c.start||0)-e,r=!(null==h||!h.live)?2*h.targetduration:2,n=vc(e,f);if(t>0&&(t<=r||n))return void(a.paused||this._trySkipBufferHole(n))}const g=i.detectStallWithCurrentTimeMs,p=self.performance.now(),m=this.waiting;let v=this.stalled;if(null===v){if(!(m>0&&p-m<g))return void(this.stalled=p);v=this.stalled=m}const y=p-v;if(!s&&(y>=g||m)&&this.hls){var E;if("ended"===(null==(E=this.mediaSource)?void 0:E.readyState)&&(null==h||!h.live)&&Math.abs(e-((null==h?void 0:h.edge)||0))<1){if(this.ended)return;return this.ended=e||1,void this.hls.trigger(It.MEDIA_ENDED,{stalled:!0})}if(this._reportStall(c),!this.media||!this.hls)return}const T=Ti.bufferInfo(a,e,i.maxBufferHole);this._tryFixBufferStall(T,y,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const r=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(r)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(It.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var r;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&null!=(r=this.buffered.audio)&&r.length&&n&&n.length>1&&e>n.end(0)){const r=Ti.bufferedInfo(Ti.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const r=Ti.timeRangesToArray(n),i=Ti.bufferedInfo(r,t,0).bufferedIndex;if(i>-1&&i<r.length-1){const t=Ti.bufferedInfo(r,e,0).bufferedIndex,n=r[i].end,a=r[i+1].start;if((-1===t||t>i)&&a-n<1&&e-n<2){const r=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${n} -> ${a} buffered index: ${t}`);this.warn(r.message),this.media.currentTime+=1e-6;let i=vc(e,this.fragmentTracker);i&&"fragment"in i?i=i.fragment:i||(i=void 0);const s=Ti.bufferInfo(this.media,e,0);this.hls.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:r,reason:r.message,frag:i,buffer:s.len,bufferInfo:s})}}}}}_tryFixBufferStall(e,t,r){var n,i;const{fragmentTracker:a,media:s}=this,o=null==(n=this.hls)?void 0:n.config;if(!s||!a||!o)return;const l=null==(i=this.hls)?void 0:i.latestLevelDetails,u=vc(r,a);if(u||null!=l&&l.live&&r<l.fragmentStart){if(this._trySkipBufferHole(u)||!this.media)return}const c=e.buffered,d=this.adjacentTraversal(e,r);(c&&c.length>1&&e.len>o.maxBufferHole||e.nextStart&&(e.nextStart-r<o.maxBufferHole||d))&&(t>1e3*o.highBufferWatchdogPeriod||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const r=this.fragmentTracker,n=e.nextStart;if(r&&n){const e=r.getFragAtPos(t,Ct),i=r.getFragAtPos(n,Ct);if(e&&i)return i.sn-e.sn<2}return!1}_reportStall(e){const{hls:t,media:r,stallReported:n,stalled:i}=this;if(!n&&null!==i&&r&&t){this.stallReported=!0;const n=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${_n(e)})`);this.warn(n.message),t.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.BUFFER_STALLED_ERROR,fatal:!1,error:n,buffer:e.len,bufferInfo:e,stalled:{start:i}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:r,media:n}=this,i=null==(t=this.hls)?void 0:t.config;if(!n||!r||!i)return 0;const a=n.currentTime,s=Ti.bufferInfo(n,a,0),o=a<s.start?s.start:s.nextStart;if(o&&this.hls){const t=s.len<=i.maxBufferHole,u=s.len>0&&s.len<1&&n.readyState<3,c=o-a;if(c>0&&(t||u)){if(c>i.maxBufferHole){let t=!1;if(0===a){const e=r.getAppendedFrag(0,Ct);e&&o<e.end&&(t=!0)}if(!t&&e){var l;if(null==(l=this.hls.loadLevelObj)||!l.details)return 0;if(pc(this.hls.inFlightFragments,o))return 0;let t=!1,n=e.end;for(;n<o;){const e=vc(n,r);if(!e){t=!0;break}n+=e.duration}if(t)return 0}}const t=Math.max(o+.05,a+.1);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${t}`),this.moved=!0,n.currentTime=t,null==e||!e.gap){const r=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${t}`),n={type:bt.MEDIA_ERROR,details:At.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:r,reason:r.message,buffer:s.len,bufferInfo:s};e&&("fragment"in e?n.part=e:n.frag=e),this.hls.trigger(It.ERROR,n)}return t}}return 0}_tryNudgeBuffer(e){const{hls:t,media:r,nudgeRetry:n}=this,i=null==t?void 0:t.config;if(!r||!i)return 0;const a=r.currentTime;if(this.nudgeRetry++,n<i.nudgeMaxRetry){const s=a+(n+1)*i.nudgeOffset,o=new Error(`Nudging 'currentTime' from ${a} to ${s}`);this.warn(o.message),r.currentTime=s,t.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1,buffer:e.len,bufferInfo:e})}else{const r=new Error(`Playhead still not moving while enough data buffered @${a} after ${i.nudgeMaxRetry} nudges`);this.error(r.message),t.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.BUFFER_STALLED_ERROR,error:r,fatal:!0,buffer:e.len,bufferInfo:e})}}}function pc(e,t){const r=mc(e.main);if(r&&r.start<=t)return r;const n=mc(e.audio);return n&&n.start<=t?n:null}function mc(e){if(!e)return null;switch(e.state){case Ga:case Za:case ja:case za:return null}return e.frag}function vc(e,t){return t.getAppendedFrag(e,Ct)||t.getPartialFragment(e)}function yc(){if("undefined"!=typeof self)return self.VTTCue||self.TextTrackCue}function Ec(e,t,r,n,i){let a=new e(t,r,"");try{a.value=n,i&&(a.type=i)}catch(s){a=new e(t,r,_n(i?Bt({type:i},n):n))}return a}const Tc=(()=>{const e=yc();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch(e){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class _c{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(It.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(It.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(It.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(It.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(It.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(It.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(It.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(It.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(It.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var r;this.media=t.media,!1===(null==(r=t.overrides)?void 0:r.cueRemoval)&&(this.removeCues=!1)}onMediaAttached(){var e;const t=null==(e=this.hls)?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null;!!t.transferMedia||(this.id3Track&&(this.removeCues&&Vl(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const r=e[t];if("metadata"===r.kind&&"id3"===r.label)return Hl(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:r,enableID3MetadataCues:n}=this.hls.config;if(!r&&!n)return;const{samples:i}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=yc();if(a)for(let e=0;e<i.length;e++){const t=i[e].type;if(t===Ds.emsg&&!r||!n)continue;const s=As(i[e].data),o=i[e].pts;let l=o+i[e].duration;l>Tc&&(l=Tc);l-o<=0&&(l=o+.25);for(let e=0;e<s.length;e++){const r=s[e];if(!Is(r)){this.updateId3CueEnds(o,t);const e=Ec(a,o,l,r,t);e&&this.id3Track.addCue(e)}}}}updateId3CueEnds(e,t){var r;const n=null==(r=this.id3Track)?void 0:r.cues;if(n)for(let r=n.length;r--;){const i=n[r];i.type===t&&i.startTime<e&&i.endTime===Tc&&(i.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:n}){const{id3Track:i,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:s,enableID3MetadataCues:o}}=a;if(i&&(s||o)){let e;e="audio"===n?e=>e.type===Ds.audioId3&&o:"video"===n?e=>e.type===Ds.emsg&&s:e=>e.type===Ds.audioId3&&o||e.type===Ds.emsg&&s,Kl(i,t,r,e)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:r,timelineOffset:n,enableDateRangeMetadataCues:i,interstitialsController:a}=this.hls.config;if(!i)return;const s=yc();if(r&&n&&!a){const{fragmentStart:t,fragmentEnd:n}=e;let i=this.assetCue;i?(i.startTime=t,i.endTime=n):s&&(i=this.assetCue=Ec(s,t,n,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),i&&(i.id=r,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(i),i.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:o}=this,{dateRanges:l}=e,u=Object.keys(l);let c=this.dateRangeCuesAppended;var d;if(o&&t)if(null!=(d=o.cues)&&d.length){const e=Object.keys(c).filter(e=>!u.includes(e));for(let t=e.length;t--;){var f;const r=e[t],n=null==(f=c[r])?void 0:f.cues;delete c[r],n&&Object.keys(n).forEach(e=>{const t=n[e];if(t){t.removeEventListener("enter",this.onEventCueEnter);try{o.removeCue(t)}catch(e){}}})}}else c=this.dateRangeCuesAppended={};const h=e.fragments[e.fragments.length-1];if(0!==u.length&&Tt(null==h?void 0:h.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let e=0;e<u.length;e++){const t=u[e],r=l[t],n=r.startTime,i=c[t],o=(null==i?void 0:i.cues)||{};let d=(null==i?void 0:i.durationKnown)||!1,f=Tc;const{duration:h,endDate:g}=r;if(g&&null!==h)f=n+h,d=!0;else if(r.endOnNext&&!d){const e=u.reduce((e,t)=>{if(t!==r.id){const n=l[t];if(n.class===r.class&&n.startDate>r.startDate&&(!e||r.startDate<e.startDate))return n}return e},null);e&&(f=e.startTime,d=!0)}const p=Object.keys(r.attr);for(let e=0;e<p.length;e++){const l=p[e];if(!Li(l))continue;const u=o[l];if(u)!d||null!=i&&i.durationKnown?Math.abs(u.startTime-n)>.01&&(u.startTime=n,u.endTime=f):u.endTime=f;else if(s){let e=r.attr[l];Ci(l)&&(e=Wt(e));const i=Ec(s,n,f,{key:l,data:e},Ds.dateRange);i&&(i.id=t,this.id3Track.addCue(i),o[l]=i,a&&("X-ASSET-LIST"!==l&&"X-ASSET-URL"!==l||i.addEventListener("enter",this.onEventCueEnter)))}}c[t]={cues:o,dateRange:r,durationKnown:d}}}}}class Sc{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:e}=this,t=this.levelDetails;if(!e||!t)return;this.currentTime=e.currentTime;const r=this.computeLatency();if(null===r)return;this._latency=r;const{lowLatencyMode:n,maxLiveSyncPlaybackRate:i}=this.config;if(!n||1===i||!t.live)return;const a=this.targetLatency;if(null===a)return;const s=r-a;if(s<Math.min(this.maxLatency,a+t.targetduration)&&s>.05&&this.forwardBufferLength>1){const t=Math.min(2,Math.max(1,i)),r=Math.round(2/(1+Math.exp(-.75*s-this.edgeStalled))*20)/20,n=Math.min(t,Math.max(1,r));this.changeMediaPlaybackRate(e,n)}else 1!==e.playbackRate&&0!==e.playbackRate&&this.changeMediaPlaybackRate(e,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return(null==(e=this.hls)?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(void 0!==e.liveMaxLatencyDuration)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(null===e||null===this.hls)return null;const{holdBack:t,partHoldBack:r,targetduration:n}=e,{liveSyncDuration:i,liveSyncDurationCount:a,lowLatencyMode:s}=this.config,o=this.hls.userConfig;let l=s&&r||t;(this._targetLatencyUpdated||o.liveSyncDuration||o.liveSyncDurationCount||0===l)&&(l=void 0!==i?i:a*n);const u=n;return l+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(null===e||null===t)return null;const r=this.levelDetails;if(null===r)return null;const n=r.edge,i=e-t-this.edgeStalled,a=n-r.totalduration,s=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(a,i),s)}get drift(){const e=this.levelDetails;return null===e?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(null===e)return 0;const t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(It.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(It.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(It.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(It.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var r;t.details===At.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&null!=(r=this.levelDetails)&&r.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var r,n;e.playbackRate!==t&&(null==(r=this.hls)||r.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${null==(n=this.targetLatency)?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return null===e?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return null===e?null:e-this.currentTime}}class bc extends No{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(It.LEVEL_LOADED,this.onLevelLoaded,this),e.on(It.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(It.FRAG_BUFFERED,this.onFragBuffered,this),e.on(It.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(It.LEVEL_LOADED,this.onLevelLoaded,this),e.off(It.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(It.FRAG_BUFFERED,this.onFragBuffered,this),e.off(It.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const r=this.hls.config.preferManagedMediaSource,n=[],i={},a={};let s=!1,o=!1,l=!1;t.levels.forEach(e=>{const t=e.attrs;let{audioCodec:u,videoCodec:c}=e;u&&(e.audioCodec=u=Xr(u,r)||void 0),c&&(c=e.videoCodec=function(e){const t=e.split(",");for(let e=0;e<t.length;e++){const r=t[e].split(".");r.length>2&&"avc1"===r[0]&&(t[e]=`avc1.${parseInt(r[1]).toString(16)}${("000"+parseInt(r[2]).toString(16)).slice(-4)}`)}return t.join(",")}(c));const{width:d,height:f,unknownCodecs:h}=e,g=(null==h?void 0:h.length)||0;if(s||(s=!(!d||!f)),o||(o=!!c),l||(l=!!u),g||u&&!this.isAudioSupported(u)||c&&!this.isVideoSupported(c))return void this.log(`Some or all CODECS not supported "${t.CODECS}"`);const{CODECS:p,"FRAME-RATE":m,"HDCP-LEVEL":v,"PATHWAY-ID":y,RESOLUTION:E,"VIDEO-RANGE":T}=t,_=`${`${y||"."}-`}${e.bitrate}-${E}-${m}-${p}-${T}-${v}`;if(i[_])if(i[_].uri===e.url||e.attrs["PATHWAY-ID"])i[_].addGroupId("audio",t.AUDIO),i[_].addGroupId("text",t.SUBTITLES);else{const t=a[_]+=1;e.attrs["PATHWAY-ID"]=new Array(t+1).join(".");const r=this.createLevel(e);i[_]=r,n.push(r)}else{const t=this.createLevel(e);i[_]=t,a[_]=1,n.push(t)}}),this.filterAndSortMediaOptions(n,t,s,o,l)}createLevel(e){const t=new yn(e),r=e.supplemental;if(null!=r&&r.videoCodec&&!this.isVideoSupported(r.videoCodec)){const e=new Error(`SUPPLEMENTAL-CODECS not supported "${r.videoCodec}"`);this.log(e.message),t.supportedResult=sn(e,[])}return t}isAudioSupported(e){return Vr(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Vr(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,r,n,i){var a;let s=[],o=[],l=e;const u=(null==(a=t.stats)?void 0:a.parsing)||{};if((r||n)&&i&&(l=l.filter(({videoCodec:e,videoRange:t,width:r,height:n})=>{return(!!e||!(!r||!n))&&(!!(i=t)&&fn.indexOf(i)>-1);var i})),0===l.length)return Promise.resolve().then(()=>{if(this.hls){let e="no level with compatible codecs found in manifest",r=e;t.levels.length&&(r=`one or more CODECS in variant not supported: ${_n(t.levels.map(e=>e.attrs.CODECS).filter((e,t,r)=>r.indexOf(e)===t))}`,this.warn(r),e+=` (${r})`);const n=new Error(e);this.hls.trigger(It.ERROR,{type:bt.MEDIA_ERROR,details:At.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:n,reason:r})}}),void(u.end=performance.now());t.audioTracks&&(s=t.audioTracks.filter(e=>!e.audioCodec||this.isAudioSupported(e.audioCodec)),Ac(s)),t.subtitles&&(o=t.subtitles,Ac(o));const c=l.slice(0);l.sort((e,t)=>{if(e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"])return(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&e.height!==t.height)return e.height-t.height;if(e.frameRate!==t.frameRate)return e.frameRate-t.frameRate;if(e.videoRange!==t.videoRange)return fn.indexOf(e.videoRange)-fn.indexOf(t.videoRange);if(e.videoCodec!==t.videoCodec){const r=Yr(e.videoCodec),n=Yr(t.videoCodec);if(r!==n)return n-r}if(e.uri===t.uri&&e.codecSet!==t.codecSet){const r=jr(e.codecSet),n=jr(t.codecSet);if(r!==n)return n-r}return e.averageBitrate!==t.averageBitrate?e.averageBitrate-t.averageBitrate:0});let d=c[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==c.length))for(let e=0;e<c.length;e++)if(c[e].pathwayId===l[0].pathwayId){d=c[e];break}this._levels=l;for(let e=0;e<l.length;e++)if(l[e]===d){var f;this._firstLevel=e;const t=d.bitrate,r=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${l.length} level(s) found, first bitrate: ${t}`),void 0===(null==(f=this.hls.userConfig)?void 0:f.abrEwmaDefaultEstimate)){const e=Math.min(t,this.hls.config.abrEwmaDefaultEstimateMax);e>r&&r===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=e)}break}const h=i&&!n,g=this.hls.config,p=!(!g.audioStreamController||!g.audioTrackController),m={levels:l,audioTracks:s,subtitleTracks:o,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:i,video:n,altAudio:p&&!h&&s.some(e=>!!e.url)};u.end=performance.now(),this.hls.trigger(It.MANIFEST_PARSED,m)}get levels(){return 0===this._levels.length?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(0===t.length)return;if(e<0||e>=t.length){const r=new Error("invalid level idx"),n=e<0;if(this.hls.trigger(It.ERROR,{type:bt.OTHER_ERROR,details:At.LEVEL_SWITCH_ERROR,level:e,fatal:n,error:r,reason:r.message}),n)return;e=Math.min(e,t.length-1)}const r=this.currentLevelIndex,n=this.currentLevel,i=n?n.attrs["PATHWAY-ID"]:void 0,a=t[e],s=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,r===e&&n&&i===s)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${s?" with Pathway "+s:""} from level ${r}${i?" with Pathway "+i:""}`);const o={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(It.LEVEL_SWITCHING,o);const l=a.details;if(!l||l.live){const e=this.switchParams(a.uri,null==n?void 0:n.details,l);this.loadPlaylist(e)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(void 0===this._startLevel){const e=this.hls.config.startLevel;return void 0!==e?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),r=e.filter(e=>-1!==t.indexOf(e));if(e.length<1)return void this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);this.steering.pathwayPriority=r}}onError(e,t){!t.fatal&&t.context&&t.context.type===wt&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(void 0!==t&&t.type===Ct){const e=t.elementaryStreams;if(!Object.keys(e).some(t=>!!e[t]))return;const r=this._levels[t.level];null!=r&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var r;const{level:n,details:i}=t,a=t.levelInfo;var s;if(!a)return this.warn(`Invalid level index ${n}`),void(null!=(s=t.deliveryDirectives)&&s.skip&&(i.deltaUpdateFailed=!0));if(a===this.currentLevel||t.withoutMultiVariant){0===a.fragmentError&&(a.loadError=0);let e=a.details;e===t.details&&e.advanced&&(e=void 0),this.playlistLoaded(n,t,e)}else null!=(r=t.deliveryDirectives)&&r.skip&&(i.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const r=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,i=e.attrs["PATHWAY-ID"],a=e.details,s=null==a?void 0:a.age;this.log(`Loading level index ${n}${void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:""}${i?" Pathway "+i:""}${s&&a.live?" age "+s.toFixed(1)+(a.type&&" "+a.type||""):""} ${r}`),this.hls.trigger(It.LEVEL_LOADING,{url:r,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(1===this._levels.length)return;const r=this._levels.filter((t,r)=>r!==e||(this.steering&&this.steering.removeLevel(t),t===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,t.details&&t.details.fragments.forEach(e=>e.level=-1)),!1));La(r),this._levels=r,this.currentLevelIndex>-1&&null!=(t=this.currentLevel)&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=r.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(It.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(It.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}}function Ac(e){const t={};e.forEach(e=>{const r=e.groupId||"";e.id=t[r]=t[r]||0,t[r]++})}function Ic(){return self.SourceBuffer||self.WebKitSourceBuffer}function Rc(){if(!qt())return!1;const e=Ic();return!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove}class wc extends Qa{constructor(e,t,r){super(e,t,r,"stream-controller",Ct),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const e=this.media,t=e?e.currentTime:null;if(null===t||!Tt(t))return;if(this.log(`Media seeked to ${t.toFixed(3)}`),!this.getBufferedFrag(t))return;const r=this.getFwdBufferInfoAtPos(e,t,Ct,0);null!==r&&0!==r.len?this.tick():this.warn(`Main forward buffer length at ${t} on "seeked" event ${r?r.len:"empty"})`)},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(It.MANIFEST_PARSED,this.onManifestParsed,this),e.on(It.LEVEL_LOADING,this.onLevelLoading,this),e.on(It.LEVEL_LOADED,this.onLevelLoaded,this),e.on(It.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(It.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(It.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(It.BUFFER_CREATED,this.onBufferCreated,this),e.on(It.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(It.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(It.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(It.MANIFEST_PARSED,this.onManifestParsed,this),e.off(It.LEVEL_LOADED,this.onLevelLoaded,this),e.off(It.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(It.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(It.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(It.BUFFER_CREATED,this.onBufferCreated,this),e.off(It.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(It.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(It.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:r,hls:n}=this;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){let e=n.startLevel;-1===e&&(n.config.testBandwidth&&this.levels.length>1?(e=0,this.bitrateTest=!0):e=n.firstAutoLevel),n.nextLoadLevel=e,this.level=n.loadLevel,this._hasEnoughToStart=!!t}r>0&&-1===e&&!t&&(this.log(`Override startPosition with lastCurrentTime @${r.toFixed(3)}`),e=r),this.state=Ga,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Za}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Xa:{const{levels:e,level:t}=this,r=null==e?void 0:e[t],n=null==r?void 0:r.details;if(n&&(!n.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(n))break;this.state=Ga;break}if(this.hls.nextLoadLevel!==this.level){this.state=Ga;break}break}case Va:this.checkRetryDate()}this.state===Ga&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),null!=(e=this.media)&&e.readyState&&!1===this.media.seeking&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:r,media:n}=this;if(null===t||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch))return;if(this.altAudio&&this.audioOnly)return;const i=this.buffering?e.nextLoadLevel:e.loadLevel;if(null==r||!r[i])return;const a=r[i],s=this.getMainFwdBufferInfo();if(null===s)return;const o=this.getLevelDetails();if(o&&this._streamEnded(s,o)){const e={};return 2===this.altAudio&&(e.type="video"),this.hls.trigger(It.BUFFER_EOS,e),void(this.state=ja)}if(!this.buffering)return;e.loadLevel!==i&&-1===e.manualLevel&&this.log(`Adapting to level ${i} from level ${this.level}`),this.level=e.nextLoadLevel=i;const l=a.details;if(!l||this.state===Xa||this.waitForLive(a))return this.level=i,this.state=Xa,void(this.startFragRequested=!1);const u=s.len,c=this.getMaxBufferLength(a.maxBitrate);if(u>=c)return;this.backtrackFragment&&this.backtrackFragment.start>s.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:s.end;let f=this.getNextFragment(d,l);if(this.couldBacktrack&&!this.fragPrevious&&f&&dr(f)&&this.fragmentTracker.getState(f)!==ti){var h;const e=(null!=(h=this.backtrackFragment)?h:f).sn-l.startSN,t=l.fragments[e-1];t&&f.cc===t.cc&&(f=t,this.fragmentTracker.removeFragment(t))}else this.backtrackFragment&&s.len&&(this.backtrackFragment=null);if(f&&this.isLoopLoading(f,d)){if(!f.gap){const e=this.audioOnly&&!this.altAudio?or:lr,t=(e===lr?this.videoBuffer:this.mediaBuffer)||this.media;t&&this.afterBufferFlushed(t,e,Ct)}f=this.getNextFragmentLoopLoading(f,l,s,Ct,c)}f&&(!f.initSegment||f.initSegment.data||this.bitrateTest||(f=f.initSegment),this.loadFragment(f,a,d))}loadFragment(e,t,r){const n=this.fragmentTracker.getState(e);n===Qn||n===ei?dr(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,r):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Ct)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(null!=t&&t.readyState){let r;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const i=this.getLevelDetails();if(null!=i&&i.live){const e=this.getMainFwdBufferInfo();if(!e||e.len<2*i.targetduration)return}if(!t.paused&&e){const t=e[this.hls.nextLoadLevel],n=this.fragLastKbps;r=n&&this.fragCurrent?this.fragCurrent.duration*t.maxBitrate/(1e3*n)+1:0}else r=0;const a=this.getBufferedFrag(t.currentTime+r);if(a){const e=this.followingBufferedFrag(a);if(e){this.abortCurrentFrag();const t=e.maxStartPTS?e.maxStartPTS:e.start,r=e.duration,n=Math.max(a.end,t+Math.min(Math.max(r-this.config.maxFragLookUpTolerance,r*(this.couldBacktrack?.5:.125)),r*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(n,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Ha:case $a:case Va:case qa:case Ya:this.state=Ga}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,2===this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const r=t.media;Fa(r,"playing",this.onMediaPlaying),Fa(r,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:r}=this;r&&(Ba(r,"playing",this.onMediaPlaying),Ba(r,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t);!!t.transferMedia||(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(It.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let r=!1,n=!1;for(let e=0;e<t.levels.length;e++){const i=t.levels[e].audioCodec;i&&(r=r||-1!==i.indexOf("mp4a.40.2"),n=n||-1!==i.indexOf("mp4a.40.5"))}this.audioCodecSwitch=r&&n&&!function(){var e;const t=Ic();return"function"==typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:r}=this;if(!r||this.state!==Ga)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=Xa)}onLevelLoaded(e,t){var r;const{levels:n,startFragRequested:i}=this,a=t.level,s=t.details,o=s.totalduration;if(!n)return void this.warn(`Levels were reset while loading level ${a}`);this.log(`Level ${a} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""}, cc [${s.startCC}, ${s.endCC}] duration:${o}`);const l=t.levelInfo,u=this.fragCurrent;!u||this.state!==$a&&this.state!==Va||u.level!==t.level&&u.loader&&this.abortCurrentFrag();let c=0;if(s.live||null!=(r=l.details)&&r.live){var d;if(this.checkLiveUpdate(s),s.deltaUpdateFailed)return;c=this.alignPlaylists(s,l.details,null==(d=this.levelLastLoaded)?void 0:d.details)}if(l.details=s,this.levelLastLoaded=l,i||this.setStartPosition(s,c),this.hls.trigger(It.LEVEL_UPDATED,{details:s,level:a}),this.state===Xa){if(this.waitForCdnTuneIn(s))return;this.state=Ga}i&&s.live&&this.synchronizeToLiveEdge(s),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:r}=this;if(!r)return;const n=this.hls.liveSyncPosition,i=this.getLoadPosition(),a=e.fragmentStart,s=e.edge,o=i>=a-t.maxFragLookUpTolerance&&i<=s;if(null!==n&&r.duration>n&&(i<n||!o)){const a=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!o&&r.readyState<4||i<s-a)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),r.readyState))if(this.warn(`Playback: ${i.toFixed(3)} is located too far from the end of live sliding playlist: ${s}, reset currentTime to : ${n.toFixed(3)}`),"buffered"===this.config.liveSyncMode){var l;const e=Ti.bufferInfo(r,n,0);if(null==(l=e.buffered)||!l.length)return void(r.currentTime=n);if(e.start<=i)return void(r.currentTime=n);const{nextStart:t}=Ti.bufferedInfo(e.buffered,i,0);t&&(r.currentTime=t)}else r.currentTime=n}}_handleFragmentLoadProgress(e){var t;const r=e.frag,{part:n,payload:i}=e,{levels:a}=this;if(!a)return void this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);const s=a[r.level];if(!s)return void this.warn(`Level ${r.level} not found on progress`);const o=s.details;if(!o)return this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),void this.fragmentTracker.removeFragment(r);const l=s.videoCodec,u=o.PTSKnown||!o.live,c=null==(t=r.initSegment)?void 0:t.data,d=this._getAudioCodec(s),f=this.transmuxer=this.transmuxer||new Co(this.hls,Ct,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),h=n?n.index:-1,g=-1!==h,p=new yi(r.level,r.sn,r.stats.chunkCount,i.byteLength,h,g),m=this.initPTS[r.cc];f.push(i,c,d,l,r,n,o.totalduration,u,p,m)}onAudioTrackSwitching(e,t){const r=this.hls,n=2===this.altAudio;if(Ln(t.url,r))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const e=this.fragCurrent;e&&(this.log("Switching to main audio track, cancel main fragment load"),e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n)return this.fragmentTracker.removeAllFragments(),r.once(It.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(It.AUDIO_TRACK_SWITCHED,t)}),void r.trigger(It.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});r.trigger(It.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const r=Ln(t.url,this.hls);if(r){const e=this.videoBuffer;e&&this.mediaBuffer!==e&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=e)}this.altAudio=r?2:0,this.tick()}onBufferCreated(e,t){const r=t.tracks;let n,i,a=!1;for(const e in r){const t=r[e];if("main"===t.id){if(i=e,n=t,"video"===e){const t=r[e];t&&(this.videoBuffer=t.buffer)}}else a=!0}a&&n?(this.log(`Alternate track found, use ${i}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:r,part:n}=t,i=r.type===Ct;if(i){if(this.fragContextChanged(r))return this.warn(`Fragment ${r.sn}${n?" p: "+n.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),void(this.state===Ya&&(this.state=Ga));const e=n?n.stats:r.stats;this.fragLastKbps=Math.round(8*e.total/(e.buffering.end-e.loading.first)),dr(r)&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}const a=this.media;a&&(!this._hasEnoughToStart&&Ti.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),i&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var r;if(t.fatal)this.state=za;else switch(t.details){case At.FRAG_GAP:case At.FRAG_PARSING_ERROR:case At.FRAG_DECRYPT_ERROR:case At.FRAG_LOAD_ERROR:case At.FRAG_LOAD_TIMEOUT:case At.KEY_LOAD_ERROR:case At.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ct,t);break;case At.LEVEL_LOAD_ERROR:case At.LEVEL_LOAD_TIMEOUT:case At.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Xa||(null==(r=t.context)?void 0:r.type)!==wt||(this.state=Ga);break;case At.BUFFER_ADD_CODEC_ERROR:case At.BUFFER_APPEND_ERROR:if("main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case At.BUFFER_FULL_ERROR:if("main"!==t.parent)return;if(this.reduceLengthAndFlushBuffer(t)){!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}break;case At.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}}onFragLoadEmergencyAborted(){this.state=Ga,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==or||!this.altAudio){const e=(t===lr?this.videoBuffer:this.mediaBuffer)||this.media;e&&(this.afterBufferFlushed(e,t,Ct),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,-1===this.level&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let r=this.startPosition;if(r>=0&&t<r){if(e.seeking)return void this.log(`could not seek to ${r}, already seeking at ${t}`);const n=this.timelineOffset;n&&r&&(r+=n);const i=this.getLevelDetails(),a=Ti.getBuffered(e),s=a.length?a.start(0):0,o=s-r,l=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||o>0&&(o<l||this.loadingParts&&o<2*((null==i?void 0:i.partTarget)||0)))&&(this.log(`adjusting start position by ${o} to match buffer start`),r+=o,this.startPosition=r),t<r&&(this.log(`seek to target start position ${r} from current time ${t} buffer start ${s}`),e.currentTime=r)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(e=>{const{hls:r}=this,n=null==e?void 0:e.frag;if(!n||this.fragContextChanged(n))return;t.fragmentError=0,this.state=Ga,this.startFragRequested=!1,this.bitrateTest=!1;const i=n.stats;i.parsing.start=i.parsing.end=i.buffering.start=i.buffering.end=self.performance.now(),r.trigger(It.FRAG_LOADED,e),n.bitrateTest=!1}).catch(t=>{this.state!==Za&&this.state!==za&&(this.warn(t),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:r}=this,{remuxResult:n,chunkMeta:i}=e,a=this.getCurrentContext(i);if(!a)return void this.resetWhenMissingContext(i);const{frag:s,part:o,level:l}=a,{video:u,text:c,id3:d,initSegment:f}=n,{details:h}=l,g=this.altAudio?void 0:n.audio;if(this.fragContextChanged(s))this.fragmentTracker.removeFragment(s);else{if(this.state=qa,f){const e=f.tracks;if(e){const n=s.initSegment||s;if(this.unhandledEncryptionError(f,s))return;this._bufferInitSegment(l,e,n,i),r.trigger(It.FRAG_PARSING_INIT_SEGMENT,{frag:n,id:t,tracks:e})}const n=f.initPTS,a=f.timescale,o=this.initPTS[s.cc];if(Tt(n)&&(!o||o.baseTime!==n||o.timescale!==a)){const e=f.trackId;this.initPTS[s.cc]={baseTime:n,timescale:a,trackId:e},r.trigger(It.INIT_PTS_FOUND,{frag:s,id:t,initPTS:n,timescale:a,trackId:e})}}if(u&&h){g&&"audiovideo"===u.type&&this.logMuxedErr(s);const e=h.fragments[s.sn-1-h.startSN],t=s.sn===h.startSN,r=!e||s.cc>e.cc;if(!1!==n.independent){const{startPTS:e,endPTS:n,startDTS:a,endDTS:l}=u;if(o)o.elementaryStreams[u.type]={startPTS:e,endPTS:n,startDTS:a,endDTS:l};else if(u.firstKeyFrame&&u.independent&&1===i.id&&!r&&(this.couldBacktrack=!0),u.dropped&&u.independent){const i=this.getMainFwdBufferInfo(),a=(i?i.end:this.getLoadPosition())+this.config.maxBufferHole,o=u.firstKeyFramePTS?u.firstKeyFramePTS:e;if(!t&&a<o-this.config.maxBufferHole&&!r)return void this.backtrack(s);r&&(s.gap=!0),s.setElementaryStreamInfo(u.type,s.start,n,s.start,l,!0)}else t&&e-(h.appliedTimelineOffset||0)>2&&(s.gap=!0);s.setElementaryStreamInfo(u.type,e,n,a,l),this.backtrackFragment&&(this.backtrackFragment=s),this.bufferFragmentData(u,s,o,i,t||r)}else{if(!t&&!r)return void this.backtrack(s);s.gap=!0}}if(g){const{startPTS:e,endPTS:t,startDTS:r,endDTS:n}=g;o&&(o.elementaryStreams[or]={startPTS:e,endPTS:t,startDTS:r,endDTS:n}),s.setElementaryStreamInfo(or,e,t,r,n),this.bufferFragmentData(g,s,o,i)}if(h&&null!=d&&d.samples.length){const e={id:t,frag:s,details:h,samples:d.samples};r.trigger(It.FRAG_PARSING_METADATA,e)}if(h&&c){const e={id:t,frag:s,details:h,samples:c.samples};r.trigger(It.FRAG_PARSING_USERDATA,e)}}}logMuxedErr(e){this.warn(`${dr(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,r,n){if(this.state!==qa)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(r));const{audio:i,video:a,audiovideo:s}=t;if(i){const r=e.audioCodec;let n=Qr(i.codec,r);"mp4a"===n&&(n="mp4a.40.5");const a=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){n&&(n=-1!==n.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5");const e=i.metadata;e&&"channelCount"in e&&1!==(e.channelCount||1)&&-1===a.indexOf("firefox")&&(n="mp4a.40.5")}n&&-1!==n.indexOf("mp4a.40.5")&&-1!==a.indexOf("android")&&"audio/mpeg"!==i.container&&(n="mp4a.40.2",this.log(`Android: force audio codec to ${n}`)),r&&r!==n&&this.log(`Swapping manifest audio codec "${r}" for "${n}"`),i.levelCodec=n,i.id=Ct,this.log(`Init audio buffer, container:${i.container}, codecs[selected/level/parsed]=[${n||""}/${r||""}/${i.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=Ct;const r=a.codec;if(4===(null==r?void 0:r.length))switch(r){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e"}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${r}]${a.codec!==r?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}s&&(this.log(`Init audiovideo buffer, container:${s.container}, codecs[level/parsed]=[${e.codecs}/${s.codec}]`),delete t.video,delete t.audio);const o=Object.keys(t);if(o.length){if(this.hls.trigger(It.BUFFER_CODECS,t),!this.hls)return;o.forEach(e=>{const i=t[e].initSegment;null!=i&&i.byteLength&&this.hls.trigger(It.BUFFER_APPENDING,{type:e,data:i,frag:r,part:null,chunkMeta:n,parent:r.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&2===this.altAudio?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,Ct)}get maxBufferLength(){const{levels:e,level:t}=this,r=null==e?void 0:e[t];return r?this.getMaxBufferLength(r.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Ga}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&!1===e.seeking){const r=e.currentTime;if(Ti.isBuffered(e,r)?t=this.getAppendedFrag(r):Ti.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;const e=this.fragPlaying,r=t.level;e&&t.sn===e.sn&&e.level===r||(this.fragPlaying=t,this.hls.trigger(It.FRAG_CHANGED,{frag:t}),e&&e.level===r||this.hls.trigger(It.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;return Tt(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=(null==(e=this.media)?void 0:e.currentTime)||this.lastCurrentTime;if(Tt(t)){const e=this.getLevelDetails(),r=this.currentFrag||(e?Nn(null,e.fragments,t):null);if(r){const e=r.programDateTime;if(null!==e){const n=e+1e3*(t-r.start);return new Date(n)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class Dc extends Ut{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const r in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[r].loader;if(n){var t;if(e&&e!==(null==(t=n.context)?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=At.KEY_LOAD_ERROR,r,n,i){return new mi({type:bt.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:i,error:r,networkDetails:n})}loadClear(e,t,r){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let n=0,i=t.length;n<i;n++){const a=t[n];if(e.cc<=a.cc&&(!dr(e)||!dr(a)||e.sn<a.sn)||!r&&n==i-1)return this.emeController.selectKeySystemFormat(a).then(e=>{if(!this.emeController)return;a.setKeyFormat(e);const t=Yi(e);return t?this.emeController.getKeySystemAccess([t]):void 0})}if(this.config.requireKeySystemAccessOnStart){const e=zi(this.config);if(e.length)return this.emeController.getKeySystemAccess(e)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,n;t&&e.setKeyFormat(t);const i=e.decryptdata;if(!i){const r=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,At.KEY_LOAD_ERROR,r))}const a=i.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,At.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const s=Lc(i);let o=this.keyIdToKeyInfo[s];if(null!=(r=o)&&r.decryptdata.key)return i.key=o.decryptdata.key,Promise.resolve({frag:e,keyInfo:o});if(this.emeController&&null!=(n=o)&&n.keyLoadPromise){switch(this.emeController.getKeyStatus(o.decryptdata)){case"usable":case"usable-in-future":return o.keyLoadPromise.then(t=>{const{keyInfo:r}=t;return i.key=r.decryptdata.key,{frag:e,keyInfo:r}})}}switch(this.log(`${this.keyIdToKeyInfo[s]?"Rel":"L"}oading${i.keyId?" keyId: "+zt(i.keyId):""} URI: ${i.uri} from ${e.type} ${e.level}`),o=this.keyIdToKeyInfo[s]={decryptdata:i,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},i.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===i.keyFormat?this.loadKeyHTTP(o,e):this.loadKeyEME(o,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(o,e);default:return Promise.reject(this.createKeyLoadError(e,At.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${i.method}"`)))}}loadKeyEME(e,t){const r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n;if(!e.decryptdata.keyId&&null!=(n=t.initSegment)&&n.data){const r=function(e){const t=[];return Nr(e,e=>t.push(e.subarray(8,24))),t}(t.initSegment.data);if(r.length){const t=r[0];t.some(e=>0!==e)&&(this.log(`Using keyId found in init segment ${zt(t)}`),e.decryptdata.keyId=t,ea.setKeyIdForUri(e.decryptdata.uri,t))}}const i=this.emeController.loadKey(r);return(e.keyLoadPromise=i.then(t=>(e.mediaKeySessionContext=t,r))).catch(r=>{throw e.keyLoadPromise=null,"data"in r&&(r.data.frag=t),r})}return Promise.resolve(r)}loadKeyHTTP(e,t){const r=this.config,n=new(0,r.loader)(r);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise((i,a)=>{const s={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},o=r.keyLoadPolicy.default,l={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:(e,t,r,n)=>{const{frag:s,keyInfo:o}=r,l=Lc(o.decryptdata);if(!s.decryptdata||o!==this.keyIdToKeyInfo[l])return a(this.createKeyLoadError(s,At.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),n));o.decryptdata.key=s.decryptdata.key=new Uint8Array(e.data),s.keyLoader=null,o.loader=null,i({frag:s,keyInfo:o})},onError:(e,r,n,i)=>{this.resetLoader(r),a(this.createKeyLoadError(t,At.KEY_LOAD_ERROR,new Error(`HTTP Error ${e.code} loading key ${e.text}`),n,Bt({url:s.url,data:void 0},e)))},onTimeout:(e,r,n)=>{this.resetLoader(r),a(this.createKeyLoadError(t,At.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),n))},onAbort:(e,r,n)=>{this.resetLoader(r),a(this.createKeyLoadError(t,At.INTERNAL_ABORTED,new Error("key loading aborted"),n))}};n.load(s,l,u)})}resetLoader(e){const{frag:t,keyInfo:r,url:n}=e,i=r.loader;t.keyLoader===i&&(t.keyLoader=null,r.loader=null);const a=Lc(r.decryptdata)||n;delete this.keyIdToKeyInfo[a],i&&i.destroy()}}function Lc(e){if(e.keyFormat!==Vi){const t=e.keyId;if(t)return zt(t)}return e.uri}function Cc(e){const{type:t}=e;switch(t){case Dt:return Nt;case Lt:return Pt;default:return Ct}}function Nc(e,t){let r=e.url;return void 0!==r&&0!==r.indexOf("data:")||(r=t.url),r}class Pc{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(It.MANIFEST_LOADING,this.onManifestLoading,this),e.on(It.LEVEL_LOADING,this.onLevelLoading,this),e.on(It.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(It.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(It.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(It.MANIFEST_LOADING,this.onManifestLoading,this),e.off(It.LEVEL_LOADING,this.onLevelLoading,this),e.off(It.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(It.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(It.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,r=t.pLoader,n=t.loader,i=new(r||n)(t);return this.loaders[e.type]=i,i}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Rt,url:r,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:r,level:n,pathwayId:i,url:a,deliveryDirectives:s,levelInfo:o}=t;this.load({id:r,level:n,pathwayId:i,responseType:"text",type:wt,url:a,deliveryDirectives:s,levelOrTrack:o})}onAudioTrackLoading(e,t){const{id:r,groupId:n,url:i,deliveryDirectives:a,track:s}=t;this.load({id:r,groupId:n,level:null,responseType:"text",type:Dt,url:i,deliveryDirectives:a,levelOrTrack:s})}onSubtitleTrackLoading(e,t){const{id:r,groupId:n,url:i,deliveryDirectives:a,track:s}=t;this.load({id:r,groupId:n,level:null,responseType:"text",type:Lt,url:i,deliveryDirectives:a,levelOrTrack:s})}onLevelsUpdated(e,t){const r=this.loaders[wt];if(r){const e=r.context;e&&!t.levels.some(t=>t===e.levelOrTrack)&&(r.abort(),delete this.loaders[wt])}}load(e){var t;const r=this.hls.config;let n,i=this.getInternalLoader(e);if(i){const t=this.hls.logger,r=i.context;if(r&&r.levelOrTrack===e.levelOrTrack&&(r.url===e.url||r.deliveryDirectives&&!e.deliveryDirectives))return void(r.url===e.url?t.log(`[playlist-loader]: ignore ${e.url} ongoing request`):t.log(`[playlist-loader]: ignore ${e.url} in favor of ${r.url}`));t.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}if(n=e.type===Rt?r.manifestLoadPolicy.default:xt({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),Tt(null==(t=e.deliveryDirectives)?void 0:t.part)){let t;if(e.type===wt&&null!==e.level?t=this.hls.levels[e.level].details:e.type===Dt&&null!==e.id?t=this.hls.audioTracks[e.id].details:e.type===Lt&&null!==e.id&&(t=this.hls.subtitleTracks[e.id].details),t){const e=t.partTarget,r=t.targetduration;if(e&&r){const t=1e3*Math.max(3*e,.8*r);n=xt({},n,{maxTimeToFirstByteMs:Math.min(t,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(t,n.maxTimeToFirstByteMs)})}}}const a=n.errorRetry||n.timeoutRetry||{},s={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},o={onSuccess:(e,t,r,n)=>{const i=this.getInternalLoader(r);this.resetInternalLoader(r.type);const a=e.data;t.parsing.start=performance.now(),oa.isMediaPlaylist(a)||r.type!==Rt?this.handleTrackOrLevelPlaylist(e,t,r,n||null,i):this.handleMasterPlaylist(e,t,r,n)},onError:(e,t,r,n)=>{this.handleNetworkError(t,r,!1,e,n)},onTimeout:(e,t,r)=>{this.handleNetworkError(t,r,!0,void 0,e)}};i.load(e,s,o)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:r}=this.hls;(e||r)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,r,n){const i=this.hls,a=e.data,s=Nc(e,r),o=oa.parseMasterPlaylist(a,s);if(o.playlistParsingError)return t.parsing.end=performance.now(),void this.handleManifestParsingError(e,r,o.playlistParsingError,n,t);const{contentSteering:l,levels:u,sessionData:c,sessionKeys:d,startTimeOffset:f,variableList:h}=o;this.variableList=h,u.forEach(e=>{const{unknownCodecs:t}=e;if(t){const{preferManagedMediaSource:r}=this.hls.config;let{audioCodec:n,videoCodec:i}=e;for(let a=t.length;a--;){const s=t[a];Vr(s,"audio",r)?(e.audioCodec=n=n?`${n},${s}`:s,Hr.audio[n.substring(0,4)]=2,t.splice(a,1)):Vr(s,"video",r)&&(e.videoCodec=i=i?`${i},${s}`:s,Hr.video[i.substring(0,4)]=2,t.splice(a,1))}}});const{AUDIO:g=[],SUBTITLES:p,"CLOSED-CAPTIONS":m}=oa.parseMasterPlaylistMedia(a,s,o);if(g.length){g.some(e=>!e.url)||!u[0].audioCodec||u[0].attrs.AUDIO||(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),g.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Di({}),bitrate:0,url:""}))}i.trigger(It.MANIFEST_LOADED,{levels:u,audioTracks:g,subtitles:p,captions:m,contentSteering:l,url:s,stats:t,networkDetails:n,sessionData:c,sessionKeys:d,startTimeOffset:f,variableList:h})}handleTrackOrLevelPlaylist(e,t,r,n,i){const a=this.hls,{id:s,level:o,type:l}=r,u=Nc(e,r),c=Tt(o)?o:Tt(s)?s:0,d=Cc(r),f=oa.parseLevelPlaylist(e.data,u,c,d,0,this.variableList);if(l===Rt){const e={attrs:new Di({}),bitrate:0,details:f,name:"",url:u};f.requestScheduled=t.loading.start+Ia(f,0),a.trigger(It.MANIFEST_LOADED,{levels:[e],audioTracks:[],url:u,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=f,this.handlePlaylistLoaded(f,e,t,r,n,i)}handleManifestParsingError(e,t,r,n,i){this.hls.trigger(It.ERROR,{type:bt.NETWORK_ERROR,details:At.MANIFEST_PARSING_ERROR,fatal:t.type===Rt,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:n,stats:i})}handleNetworkError(e,t,r=!1,n,i){let a=`A network ${r?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===wt?a+=`: ${e.level} id: ${e.id}`:e.type!==Dt&&e.type!==Lt||(a+=` id: ${e.id} group-id: "${e.groupId}"`);const s=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let o=At.UNKNOWN,l=!1;const u=this.getInternalLoader(e);switch(e.type){case Rt:o=r?At.MANIFEST_LOAD_TIMEOUT:At.MANIFEST_LOAD_ERROR,l=!0;break;case wt:o=r?At.LEVEL_LOAD_TIMEOUT:At.LEVEL_LOAD_ERROR,l=!1;break;case Dt:o=r?At.AUDIO_TRACK_LOAD_TIMEOUT:At.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case Lt:o=r?At.SUBTITLE_TRACK_LOAD_TIMEOUT:At.SUBTITLE_LOAD_ERROR,l=!1}u&&this.resetInternalLoader(e.type);const c={type:bt.NETWORK_ERROR,details:o,fatal:l,url:e.url,loader:u,context:e,error:s,networkDetails:t,stats:i};if(n){const r=(null==t?void 0:t.url)||e.url;c.response=Bt({url:r,data:void 0},n)}this.hls.trigger(It.ERROR,c)}handlePlaylistLoaded(e,t,r,n,i,a){const s=this.hls,{type:o,level:l,levelOrTrack:u,id:c,groupId:d,deliveryDirectives:f}=n,h=Nc(t,n),g=Cc(n);let p="number"==typeof n.level&&g===Ct?l:void 0;const m=e.playlistParsingError;if(m){if(this.hls.logger.warn(`${m} ${e.url}`),!s.config.ignorePlaylistParsingErrors)return void s.trigger(It.ERROR,{type:bt.NETWORK_ERROR,details:At.LEVEL_PARSING_ERROR,fatal:!1,url:h,error:m,reason:m.message,response:t,context:n,level:p,parent:g,networkDetails:i,stats:r});e.playlistParsingError=null}if(!e.fragments.length){const a=e.playlistParsingError=new Error("No Segments found in Playlist");return void s.trigger(It.ERROR,{type:bt.NETWORK_ERROR,details:At.LEVEL_EMPTY_ERROR,fatal:!1,url:h,error:a,reason:a.message,response:t,context:n,level:p,parent:g,networkDetails:i,stats:r})}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),a.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case Rt:case wt:if(p)if(u){if(u!==s.levels[p]){const e=s.levels.indexOf(u);e>-1&&(p=e)}}else p=0;s.trigger(It.LEVEL_LOADED,{details:e,levelInfo:u||s.levels[0],level:p||0,id:c||0,stats:r,networkDetails:i,deliveryDirectives:f,withoutMultiVariant:o===Rt});break;case Dt:s.trigger(It.AUDIO_TRACK_LOADED,{details:e,track:u,id:c||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:f});break;case Lt:s.trigger(It.SUBTITLE_TRACK_LOADED,{details:e,track:u,id:c||0,groupId:d||"",stats:r,networkDetails:i,deliveryDirectives:f})}}}class Oc{static get version(){return as}static isMSESupported(){return Rc()}static isSupported(){return function(){if(!Rc())return!1;const e=qt();return"function"==typeof(null==e?void 0:e.isTypeSupported)&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(qr(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(qr(t,"audio"))))}()}static getMediaSource(){return qt()}static get Events(){return It}static get MetadataSchema(){return Ds}static get ErrorTypes(){return bt}static get ErrorDetails(){return At}static get DefaultConfig(){return Oc.defaultConfig?Oc.defaultConfig:dc}static set DefaultConfig(e){Oc.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new is,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=function(e,t,r){const n=Ht();if("object"==typeof console&&!0===e||"object"==typeof e){const i=["debug","log","info","warn","error"];i.forEach(t=>{n[t]=$t(t,e,r)});try{n.log(`Debug logs enabled for "${t}" in hls.js version 1.6.14`)}catch(e){return Ht()}i.forEach(t=>{Vt[t]=$t(t,e)})}else xt(Vt,n);return n}(e.debug||!1,"Hls instance",e.assetPlayerId),r=this.config=function(e,t,r){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=fc(e),i=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return["manifest","level","frag"].forEach(e=>{const a=`${"level"===e?"playlist":e}LoadPolicy`,s=void 0===t[a],o=[];i.forEach(r=>{const i=`${e}Loading${r}`,l=t[i];if(void 0!==l&&s){o.push(i);const e=n[a].default;switch(t[a]={default:e},r){case"TimeOut":e.maxLoadTimeMs=l,e.maxTimeToFirstByteMs=l;break;case"MaxRetry":e.errorRetry.maxNumRetry=l,e.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":e.errorRetry.retryDelayMs=l,e.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":e.errorRetry.maxRetryDelayMs=l,e.timeoutRetry.maxRetryDelayMs=l}}}),o.length&&r.warn(`hls.js config: "${o.join('", "')}" setting(s) are deprecated, use "${a}": ${_n(t[a])}`)}),Bt(Bt({},n),t)}(Oc.DefaultConfig,e,t);this.userConfig=e,r.progressive&&hc(r,t);const{abrController:n,bufferController:i,capLevelController:a,errorController:s,fpsController:o}=r,l=new s(this),u=this.abrController=new n(this),c=new ri(this),d=r.interstitialsController,f=d?this.interstitialsController=new d(this,Oc):null,h=this.bufferController=new i(this,c),g=this.capLevelController=new a(this),p=new o(this),m=new Pc(this),v=r.contentSteeringController,y=v?new v(this):null,E=this.levelController=new bc(this,y),T=new _c(this),_=new Dc(this.config,this.logger),S=this.streamController=new wc(this,c,_),b=this.gapController=new gc(this,c);g.setStreamController(S),p.setStreamController(S);const A=[m,E,S];f&&A.splice(1,0,f),y&&A.splice(1,0,y),this.networkControllers=A;const I=[u,h,b,g,p,T,c];this.audioTrackController=this.createController(r.audioTrackController,A);const R=r.audioStreamController;R&&A.push(this.audioStreamController=new R(this,c,_)),this.subtitleTrackController=this.createController(r.subtitleTrackController,A);const w=r.subtitleStreamController;w&&A.push(this.subtititleStreamController=new w(this,c,_)),this.createController(r.timelineController,I),_.emeController=this.emeController=this.createController(r.emeController,I),this.cmcdController=this.createController(r.cmcdController,I),this.latencyController=this.createController(Sc,I),this.coreComponents=I,A.push(l);const D=l.onErrorOut;"function"==typeof D&&this.on(It.ERROR,D,l),this.on(It.MANIFEST_LOADED,m.onManifestLoaded,m)}createController(e,t){if(e){const r=new e(this);return t&&t.push(r),r}return null}on(e,t,r=this){this._emitter.on(e,t,r)}once(e,t,r=this){this._emitter.once(e,t,r)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,r=this,n){this._emitter.off(e,t,r,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,r){return this._emitter.emit(e,t,r)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(t){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),!this.triggeringException){this.triggeringException=!0;const r=e===It.ERROR;this.trigger(It.ERROR,{type:bt.OTHER_ERROR,details:At.INTERNAL_EXCEPTION,fatal:r,event:e,error:t}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(It.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const t=new Error(`attachMedia failed: invalid argument (${e})`);return void this.trigger(It.ERROR,{type:bt.OTHER_ERROR,details:At.ATTACH_MEDIA_ERROR,fatal:!0,error:t})}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,r=t?e.media:e,n=t?e:{media:r};this._media=r,this.trigger(It.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(It.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(It.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,r=this._url,n=this._url=ar.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),t&&r&&(r!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(It.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let r=0;r<this.networkControllers.length&&(this.networkControllers[r].startLoad(e,t),this.started&&this.networkControllers);r++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!this.started&&this.networkControllers);e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[Ct]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[Nt]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[Pt]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=null==e?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=function(){try{return crypto.randomUUID()}catch(e){try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch(e){let t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)})}}}()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return-1===e&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){(function(e){return dn.indexOf(e)>-1})(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return-1===this.levelController.manualLevel}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const r=e.length;for(let n=0;n<r;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:r}=this;let n;if(n=-1===t&&null!=e&&e.length?e.length-1:t,r)for(let t=n;t--;){const n=e[t].attrs["HDCP-LEVEL"];if(n&&n<=r)return t}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return(null==(t=this.audioTrackController)?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return(null==(t=this.subtitleTrackController)?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return!!e&&e.subtitleDisplay}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!(null==(e=this.bufferController)||!e.bufferedToEnd)}get interstitialsManager(){var e;return(null==(e=this.interstitialsController)?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){return ln(e,bn(t),navigator.mediaCapabilities)}}function Mc(e){return e?e>=2160?"4K":e>=1440?"1440p":e>=1080?"1080p":e>=720?"720p":e>=540?"540p":e>=480?"480p":e>=360?"360p":e>=240?"240p":`${e}p`:null}Oc.defaultConfig=void 0;var kc,xc={exports:{}};
/*! For license information please see dash.all.min.js.LICENSE.txt */var Fc=(kc||(kc=1,self,xc.exports=function(){var e={4593:function(e,t){var r,n,i,o,l,u=function(e){for(var t=[],r=0;r<e.length;++r){var n=e.charCodeAt(r);n<128?t.push(n):n<2048?(t.push(192|n>>6),t.push(128|63&n)):n<65536?(t.push(224|n>>12),t.push(128|63&n>>6),t.push(128|63&n)):(t.push(240|n>>18),t.push(128|63&n>>12),t.push(128|63&n>>6),t.push(128|63&n))}return t},c=function(e){for(var t=[],r=0;r<e.length;){var n=e[r++];n<128||(n<224?(n=(31&n)<<6,n|=63&e[r++]):n<240?(n=(15&n)<<12,n|=(63&e[r++])<<6,n|=63&e[r++]):(n=(7&n)<<18,n|=(63&e[r++])<<12,n|=(63&e[r++])<<6,n|=63&e[r++])),t.push(String.fromCharCode(n))}return t.join("")},d={};r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=function(e){for(var t=0,n=[],i=0|e.length/3;0<i--;){var a=(e[t]<<16)+(e[t+1]<<8)+e[t+2];t+=3,n.push(r.charAt(63&a>>18)),n.push(r.charAt(63&a>>12)),n.push(r.charAt(63&a>>6)),n.push(r.charAt(63&a))}return 2==e.length-t?(a=(e[t]<<16)+(e[t+1]<<8),n.push(r.charAt(63&a>>18)),n.push(r.charAt(63&a>>12)),n.push(r.charAt(63&a>>6)),n.push("=")):1==e.length-t&&(a=e[t]<<16,n.push(r.charAt(63&a>>18)),n.push(r.charAt(63&a>>12)),n.push("==")),n.join("")},i=function(){for(var e=[],t=0;t<r.length;++t)e[r.charCodeAt(t)]=t;return e["=".charCodeAt(0)]=0,e}(),o=function(e){for(var t=0,r=[],n=0|e.length/4;0<n--;){var a=(i[e.charCodeAt(t)]<<18)+(i[e.charCodeAt(t+1)]<<12)+(i[e.charCodeAt(t+2)]<<6)+i[e.charCodeAt(t+3)];r.push(255&a>>16),r.push(255&a>>8),r.push(255&a),t+=4}return r&&("="==e.charAt(t-2)?(r.pop(),r.pop()):"="==e.charAt(t-1)&&r.pop()),r},l={encode:function(e){for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t},decode:function(e){for(var t=0;t<s.length;++t)a[t]=String.fromCharCode(a[t]);return a.join("")}},d.decodeArray=function(e){var t=o(e);return new Uint8Array(t)},d.encodeASCII=function(e){var t=l.encode(e);return n(t)},d.decodeASCII=function(e){var t=o(e);return l.decode(t)},d.encode=function(e){var t=u(e);return n(t)},d.decode=function(e){var t=o(e);return c(t)},t.decode=d.decode,t.decodeArray=d.decodeArray,t.encode=d.encode,t.encodeASCII=d.encodeASCII},452:function(e,t){!function(e){var t={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},r=function(e){var r=e;return t.hasOwnProperty(e)&&(r=t[e]),String.fromCharCode(r)},n=15,i=32,a={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},s={17:2,18:4,21:6,22:8,23:10,19:13,20:15},o={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},l={25:2,26:4,29:6,30:8,31:10,27:13,28:15},u=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],c={verboseFilter:{DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){var r=this.verboseFilter[e];this.verboseLevel>=r&&console.log(this.time+" ["+e+"] "+t)}},d=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},f=function(e,t,r,n,i){this.foreground=e||"white",this.underline=t||!1,this.italics=r||!1,this.background=n||"black",this.flash=i||!1};f.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(e){for(var t=["foreground","underline","italics","background","flash"],r=0;r<t.length;r++){var n=t[r];e.hasOwnProperty(n)&&(this[n]=e[n])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},copy:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var h=function(e,t,r,n,i,a){this.uchar=e||" ",this.penState=new f(t,r,n,i,a)};h.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(e,t){this.uchar=e,this.penState.copy(t)},setPenState:function(e){this.penState.copy(e)},equals:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},copy:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var g=function(){this.chars=[];for(var e=0;e<i;e++)this.chars.push(new h);this.pos=0,this.currPenState=new f};g.prototype={equals:function(e){for(var t=!0,r=0;r<i;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t},copy:function(e){for(var t=0;t<i;t++)this.chars[t].copy(e.chars[t])},isEmpty:function(){for(var e=!0,t=0;t<i;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},setCursor:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(c.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>i&&(c.log("ERROR","Too large cursor position "+this.pos),this.pos=i)},moveCursor:function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(e){e>=144&&this.backSpace();var t=r(e);this.pos>=i?c.log("ERROR","Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},clearFromPos:function(e){var t;for(t=e;t<i;t++)this.chars[t].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var e=[],t=!0,r=0;r<i;r++){var n=this.chars[r].uchar;" "!==n&&(t=!1),e.push(n)}return t?"":e.join("")},setPenStyles:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}};var p=function(){this.rows=[];for(var e=0;e<n;e++)this.rows.push(new g);this.currRow=14,this.nrRollUpRows=null,this.reset()};p.prototype={reset:function(){for(var e=0;e<n;e++)this.rows[e].clear();this.currRow=14},equals:function(e){for(var t=!0,r=0;r<n;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t},copy:function(e){for(var t=0;t<n;t++)this.rows[t].copy(e.rows[t])},isEmpty:function(){for(var e=!0,t=0;t<n;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(e){this.rows[this.currRow].insertChar(e)},setPen:function(e){this.rows[this.currRow].setPenStyles(e)},moveCursor:function(e){this.rows[this.currRow].moveCursor(e)},setCursor:function(e){c.log("INFO","setCursor: "+e),this.rows[this.currRow].setCursor(e)},setPAC:function(e){c.log("INFO","pacData = "+JSON.stringify(e));var t=e.row-1;this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.currRow=t;var r=this.rows[this.currRow];if(null!==e.indent){var n=e.indent,i=Math.max(n-1,0);r.setCursor(e.indent),e.color=r.chars[i].penState.foreground}var a={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(a)},setBkgData:function(e){c.log("INFO","bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},setRollUpRows:function(e){this.nrRollUpRows=e},rollUp:function(){if(null!==this.nrRollUpRows){c.log("TEXT",this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),c.log("INFO","Rolling up")}else c.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(e){e=e||!1;for(var t=[],r="",i=-1,a=0;a<n;a++){var s=this.rows[a].getTextString();s&&(i=a+1,e?t.push("Row "+i+': "'+s+'"'):t.push(s.trim()))}return t.length>0&&(r=e?"["+t.join(" | ")+"]":t.join("\n")),r},getTextAndFormat:function(){return this.rows}};var m=function(e,t){this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new p,this.nonDisplayedMemory=new p,this.lastOutputScreen=new p,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null};m.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null},getHandler:function(){return this.outputFilter},setHandler:function(e){this.outputFilter=e},setPAC:function(e){this.writeScreen.setPAC(e)},setBkgData:function(e){this.writeScreen.setBkgData(e)},setMode:function(e){e!==this.mode&&(this.mode=e,c.log("INFO","MODE="+e),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},insertChars:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";c.log("INFO",r+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(c.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){c.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){c.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){c.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(e){c.log("INFO","RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},cc_FON:function(){c.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){c.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){c.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){c.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){c.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){c.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){c.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(c.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,c.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(e){c.log("INFO","TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},cc_MIDROW:function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var r=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][r]}c.log("INFO","MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},outputDataUpdate:function(){var e=c.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}};var v=function(e,t,r){this.field=e||1,this.outputs=[t,r],this.channels=[new m(1,t),new m(2,r)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0}};v.prototype={getHandler:function(e){return this.channels[e].getHandler()},setHandler:function(e,t){this.channels[e].setHandler(t)},addData:function(e,t){var r,n,i,a=!1;this.lastTime=e,c.setTime(e);for(var s=0;s<t.length;s+=2)n=127&t[s],i=127&t[s+1],n>=16&&n<=31&&n===this.lastCmdA&&i===this.lastCmdB?(this.lastCmdA=null,this.lastCmdB=null,c.log("DEBUG","Repeated command ("+d([n,i])+") is dropped")):0!==n||0!==i?(c.log("DATA","["+d([t[s],t[s+1]])+"] -> ("+d([n,i])+")"),(r=this.parseCmd(n,i))||(r=this.parseMidrow(n,i)),r||(r=this.parsePAC(n,i)),r||(r=this.parseBackgroundAttributes(n,i)),r||(a=this.parseChars(n,i))&&(this.currChNr&&this.currChNr>=0?this.channels[this.currChNr-1].insertChars(a):c.log("WARNING","No channel found yet. TEXT-MODE?")),r?this.dataCounters.cmd+=2:a?this.dataCounters.char+=2:(this.dataCounters.other+=2,c.log("WARNING","Couldn't parse cleaned data "+d([n,i])+" orig: "+d([t[s],t[s+1]])))):this.dataCounters.padding+=2},parseCmd:function(e,t){var r;if(!((20===e||21===e||28===e||29===e)&&32<=t&&t<=47||(23===e||31===e)&&33<=t&&t<=35))return!1;r=20===e||21===e||23===e?1:2;var n=this.channels[r-1];return 20===e||21===e||28===e||29===e?32===t?n.cc_RCL():33===t?n.cc_BS():34===t?n.cc_AOF():35===t?n.cc_AON():36===t?n.cc_DER():37===t?n.cc_RU(2):38===t?n.cc_RU(3):39===t?n.cc_RU(4):40===t?n.cc_FON():41===t?n.cc_RDC():42===t?n.cc_TR():43===t?n.cc_RTD():44===t?n.cc_EDM():45===t?n.cc_CR():46===t?n.cc_ENM():47===t&&n.cc_EOC():n.cc_TO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},parseMidrow:function(e,t){var r=null;if((17===e||25===e)&&32<=t&&t<=47){if((r=17===e?1:2)!==this.currChNr)return c.log("ERROR","Mismatch channel in midrow parsing"),!1;var n=this.channels[r-1];return n.insertChars([32]),n.cc_MIDROW(t),c.log("DEBUG","MIDROW ("+d([e,t])+")"),this.lastCmdA=e,this.lastCmdB=t,!0}return!1},parsePAC:function(e,t){var r,n;if(!((17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127||(16===e||24===e)&&64<=t&&t<=95))return!1;r=e<=23?1:2,n=64<=t&&t<=95?1===r?a[e]:o[e]:1===r?s[e]:l[e];var i=this.interpretPAC(n,t);return this.channels[r-1].setPAC(i),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0},interpretPAC:function(e,t){var r,n={color:null,italics:!1,indent:null,underline:!1,row:e};return r=t>95?t-96:t-64,n.underline=!(1&~r),r<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(n.italics=!0,n.color="white"):n.indent=4*Math.floor((r-16)/2),n},parseChars:function(e,t){var n,i=null,a=null,s=null;if(e>=25?(i=2,s=e-8):(i=1,s=e),17<=s&&s<=19?(n=17===s?t+80:18===s?t+112:t+144,c.log("INFO","Special char '"+r(n)+"' in channel "+i),a=[n],this.lastCmdA=e,this.lastCmdB=t):32<=e&&e<=127&&(a=0===t?[e]:[e,t],this.lastCmdA=null,this.lastCmdB=null),a){var o=d(a);c.log("DEBUG","Char codes =  "+o.join(","))}return a},parseBackgroundAttributes:function(e,t){var r,n,i;return((16===e||24===e)&&32<=t&&t<=47||(23===e||31===e)&&45<=t&&t<=47)&&(r={},16===e||24===e?(n=Math.floor((t-32)/2),r.background=u[n],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0)),i=e<24?1:2,this.channels[i-1].setBkgData(r),this.lastCmdA=e,this.lastCmdB=t,!0)},reset:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)}},e.logger=c,e.PenState=f,e.CaptionScreen=p,e.Cea608Parser=v,e.findCea608Nalus=function(e,t,r){for(var n=0,i=t,a=[],s=function(e,t,r,n){if(4!==e||t<8)return null;var i=r.getUint8(n),a=r.getUint16(n+1),s=r.getUint32(n+3),o=r.getUint8(n+7);return 181==i&&49==a&&1195456820==s&&3==o};i<t+r;){if(n=e.getUint32(i),6==(31&e.getUint8(i+4)))for(var o=i+5,l=-1;o<i+4+n-1;){l=0;for(var u=255;255===u;)l+=u=e.getUint8(o),o++;var c=0;for(u=255;255===u;)c+=u=e.getUint8(o),o++;s(l,c,e,o)&&a.push([o,c]),o+=c}i+=n+4}return a},e.extractCea608DataFromRange=function(e,t){var r=t[0],n=[[],[]];r+=8;var i=31&e.getUint8(r);r+=2;for(var a=0;a<i;a++){var s=e.getUint8(r),o=4&s,l=3&s;r++;var u=e.getUint8(r);r++;var c=e.getUint8(r);r++,o&&(127&u)+(127&c)!=0&&(0===l?(n[0].push(u),n[0].push(c)):1===l&&(n[1].push(u),n[1].push(c)))}return n}}(t)},8416:function(e,t,r){var n=r(1139),i=r(5448),a=r(6398),s=r(2032),o=(r(5530),"undefined"!=typeof window&&window||r.g),l=o.dashjs;l||(l=o.dashjs={}),l.MediaPlayer=n.Z,l.FactoryMaker=i.Z,l.Debug=a.Z,l.Version=(0,s.e)()},6398:function(e,t,r){var n=r(5595),i=r(8512),a=r(5448),s=1,o=2,l=3,u=4,c=5;function d(e){e=e||{};var t,r,a,d,f=this.context,h=(0,n.Z)(f).getInstance(),g=e.settings,p=[];function m(e){return e&&e.bind?e.bind(window.console):window.console.log.bind(window.console)}function v(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];S.apply(void 0,[s,this].concat(t))}function y(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];S.apply(void 0,[o,this].concat(t))}function E(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];S.apply(void 0,[l,this].concat(t))}function T(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];S.apply(void 0,[u,this].concat(t))}function _(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];S.apply(void 0,[c,this].concat(t))}function S(e,t){var n="",s=null;r&&(s=(new Date).getTime(),n+="["+(s-d)+"]"),a&&t&&t.getClassName&&(n+="["+t.getClassName()+"]",t.getType&&(n+="["+t.getType()+"]")),n.length>0&&(n+=" ");for(var o=arguments.length,l=new Array(o>2?o-2:0),u=2;u<o;u++)l[u-2]=arguments[u];Array.apply(null,l).forEach(function(e){n+=e+" "}),p[e]&&g&&g.get().debug.logLevel>=e&&p[e](n),g&&g.get().debug.dispatchEvent&&h.trigger(i.Z.LOG,{message:n,level:e})}return t={getLogger:function(e){return{fatal:v.bind(e),error:y.bind(e),warn:E.bind(e),info:T.bind(e),debug:_.bind(e)}},setLogTimestampVisible:function(e){r=e},setCalleeNameVisible:function(e){a=e}},r=!0,a=!0,d=(new Date).getTime(),"undefined"!=typeof window&&window.console&&(p[s]=m(window.console.error),p[o]=m(window.console.error),p[l]=m(window.console.warn),p[u]=m(window.console.info),p[c]=m(window.console.debug)),t}d.__dashjs_factory_name="Debug";var f=a.Z.getSingletonFactory(d);f.LOG_LEVEL_NONE=0,f.LOG_LEVEL_FATAL=s,f.LOG_LEVEL_ERROR=o,f.LOG_LEVEL_WARNING=l,f.LOG_LEVEL_INFO=u,f.LOG_LEVEL_DEBUG=c,a.Z.updateSingletonFactory(d.__dashjs_factory_name,f),t.Z=f},5595:function(e,t,r){var n=r(5448),i=r(8825);function a(){var e={};function t(t,r,n){var i=-1;return e[t]?(e[t].some(function(e,t){if(e&&e.callback===r&&(!n||n===e.scope))return i=t,!0}),i):i}var r={on:function(r,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(!r)throw new Error("event type cannot be null or undefined");if(!n||"function"!=typeof n)throw new Error("listener must be a function: "+n);var s=a.priority||0;if(!(t(r,n,i)>=0)){e[r]=e[r]||[];var o={callback:n,scope:i,priority:s};i&&i.getStreamId&&(o.streamId=i.getStreamId()),i&&i.getType&&(o.mediaType=i.getType()),a&&a.mode&&(o.mode=a.mode);var l=e[r].some(function(t,n){if(t&&s>t.priority)return e[r].splice(n,0,o),!0});l||e[r].push(o)}},off:function(r,n,i){if(r&&n&&e[r]){var a=t(r,n,i);a<0||(e[r][a]=null)}},trigger:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t&&e[t]){if((r=r||{}).hasOwnProperty("type"))throw new Error("'type' is a reserved word for event dispatching");r.type=t,n.streamId&&(r.streamId=n.streamId),n.mediaType&&(r.mediaType=n.mediaType),e[t].filter(function(e){return!(!e||n.streamId&&e.streamId&&e.streamId!==n.streamId||n.mediaType&&e.mediaType&&e.mediaType!==n.mediaType||n.mode&&e.mode&&e.mode!==n.mode||!e.mode&&n.mode&&n.mode===i.Z.EVENT_MODE_ON_RECEIVE)}).forEach(function(e){return e&&e.callback.call(e.scope,r)})}},reset:function(){e={}}};return r}a.__dashjs_factory_name="EventBus";var s=n.Z.getSingletonFactory(a);s.EVENT_PRIORITY_LOW=0,s.EVENT_PRIORITY_HIGH=5e3,n.Z.updateSingletonFactory(a.__dashjs_factory_name,s),t.Z=s},5448:function(e,t){var r=function(){var e,t=[],r={},n={};function i(e,r){for(var n in t){var i=t[n];if(i.context===e&&i.name===r)return i.instance}return null}function a(e,t){return t[e]}function s(e,t,r){e in r&&(r[e]=t)}function o(t,r,n){var i,a=t.__dashjs_factory_name,s=r[a];if(s){var o=s.instance;if(!s.override)return o.apply({context:r,factory:e},n);for(var l in i=t.apply({context:r},n),o=o.apply({context:r,factory:e,parent:i},n))i.hasOwnProperty(l)&&(i[l]=o[l])}else i=t.apply({context:r},n);return i.getClassName=function(){return a},i}return e={extend:function(e,t,r,n){!n[e]&&t&&(n[e]={instance:t,override:r})},getSingletonInstance:i,setSingletonInstance:function(e,r,n){for(var i in t){var a=t[i];if(a.context===e&&a.name===r)return void(t[i].instance=n)}t.push({name:r,context:e,instance:n})},deleteSingletonInstances:function(e){t=t.filter(function(t){return t.context!==e})},getSingletonFactory:function(e){var n=a(e.__dashjs_factory_name,r);return n||(n=function(r){var n;return void 0===r&&(r={}),{getInstance:function(){return n||(n=i(r,e.__dashjs_factory_name)),n||(n=o(e,r,arguments),t.push({name:e.__dashjs_factory_name,context:r,instance:n})),n}}},r[e.__dashjs_factory_name]=n),n},getSingletonFactoryByName:function(e){return a(e,r)},updateSingletonFactory:function(e,t){s(e,t,r)},getClassFactory:function(e){var t=a(e.__dashjs_factory_name,n);return t||(t=function(t){return void 0===t&&(t={}),{create:function(){return o(e,t,arguments)}}},n[e.__dashjs_factory_name]=t),t},getClassFactoryByName:function(e){return a(e,n)},updateClassFactory:function(e,t){s(e,t,n)}},e}();t.Z=r},1264:function(e,t,r){var n=r(5448),i=r(703),a=r(6398),s=r(3393),o=r(7855),l=r(5595),u=r(8512);function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(){var e,t,r=this.context,n=(0,l.Z)(r).getInstance(),f={"streaming.delay.liveDelay":u.Z.SETTING_UPDATED_LIVE_DELAY,"streaming.delay.liveDelayFragmentCount":u.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,"streaming.liveCatchup.enabled":u.Z.SETTING_UPDATED_CATCHUP_ENABLED,"streaming.liveCatchup.playbackRate.min":u.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,"streaming.liveCatchup.playbackRate.max":u.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX},h={debug:{logLevel:a.Z.LOG_LEVEL_WARNING,dispatchEvent:!1},streaming:{abandonLoadTimeout:1e4,wallclockTimeUpdateInterval:100,manifestUpdateRetryInterval:100,liveUpdateTimeThresholdInMilliseconds:0,cacheInitSegments:!1,applyServiceDescription:!0,applyProducerReferenceTime:!0,applyContentSteering:!0,eventControllerRefreshDelay:100,enableManifestDurationMismatchFix:!0,parseInbandPrft:!1,enableManifestTimescaleMismatchFix:!1,capabilities:{filterUnsupportedEssentialProperties:!0,useMediaCapabilitiesApi:!1},timeShiftBuffer:{calcFromSegmentTimeline:!1,fallbackToSegmentTimeline:!0},metrics:{maxListDepth:100},delay:{liveDelayFragmentCount:NaN,liveDelay:NaN,useSuggestedPresentationDelay:!0},protection:{keepProtectionMediaKeys:!1,ignoreEmeEncryptedEvent:!1,detectPlayreadyMessageFormat:!0},buffer:{enableSeekDecorrelationFix:!1,fastSwitchEnabled:!0,flushBufferAtTrackSwitch:!1,reuseExistingSourceBuffers:!0,bufferPruningInterval:10,bufferToKeep:20,bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:60,initialBufferLevel:NaN,stableBufferTime:12,longFormContentDurationThreshold:600,stallThreshold:.3,useAppendWindow:!0,setStallState:!0,avoidCurrentTimeRangePruning:!1,useChangeTypeForTrackSwitch:!0,mediaSourceDurationInfinity:!0,resetSourceBuffersForTrackSwitch:!1},gaps:{jumpGaps:!0,jumpLargeGaps:!0,smallGapLimit:1.5,threshold:.3,enableSeekFix:!0,enableStallFix:!1,stallSeek:.1},utcSynchronization:{enabled:!0,useManifestDateHeaderTimeSource:!0,backgroundAttempts:2,timeBetweenSyncAttempts:30,maximumTimeBetweenSyncAttempts:600,minimumTimeBetweenSyncAttempts:2,timeBetweenSyncAttemptsAdjustmentFactor:2,maximumAllowedDrift:100,enableBackgroundSyncAfterSegmentDownloadError:!0,defaultTimingSource:{scheme:"urn:mpeg:dash:utc:http-xsdate:2014",value:"https://time.akamai.com/?iso&ms"}},scheduling:{defaultTimeout:500,lowLatencyTimeout:0,scheduleWhilePaused:!0},text:{defaultEnabled:!0,dispatchForManualRendering:!1,extendSegmentedCues:!0,imsc:{displayForcedOnlyMode:!1,enableRollUp:!0},webvtt:{customRenderingEnabled:!1}},liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN},playbackBufferMin:.5,enabled:null,mode:s.Z.LIVE_CATCHUP_MODE_DEFAULT},lastBitrateCachingInfo:{enabled:!0,ttl:36e4},lastMediaSettingsCachingInfo:{enabled:!0,ttl:36e4},saveLastMediaSettingsForCurrentStreamingSession:!0,cacheLoadThresholds:{video:50,audio:5},trackSwitchMode:{audio:s.Z.TRACK_SWITCH_MODE_ALWAYS_REPLACE,video:s.Z.TRACK_SWITCH_MODE_NEVER_REPLACE},selectionModeForInitialTrack:s.Z.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY,fragmentRequestTimeout:2e4,fragmentRequestProgressTimeout:-1,manifestRequestTimeout:1e4,retryIntervals:(e={},d(e,o.w.MPD_TYPE,500),d(e,o.w.XLINK_EXPANSION_TYPE,500),d(e,o.w.MEDIA_SEGMENT_TYPE,1e3),d(e,o.w.INIT_SEGMENT_TYPE,1e3),d(e,o.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,1e3),d(e,o.w.INDEX_SEGMENT_TYPE,1e3),d(e,o.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE,1e3),d(e,o.w.LICENSE,1e3),d(e,o.w.OTHER_TYPE,1e3),d(e,"lowLatencyReductionFactor",10),e),retryAttempts:(t={},d(t,o.w.MPD_TYPE,3),d(t,o.w.XLINK_EXPANSION_TYPE,1),d(t,o.w.MEDIA_SEGMENT_TYPE,3),d(t,o.w.INIT_SEGMENT_TYPE,3),d(t,o.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,3),d(t,o.w.INDEX_SEGMENT_TYPE,3),d(t,o.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE,3),d(t,o.w.LICENSE,3),d(t,o.w.OTHER_TYPE,3),d(t,"lowLatencyMultiplyFactor",5),t),abr:{movingAverageMethod:s.Z.MOVING_AVERAGE_SLIDING_WINDOW,ABRStrategy:s.Z.ABR_STRATEGY_DYNAMIC,additionalAbrRules:{insufficientBufferRule:!0,switchHistoryRule:!0,droppedFramesRule:!0,abandonRequestsRule:!0},abrRulesParameters:{abandonRequestsRule:{graceTimeThreshold:500,abandonMultiplier:1.8,minLengthToAverage:5}},bandwidthSafetyFactor:.9,useDefaultABRRules:!0,useDeadTimeLatency:!0,limitBitrateByPortal:!1,usePixelRatioInLimitBitrateByPortal:!1,maxBitrate:{audio:-1,video:-1},minBitrate:{audio:-1,video:-1},maxRepresentationRatio:{audio:1,video:1},initialBitrate:{audio:-1,video:-1},initialRepresentationRatio:{audio:-1,video:-1},autoSwitchBitrate:{audio:!0,video:!0},fetchThroughputCalculationMode:s.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING},cmcd:{enabled:!1,sid:null,cid:null,rtp:null,rtpSafetyFactor:5,mode:s.Z.CMCD_MODE_QUERY,enabledKeys:["br","d","ot","tb","bl","dl","mtp","nor","nrr","su","bs","rtp","cid","pr","sf","sid","st","v"]},cmsd:{enabled:!1,abr:{applyMb:!1,etpWeightRatio:0}}},errors:{recoverAttempts:{mediaErrorDecode:5}}},g=i.Z.clone(h);function p(e,t,r){for(var a in e)e.hasOwnProperty(a)&&(t.hasOwnProperty(a)?"object"!==c(e[a])||e[a]instanceof Array||null===e[a]?(t[a]=i.Z.clone(e[a]),f[r+a]&&n.trigger(f[r+a])):p(e[a],t[a],r.slice()+a+"."):console.error("Settings parameter "+r+a+" is not supported"))}return{get:function(){return g},update:function(e){"object"===c(e)&&p(e,g,"")},reset:function(){g=i.Z.clone(h)}}}f.__dashjs_factory_name="Settings";var h=n.Z.getSingletonFactory(f);t.Z=h},703:function(e,t,r){var n=r(3875),i=r.n(n),a=r(1067);function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return t=[{key:"mixin",value:function(t,r,n){var i,a={};if(t)for(var o in r)r.hasOwnProperty(o)&&(i=r[o],o in t&&(t[o]===i||o in a&&a[o]===i)||("object"===s(t[o])&&null!==t[o]?t[o]=e.mixin(t[o],i,n):t[o]=n(i)));return t}},{key:"clone",value:function(t){if(!t||"object"!==s(t))return t;var r;if(t instanceof Array){r=[];for(var n=0,i=t.length;n<i;++n)n in t&&r.push(e.clone(t[n]))}else r={};return e.mixin(r,t,e.clone)}},{key:"addAditionalQueryParameterToUrl",value:function(e,t){try{if(!t||0===t.length)return e;var r=new URL(e);return t.forEach(function(e){e.key&&e.value&&r.searchParams.set(e.key,e.value)}),r.href}catch(t){return e}}},{key:"parseHttpHeaders",value:function(e){var t={};if(!e)return t;for(var r=e.trim().split("\r\n"),n=0,i=r.length;n<i;n++){var a=r[n],s=a.indexOf(": ");s>0&&(t[a.substring(0,s)]=a.substring(s+2))}return t}},{key:"generateUuid",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)})}},{key:"generateHashCode",value:function(e){var t=0;if(0===e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}},{key:"getRelativeUrl",value:function(e,t){try{var r=new URL(e),n=new URL(t);if(r.protocol=n.protocol,r.origin!==n.origin)return t;var a=i().relative(r.pathname.substr(0,r.pathname.lastIndexOf("/")),n.pathname.substr(0,n.pathname.lastIndexOf("/"))),s=0===a.length?1:0;return a+=n.pathname.substr(n.pathname.lastIndexOf("/")+s,n.pathname.length-1),n.pathname.length<a.length?n.pathname:a}catch(e){return t}}},{key:"parseUserAgent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var t=null===e&&"undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"";return(0,a.UAParser)(t)}catch(e){return{}}}},{key:"stringHasProtocol",value:function(e){return/(http(s?)):\/\//i.test(e)}}],t&&o(e,t),e}();t.Z=l},2032:function(e,t,r){function n(){return"4.7.4"}r.d(t,{e:function(){return n}})},2230:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"extend",value:function(e,t){if(e){var r=!!t&&t.override,n=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!r||n&&-1===e[i].indexOf("public_")||(this[i]=e[i])}}}])&&r(e.prototype,t),e}();t.Z=n},4351:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}var o=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=s(t);if(r){var i=s(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return a(this,e)});function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=n.call(this)).ATTEMPT_BACKGROUND_SYNC="attemptBackgroundSync",e.BUFFERING_COMPLETED="bufferingCompleted",e.BUFFER_CLEARED="bufferCleared",e.BYTES_APPENDED_END_FRAGMENT="bytesAppendedEndFragment",e.BUFFER_REPLACEMENT_STARTED="bufferReplacementStarted",e.CHECK_FOR_EXISTENCE_COMPLETED="checkForExistenceCompleted",e.CMSD_STATIC_HEADER="cmsdStaticHeader",e.CURRENT_TRACK_CHANGED="currentTrackChanged",e.DATA_UPDATE_COMPLETED="dataUpdateCompleted",e.INBAND_EVENTS="inbandEvents",e.INITIAL_STREAM_SWITCH="initialStreamSwitch",e.INIT_FRAGMENT_LOADED="initFragmentLoaded",e.INIT_FRAGMENT_NEEDED="initFragmentNeeded",e.INTERNAL_MANIFEST_LOADED="internalManifestLoaded",e.ORIGINAL_MANIFEST_LOADED="originalManifestLoaded",e.LOADING_COMPLETED="loadingCompleted",e.LOADING_PROGRESS="loadingProgress",e.LOADING_DATA_PROGRESS="loadingDataProgress",e.LOADING_ABANDONED="loadingAborted",e.MANIFEST_UPDATED="manifestUpdated",e.MEDIA_FRAGMENT_LOADED="mediaFragmentLoaded",e.MEDIA_FRAGMENT_NEEDED="mediaFragmentNeeded",e.QUOTA_EXCEEDED="quotaExceeded",e.SEGMENT_LOCATION_BLACKLIST_ADD="segmentLocationBlacklistAdd",e.SEGMENT_LOCATION_BLACKLIST_CHANGED="segmentLocationBlacklistChanged",e.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD="serviceLocationBlacklistAdd",e.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED="serviceLocationBlacklistChanged",e.SERVICE_LOCATION_LOCATION_BLACKLIST_ADD="serviceLocationLocationBlacklistAdd",e.SERVICE_LOCATION_LOCATION_BLACKLIST_CHANGED="serviceLocationLocationBlacklistChanged",e.SET_FRAGMENTED_TEXT_AFTER_DISABLED="setFragmentedTextAfterDisabled",e.SET_NON_FRAGMENTED_TEXT="setNonFragmentedText",e.SOURCE_BUFFER_ERROR="sourceBufferError",e.STREAMS_COMPOSED="streamsComposed",e.STREAM_BUFFERING_COMPLETED="streamBufferingCompleted",e.STREAM_REQUESTING_COMPLETED="streamRequestingCompleted",e.TEXT_TRACKS_QUEUE_INITIALIZED="textTracksQueueInitialized",e.TIME_SYNCHRONIZATION_COMPLETED="timeSynchronizationComplete",e.UPDATE_TIME_SYNC_OFFSET="updateTimeSyncOffset",e.URL_RESOLUTION_FAILED="urlResolutionFailed",e.VIDEO_CHUNK_RECEIVED="videoChunkReceived",e.WALLCLOCK_TIME_UPDATED="wallclockTimeUpdated",e.XLINK_ELEMENT_LOADED="xlinkElementLoaded",e.XLINK_READY="xlinkReady",e.SEEK_TARGET="seekTarget",e.SETTING_UPDATED_LIVE_DELAY="settingUpdatedLiveDelay",e.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT="settingUpdatedLiveDelayFragmentCount",e.SETTING_UPDATED_CATCHUP_ENABLED="settingUpdatedCatchupEnabled",e.SETTING_UPDATED_PLAYBACK_RATE_MIN="settingUpdatedPlaybackRateMin",e.SETTING_UPDATED_PLAYBACK_RATE_MAX="settingUpdatedPlaybackRateMax",e}return o}(r(8342).Z);t.Z=o},8512:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function s(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(l,e);var t,r,n=(t=l,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=o(t);if(r){var i=o(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return s(this,e)});function l(){return i(this,l),n.apply(this,arguments)}return l}(r(4351).Z),u=new l;t.Z=u},8342:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return(t=[{key:"extend",value:function(e,t){if(e){var r=!!t&&t.override,n=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!r||n&&-1===e[i].indexOf("public_")||(this[i]=e[i])}}}])&&r(e.prototype,t),e}();t.Z=n},9326:function(e,t,r){var n=r(3186),i=r(7855),a=r(5448),s=r(8825),o=r(7387),l=r(1553);function u(e){var t,r,a,u,c,d=(e=e||{}).eventBus,f=e.debug,h=e.urlUtils,g=e.type,p=e.streamInfo,m=e.segmentsController,v=e.timelineConverter,y=e.baseURLController;function E(){return g}function T(){a=null}function _(e,t,r){var n,i,a=y.resolve(r.path),s={};return a&&t!==a.url&&h.isRelative(t)?(n=a.url,i=a.serviceLocation,s=a.queryParams,t&&(n=h.resolve(t,n))):n=t,!h.isRelative(n)&&(e.url=n,e.serviceLocation=i,e.queryParams=s,!0)}function S(e,t){if(null==t)return null;var r=new n.Z,a=t.representation,s=a.adaptation.period.mpd.manifest.Period_asArray[a.adaptation.period.index].AdaptationSet_asArray[a.adaptation.index].Representation_asArray[a.index].bandwidth,l=t.media;return l=(0,o.vi)(l,"Number",t.replacementNumber),l=(0,o.vi)(l,"Time",t.replacementTime),l=(0,o.vi)(l,"Bandwidth",s),l=(0,o.Aj)(l,a.id),l=(0,o.eR)(l),r.mediaType=E(),r.type=i.w.MEDIA_SEGMENT_TYPE,r.range=t.mediaRange,r.startTime=t.presentationStartTime,r.mediaStartTime=t.mediaStartTime,r.duration=t.duration,r.timescale=a.timescale,r.availabilityStartTime=t.availabilityStartTime,r.availabilityEndTime=t.availabilityEndTime,r.availabilityTimeComplete=a.availabilityTimeComplete,r.wallStartTime=t.wallStartTime,r.quality=a.index,r.index=t.index,r.mediaInfo=e,r.adaptationIndex=a.adaptation.index,r.representationId=a.id,_(r,l,a)?r:void 0}function b(e,t,n){var i=null;if(!t||!t.segmentInfoType)return i;var s=m.getSegmentByTime(t,n);return s&&(a=s,r.debug("Index for time "+n+" is "+s.index),i=S(e,s)),i}function A(e,t,n){var i=null,s=m.getSegmentByIndex(t,n,a?a.mediaStartTime:-1);if(s)i=S(e,s),a=s;else{if(u&&!c)return r.debug(E()+" No segment found at index: "+n+". Wait for next loop"),null;c=!0}return i}function I(){r.debug("Dynamic stream complete"),c=!0}return t={getCurrentIndex:function(){return a?a.index:-1},getInitRequest:function(e,t){return t?function(e,t,r){var a=new n.Z,s=t.adaptation.period,l=s.start;if(a.mediaType=r,a.type=i.w.INIT_SEGMENT_TYPE,a.range=t.range,a.availabilityStartTime=v.calcAvailabilityStartTimeFromPresentationTime(l,t,u),a.availabilityEndTime=v.calcAvailabilityEndTimeFromPresentationTime(l+s.duration,t,u),a.quality=t.index,a.mediaInfo=e,a.representationId=t.id,_(a,t.initialization,t))return a.url=(0,o.vi)(a.url,"Bandwidth",t.bandwidth),a}(e,t,E()):null},getNextSegmentRequest:function(e,t){return t&&t.segmentInfoType?A(e,t,a?a.index+1:0):null},getNextSegmentRequestIdempotent:function(e,t){var r=a?a.index+1:0,n=m.getSegmentByIndex(t,r,a?a.mediaStartTime:-1);return n?S(e,n):null},getSegmentRequestForTime:b,getStreamId:function(){return p.id},getStreamInfo:function(){return p},getType:E,getValidTimeAheadOfTargetTime:function(e,t,r,n){try{if(isNaN(e)||!t||!r)return NaN;if(e<0&&(e=0),isNaN(n)&&(n=.5),b(t,r,e))return e;if(r.adaptation.period.start+r.adaptation.period.duration<e)return NaN;for(var i=isFinite(r.adaptation.period.duration)?r.adaptation.period.start+r.adaptation.period.duration:e+30,a=Math.min(e+n,i),s=NaN,o=null;a<=i;){var l=null;if(a<=i&&(l=b(t,r,a)),l){s=a,o=l;break}a+=n}if(o){var u=o.startTime+o.duration;return e>o.startTime&&u-e>n?e:!isNaN(o.startTime)&&e<o.startTime&&s>o.startTime?o.startTime+.001:Math.min(u-n,s)}return s}catch(e){return NaN}},initialize:function(e){u=e,c=!1,m.initialize(e)},isLastSegmentRequested:function(e,t){if(!e||!a)return!1;if(c)return!0;if(!isFinite(e.adaptation.period.duration))return!1;if(a.presentationStartTime+a.duration>t)return!1;if(e.mediaFinishedInformation&&!isNaN(e.mediaFinishedInformation.numberOfSegments)&&!isNaN(a.index)&&a.index>=e.mediaFinishedInformation.numberOfSegments-1){if(!u||e.segmentInfoType===l.Z.SEGMENT_TEMPLATE)return!0;if(u&&e.segmentInfoType===l.Z.SEGMENT_LIST&&e.adaptation.period.nextPeriodId)return!0}return!!(u&&e.adaptation.period.nextPeriodId&&e.segmentInfoType===l.Z.SEGMENT_TIMELINE&&e.mediaFinishedInformation&&!isNaN(e.mediaFinishedInformation.mediaTimeOfLastSignaledSegment)&&a&&!isNaN(a.mediaStartTime)&&!isNaN(a.duration)&&a.mediaStartTime+a.duration>=e.mediaFinishedInformation.mediaTimeOfLastSignaledSegment-.05)},repeatSegmentRequest:function(e,t){return t&&t.segmentInfoType?A(e,t,a?a.index:0):null},reset:function(){T(),d.off(s.Z.DYNAMIC_TO_STATIC,I,t)}},r=f.getLogger(t),T(),d.on(s.Z.DYNAMIC_TO_STATIC,I,t),t}u.__dashjs_factory_name="DashHandler",t.Z=a.Z.getClassFactory(u)},1553:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.BASE_URL="BaseURL",this.SEGMENT_BASE="SegmentBase",this.SEGMENT_TEMPLATE="SegmentTemplate",this.SEGMENT_LIST="SegmentList",this.SEGMENT_URL="SegmentURL",this.SEGMENT_TIMELINE="SegmentTimeline",this.SEGMENT_PROFILES="segmentProfiles",this.ADAPTATION_SET="AdaptationSet",this.REPRESENTATION="Representation",this.REPRESENTATION_INDEX="RepresentationIndex",this.SUB_REPRESENTATION="SubRepresentation",this.INITIALIZATION="Initialization",this.INITIALIZATION_MINUS="initialization",this.MPD="MPD",this.PERIOD="Period",this.ASSET_IDENTIFIER="AssetIdentifier",this.EVENT_STREAM="EventStream",this.ID="id",this.PROFILES="profiles",this.SERVICE_LOCATION="serviceLocation",this.RANGE="range",this.INDEX="index",this.MEDIA="media",this.BYTE_RANGE="byteRange",this.INDEX_RANGE="indexRange",this.MEDIA_RANGE="mediaRange",this.VALUE="value",this.CONTENT_TYPE="contentType",this.MIME_TYPE="mimeType",this.BITSTREAM_SWITCHING="BitstreamSwitching",this.BITSTREAM_SWITCHING_MINUS="bitstreamSwitching",this.CODECS="codecs",this.DEPENDENCY_ID="dependencyId",this.MEDIA_STREAM_STRUCTURE_ID="mediaStreamStructureId",this.METRICS="Metrics",this.METRICS_MINUS="metrics",this.REPORTING="Reporting",this.WIDTH="width",this.HEIGHT="height",this.SAR="sar",this.FRAMERATE="frameRate",this.AUDIO_SAMPLING_RATE="audioSamplingRate",this.MAXIMUM_SAP_PERIOD="maximumSAPPeriod",this.START_WITH_SAP="startWithSAP",this.MAX_PLAYOUT_RATE="maxPlayoutRate",this.CODING_DEPENDENCY="codingDependency",this.SCAN_TYPE="scanType",this.FRAME_PACKING="FramePacking",this.AUDIO_CHANNEL_CONFIGURATION="AudioChannelConfiguration",this.CONTENT_PROTECTION="ContentProtection",this.ESSENTIAL_PROPERTY="EssentialProperty",this.ESSENTIAL_PROPERTY_ASARRAY="EssentialProperty_asArray",this.SUPPLEMENTAL_PROPERTY="SupplementalProperty",this.SUPPLEMENTAL_PROPERTY_ASARRAY="SupplementalProperty_asArray",this.INBAND_EVENT_STREAM="InbandEventStream",this.PRODUCER_REFERENCE_TIME="ProducerReferenceTime",this.INBAND="inband",this.TYPE="type",this.ACCESSIBILITY="Accessibility",this.ROLE="Role",this.RATING="Rating",this.CONTENT_COMPONENT="ContentComponent",this.SUBSET="Subset",this.LANG="lang",this.VIEWPOINT="Viewpoint",this.VIEWPOINT_ASARRAY="Viewpoint_asArray",this.ROLE_ASARRAY="Role_asArray",this.REPRESENTATION_ASARRAY="Representation_asArray",this.PRODUCERREFERENCETIME_ASARRAY="ProducerReferenceTime_asArray",this.ACCESSIBILITY_ASARRAY="Accessibility_asArray",this.AUDIOCHANNELCONFIGURATION_ASARRAY="AudioChannelConfiguration_asArray",this.CONTENTPROTECTION_ASARRAY="ContentProtection_asArray",this.MAIN="main",this.DYNAMIC="dynamic",this.STATIC="static",this.MEDIA_PRESENTATION_DURATION="mediaPresentationDuration",this.MINIMUM_UPDATE_PERIOD="minimumUpdatePeriod",this.CODEC_PRIVATE_DATA="codecPrivateData",this.BANDWITH="bandwidth",this.SOURCE_URL="sourceURL",this.TIMESCALE="timescale",this.DURATION="duration",this.START_NUMBER="startNumber",this.PRESENTATION_TIME_OFFSET="presentationTimeOffset",this.AVAILABILITY_START_TIME="availabilityStartTime",this.AVAILABILITY_END_TIME="availabilityEndTime",this.TIMESHIFT_BUFFER_DEPTH="timeShiftBufferDepth",this.MAX_SEGMENT_DURATION="maxSegmentDuration",this.PRESENTATION_TIME="presentationTime",this.MIN_BUFFER_TIME="minBufferTime",this.MAX_SUBSEGMENT_DURATION="maxSubsegmentDuration",this.START="start",this.AVAILABILITY_TIME_OFFSET="availabilityTimeOffset",this.AVAILABILITY_TIME_COMPLETE="availabilityTimeComplete",this.CENC_DEFAULT_KID="cenc:default_KID",this.DVB_PRIORITY="dvb:priority",this.DVB_WEIGHT="dvb:weight",this.DVB_URL="dvb:url",this.DVB_MIMETYPE="dvb:mimeType",this.DVB_FONTFAMILY="dvb:fontFamily",this.SUGGESTED_PRESENTATION_DELAY="suggestedPresentationDelay",this.SERVICE_DESCRIPTION="ServiceDescription",this.SERVICE_DESCRIPTION_SCOPE="Scope",this.SERVICE_DESCRIPTION_LATENCY="Latency",this.SERVICE_DESCRIPTION_PLAYBACK_RATE="PlaybackRate",this.SERVICE_DESCRIPTION_OPERATING_QUALITY="OperatingQuality",this.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH="OperatingBandwidth",this.PATCH_LOCATION="PatchLocation",this.PATCH_LOCATION_AS_ARRAY="PatchLocation_asArray",this.LOCATION="Location",this.LOCATION_AS_ARRAY="Location_asArray",this.PUBLISH_TIME="publishTime",this.ORIGINAL_PUBLISH_TIME="originalPublishTime",this.ORIGINAL_MPD_ID="mpdId",this.WALL_CLOCK_TIME="wallClockTime",this.PRESENTATION_TIME="presentationTime",this.LABEL="Label",this.GROUP_LABEL="GroupLabel",this.CONTENT_STEERING="ContentSteering",this.CONTENT_STEERING_AS_ARRAY="ContentSteering_asArray",this.DEFAULT_SERVICE_LOCATION="defaultServiceLocation",this.QUERY_BEFORE_START="queryBeforeStart",this.CLIENT_REQUIREMENT="clientRequirement",this.TTL="ttl",this.CONTENT_STEERING_RESPONSE={VERSION:"VERSION",TTL:"TTL",RELOAD_URI:"RELOAD-URI",PATHWAY_PRIORITY:"PATHWAY-PRIORITY",PATHWAY_CLONES:"PATHWAY-CLONES",BASE_ID:"BASE-ID",ID:"ID",URI_REPLACEMENT:"URI-REPLACEMENT",HOST:"HOST",PARAMS:"PARAMS"},this.PRODUCER_REFERENCE_TIME_TYPE={ENCODER:"encoder",CAPTURED:"captured",APPLICATION:"application"},this.SEGMENT_ALIGNMENT="segmentAlignment",this.SUB_SEGMENT_ALIGNMENT="subsegmentAlignment"}}])&&r(e.prototype,t),e}());t.Z=n},7802:function(e,t,r){var n=r(5448),i=r(1724),a=r(3636),s=r(1736),o=r(5246);function l(e){e=e||{};var t,r,n=this.context,l=e.dashConstants,u=e.type,c=e.segmentBaseController;function d(e){return e?e.segments?r[l.SEGMENT_BASE]:r[e.segmentInfoType]:null}return t={initialize:function(t){r[l.SEGMENT_TIMELINE]=(0,i.Z)(n).create(e,t),r[l.SEGMENT_TEMPLATE]=(0,a.Z)(n).create(e,t),r[l.SEGMENT_LIST]=(0,s.Z)(n).create(e,t),r[l.SEGMENT_BASE]=(0,o.Z)(n).create(e,t)},updateInitData:function(e,t){return t?Promise.resolve():c.getSegmentBaseInitSegment({representation:e,mediaType:u})},updateSegmentData:function(e,t){return t?Promise.resolve():c.getSegmentList({mimeType:e.mimeType,representation:e,mediaType:u})},getSegmentByIndex:function(e,t,r){var n=d(e);return n?n.getSegmentByIndex(e,t,r):null},getSegmentByTime:function(e,t){var r=d(e);return r?r.getSegmentByTime(e,t):null},getMediaFinishedInformation:function(e){var t=d(e);return t?t.getMediaFinishedInformation(e):{numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN}}},r={},t}l.__dashjs_factory_name="SegmentsController";var u=n.Z.getClassFactory(l);t.Z=u},1736:function(e,t,r){var n=r(5448),i=r(3393),a=r(7387);function s(e,t){var r=(e=e||{}).timelineConverter;function n(){if(!r||!r.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(i.Z.MISSING_CONFIG_ERROR)}function s(e,i){if(n(),!e)return null;var s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,o=s.SegmentURL_asArray.length,l=e&&!isNaN(e.startNumber)?e.startNumber:1,u=Math.max(l-1,0),c=Math.max(i-u,0),d=null;if(c<o){var f=s.SegmentURL_asArray[c];(d=(0,a.NF)(r,t,e,i))&&(d.replacementTime=(l+i-1)*e.segmentDuration,d.media=f.media?f.media:"",d.mediaRange=f.mediaRange,d.indexRange=f.indexRange)}return d}return{getSegmentByIndex:s,getSegmentByTime:function(e,t){if(n(),!e)return null;var i=e.segmentDuration;if(isNaN(i))return null;var a=r.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return s(e,Math.floor(a/i))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!e)return t;var r=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,n=e&&!isNaN(e.startNumber)?e.startNumber:1,i=Math.max(n-1,0);return t.numberOfSegments=i+r.SegmentURL_asArray.length,t}}}s.__dashjs_factory_name="ListSegmentsGetter";var o=n.Z.getClassFactory(s);t.Z=o},5246:function(e,t,r){var n=r(5448),i=r(3393);function a(e){var t=(e=e||{}).timelineConverter;function r(){if(!t||!t.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(i.Z.MISSING_CONFIG_ERROR)}function n(e,t){if(r(),!e)return null;var n,i=e.segments?e.segments.length:-1;if(t<i&&(n=e.segments[t])&&n.index===t)return n;for(var a=0;a<i;a++)if((n=e.segments[a])&&n.index===t)return n;return null}return{getSegmentByIndex:n,getSegmentByTime:function(e,t){r();var i=function(e,t){if(!e)return-1;var r,n,i,a,s,o=e.segments,l=o?o.length:null,u=-1;if(o&&l>0)for(s=0;s<l;s++)if(i=(n=o[s]).presentationStartTime,t+(r=(a=n.duration)/2)>=i&&t-r<i+a){u=n.index;break}return u}(e,t);return n(e,i)},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};return e&&e.segments?(t.numberOfSegments=e.segments.length,t):t}}}a.__dashjs_factory_name="SegmentBaseGetter";var s=n.Z.getClassFactory(a);t.Z=s},7387:function(e,t,r){r.d(t,{Aj:function(){return s},NF:function(){return c},TJ:function(){return d},eR:function(){return a},vi:function(){return o}});var n=r(2011);function i(e,t){for(;e.length<t;)e="0"+e;return e}function a(e){return e?e.split("$$").join("$"):e}function s(e,t){if(!t||!e||-1===e.indexOf("$RepresentationID$"))return e;var r=t.toString();return e.split("$RepresentationID$").join(r)}function o(e,t,r){var n,a,s,o,l,u,c=t.length,d=2;if(!e)return e;for(;;){if((n=e.indexOf("$"+t))<0)return e;if((a=e.indexOf("$",n+c))<0)return e;if((s=e.indexOf("%0",n+c))>n&&s<a)switch(o=e.charAt(a-1),l=parseInt(e.substring(s+d,a-1),10),o){case"d":case"i":case"u":u=i(r.toString(),l);break;case"x":u=i(r.toString(16),l);break;case"X":u=i(r.toString(16),l).toUpperCase();break;case"o":u=i(r.toString(8),l);break;default:return e}else u=r;e=e.substring(0,n)+u+e.substring(a+1)}}function l(e,t,r,i,a,s,o,l){var u,c=new n.Z;return c.representation=e,c.duration=t,c.presentationStartTime=r,c.mediaStartTime=i,c.availabilityStartTime=a.calcAvailabilityStartTimeFromPresentationTime(s,e,o),c.availabilityEndTime=a.calcAvailabilityEndTimeFromPresentationTime(s+t,e,o),c.wallStartTime=a.calcWallTimeForSegment(c,o),c.replacementNumber=(u=l,c.representation.startNumber+u),c.index=l,c}function u(e,t,r,n){var i=t.adaptation.period;if(isFinite(i.duration)&&i.start+i.duration<=r.presentationStartTime)return!1;if(n){if("INF"===t.availabilityTimeOffset)return!0;var a=e.getClientReferenceTime();return r.availabilityStartTime.getTime()<=a&&(!isFinite(r.availabilityEndTime)||r.availabilityEndTime.getTime()>=a)}return!0}function c(e,t,r,n){var i,a,s;i=r.segmentDuration,isNaN(i)&&(i=r.adaptation.period.duration),a=parseFloat((r.adaptation.period.start+n*i).toFixed(5)),s=parseFloat((a+i).toFixed(5));var o=l(r,i,a,e.calcMediaTimeFromPresentationTime(a,r),e,s,t,n);return u(e,r,o,t)?o:null}function d(e,t,r,n,i,a,s,c,d,f){var h,g,p=n/a,m=i/a;return h=e.calcPresentationTimeFromMediaTime(p,r),u(e,r,g=l(r,m,h,p,e,h+m,t,d),t)?(g.replacementTime=f||n,s=o(s,"Number",g.replacementNumber),s=o(s,"Time",g.replacementTime),g.media=s,g.mediaRange=c,g):null}},3636:function(e,t,r){var n=r(5448),i=r(3393),a=r(7387);function s(e,t){var r=(e=e||{}).timelineConverter;function n(){if(!r||!r.hasOwnProperty("calcPeriodRelativeTimeFromMpdRelativeTime"))throw new Error(i.Z.MISSING_CONFIG_ERROR)}function s(e,i){if(n(),!e)return null;var s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate;i=Math.max(i,0);var o=(0,a.NF)(r,t,e,i);if(o){o.replacementTime=Math.round((i-1)*e.segmentDuration*e.timescale,10);var l=s.media;l=(0,a.vi)(l,"Number",o.replacementNumber),l=(0,a.vi)(l,"Time",o.replacementTime),o.media=l}return o}return{getSegmentByIndex:s,getSegmentByTime:function(e,t){if(n(),!e)return null;var i=e.segmentDuration;if(isNaN(i))return null;var a=r.calcPeriodRelativeTimeFromMpdRelativeTime(e,t);return s(e,Math.floor(a/i))},getMediaFinishedInformation:function(e){var t={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN};if(!e)return t;var r=e.segmentDuration;return isNaN(r)?t.numberOfSegments=1:t.numberOfSegments=Math.ceil(e.adaptation.period.duration/r),t}}}s.__dashjs_factory_name="TemplateSegmentsGetter";var o=n.Z.getClassFactory(s);t.Z=o},1724:function(e,t,r){var n=r(5448),i=r(3393),a=r(7387);function s(e,t){var r=(e=e||{}).timelineConverter,n=e.dashMetrics;function s(){if(!r)throw new Error(i.Z.MISSING_CONFIG_ERROR)}function o(e,t){var r,n,i,a,s,o,u,c=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList,d=c.SegmentTimeline,f=c.SegmentURL_asArray,h=0,g=-1;u=e.timescale;var p=!1;for(i=0,a=(r=d.S_asArray).length;i<a&&!p;i++)for(o=0,(n=r[i]).hasOwnProperty("r")&&(o=n.r),n.hasOwnProperty("t")&&(h=n.t),o<0&&(o=l(e,r[i+1],n,u,h/u)),s=0;s<=o&&!p;s++)(p=t(h,c,f,n,u,++g,i))&&(e.segmentDuration=n.d/u),h+=n.d}function l(e,t,i,a,s){var o;if(t&&t.hasOwnProperty("t"))o=t.t/a;else try{var l=0;if(isNaN(e.adaptation.period.start)||isNaN(e.adaptation.period.duration)||!isFinite(e.adaptation.period.duration)){var u=n.getCurrentDVRInfo();l=isNaN(u.end)?0:u.end}else l=e.adaptation.period.start+e.adaptation.period.duration;o=r.calcMediaTimeFromPresentationTime(l,e),e.segmentDuration=i.d/a}catch(e){o=0}return Math.max(Math.ceil((o-s)/(i.d/a))-1,0)}return{getSegmentByIndex:function(e,n,i){if(s(),!e)return null;var l=null,u=!1;return o(e,function(n,s,o,c,d,f,h){if(u||i<0){var g=s.media,p=c.mediaRange;return o&&(g=o[h].media||"",p=o[h].mediaRange),l=(0,a.TJ)(r,t,e,n,c.d,d,g,p,f,c.tManifest),!0}return n>=i*d-.5*c.d&&(u=!0),!1}),l},getSegmentByTime:function(e,n){if(s(),!e)return null;void 0===n&&(n=null);var i=null,l=r.calcMediaTimeFromPresentationTime(n,e);return o(e,function(n,s,o,u,c,d,f){var h=parseFloat((l*c).toPrecision(15));if(h<n+u.d&&h>=n){var g=s.media,p=u.mediaRange;return o&&(g=o[f].media||"",p=o[f].mediaRange),i=(0,a.TJ)(r,t,e,n,u.d,c,g,p,d,u.tManifest),!0}return!1}),i},getMediaFinishedInformation:function(e){if(!e)return 0;var t,r,n,i,a,s,o,u=(e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentTemplate||e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index].Representation_asArray[e.index].SegmentList).SegmentTimeline,c=0,d=0,f=0;for(o=e.timescale,i=(t=u.S_asArray).length,n=0;n<i;n++)for(s=0,(r=t[n]).hasOwnProperty("r")&&(s=r.r),r.hasOwnProperty("t")&&(d=(c=r.t)/o),s<0&&(s=l(e,t[n+1],r,o,d)),a=0;a<=s;a++)f++,d=(c+=r.d)/o;return{numberOfSegments:f,mediaTimeOfLastSignaledSegment:d}}}}s.__dashjs_factory_name="TimelineSegmentsGetter";var o=n.Z.getClassFactory(s);t.Z=o},2011:function(e,t){t.Z=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.wallStartTime=NaN,this.representation=null}},2610:function(e,t){t.Z=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value=""}},1139:function(e,t,r){r.d(t,{Z:function(){return Ja}});var n=r(452),i=r.n(n),a=r(3393),s=r(1553),o=r(3860),l=r(5595),u=r(8512),c=r(5448),d=r(6398),f=r(8825);function h(){var e,t,r,n,i,s,c,h,g,p,m,v,y,E,T,_,S,b,A,I,R,w,D,L,C,N=this.context,P=(0,l.Z)(N).getInstance();function O(){F(),E=!1,p=0,m=0,S=0,D=!1,b=!0,A=!1,L=!1,I=NaN,_=NaN,c&&(P.off(u.Z.DATA_UPDATE_COMPLETED,Q,e),P.off(u.Z.LOADING_PROGRESS,ye,e),P.off(u.Z.MANIFEST_UPDATED,Se,e),P.off(u.Z.STREAMS_COMPOSED,be,e),P.off(f.Z.PLAYBACK_ENDED,pe,e),P.off(f.Z.STREAM_INITIALIZING,Te,e),P.off(f.Z.REPRESENTATION_SWITCH,_e,e),P.off(f.Z.BUFFER_LEVEL_STATE_CHANGED,te,e),X(),c.removeEventListener("canplay",J),c.removeEventListener("canplaythrough",ee),c.removeEventListener("play",re),c.removeEventListener("waiting",ne),c.removeEventListener("playing",ie),c.removeEventListener("pause",ae),c.removeEventListener("error",me),c.removeEventListener("seeking",se),c.removeEventListener("seeked",oe),c.removeEventListener("timeupdate",le),c.removeEventListener("progress",ue),c.removeEventListener("ratechange",ce),c.removeEventListener("loadedmetadata",de),c.removeEventListener("loadeddata",fe),c.removeEventListener("stalled",Ee),c.removeEventListener("ended",he),c.removeEventListener("volumechange",ge)),g=null,c=null,v=null,y=null}function M(){return parseFloat((k(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)-G()).toFixed(5))}function k(e){var t=e||v;return t.start+t.duration}function x(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];v&&c&&c.getElement()?(e&&y&&Z(G()),c.play()):E=!0}function F(){v&&c&&c.pause()}function B(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];v&&c&&c.getElement()&&e!==(isNaN(I)?c.getTime():I)&&((R=!0===n)||(I=e),t.info("Requesting seek to time: "+e+(R?" (internal)":"")),y&&i&&Z(e),c.setCurrentTime(e,r))}function U(){if(v&&c&&y){var e=r&&r.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,t=i.getCurrentDVRInfo(e);return t&&t.range?t.range.end:0}}function Z(e){var t=new Date(h.getClientReferenceTime()),r=s.getRegularPeriods()[0],n=h.calcPresentationTimeFromWallTime(t,r);p=n-e}function G(){return v&&c?c.getTime():null}function H(){return v&&c?c.isPaused():null}function $(){return v&&c?c.isSeeking():null}function V(){return v&&c?c.isStalled():null}function K(){return v&&c?c.getPlaybackRate():null}function q(){return v&&c?c.getEnded():null}function Y(){return y}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!H()&&y&&0!==c.getReadyState()&&!$()&&!D){e||(e=r.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO);var n=G(),i=z(n,e);!isNaN(i)&&i!==n&&!$()&&(V()||w||1===c.getReadyState())&&(t.debug("UpdateCurrentTime: Seek to actual time: ".concat(i," from currentTime: ").concat(n)),B(i,!1,!1))}}function z(e,t){var r=i.getCurrentDVRInfo(t),n=r?r.range:null;return n?e>n.end?Math.max(n.end-p,n.start):e>0&&e+.25<n.start&&Math.abs(e-n.start)<31536e4?A?Math.max(n.end-p,n.start):n.start:e:NaN}function W(){null===g&&(g=setInterval(function(){!function(){if(P.trigger(u.Z.WALLCLOCK_TIME_UPDATED,{isDynamic:y,time:new Date}),Y()){var e=Date.now();(isNaN(_)||e>_+C.get().streaming.liveUpdateTimeThresholdInMilliseconds)&&(r.addDVRMetric(),H()?function(){var e=Date.now();(!T||e>T+500)&&(T=e,le())}():j(),_=e)}}()},C.get().streaming.wallclockTimeUpdateInterval))}function X(){clearInterval(g),g=null}function Q(e){var t=s.convertRepresentationToRepresentationInfo(e.currentRepresentation),r=t?t.mediaInfo.streamInfo:null;null!==r&&v.id===r.id&&(v=r)}function J(){P.trigger(u.Z.CAN_PLAY)}function ee(){P.trigger(u.Z.CAN_PLAY_THROUGH)}function te(e){e.streamId===r.getActiveStreamInfo().id&&(w=e.state===o.Z.BUFFER_EMPTY,C.get().streaming.buffer.setStallState&&c.setStallState(e.mediaType,e.state===o.Z.BUFFER_EMPTY))}function re(){t.info("Native video element event: play"),j(),W(),P.trigger(u.Z.PLAYBACK_STARTED,{startTime:G()})}function ne(){t.info("Native video element event: waiting"),P.trigger(u.Z.PLAYBACK_WAITING,{playingTime:G()})}function ie(){t.info("Native video element event: playing"),R=!1,P.trigger(u.Z.PLAYBACK_PLAYING,{playingTime:G()})}function ae(){t.info("Native video element event: pause"),P.trigger(u.Z.PLAYBACK_PAUSED,{ended:q()})}function se(){if(!R){var e=G();isNaN(I)||I===e||(e=I),I=NaN,t.info("Seeking to: "+e),W(),P.trigger(u.Z.PLAYBACK_SEEKING,{seekTime:e,streamId:v.id})}}function oe(){t.info("Native video element event: seeked"),R=!1,P.trigger(u.Z.PLAYBACK_SEEKED)}function le(){v&&P.trigger(u.Z.PLAYBACK_TIME_UPDATED,{timeToEnd:M(),time:G(),streamId:v.id})}function ue(){P.trigger(u.Z.PLAYBACK_PROGRESS,{streamId:v.id})}function ce(){var e=K();t.info("Native video element event: ratechange: ",e),P.trigger(u.Z.PLAYBACK_RATE_CHANGED,{playbackRate:e})}function de(){t.info("Native video element event: loadedmetadata"),P.trigger(u.Z.PLAYBACK_METADATA_LOADED),W()}function fe(){t.info("Native video element event: loadeddata"),P.trigger(u.Z.PLAYBACK_LOADED_DATA)}function he(){t.info("Native video element event: ended"),F(),X();var e=r?r.getActiveStreamInfo():null;e&&P.trigger(u.Z.PLAYBACK_ENDED,{isLast:e.isLast})}function ge(){P.trigger(u.Z.PLAYBACK_VOLUME_CHANGED)}function pe(e){if(g&&e.isLast){t.info("onPlaybackEnded -- PLAYBACK_ENDED but native video element didn't fire ended");var r=e.seekTime?e.seekTime:k();c.setCurrentTime(r),F(),X()}}function me(e){var t=e.target||e.srcElement;P.trigger(u.Z.PLAYBACK_ERROR,{error:t.error})}function ve(){y=!1}function ye(e){if(!1===e.stream&&A&&!isNaN(e.request.duration)){var r=1.2*e.request.duration;r>p&&(t.warn("Browser does not support fetch API with StreamReader. Increasing live delay to be 20% higher than segment duration:",r.toFixed(2)),p=r,m=r)}}function Ee(e){P.trigger(u.Z.PLAYBACK_STALLED,{e:e})}function Te(e){var r;(r=e.mediaInfo)&&r.supplementalProperties&&r.supplementalProperties[a.Z.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME]&&"true"===r.supplementalProperties[a.Z.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME].value&&(t.debug("Low Latency critical SupplementalProperty set: Enabling low Latency"),A=!0)}function _e(e){var t=r.getActiveStreamInfo();e&&t&&e.currentRepresentation&&e.streamId&&e.streamId===t.id&&e.mediaType&&(e.mediaType===a.Z.VIDEO||e.mediaType===a.Z.AUDIO)&&(b=e.currentRepresentation.availabilityTimeComplete,(A=!b)&&!L&&(L=!0))}function Se(){D=!0}function be(){D=!1}return e={initialize:function(t,r){v=t,!0!==r&&(c.addEventListener("canplay",J),c.addEventListener("canplaythrough",ee),c.addEventListener("play",re),c.addEventListener("waiting",ne),c.addEventListener("playing",ie),c.addEventListener("pause",ae),c.addEventListener("error",me),c.addEventListener("seeking",se),c.addEventListener("seeked",oe),c.addEventListener("timeupdate",le),c.addEventListener("progress",ue),c.addEventListener("ratechange",ce),c.addEventListener("loadedmetadata",de),c.addEventListener("loadeddata",fe),c.addEventListener("stalled",Ee),c.addEventListener("ended",he),c.addEventListener("volumechange",ge),y=v.manifestInfo.isDynamic,w=!1,R=!1,P.on(u.Z.DATA_UPDATE_COMPLETED,Q,e),P.on(u.Z.LOADING_PROGRESS,ye,e),P.on(u.Z.MANIFEST_UPDATED,Se,e),P.on(u.Z.STREAMS_COMPOSED,be,e),P.on(f.Z.PLAYBACK_ENDED,pe,e,{priority:l.Z.EVENT_PRIORITY_HIGH}),P.on(f.Z.STREAM_INITIALIZING,Te,e),P.on(f.Z.REPRESENTATION_SWITCH,_e,e),P.on(f.Z.BUFFER_LEVEL_STATE_CHANGED,te,e),P.on(f.Z.DYNAMIC_TO_STATIC,ve,e),E&&(E=!1,x()))},setConfig:function(e){e&&(e.streamController&&(r=e.streamController),e.serviceDescriptionController&&(n=e.serviceDescriptionController),e.dashMetrics&&(i=e.dashMetrics),e.adapter&&(s=e.adapter),e.videoModel&&(c=e.videoModel),e.timelineConverter&&(h=e.timelineConverter),e.settings&&(C=e.settings))},getTimeToStreamEnd:M,getBufferLevel:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null;return r.getActiveStreamProcessors().forEach(function(r){if(!e||0===e.length||-1===e.indexOf(r.getType())){var n=r.getBufferLevel();t=null===t?n:Math.min(t,n)}}),t},getPlaybackStalled:function(){return w},getTime:G,getLowLatencyModeEnabled:function(){return A},getInitialCatchupModeActivated:function(){return L},getIsManifestUpdateInProgress:function(){return D},getPlaybackRate:K,getPlayedRanges:function(){return v&&c?c.getPlayedRanges():null},getEnded:q,getIsDynamic:Y,getStreamController:function(){return r},computeAndSetLiveDelay:function(e,t){var r,i,a,o=!isNaN(e)&&isFinite(e)?e:NaN,l=s.getSuggestedPresentationDelay(),u=n.getServiceDescriptionSettings();return r=isNaN(C.get().streaming.delay.liveDelay)?null===C.get().streaming.delay.liveDelayFragmentCount||isNaN(C.get().streaming.delay.liveDelayFragmentCount)||isNaN(o)?u&&!isNaN(u.liveDelay)&&u.liveDelay>0?u.liveDelay:!0===C.get().streaming.delay.useSuggestedPresentationDelay&&null!==l&&!isNaN(l)&&l>0?l:isNaN(o)?t&&!isNaN(t.minBufferTime)?4*t.minBufferTime:4*v.manifestInfo.minBufferTime:4*o:o*C.get().streaming.delay.liveDelayFragmentCount:C.get().streaming.delay.liveDelay,null!==(a=s.getAvailabilityStartTime())&&(S=a),i=t&&t.dvrWindowSize>0?Math.min(r,t.dvrWindowSize):r,p=i,m=i,i},getLiveDelay:function(){return p},getOriginalLiveDelay:function(){return m},getCurrentLiveLatency:function(){if(!y||isNaN(S))return NaN;var e=G();if(isNaN(e)||0===e)return 0;var t=(new Date).getTime()+1e3*h.getClientTimeOffset();return Math.max(((t-S-1e3*e)/1e3).toFixed(3),0)},play:x,isPaused:H,isStalled:V,pause:F,isSeeking:$,getStreamEndTime:k,seek:B,seekToOriginalLive:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=U();0!==n&&B(n-(p=m),e,t,r)},seekToCurrentLive:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=U();0!==n&&B(n-p,e,t,r)},reset:O,updateCurrentTime:j,getAvailabilityStartTime:function(){return S}},t=(0,d.Z)(N).getInstance().getLogger(e),O(),e}h.__dashjs_factory_name="PlaybackController";var g=c.Z.getSingletonFactory(h),p=r(3186),m="loading",v="executed",y="failed";function E(e){var t,r,n,i,a=(e=e||{}).eventBus,s=e.events,o=e.dashMetrics,l=e.fragmentLoader,u=e.debug,c=e.streamInfo,d=e.type;function f(e){var t;return!!e&&(t=!1,n.some(function(r){if(n=e,i=r,!isNaN(n.index)&&n.startTime===i.startTime&&n.adaptationIndex===i.adaptationIndex&&n.type===i.type||function(e,t){return isNaN(e.index)&&isNaN(t.index)&&e.quality===t.quality}(e,r)||function(e,t){return e.action===p.Z.ACTION_COMPLETE&&e.action===t.action}(e,r))return t=!0;var n,i}),t)}function h(e){return isNaN(e.duration)?.25:Math.min(e.duration/8,.5)}function g(e){n=n.filter(function(t){var r=h(t);return isNaN(t.startTime)||void 0!==e&&t.startTime>=e-r})}function E(e,t){t<=e+.5||(n=n.filter(function(r){var n=h(r);return isNaN(r.startTime)||r.startTime>=t-n||isNaN(r.duration)||r.startTime+r.duration<=e+n}))}function T(e,t,r){for(var n=e.length-1;n>=0;n--){var i=e[n],a=i.startTime,s=a+i.duration;if(r=isNaN(r)?h(i):r,!isNaN(a)&&!isNaN(s)&&t+r>=a&&t-r<s||isNaN(a)&&isNaN(t))return i}return null}function _(e,t){o.addSchedulingInfo(e,t),o.addRequestsQueue(e.mediaType,i,n)}function S(e){e.sender===l&&(i.splice(i.indexOf(e.request),1),e.response&&!e.error&&n.push(e.request),_(e.request,e.error?y:v),a.trigger(s.FRAGMENT_LOADING_COMPLETED,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:c.id,mediaType:d}))}function b(e){e.sender===l&&a.trigger(s.FRAGMENT_LOADING_PROGRESS,{request:e.request,response:e.response,error:e.error,sender:this},{streamId:c.id,mediaType:d})}function A(e){e.sender===l&&a.trigger(s.FRAGMENT_LOADING_ABANDONED,{request:e.request},{streamId:c.id,mediaType:d})}function I(){n=[],i=[]}return t={getStreamId:function(){return c.id},getType:function(){return d},getRequests:function(e){var t=e?e.state instanceof Array?e.state:[e.state]:[],r=[];return t.forEach(function(t){var a=function(e){var t;switch(e){case m:t=i;break;case v:t=n;break;default:t=[]}return t}(t);r=r.concat(function(e,t){return t.hasOwnProperty("time")?[T(e,t.time,t.threshold)]:e.filter(function(e){for(var r in t)if("state"!==r&&t.hasOwnProperty(r)&&e[r]!=t[r])return!1;return!0})}(a,e))}),r},isFragmentLoaded:f,isFragmentLoadedOrPending:function(e){var t,r=!1,n=0;if(!(r=f(e)))for(n=0;n<i.length;n++)t=i[n],e.url===t.url&&e.startTime===t.startTime&&(r=!0);return r},removeExecutedRequestsBeforeTime:g,removeExecutedRequestsAfterTime:function(e){n=n.filter(function(t){return isNaN(t.startTime)||void 0!==e&&t.startTime<e})},syncExecutedRequestsWithBufferedRange:function(e,t){if(e&&0!==e.length){for(var r=0,n=0,i=e.length;n<i;n++)E(r,e.start(n)),r=e.end(n);t>0&&E(r,t)}else g()},abortRequests:function(){r.debug("abort requests"),l.abort(),i=[]},executeRequest:function(e){e.action===p.Z.ACTION_DOWNLOAD?(_(e,m),i.push(e),function(e){a.trigger(s.FRAGMENT_LOADING_STARTED,{request:e},{streamId:c.id,mediaType:d}),l.load(e)}(e)):r.warn("Unknown request action.")},reset:function(){a.off(s.LOADING_COMPLETED,S,this),a.off(s.LOADING_DATA_PROGRESS,b,this),a.off(s.LOADING_ABANDONED,A,this),l&&l.reset(),I()},resetInitialSettings:I,addExecutedRequest:function(e){n.push(e)}},r=u.getLogger(t),I(),a.on(s.LOADING_COMPLETED,S,t),a.on(s.LOADING_DATA_PROGRESS,b,t),a.on(s.LOADING_ABANDONED,A,t),t}E.__dashjs_factory_name="FragmentModel";var T=c.Z.getClassFactory(E);T.FRAGMENT_MODEL_LOADING=m,T.FRAGMENT_MODEL_EXECUTED=v,T.FRAGMENT_MODEL_CANCELED="canceled",T.FRAGMENT_MODEL_FAILED=y,c.Z.updateClassFactory(E.__dashjs_factory_name,T);var _=T,S=r(5459);function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function A(e,t){return A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},A(e,t)}function I(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},R(e)}var w=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=R(t);if(r){var i=R(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return I(this,e)});function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=n.call(this)).MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE=10,e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE=11,e.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE=12,e.SEGMENT_BASE_LOADER_ERROR_CODE=15,e.TIME_SYNC_FAILED_ERROR_CODE=16,e.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE=17,e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE=18,e.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE=19,e.APPEND_ERROR_CODE=20,e.REMOVE_ERROR_CODE=21,e.DATA_UPDATE_FAILED_ERROR_CODE=22,e.CAPABILITY_MEDIASOURCE_ERROR_CODE=23,e.CAPABILITY_MEDIAKEYS_ERROR_CODE=24,e.DOWNLOAD_ERROR_ID_MANIFEST_CODE=25,e.DOWNLOAD_ERROR_ID_SIDX_CODE=26,e.DOWNLOAD_ERROR_ID_CONTENT_CODE=27,e.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE=28,e.DOWNLOAD_ERROR_ID_XLINK_CODE=29,e.MANIFEST_ERROR_ID_PARSE_CODE=31,e.MANIFEST_ERROR_ID_NOSTREAMS_CODE=32,e.TIMED_TEXT_ERROR_ID_PARSE_CODE=33,e.MANIFEST_ERROR_ID_MULTIPLEXED_CODE=34,e.MEDIASOURCE_TYPE_UNSUPPORTED_CODE=35,e.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE="parsing failed for ",e.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading manifest: ",e.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE="Failed loading Xlink element: ",e.SEGMENTS_UPDATE_FAILED_ERROR_MESSAGE="Segments update failed",e.SEGMENTS_UNAVAILABLE_ERROR_MESSAGE="no segments are available yet",e.SEGMENT_BASE_LOADER_ERROR_MESSAGE="error loading segment ranges from sidx",e.TIME_SYNC_FAILED_ERROR_MESSAGE="Failed to synchronize client and server time",e.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE="request is null",e.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE="Failed to resolve a valid URL",e.APPEND_ERROR_MESSAGE="chunk is not defined",e.REMOVE_ERROR_MESSAGE="Removing data from the SourceBuffer",e.DATA_UPDATE_FAILED_ERROR_MESSAGE="Data update failed",e.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE="mediasource is not supported",e.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE="mediakeys is not supported",e.TIMED_TEXT_ERROR_MESSAGE_PARSE="parsing error :",e.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE="Error creating source buffer of type : ",e}return i}(r(2230).Z)),D=r(1264),L=r(7855);function C(e){var t,r,n,i,s,o,l=this.context,c=(0,D.Z)(l).getInstance(),f=e.textController,h=e.eventBus,g=[],p=[],m=!1,v=e.mediaSource,y=null;function E(e){return new Promise(function(t){P(function(){i.changeType&&i.changeType(e),t()})})}function T(e){return i=f.getTextSourceBuffer(e),Promise.resolve()}function _(){if("function"==typeof i.addEventListener)try{i.addEventListener("updateend",C,!1),i.addEventListener("error",N,!1),i.addEventListener("abort",N,!1)}catch(e){o=setInterval(C,50)}else o=setInterval(C,50)}function b(e){return new Promise(function(t){i&&c.get().streaming.buffer.useAppendWindow?P(function(){try{if(!i)return void t();var r=v.duration,a=0;e&&!isNaN(e.start)&&!isNaN(e.duration)&&isFinite(e.duration)&&(r=e.start+e.duration),e&&!isNaN(e.start)&&(a=e.start),i.appendWindowEnd===r&&i.appendWindowStart===a||(i.appendWindowStart=0,i.appendWindowEnd=r+.01,i.appendWindowStart=Math.max(a-.1,0),n.debug("Updated append window for ".concat(s.type,". Set start to ").concat(i.appendWindowStart," and end to ").concat(i.appendWindowEnd))),t()}catch(e){n.warn("Failed to set append window"),t()}}):t()})}function A(e){return new Promise(function(t){i?P(function(){try{i.timestampOffset===e||isNaN(e)||(i.timestampOffset=e,n.debug("Set MSE timestamp offset to ".concat(e))),t()}catch(e){t()}}):t()})}function I(){if(!m&&p.length>0){m=!0;var e=p[0];p.splice(0,1);var t=function(){m=!1,p.length>0&&I.call(this),e&&e.data&&e.data.segmentType&&e.data.segmentType!==L.w.INIT_SEGMENT_TYPE&&delete e.data.bytes,e.promise.resolve({chunk:e.data})};try{y=e.request,0===e.data.bytes.byteLength?t.call(this):(i.appendBuffer?i.appendBuffer(e.data.bytes):i.append(e.data.bytes,e.data),P(t.bind(this)))}catch(t){n.fatal('SourceBuffer append failed "'+t+'"'),p.length>0?I():m=!1,delete e.data.bytes,e.promise.reject({chunk:e.data,error:new S.Z(t.code,t.message)})}}}function R(){g.length>0&&(i.updating||(g.shift()(),R()))}function C(){i.updating||R()}function N(e){var t,n,i=e.target||{};t=u.Z.SOURCE_BUFFER_ERROR,n={error:i,lastRequestAppended:y}||{},h.trigger(t,n,{streamId:s.streamInfo.id,mediaType:r})}function P(e){g.push(e),i.updating||R()}return t={getType:function(){return r},getAllBufferRanges:function(){try{return i.buffered}catch(e){return n.error("getAllBufferRanges exception: "+e.message),null}},getBuffer:function(){return i},append:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise(function(n,i){e?(p.push({data:e,promise:{resolve:n,reject:i},request:r}),P(I.bind(t))):i({chunk:e,error:new S.Z(w.APPEND_ERROR_CODE,w.APPEND_ERROR_MESSAGE)})})},remove:function(e){return new Promise(function(t,r){var n=e.start,a=e.end;n>=0&&a>n?P(function(){try{i.remove(n,a),P(function(){t({from:n,to:a,unintended:!1}),e.resolve&&e.resolve()})}catch(t){r({from:n,to:a,unintended:!1,error:new S.Z(w.REMOVE_ERROR_CODE,w.REMOVE_ERROR_MESSAGE)}),e.reject&&e.reject(t)}}):t()})},abort:function(){return new Promise(function(e){try{p=[],"open"===v.readyState?P(function(){try{i&&i.abort(),e()}catch(t){e()}}):i&&i.setTextTrack&&"ended"===v.readyState?(i.abort(),e()):e()}catch(t){e()}})},reset:function(){if(i){try{g=[],function(){try{"function"==typeof i.removeEventListener&&(i.removeEventListener("updateend",C,!1),i.removeEventListener("error",N,!1),i.removeEventListener("abort",N,!1)),clearInterval(o)}catch(e){n.error(e)}}(),m=!1,p=[],i.getClassName&&"TextSourceBuffer"===i.getClassName()||(n.debug("Removing sourcebuffer from media source"),v.removeSourceBuffer(i))}catch(e){}i=null}y=null},updateTimestampOffset:A,initializeForStreamSwitch:function(e,t,n){r=(s=e).type;var a=s.codec;!function(e){i=e.getBuffer()}(n),_();var o=[];return o.push(new Promise(function(e){P(function(){var t=i.appendWindowStart,r=i.appendWindowEnd;i&&(i.abort(),i.appendWindowStart=t,i.appendWindowEnd=r),e()})})),o.push(b(s.streamInfo)),c.get().streaming.buffer.useChangeTypeForTrackSwitch&&o.push(E(a)),t&&void 0!==t.MSETimeOffset&&o.push(A(t.MSETimeOffset)),Promise.all(o)},initializeForFirstUse:function(e,t,n){r=(s=t).type;var o=s.codec;try{if(o.match(/application\/mp4;\s*codecs="(stpp|wvtt).*"/i))return T(e);i=v.addSourceBuffer(o),_();var l=[];return l.push(b(s.streamInfo)),n&&void 0!==n.MSETimeOffset&&l.push(A(n.MSETimeOffset)),Promise.all(l)}catch(t){return s.type==a.Z.TEXT&&!s.isFragmented||-1!==o.indexOf('codecs="stpp')||-1!==o.indexOf('codecs="vtt')||-1!==o.indexOf("text/vtt")?T(e):Promise.reject(t)}},updateAppendWindow:b,changeType:E},n=(0,d.Z)(l).getInstance().getLogger(t),t}C.__dashjs_factory_name="SourceBufferSink";var N=c.Z.getClassFactory(C);function P(e){var t,r,n,i=this.context,a=[],s=e;function o(e,t){return a=a.filter(function(r){return!((isNaN(t)||r.start<t)&&(isNaN(e)||r.end>e))}),Promise.resolve()}return t={getAllBufferRanges:function(){for(var e=[],t=0;t<a.length;t++){var r=a[t];0===e.length||r.start>e[e.length-1].end?e.push({start:r.start,end:r.end}):e[e.length-1].end=r.end}var n={start:function(t){return e[t].start},end:function(t){return e[t].end}};return Object.defineProperty(n,"length",{get:function(){return e.length}}),n},append:function(e){return"InitializationSegment"!==e.segmentType?(a.push(e),a.sort(function(e,t){return e.start-t.start}),n=null):n=e,r.debug("PreBufferSink appended chunk s: "+e.start+"; e: "+e.end),s&&s({chunk:e}),Promise.resolve()},remove:o,abort:function(){return Promise.resolve()},discharge:function(e,t){var r=function(e,t){return a.filter(function(r){return(isNaN(t)||r.start<t)&&(isNaN(e)||r.end>e)})}(e,t);return n&&(r.push(n),n=null),o(e,t),r},reset:function(){a=[],n=null,s=null},updateTimestampOffset:function(){return Promise.resolve()},waitForUpdateEnd:function(e){e()},getBuffer:function(){return this}},r=(0,d.Z)(i).getInstance().getLogger(t),t}P.__dashjs_factory_name="PreBufferSink";var O=c.Z.getClassFactory(P);function M(){var e={};return{save:function(t){var r=t.streamId,n=t.representationId;e[r]=e[r]||{},e[r][n]=t},extract:function(t,r){return e&&e[t]&&e[t][r]?e[t][r]:null},reset:function(){e={}}}}M.__dashjs_factory_name="InitCache";var k=c.Z.getSingletonFactory(M),x=.01,F="BufferController";function B(e){e=e||{};var t,r,n,i,s,c,h,g,p,m,v,y,E,T,b,A,I,R,D,C,P,M=this.context,B=(0,l.Z)(M).getInstance(),U=e.errHandler,Z=e.fragmentModel,G=e.representationController,H=e.adapter,$=e.textController,V=e.abrController,K=e.playbackController,q=e.streamInfo,Y=e.type,j=e.settings;function z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise(function(r,n){c=e,p&&t&&"function"==typeof p.discharge?(m=p,X(t).then(function(){r()}).catch(function(e){n(e)})):r()})}function W(e){return H.convertRepresentationToRepresentationInfo(G.getRepresentationForQuality(e))}function X(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise(function(r,n){R&&e?c?(v=!1,J(e,t).then(function(e){r(e)}).catch(function(e){n(e)})):(v=!0,Q().then(function(e){r(e)}).catch(function(e){n(e)})):r(null)})}function Q(){var e=this;return new Promise(function(t,r){var n=V.getQualityFor(Y,q.id);p=O(M).create(ie.bind(e)),Te(W(n)).then(function(){t(p)}).catch(function(){r()})})}function J(e,t){return new Promise(function(n,i){var s=V.getQualityFor(Y,q.id);p=N(M).create({mediaSource:c,textController:$,eventBus:B}),function(e,t,r){var n=W(r);return t&&t[Y]&&(Y===a.Z.VIDEO||Y===a.Z.AUDIO)?p.initializeForStreamSwitch(e,n,t[Y]):p.initializeForFirstUse(q,e,n)}(e,t,s).then(function(){return Te(W(s))}).then(function(){n(p)}).catch(function(e){r.fatal("Caught error on create SourceBuffer: "+e),U.error(new S.Z(w.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,w.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+Y)),i(e)})})}function ee(e){j.get().streaming.cacheInitSegments&&(r.info("Init fragment finished loading saving to",Y+"'s init cache"),R.save(e.chunk)),r.debug("Append Init fragment",Y," with representationId:",e.chunk.representationId," and quality:",e.chunk.quality,", data size:",e.chunk.bytes.byteLength),re(e.chunk)}function te(e){re(e.chunk,e.request)}function re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;p&&(p.append(e,t).then(function(e){ie(e)}).catch(function(e){ie(e)}),e.mediaInfo.type===a.Z.VIDEO&&De(u.Z.VIDEO_CHUNK_RECEIVED,{chunk:e}))}function ne(e){if(e&&e.length>0)for(var t=0,n=e.length;t<n;t++)r.debug("Buffered range: "+e.start(t)+" - "+e.end(t)+", currentTime = ",K.getTime())}function ie(e){if(e.error)return 22===e.error.code&&function(){if(I=!0,s=.8*Ie(),r.warn("Quota exceeded, Critical Buffer: "+s),s>0){var e=Math.max(.2*s,1),t=s-e,n=Math.min(j.get().streaming.buffer.bufferTimeAtTopQuality,.9*t),i=Math.min(j.get().streaming.buffer.bufferTimeAtTopQualityLongForm,.9*t),a={streaming:{buffer:{bufferToKeep:parseFloat(e.toFixed(5)),bufferTimeAtTopQuality:parseFloat(n.toFixed(5)),bufferTimeAtTopQualityLongForm:parseFloat(i.toFixed(5))}}};j.update(a)}}(),void(22!==e.error.code&&we()||(r.warn("Clearing playback buffer to overcome quota exceed situation"),De(u.Z.QUOTA_EXCEEDED,{criticalBufferLevel:s,quotaExceededTime:e.chunk.start}),ve(me())));if(p&&(de(),I=!1,(T=e.chunk)&&T.endFragment)){T&&!isNaN(T.index)&&(h=Math.max(T.index,h),fe());var t=p.getAllBufferRanges();T.segmentType===L.w.MEDIA_SEGMENT_TYPE&&(ne(t),oe(),function(){if(!isNaN(P)&&!v)if(Y===a.Z.AUDIO||Y===a.Z.VIDEO){var e=K.getTime(),t=ce(e,0),r=ce(P,0);if(t&&r&&t.start===r.start)P=NaN;else{var n=G.getCurrentRepresentation().segmentDuration,i=ce(P,n);i&&(j.get().streaming.buffer.enableSeekDecorrelationFix&&Math.abs(e-P)>n?P<=i.end&&K.seek(Math.max(P,i.start),!1,!0):e<i.start&&K.seek(i.start,!1,!0))}}else P=NaN}());var n=!1;y&&(y.indexOf(T)>0&&(n=!0),y=null),T&&!n&&De(u.Z.BYTES_APPENDED_END_FRAGMENT,{quality:T.quality,startTime:T.start,index:T.index,bufferedRanges:t,segmentType:T.segmentType,mediaType:Y})}}function ae(){return new Promise(function(e,t){var r=se();if(!r||0===r.length)return oe(),void e();ve(r).then(function(){e()}).catch(function(e){t(e)})})}function se(e){var t=[],n=p.getAllBufferRanges();if(!n||0===n.length)return t;if(!e&&0!==e||isNaN(e))t.push({start:n.start(0),end:n.end(n.length-1)+.5});else{var i=function(e,t){var r=j.get().streaming.buffer.bufferToKeep,n=t.start(0);if(e-n>r){var i=Math.max(0,e-r),a=Z.getRequests({state:_.FRAGMENT_MODEL_EXECUTED,time:e,threshold:x})[0];if(a&&(i=Math.min(a.startTime,i)),i>0)return{start:n,end:i}}return null}(e,n),a=function(e,t){var n=t.end(t.length-1)+.5,i=Re(e),a=q.manifestInfo.duration>=j.get().streaming.buffer.longFormContentDurationThreshold?j.get().streaming.buffer.bufferTimeAtTopQualityLongForm:j.get().streaming.buffer.bufferTimeAtTopQuality,s=isNaN(i)?e:Math.min(i,e+a);if(s>=t.end(t.length-1))return null;var o=Z.getRequests({state:_.FRAGMENT_MODEL_EXECUTED,time:e,threshold:x})[0];if(o&&(s=Math.max(o.startTime+o.duration,s)),j.get().streaming.buffer.avoidCurrentTimeRangePruning)for(var l=0;l<t.length;l++)if(t.start(l)<=e&&e<=t.end(l)&&t.start(l)<=s&&s<=t.end(l)){var u=s;s=l+1<t.length?t.start(l+1):t.end(l)+1,r.debug("Buffered range ["+t.start(l)+", "+t.end(l)+"] overlaps with targetTime "+e+" and range to be pruned ["+u+", "+n+"], using ["+s+", "+n+"] instead"+(s<n?"":" (no actual pruning)"));break}return s<t.end(t.length-1)?{start:s,end:n}:null}(e,n);i&&t.push(i),a&&t.push(a)}return t}function oe(){(!C||Y===a.Z.TEXT&&$.isTextEnabled())&&de()}function le(){he()}function ue(){he(),P=NaN}function ce(e,t){if(!p)return null;var r,n,i=p.getAllBufferRanges(),a=0,s=0,o=null,l=null,u=0,c=isNaN(t)?.15:t;if(null!=i){for(n=0,r=i.length;n<r;n++)if(a=i.start(n),s=i.end(n),null===o)u=Math.abs(a-e),(e>=a&&e<s||u<=c)&&(o=a,l=s);else{if(!((u=a-l)<=c))break;l=s}if(null!==o)return{start:o,end:l}}return null}function de(){if(K){var e=K.getTime()||0;v&&(e=isNaN(P)?0:P);var t=j.get().streaming.gaps.jumpGaps&&!isNaN(j.get().streaming.gaps.smallGapLimit)?j.get().streaming.gaps.smallGapLimit:NaN;i=Math.max(function(e,t){var r;return j.get().streaming.gaps.jumpGaps&&(t=j.get().streaming.gaps.smallGapLimit),null===(r=ce(e,t))?0:r.end-e}(e,t),0),De(u.Z.BUFFER_LEVEL_UPDATED,{mediaType:Y,bufferLevel:i}),he()}}function fe(){var e=h>=g-1,t=K.getTimeToStreamEnd(q)-i<1e-5;!e&&!t||n||(Ae(!0),r.debug("checkIfBufferingCompleted trigger BUFFERING_COMPLETED for stream id ".concat(q.id," and type ").concat(Y)))}function he(){Y!==a.Z.AUDIO&&Y!==a.Z.VIDEO||((!K.getLowLatencyModeEnabled()&&i<j.get().streaming.buffer.stallThreshold||0===i)&&!n?ge(o.Z.BUFFER_EMPTY):(n||i>=j.get().streaming.buffer.stallThreshold||K.getLowLatencyModeEnabled()&&i>0)&&ge(o.Z.BUFFER_LOADED))}function ge(e){E===e||e===o.Z.BUFFER_EMPTY&&0===K.getTime()||Y===a.Z.TEXT&&!$.isTextEnabled()||(E=e,De(u.Z.BUFFER_LEVEL_STATE_CHANGED,{state:e}),De(e===o.Z.BUFFER_LOADED?u.Z.BUFFER_LOADED:u.Z.BUFFER_EMPTY),r.debug(e===o.Z.BUFFER_LOADED?"Got enough buffer to start":"Waiting for more buffer before starting playback"))}function pe(){p&&Y!==a.Z.TEXT&&(n||ve(me()))}function me(){var e=[],t=p.getAllBufferRanges();if(!t||0===t.length)return e;var r=K.getTime(),n=Math.max(0,r-j.get().streaming.buffer.bufferToKeep),i=Z.getRequests({state:_.FRAGMENT_MODEL_EXECUTED,time:r,threshold:x})[0];if(i)n=Math.min(i.startTime,n);else if(0===r&&K.getIsDynamic())return[];if(t.start(0)<=n){for(var a={start:0,end:n},s=0;s<t.length&&t.end(s)<=n;s++)a.end=t.end(s);a.start<a.end&&e.push(a)}return e}function ve(e){return new Promise(function(t,r){if(e&&p&&0!==e.length){var n=[];e.forEach(function(e){n.push(function(e){return new Promise(function(t,r){e.resolve=t,e.reject=r,D.push(e)})}(e))}),A||ye(),Promise.all(n).then(function(){t()}).catch(function(e){r(e)})}else t()})}function ye(){try{if(0===D.length||!p)return r.debug("Nothing to prune, halt pruning"),D=[],void(A=!1);var e=p.getBuffer();if(!e||!e.buffered||0===e.buffered.length)return r.debug("SourceBuffer is empty (or does not exist), halt pruning"),D=[],void(A=!1);var t=D.shift();r.debug("".concat(Y,": Removing buffer from: ").concat(t.start," to ").concat(t.end)),A=!0,K.getTime()<t.end&&Ae(!1),p.remove(t).then(function(e){Ee(e)}).catch(function(e){Ee(e)})}catch(e){A=!1}}function Ee(e){r.debug("onRemoved buffer from:",e.from,"to",e.to),p&&(ne(p.getAllBufferRanges()),0===D.length&&(A=!1,de()),e.unintended&&(r.warn("Detected unintended removal from:",e.from,"to",e.to,"setting streamprocessor time to",e.from),De(u.Z.SEEK_TARGET,{time:e.from})),A?ye():(C?C=!1:de(),De(u.Z.BUFFER_CLEARED,{from:e.from,to:e.to,unintended:e.unintended,hasEnoughSpaceToAppend:we(),quotaExceeded:I})))}function Te(e){return new Promise(function(t){e&&void 0!==e.MSETimeOffset&&p&&p.updateTimestampOffset?p.updateTimestampOffset(e.MSETimeOffset).then(function(){t()}).catch(function(){t()}):t()})}function _e(){return p&&!n?p.updateAppendWindow(q):Promise.resolve()}function Se(){++b*(j.get().streaming.wallclockTimeUpdateInterval/1e3)>=j.get().streaming.buffer.bufferPruningInterval&&(b=0,pe())}function be(){he()}function Ae(e){(n=e)?De(u.Z.BUFFERING_COMPLETED):g=Number.POSITIVE_INFINITY}function Ie(){try{var e,t,r=p.getAllBufferRanges(),n=0;if(!r)return n;for(t=0,e=r.length;t<e;t++)n+=r.end(t)-r.start(t);return n}catch(e){return 0}}function Re(e){try{var t=e,r=p.getAllBufferRanges();if(!r||0===r.length)return NaN;for(var n=0;t===e&&n<r.length;){var i=r.start(n),a=r.end(n);t>=i&&t<=a&&(t=a),n+=1}return t===e?NaN:t}catch(e){}}function we(){var e=Ie();return isNaN(e)||e<s}function De(e,t){var r=t||{};B.trigger(e,r,{streamId:q.id,mediaType:Y})}function Le(e,t){if(s=Number.POSITIVE_INFINITY,E=void 0,g=Number.POSITIVE_INFINITY,h=0,T=null,n=!1,A=!1,I=!1,i=0,b=0,D=[],P=NaN,v=!1,p){var r=p;p=null,e||t||r.abort().then(function(){r.reset(t),r=null})}C=!1}return t={initialize:function(e){z(e),B.on(u.Z.INIT_FRAGMENT_LOADED,ee,t),B.on(u.Z.MEDIA_FRAGMENT_LOADED,te,t),B.on(u.Z.WALLCLOCK_TIME_UPDATED,Se,t),B.on(f.Z.PLAYBACK_PLAYING,ue,t),B.on(f.Z.PLAYBACK_PROGRESS,oe,t),B.on(f.Z.PLAYBACK_TIME_UPDATED,oe,t),B.on(f.Z.PLAYBACK_RATE_CHANGED,be,t),B.on(f.Z.PLAYBACK_STALLED,le,t)},getStreamId:function(){return q.id},getType:function(){return Y},getBufferControllerType:function(){return F},createBufferSink:X,dischargePreBuffer:function(){if(p&&m&&"function"==typeof m.discharge){var e=m.getAllBufferRanges();if(e.length>0){for(var t="Beginning "+Y+"PreBuffer discharge, adding buffer for:",n=0;n<e.length;n++)t+=" start: "+e.start(n)+", end: "+e.end(n)+";";r.debug(t)}else r.debug("PreBuffer discharge requested, but there were no media segments in the PreBuffer.");y=[];for(var i=m.discharge(),a=null,s=0;s<i.length;s++){var o=i[s];if(o.segmentType!==L.w.INIT_SEGMENT_TYPE){var l=R.extract(o.streamId,o.representationId);l&&a!==l&&(y.push(l),p.append(l),a=l)}y.push(o),p.append(o)}m.reset(),m=null}},getBuffer:function(){return p},getBufferLevel:function(){return i},getRangeAt:ce,hasBufferAtTime:function(e){try{var t=p.getAllBufferRanges();if(!t||0===t.length)return!1;for(var n=0;n<t.length;){var i=t.start(n),a=t.end(n);if(e>=i&&e<=a)return!0;n+=1}return!1}catch(e){return r.error(e),!1}},pruneBuffer:pe,setMediaSource:z,getMediaSource:function(){return c},appendInitSegmentFromCache:function(e){var t=R.extract(q.id,e);return!!t&&(r.info("Append Init fragment",Y," with representationId:",t.representationId," and quality:",t.quality,", data size:",t.bytes.byteLength),re(t),!0)},getIsBufferingCompleted:function(){return n},setIsBufferingCompleted:Ae,getIsPruningInProgress:function(){return A},reset:function(e,t){B.off(u.Z.INIT_FRAGMENT_LOADED,ee,this),B.off(u.Z.MEDIA_FRAGMENT_LOADED,te,this),B.off(u.Z.WALLCLOCK_TIME_UPDATED,Se,this),B.off(f.Z.PLAYBACK_PLAYING,ue,this),B.off(f.Z.PLAYBACK_PROGRESS,oe,this),B.off(f.Z.PLAYBACK_TIME_UPDATED,oe,this),B.off(f.Z.PLAYBACK_RATE_CHANGED,be,this),B.off(f.Z.PLAYBACK_STALLED,le,this),Le(e,t)},prepareForPlaybackSeek:function(){return n&&Ae(!1),p.abort()},prepareForReplacementTrackSwitch:function(e){return new Promise(function(t,r){p.abort().then(function(){return _e()}).then(function(){return j.get().streaming.buffer.useChangeTypeForTrackSwitch?p.changeType(e):Promise.resolve()}).then(function(){return ae()}).then(function(){Ae(!1),t()}).catch(function(e){r(e)})})},prepareForNonReplacementTrackSwitch:function(e){return new Promise(function(t,r){_e().then(function(){return j.get().streaming.buffer.useChangeTypeForTrackSwitch?p.changeType(e):Promise.resolve()}).then(function(){t()}).catch(function(e){r(e)})})},prepareForForceReplacementQualitySwitch:function(e){return new Promise(function(t,r){p.abort().then(function(){return _e()}).then(function(){return ae()}).then(function(){return Te(e)}).then(function(){Ae(!1),t()}).catch(function(e){r(e)})})},updateAppendWindow:_e,getAllRangesWithSafetyFactor:se,getContinuousBufferTimeForTargetTime:Re,clearBuffers:ve,pruneAllSafely:ae,updateBufferTimestampOffset:Te,setSeekTarget:function(e){P=e},segmentRequestingCompleted:function(e){isNaN(e)||(g=e,fe())}},r=(0,d.Z)(M).getInstance().getLogger(t),R=k(M).getInstance(),Le(),t}B.__dashjs_factory_name=F;var U=c.Z.getClassFactory(B),Z="NotFragmentedTextBufferController";function G(e){e=e||{};var t,r,n,i,a,s,o=this.context,c=(0,l.Z)(o).getInstance(),d=e.textController,f=e.errHandler,h=e.streamInfo,g=e.type;function p(e){i=e}function m(e){var t,n;r!==e&&(r=e)&&(t=u.Z.BUFFERING_COMPLETED,n={},c.trigger(t,n,{streamId:h.id,mediaType:g}))}function v(e){e.chunk.bytes&&!r&&(s.save(e.chunk),a.append(e.chunk),m(!0))}return t={initialize:function(e){p(e)},getStreamId:function(){return h.id},getType:function(){return g},getBufferControllerType:function(){return Z},createBufferSink:function(e){return new Promise(function(t,r){try{(a=N(o).create({mediaSource:i,textController:d,eventBus:c})).initializeForFirstUse(h,e),n||(a.getBuffer()&&"function"==typeof a.getBuffer().initialize&&a.getBuffer().initialize(),n=!0),t(a)}catch(e){f.error(new S.Z(w.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,w.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+g)),r(e)}})},dischargePreBuffer:function(){},getBuffer:function(){return a},getBufferLevel:function(){return 0},getRangeAt:function(){return null},pruneBuffer:function(){},hasBufferAtTime:function(){return!0},getAllRangesWithSafetyFactor:function(){return[]},getContinuousBufferTimeForTargetTime:function(){return Number.POSITIVE_INFINITY},setMediaSource:p,getMediaSource:function(){return i},appendInitSegmentFromCache:function(e){return null!==s.extract(h.id,e)},getIsBufferingCompleted:function(){return r},setIsBufferingCompleted:m,getIsPruningInProgress:function(){return!1},reset:function(e){c.off(u.Z.INIT_FRAGMENT_LOADED,v,t),!e&&a&&(a.abort(),a.reset(),a=null)},clearBuffers:function(){return Promise.resolve()},prepareForPlaybackSeek:function(){return Promise.resolve()},prepareForReplacementTrackSwitch:function(){return r=!1,Promise.resolve()},setSeekTarget:function(){},updateAppendWindow:function(){return Promise.resolve()},pruneAllSafely:function(){return Promise.resolve()},updateBufferTimestampOffset:function(){return Promise.resolve()},segmentRequestingCompleted:function(){}},n=!1,i=null,r=!1,s=k(o).getInstance(),c.on(u.Z.INIT_FRAGMENT_LOADED,v,t),t}G.__dashjs_factory_name=Z;var H=c.Z.getClassFactory(G);function $(e){e=e||{};var t,r,n,i,s,c,h,g,p,m,v,y,E,T=this.context,S=(0,l.Z)(T).getInstance(),b=e.dashMetrics,A=e.mediaPlayerModel,I=e.fragmentModel,R=e.abrController,w=e.playbackController,D=e.textController,L=e.type,C=e.bufferController,N=e.representationController,P=e.settings;function O(){y=!0}function M(){y=!1}function k(e){if(!C.getIsBufferingCompleted()){x();var t=isNaN(e)?0:e;s=setTimeout(F,t)}}function x(){s&&(clearTimeout(s),s=null)}function F(){try{if(function(){try{return L===a.Z.TEXT&&!D.isTextEnabled()||w.isPaused()&&(!w.getStreamController().getInitialPlayback()||!w.getStreamController().getAutoPlay())&&!P.get().streaming.scheduling.scheduleWhilePaused}catch(e){return!1}}())return void x();if(function(){try{return!!y&&N.getCurrentRepresentationInfo()&&(isNaN(p)||m||(e=r.id,t=R.getMaxAllowedIndexFor(L,e),!(!isNaN(g)&&g==t||(n.info("Top quality "+L+" index has changed from "+g+" to "+t),g=t,0)))||function(){var e=N.getCurrentRepresentationInfo();return!L||!e||b.getCurrentBufferLevel(L)<B()}())}catch(e){return!1}var e,t}()){var e=!1;E&&(e=R.checkPlaybackQuality(L,r.id)),e||(i=N.getCurrentRepresentationInfo(),v||i.quality!==p||m?(m?(n.debug("Switch track for "+L+", representation id = "+i.id),m=!1):n.debug("Quality has changed, get init request for representationid = "+i.id),S.trigger(u.Z.INIT_FRAGMENT_NEEDED,{representationId:i.id,sender:t},{streamId:r.id,mediaType:L}),E=!1,v=!1):(n.debug("Media segment needed for ".concat(L," and stream id ").concat(r.id)),S.trigger(u.Z.MEDIA_FRAGMENT_NEEDED,{},{streamId:r.id,mediaType:L}),E=!0))}else k(w.getLowLatencyModeEnabled()?P.get().streaming.scheduling.lowLatencyTimeout:P.get().streaming.scheduling.defaultTimeout)}catch(e){k(w.getLowLatencyModeEnabled()?P.get().streaming.scheduling.lowLatencyTimeout:P.get().streaming.scheduling.defaultTimeout)}var i}function B(){var e=NaN,t=N.getCurrentRepresentationInfo();return L&&t?(e=L===a.Z.TEXT?function(){try{if(D.isTextEnabled()){var e=N.getCurrentRepresentationInfo();if(isNaN(e.fragmentDuration)){var t=b.getCurrentSchedulingInfo(o.Z.SCHEDULING_INFO);return t?t.duration:0}return e.fragmentDuration}return 0}catch(e){return 0}}():L===a.Z.AUDIO&&c?function(){try{var e=b.getCurrentBufferLevel(a.Z.VIDEO),t=N.getCurrentRepresentationInfo();return isNaN(t.fragmentDuration)?e+1:Math.max(e+1,t.fragmentDuration)}catch(e){return 0}}():function(){try{var e=N.getCurrentRepresentationInfo().mediaInfo.streamInfo;return R.isPlayingAtTopQuality(e)?e.manifestInfo.duration>=P.get().streaming.buffer.longFormContentDurationThreshold?P.get().streaming.buffer.bufferTimeAtTopQualityLongForm:P.get().streaming.buffer.bufferTimeAtTopQuality:A.getStableBufferTime()}catch(e){return A.getStableBufferTime()}}(),e):e}function U(){Z(!0)}function Z(e){if(w&&I){var t=I.getRequests({state:_.FRAGMENT_MODEL_EXECUTED,time:w.getTime(),threshold:0})[0];t&&w.getTime()>=t.startTime&&((!h.mediaInfo||t.mediaInfo.type===h.mediaInfo.type&&t.mediaInfo.index!==h.mediaInfo.index)&&e&&S.trigger(u.Z.TRACK_CHANGE_RENDERED,{mediaType:L,oldMediaInfo:h.mediaInfo,newMediaInfo:t.mediaInfo,streamId:r.id}),t.quality===h.quality&&t.adaptationIndex===h.adaptationIndex||!e||(n.debug("Quality change rendered for streamId ".concat(r.id," and type ").concat(L)),S.trigger(u.Z.QUALITY_CHANGE_RENDERED,{mediaType:L,oldQuality:h.quality,newQuality:t.quality,streamId:r.id})),h={mediaInfo:t.mediaInfo,quality:t.quality,adaptationIndex:t.adaptationIndex})}}function G(){I.abortRequests(),x()}function H(){P.get().streaming.scheduling.scheduleWhilePaused||k()}function $(e){b.updatePlayListTraceMetrics({playbackspeed:e.playbackRate.toString()})}function V(){E=!0,i=0,p=NaN,h={mediaInfo:void 0,quality:NaN,adaptationIndex:NaN},g=NaN,m=!1,v=!1,y=!0}return t={initialize:function(e){c=e,S.on(u.Z.URL_RESOLUTION_FAILED,G,t),S.on(f.Z.PLAYBACK_STARTED,H,t),S.on(f.Z.PLAYBACK_RATE_CHANGED,$,t),S.on(f.Z.PLAYBACK_TIME_UPDATED,U,t),S.on(f.Z.MANAGED_MEDIA_SOURCE_START_STREAMING,O,t),S.on(f.Z.MANAGED_MEDIA_SOURCE_END_STREAMING,M,t)},getType:function(){return L},getStreamId:function(){return r.id},setTimeToLoadDelay:function(e){i=e},getTimeToLoadDelay:function(){return i},setSwitchTrack:function(e){m=e},getSwitchTrack:function(){return m},startScheduleTimer:k,clearScheduleTimer:x,reset:function(){S.off(u.Z.URL_RESOLUTION_FAILED,G,t),S.off(f.Z.PLAYBACK_STARTED,H,t),S.off(f.Z.PLAYBACK_RATE_CHANGED,$,t),S.off(f.Z.PLAYBACK_TIME_UPDATED,U,t),S.off(f.Z.MANAGED_MEDIA_SOURCE_START_STREAMING,O,t),S.off(f.Z.MANAGED_MEDIA_SOURCE_END_STREAMING,M,t),x(),Z(!1),V(),r=null},getBufferTarget:B,getPlaybackController:function(){return w},setCheckPlaybackQuality:function(e){E=e},setInitSegmentRequired:function(e){v=e},setLastInitializedQuality:function(e){p=e}},n=(0,d.Z)(T).getInstance().getLogger(t),V(),r=e.streamInfo,t}$.__dashjs_factory_name="ScheduleController";var V=c.Z.getClassFactory($),K=r(7387);function q(e){var t,r,n,i,s,o,l=(e=e||{}).eventBus,u=e.events,c=e.abrController,d=e.dashMetrics,h=e.playbackController,g=e.timelineConverter,p=e.type,m=e.streamInfo,v=e.dashConstants,y=e.segmentsController,E=e.isDynamic,T=e.adapter;function _(){return p}function S(){return n}function b(){return o}function A(){r=null,n=!0,i=[],s=null}function I(e){return new Promise(function(t,r){var n=e.hasInitialization(),a=e.hasSegments(),s=[];s.push(y.updateInitData(e,n)),s.push(y.updateSegmentData(e,a)),Promise.all(s).then(function(r){var n;r[0]&&!r[0].error&&(e=function(e,t){return t&&!t.error&&t.representation?t.representation:e}(e,r[0])),r[1]&&!r[1].error&&(e=function(e,t){if(t&&!t.error){var r,n,i,a,s=t.segments,o=[],l=0;for(r=0,n=s?s.length:0;r<n;r++)i=s[r],(a=(0,K.TJ)(g,E,e,i.startTime,i.duration,i.timescale,i.media,i.mediaRange,l))&&(o.push(a),a=null,l++);return o.length>0&&(e.segments=o),e}}(e,r[1])),(n=e).mediaFinishedInformation=y.getMediaFinishedInformation(n),function(e){if(S()){var t,r,n=d.getCurrentManifestUpdate(),a=!1;if(n){for(var s=0;s<n.representationInfo.length;s++)if((t=n.representationInfo[s]).index===e.index&&t.mediaType===_()){a=!0;break}a||d.addManifestUpdateRepresentationInfo(e,_())}if(function(){for(var e=0,t=i.length;e<t;e++){var r=i[e].segmentInfoType;if(!i[e].hasInitialization()||(r===v.SEGMENT_BASE||r===v.BASE_URL)&&!i[e].segments)return!1}return!0}()){c.setPlaybackQuality(p,m,(r=o,i.indexOf(r)));var l=d.getCurrentDVRInfo(p);l&&d.updateManifestUpdateInfo({latency:l.range.end-h.getTime()}),d.getCurrentRepresentationSwitch(b().adaptation.type)||R(),D()}}}(e),t()}).catch(function(e){r(e)})})}function R(){!function(){if(!(c&&d&&h&&g))throw new Error(a.Z.MISSING_CONFIG_ERROR)}();var e=new Date,t=b(),r=1e3*h.getTime();t&&d.addRepresentationSwitch(t.adaptation.type,e,r,t.id),l.trigger(f.Z.REPRESENTATION_SWITCH,{mediaType:p,streamId:m.id,currentRepresentation:t,numberOfRepresentations:i.length},{streamId:m.id,mediaType:p})}function w(e){return null==e||e>=i.length?null:i[e]}function D(e){n=!1,l.trigger(u.DATA_UPDATE_COMPLETED,{data:r,currentRepresentation:o,error:e},{streamId:m.id,mediaType:p})}function L(e){o=e,s=T.convertRepresentationToRepresentationInfo(o)}function C(e){if(e.newDuration){var t=b();t&&t.adaptation.period&&(t.adaptation.period.duration=e.newDuration)}}return t={getStreamId:function(){return m.id},getType:_,getData:function(){return r},isUpdating:S,updateData:function(e,t,s,o,l){return new Promise(function(u,c){if(n=!0,i=t,r=e,L(w(l)),s!==a.Z.VIDEO&&s!==a.Z.AUDIO&&(s!==a.Z.TEXT||!o))return D(),void u();for(var d=[],f=0,h=i.length;f<h;f++){var g=i[f];d.push(I(g))}Promise.all(d).then(function(){L(w(l)),u()}).catch(function(e){c(e)})})},getCurrentRepresentation:b,getCurrentRepresentationInfo:function(){return s},getRepresentationForQuality:w,prepareQualityChange:function(e){L(w(e)),R()},reset:function(){l.off(f.Z.MANIFEST_VALIDITY_CHANGED,C,t),A()}},A(),l.on(f.Z.MANIFEST_VALIDITY_CHANGED,C,t),t}q.__dashjs_factory_name="RepresentationController";var Y=c.Z.getClassFactory(q),j=r(3106),z=r(9326),W=r(7473),X=r(2594);function Q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var J=function e(){Q(this,e),this.start=null,this.mstart=null,this.starttype=null,this.trace=[]};J.INITIAL_PLAYOUT_START_REASON="initial_playout",J.SEEK_START_REASON="seek",J.RESUME_FROM_PAUSE_START_REASON="resume",J.METRICS_COLLECTION_START_REASON="metrics_collection_start";var ee=function e(){Q(this,e),this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null};ee.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",ee.REBUFFERING_REASON="rebuffering",ee.USER_REQUEST_STOP_REASON="user_request",ee.END_OF_PERIOD_STOP_REASON="end_of_period",ee.END_OF_CONTENT_STOP_REASON="end_of_content",ee.METRICS_COLLECTION_STOP_REASON="metrics_collection_end",ee.FAILURE_STOP_REASON="failure";var te=r(7802);function re(){return{ntpToUTC:function(e){var t=new Date(Date.UTC(1900,0,1,0,0,0));return new Date(t.getTime()+e).getTime()}}}re.__dashjs_factory_name="TimeUtils";var ne=c.Z.getSingletonFactory(re);function ie(e){e=e||{};var t,r,n,i,c,h,g,p,m,v,y,E,T,b,A,I=this.context,R=(0,l.Z)(I).getInstance(),D=e.streamInfo,C=e.type,N=e.errHandler,P=e.mimeType,O=e.timelineConverter,M=e.adapter,k=e.manifestModel,x=e.mediaPlayerModel,F=e.fragmentModel,B=e.abrController,Z=e.playbackController,G=e.mediaController,$=e.textController,K=e.dashMetrics,q=e.settings,Q=e.boxParser,J=e.segmentBlacklistController;function re(){return D.id}function ie(){return C}function ae(){return M.getIsTextTrack(p.getData())}function se(){c=[],i=null,b=0,m=!1,v=!1,y=!1,A=null}function oe(e){return!isNaN(e)&&!isNaN(D.duration)&&isFinite(D.duration)&&e>=D.start+D.duration}function le(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.sender)if(Z.getIsManifestUpdateInProgress())he();else if((!ae()||$.isTextEnabled())&&h&&e.representationId&&!h.appendInitSegmentFromCache(e.representationId)){var r=p.getCurrentRepresentation();if(0===r.range)return void ue();var n=E?E.getInitRequest(i,r):null;n?F.executeRequest(n):t&&(g.setInitSegmentRequired(!0),he())}}function ue(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Z.getIsManifestUpdateInProgress()||h.getIsPruningInProgress())he();else{var r=fe();r?(m=!1,v=!1,ce(r)):de(t)}}function ce(e){isNaN(e.startTime+e.duration)||(b=e.startTime+e.duration),e.delayLoadingTime=(new Date).getTime()+g.getTimeToLoadDelay(),g.setTimeToLoadDelay(0),function(e){var t=e.url;return e.range&&(t=t.concat("_",e.range)),J.contains(t)}(e)?(r.warn("Fragment request url ".concat(e.url," for stream id ").concat(D.id," and media type ").concat(C," is on the ignore list and will be skipped")),he()):(r.debug("Next fragment request url for stream id ".concat(D.id," and media type ").concat(C," is ").concat(e.url)),F.executeRequest(e))}function de(e){var t,a=p.getCurrentRepresentation();if(!q.get().streaming.gaps.enableSeekFix||!m&&0!==Z.getTime()||(n?n&&a.segmentInfoType===s.Z.SEGMENT_TIMELINE&&(t=E.getValidTimeAheadOfTargetTime(b,i,a,q.get().streaming.gaps.threshold)):t=E.getValidTimeAheadOfTargetTime(b,i,a,q.get().streaming.gaps.threshold),isNaN(t)||t===b)){if(E.isLastSegmentRequested(a,b)){var o=E.getCurrentIndex();return r.debug("Segment requesting for stream ".concat(D.id," has finished")),R.trigger(u.Z.STREAM_REQUESTING_COMPLETED,{segmentIndex:o},{streamId:D.id,mediaType:C}),h.segmentRequestingCompleted(o),void g.clearScheduleTimer()}e&&he()}else Z.isSeeking()||0===Z.getTime()?(r.warn("Adjusting playback time ".concat(t," because of gap in the manifest. Seeking by ").concat(t-b)),Z.seek(t,!1,!1)):(r.warn("Adjusting buffering time ".concat(t," because of gap in the manifest. Adjusting time by ").concat(t-b)),ke(t),e&&he())}function fe(){var e,t=De();if(isNaN(b)||ie()===a.Z.TEXT&&!$.isTextEnabled())return null;if(E){var r=p&&t?p.getRepresentationForQuality(t.quality):null;e=m?E.getSegmentRequestForTime(i,r,b):v?E.repeatSegmentRequest(i,r):E.getNextSegmentRequest(i,r)}return e}function he(){g.startScheduleTimer(Z.getLowLatencyModeEnabled()?q.get().streaming.scheduling.lowLatencyTimeout:q.get().streaming.scheduling.defaultTimeout)}function ge(e){e.error||h.getIsBufferingCompleted()||h.updateBufferTimestampOffset(e.currentRepresentation)}function pe(e){K.addBufferState(C,e.state,g.getBufferTarget()),e.state!==o.Z.BUFFER_EMPTY||Z.isSeeking()||(r.info("Buffer is empty! Stalling!"),K.pushPlayListTraceMetrics(new Date,ee.REBUFFERING_REASON))}function me(e){F.syncExecutedRequestsWithBufferedRange(h.getBuffer().getAllBufferRanges(),D.duration),e.quotaExceeded&&e.from>Z.getTime()&&ke(e.from),e.hasEnoughSpaceToAppend&&e.quotaExceeded&&g.startScheduleTimer()}function ve(e){if(e&&e.lastRequestAppended&&e.lastRequestAppended.url){var t=e.lastRequestAppended.url;e.lastRequestAppended.range&&(t=t.concat("_",e.lastRequestAppended.range)),r.warn("Blacklisting segment with url ".concat(t)),J.add(t)}}function ye(e){if(r.debug("Appended bytes for ".concat(e.mediaType," and stream id ").concat(e.streamId)),e.segmentType===L.w.INIT_SEGMENT_TYPE){var t=e.quality;g.setLastInitializedQuality(t),r.info("["+C+"] lastInitializedRepresentationInfo changed to "+e.quality)}A?Ee(A):g.startScheduleTimer(0)}function Ee(e){var t=F.getRequests({state:_.FRAGMENT_MODEL_LOADING});if(t&&t.length>0)return r.debug("Preparing for default quality switch: Waiting for ongoing segment request to be finished before applying switch."),void(A=e);h.updateBufferTimestampOffset(e).then(function(){g.setCheckPlaybackQuality(!1),i.segmentAlignment||i.subSegmentAlignment?g.startScheduleTimer():Oe(),A=null,y=!1}).catch(function(){A=null,y=!1})}function Te(e){r.info("onFragmentLoadingAbandoned request: "+e.request.url+" has been aborted"),Z.isSeeking()||g.getSwitchTrack()||y||(r.info("onFragmentLoadingAbandoned request: "+e.request.url+" has to be downloaded again, origin is not seeking process or switch track call"),e.request&&e.request.isInitializationRequest()?g.setInitSegmentRequired(!0):ke(e.request.startTime+e.request.duration/2),g.startScheduleTimer(0))}function _e(e){r.info("OnFragmentLoadingCompleted for stream id "+D.id+" and media type "+C+" - Url:",e.request?e.request.url:"undefined",e.request.range?", Range:"+e.request.range:""),ae()&&g.startScheduleTimer(0),e.error&&e.request.serviceLocation&&function(e){r.info("Fragment loading completed with an error"),e&&e.request&&e.request.type&&(e.request.type===L.w.INIT_SEGMENT_TYPE?le({representationId:e.request.representationId,sender:{}},!1):e.request.type===L.w.MEDIA_SEGMENT_TYPE&&(ke(e.request.startTime+e.request.duration/2),ue({},!1)))}(e)}function Se(){ke(Z.getTime()),we().startScheduleTimer()}function be(e){var t=e.currentTrackInfo;if(t){var r=c.find(function(e){return e.index===t.index&&e.lang===t.lang});r&&Re(r).then(function(){h.setIsBufferingCompleted(!1),ke(Z.getTime()),g.setInitSegmentRequired(!0),g.startScheduleTimer()})}}function Ae(e){ke(e.quotaExceededTime),g.clearScheduleTimer()}function Ie(){return h?h.getBuffer():null}function Re(e){e===i||e&&i&&e.type!==i.type||(i=e);var t=M.getRealAdaptation(D,i),r=M.getVoRepresentations(i);if(p){var s,o=p.getData(),l=B.getMaxAllowedIndexFor(C,D.id),u=B.getMinAllowedIndexFor(C,D.id),c=null;return null!==o&&o.id===t.id||C===a.Z.TEXT?s=B.getQualityFor(C,D.id):(c=B.getThroughputHistory().getAverageThroughput(C,n)||B.getInitialBitrateFor(C,D.id),s=B.getQualityForBitrate(i,c,D.id)),void 0!==u&&s<u&&(s=u),s>l&&(s=l),p.updateData(t,r,C,i.isFragmented,s)}return Promise.resolve()}function we(){return g}function De(e){var t;return void 0!==e?((0,j.SE)(e),t=p?p.getRepresentationForQuality(e):null):t=p?p.getCurrentRepresentation():null,M.convertRepresentationToRepresentationInfo(t)}function Le(){return!!h&&h.getIsBufferingCompleted()}function Ce(e){if(q.get().streaming.enableManifestTimescaleMismatchFix){var t=e.chunk,r=t.bytes,n=De(t.quality),i=p&&n?p.getRepresentationForQuality(n.quality):null;n&&i&&(i.timescale=Q.getMediaTimescaleFromMoov(r))}}function Ne(e){var t=e.chunk,r=t.bytes,n=t.quality,i=De(n),a=p&&i?p.getRepresentationForQuality(i.quality):null;if(i&&a){var o;if(q.get().streaming.parseInbandPrft&&e.request.type===L.w.MEDIA_SEGMENT_TYPE){var l=function(e,t){var r=e.getBoxes("prft"),n=[];return r.forEach(function(e){n.push(function(e,t){var r="unknown";switch(e.flags){case 0:r=s.Z.PRODUCER_REFERENCE_TIME_TYPE.ENCODER;break;case 16:r=s.Z.PRODUCER_REFERENCE_TIME_TYPE.APPLICATION;break;case 24:r=s.Z.PRODUCER_REFERENCE_TIME_TYPE.CAPTURED}var n=1e3*e.ntp_timestamp_sec+e.ntp_timestamp_frac/Math.pow(2,32)*1e3;return{type:r,ntpTimestamp:n=ne(I).getInstance().ntpToUTC(n),mediaTime:e.media_time/t}}(e,t))}),n}(o=o||Q.parse(r),a.timescale);l&&l.length&&R.trigger(f.Z.INBAND_PRFT,{data:l},{streamId:D.id,mediaType:C})}var c=M.getEventsFor(i.mediaInfo,null,D),d=M.getEventsFor(i,a,D);if(c&&c.length>0||d&&d.length>0){var h=F.getRequests({state:_.FRAGMENT_MODEL_EXECUTED,quality:n,index:t.index})[0],g=function(e,t,r,n){try{for(var i={},a=[],s=r.concat(n),o=0,l=s.length;o<l;o++)i[s[o].schemeIdUri+"/"+s[o].value]=s[o];var u=e.getBoxes("emsg");if(!u||0===u.length)return a;for(var c=e.getBox("sidx"),d=!c||isNaN(c.earliest_presentation_time)||isNaN(c.timescale)?t&&!isNaN(t.mediaStartTime)?t.mediaStartTime:0:c.earliest_presentation_time/c.timescale,f=Math.max(d,0),h=p.getCurrentRepresentation(),g=0,m=u.length;g<m;g++){var v=M.getEvent(u[g],i,f,h);v&&a.push(v)}return a}catch(e){return[]}}(o=o||Q.parse(r),h,c,d);R.trigger(u.Z.INBAND_EVENTS,{events:g},{streamId:D.id})}}}function Pe(){var e=Z.getTime();q.get().streaming.buffer.flushBufferAtTrackSwitch&&Z.seek(e+.001,!1,!0),ke(e),h.setSeekTarget(e),g.startScheduleTimer()}function Oe(){var e=Z.getTime(),t=h.getContinuousBufferTimeForTargetTime(e);ke(isNaN(t)?e:t),g.startScheduleTimer()}function Me(e){e&&!isNaN(e.time)&&(ke(e.time),h.setSeekTarget(e.time))}function ke(e){b=e,m=!0}return t={initialize:function(r,i,o){T=(0,te.Z)(I).create({events:u.Z,eventBus:R,streamInfo:D,timelineConverter:O,dashConstants:s.Z,segmentBaseController:e.segmentBaseController,type:C}),E=(0,z.Z)(I).create({streamInfo:D,type:C,timelineConverter:O,dashMetrics:K,mediaPlayerModel:x,baseURLController:e.baseURLController,errHandler:N,segmentsController:T,settings:q,boxParser:Q,events:u.Z,eventBus:R,errors:w,debug:(0,d.Z)(I).getInstance(),requestModifier:(0,W.Z)(I).getInstance(),dashConstants:s.Z,constants:a.Z,urlUtils:(0,X.Z)(I).getInstance()}),n=D.manifestInfo.isDynamic,E.initialize(n),B.registerStreamType(C,t),p=Y(I).create({streamInfo:D,type:C,abrController:B,dashMetrics:K,playbackController:Z,timelineConverter:O,dashConstants:s.Z,events:u.Z,eventBus:R,errors:w,isDynamic:n,adapter:M,segmentsController:T}),h=function(e,t){return e?e!==a.Z.TEXT||t?U(I).create({streamInfo:D,type:e,mediaPlayerModel:x,manifestModel:k,fragmentModel:F,errHandler:N,mediaController:G,representationController:p,adapter:M,textController:$,abrController:B,playbackController:Z,settings:q}):H(I).create({streamInfo:D,type:e,mimeType:P,fragmentModel:F,textController:$,errHandler:N,settings:q}):(N.error(new S.Z(w.MEDIASOURCE_TYPE_UNSUPPORTED_CODE,w.MEDIASOURCE_TYPE_UNSUPPORTED_MESSAGE+"not properly defined")),null)}(C,o),h&&h.initialize(r),(g=V(I).create({streamInfo:D,type:C,mimeType:P,adapter:M,dashMetrics:K,mediaPlayerModel:x,fragmentModel:F,abrController:B,playbackController:Z,textController:$,mediaController:G,bufferController:h,representationController:p,settings:q})).initialize(i),b=0,m=!1,v=!1},getStreamId:re,getType:ie,isUpdating:function(){return!!p&&p.isUpdating()},getBufferController:function(){return h},dischargePreBuffer:function(){h.dischargePreBuffer()},getFragmentModel:function(){return F},getScheduleController:we,getRepresentationController:function(){return p},getRepresentationInfo:De,getBufferLevel:function(){return h?h.getBufferLevel():0},isBufferingCompleted:Le,createBufferSinks:function(e){var t=Ie();return t?Promise.resolve(t):h?h.createBufferSink(i,e):Promise.resolve(null)},updateStreamInfo:function(e){return D=e,Le()?Promise.resolve():h.updateAppendWindow()},getStreamInfo:function(){return D},selectMediaInfo:Re,clearMediaInfoArray:function(){c=[]},addMediaInfo:function(e){-1===c.indexOf(e)&&c.push(e)},prepareTrackSwitch:function(){return new Promise(function(e){r.debug("Preparing track switch for type ".concat(C));var t=C===a.Z.TEXT||q.get().streaming.trackSwitchMode[C]===a.Z.TRACK_SWITCH_MODE_ALWAYS_REPLACE&&Z.getTimeToStreamEnd(D)>q.get().streaming.buffer.stallThreshold;if(h.getIsBufferingCompleted()&&!t)return h.prepareForNonReplacementTrackSwitch(i.codec).then(function(){R.trigger(u.Z.BUFFERING_COMPLETED,{},{streamId:D.id,mediaType:C})}).catch(function(){R.trigger(u.Z.BUFFERING_COMPLETED,{},{streamId:D.id,mediaType:C})}),void e();g.clearScheduleTimer(),g.setSwitchTrack(!0),t?(R.trigger(u.Z.BUFFER_REPLACEMENT_STARTED,{mediaType:C,streamId:D.id},{mediaType:C,streamId:D.id}),F.abortRequests(),h.prepareForReplacementTrackSwitch(i.codec).then(function(){var e=De();return h.updateBufferTimestampOffset(e)}).then(function(){Pe(),e()}).catch(function(){Pe(),e()})):h.prepareForNonReplacementTrackSwitch(i.codec).then(function(){Oe(),e()}).catch(function(){Oe(),e()})})},prepareQualityChange:function(e){A&&r.warn("Canceling queued representation switch to ".concat(A.quality," for ").concat(C)),r.debug("Preparing quality switch for type ".concat(C));var t=e.newQuality;y=!0,g.clearScheduleTimer(),p.prepareQualityChange(t);var n=De(t);e.reason&&e.reason.forceReplace?function(e){F.abortRequests(),R.trigger(u.Z.BUFFER_REPLACEMENT_STARTED,{mediaType:C,streamId:D.id},{mediaType:C,streamId:D.id}),g.setCheckPlaybackQuality(!1),h.prepareForForceReplacementQualitySwitch(e).then(function(){Pe(),A=null,y=!1}).catch(function(){Pe(),A=null,y=!1})}(n):e&&e.reason&&e.reason.forceAbandon?function(e){h.updateBufferTimestampOffset(e).then(function(){F.abortRequests(),v=!0,g.setCheckPlaybackQuality(!1),g.startScheduleTimer(),y=!1,A=null}).catch(function(){A=null,y=!1})}(n):q.get().streaming.buffer.fastSwitchEnabled?function(e){var t=Z.getTime(),r=1.5*(isNaN(e.fragmentDuration)?1:e.fragmentDuration),n=F.getRequests({state:_.FRAGMENT_MODEL_EXECUTED,time:t+r,threshold:0})[0];if(n&&!ae()){var i=h.getBufferLevel(),a=B.getAbandonmentStateFor(D.id,C);n.quality<e.quality&&i>=r&&a!==o.Z.ABANDON_LOAD?h.updateBufferTimestampOffset(e).then(function(){F.abortRequests(),ke(t+r),g.setCheckPlaybackQuality(!1),g.startScheduleTimer(),y=!1}).catch(function(){y=!1}):Ee(e)}else Ee(e)}(n):Ee(n),K.pushPlayListTraceMetrics(new Date,ee.REPRESENTATION_SWITCH_STOP_REASON),K.createPlaylistTraceMetrics(n.id,1e3*Z.getTime(),Z.getPlaybackRate())},getMediaInfo:function(){return i},getMediaSource:function(){return h.getMediaSource()},setMediaSource:function(e){return h.setMediaSource(e,i)},getBuffer:Ie,setExplicitBufferingTime:ke,finalisePlayList:function(e,t){K.pushPlayListTraceMetrics(e,t)},probeNextRequest:function(){var e=De(),t=p&&e?p.getRepresentationForQuality(e.quality):null;return E.getNextSegmentRequestIdempotent(i,t)},prepareInnerPeriodPlaybackSeeking:function(e){return new Promise(function(t){if(h.hasBufferAtTime(e.seekTime))return h.pruneBuffer(),oe(h.getContinuousBufferTimeForTargetTime(e.seekTime))&&h.setIsBufferingCompleted(!0),void t();g.clearScheduleTimer(),F.abortRequests(),h.prepareForPlaybackSeek().then(function(){var t=h.getAllRangesWithSafetyFactor(e.seekTime);return h.clearBuffers(t)}).then(function(){var r=h.getContinuousBufferTimeForTargetTime(e.seekTime);if(oe(r))h.setIsBufferingCompleted(!0),t();else{var n=isNaN(r)?e.seekTime:r;ke(n),h.setSeekTarget(n);var i=[];i.push(h.updateAppendWindow());var a=De();i.push(h.updateBufferTimestampOffset(a)),Promise.all(i).then(function(){g.setInitSegmentRequired(!0),g.setCheckPlaybackQuality(!1),g.startScheduleTimer(),t()})}}).catch(function(e){r.error(e)})})},prepareOuterPeriodPlaybackSeeking:function(){return new Promise(function(e,t){try{g.clearScheduleTimer(),F.abortRequests(),h.prepareForPlaybackSeek().then(function(){return h.pruneAllSafely()}).then(function(){e()})}catch(e){t(e)}})},reset:function(e,r){E&&E.reset(),h&&(h.reset(e,r),h=null),g&&(g.reset(),g=null),p&&(p.reset(),p=null),T&&(T=null),B&&B.unRegisterStreamType(re(),C),R.off(u.Z.DATA_UPDATE_COMPLETED,ge,t),R.off(u.Z.INIT_FRAGMENT_NEEDED,le,t),R.off(u.Z.MEDIA_FRAGMENT_NEEDED,ue,t),R.off(u.Z.INIT_FRAGMENT_LOADED,Ce,t),R.off(u.Z.MEDIA_FRAGMENT_LOADED,Ne,t),R.off(u.Z.BUFFER_LEVEL_STATE_CHANGED,pe,t),R.off(u.Z.BUFFER_CLEARED,me,t),R.off(u.Z.SEEK_TARGET,Me,t),R.off(u.Z.FRAGMENT_LOADING_ABANDONED,Te,t),R.off(u.Z.FRAGMENT_LOADING_COMPLETED,_e,t),R.off(u.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Se,t),R.off(u.Z.SET_NON_FRAGMENTED_TEXT,be,t),R.off(u.Z.QUOTA_EXCEEDED,Ae,t),R.off(u.Z.SOURCE_BUFFER_ERROR,ve,t),R.off(u.Z.BYTES_APPENDED_END_FRAGMENT,ye,t),se(),C=null,D=null}},r=(0,d.Z)(I).getInstance().getLogger(t),se(),R.on(u.Z.DATA_UPDATE_COMPLETED,ge,t,{priority:l.Z.EVENT_PRIORITY_HIGH}),R.on(u.Z.INIT_FRAGMENT_NEEDED,le,t),R.on(u.Z.MEDIA_FRAGMENT_NEEDED,ue,t),R.on(u.Z.INIT_FRAGMENT_LOADED,Ce,t),R.on(u.Z.MEDIA_FRAGMENT_LOADED,Ne,t),R.on(u.Z.BUFFER_LEVEL_STATE_CHANGED,pe,t),R.on(u.Z.BUFFER_CLEARED,me,t),R.on(u.Z.SEEK_TARGET,Me,t),R.on(u.Z.FRAGMENT_LOADING_ABANDONED,Te,t),R.on(u.Z.FRAGMENT_LOADING_COMPLETED,_e,t),R.on(u.Z.QUOTA_EXCEEDED,Ae,t),R.on(u.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,Se,t),R.on(u.Z.SET_NON_FRAGMENTED_TEXT,be,t),R.on(u.Z.SOURCE_BUFFER_ERROR,ve,t),R.on(u.Z.BYTES_APPENDED_END_FRAGMENT,ye,t),t}ie.__dashjs_factory_name="StreamProcessor";var ae=c.Z.getClassFactory(ie),se=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.streamId=null,this.mediaInfo=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN,this.representationId=null,this.endFragment=null},oe=r(9032);function le(e,t){if(e){if("string"==typeof e)return ue(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ue(e,t):void 0}}function ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ce(e){e=e||{};var t,r,n=this.context,i=e.requestModifier,s=e.lowLatencyThroughputModel,o=e.boxParser,l=(0,D.Z)(n).getInstance();function u(e){var t,n=new Date,u=e.request,f=new Headers;if(u.range&&f.append("Range","bytes="+u.range),e.headers)for(var h in e.headers){var g=e.headers[h];g&&f.append(h,g)}u.requestStartDate||(u.requestStartDate=n),i&&i.modifyRequestHeader&&i.modifyRequestHeader({setRequestHeader:function(e,t){f.append(e,t)}},{url:e.url}),"function"==typeof window.AbortController&&(t=new AbortController,e.abortController=t,t.signal.onabort=e.onabort);var p={method:e.method,headers:f,credentials:e.withCredentials?"include":void 0,signal:t?t.signal:void 0},m=l.get().streaming.abr.fetchThroughputCalculationMode,v=Date.now(),y=0;new Promise(function(e){if(m===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&s&&(y=s.getThroughputCapacityDelayMS(u,1e3*r.getCurrentBufferLevel(u.mediaType))))return setTimeout(e,y);e()}).then(function(){var t=Date.now();fetch(e.url,p).then(function(n){e.response||(e.response={}),e.response.status=n.status,e.response.statusText=n.statusText,e.response.responseURL=n.url,n.ok||e.onerror();var i,l="",f=function(e){var t;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(t=le(e))){t&&(e=t);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){t=e[Symbol.iterator]()},n:function(){var e=t.next();return a=e.done,e},e:function(e){s=!0,i=e},f:function(){try{a||null==t.return||t.return()}finally{if(s)throw i}}}}(n.headers.keys());try{for(f.s();!(i=f.n()).done;){var h=i.value;l+=h+": "+n.headers.get(h)+"\r\n"}}catch(e){f.e(e)}finally{f.f()}if(e.response.responseHeaders=l,!n.body)return n.arrayBuffer().then(function(t){e.response.response=t;var r={loaded:t.byteLength,total:t.byteLength,stream:!1};e.progress(r),e.onload(),e.onend()});var g,p,E,T,_=parseInt(n.headers.get("Content-Length"),10),S=0,b=!1,A=new Uint8Array,I=0;if(m===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST&&s){var R=t,w=0,D=(T=2,function(e){if(Array.isArray(e))return e}(E=n.body.tee())||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],n=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){i=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}return r}}(E,T)||le(E,T)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),L=D[0],C=D[1];g=L.getReader(),p=[],g.read().then(function n(i){var a=i.value,o=i.done;if(w=Date.now(),a&&a.length){var c=w-R,d=a.length;p.push({chunkDownloadTimeRelativeMS:w-t,chunkDownloadDurationMS:c,chunkBytes:d,kbps:Math.round(8*d/(c/1e3)),bufferLevel:r.getCurrentBufferLevel(u.mediaType)})}if(o){var f=w-t,h=p.reduce(function(e,t){return e+t.chunkBytes},0);return s.addMeasurement(u,f,p,v,y,l),void e.progress({loaded:h,total:h,lengthComputable:!0,time:s.getEstimatedDownloadDurationMS(u),stream:!0})}return R=Date.now(),g.read().then(n)}),e.reader=C.getReader()}else e.reader=n.body.getReader();var N=[],P=[],O=[],M=!0;c(e,function t(r){var n=r.value;if(r.done){if(A){if(m!==a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_AAST){var i=null,s=null;m===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING?(i=function(e,t){try{var r,n;r=e.filter(function(t,r){return r<e.length-1}),n=t.filter(function(e,r){return r<t.length-1});var i=[];if(r.length>1){for(var a=0,s=0,o=0;o<r.length;o++)if(r[o]&&n[o]){var l=n[o].ts-r[o].ts;if(l>1)i.push(8*n[o].bytes/l),s=0;else{0===s&&(s=r[o].ts,a=0);var u=n[o].ts-s;u>1?(a+=n[o].bytes,i.push(8*a/u),s=0):a+=n[o].bytes}}if(i.length>0)return i.reduce(function(e,t){return e+t},0)/i.length}return null}catch(e){return null}}(P,O),i&&(s=8*S/i)):m===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA&&(s=d(N,S)),e.progress({loaded:S,total:isNaN(_)?S:_,lengthComputable:!0,time:s,stream:!0})}e.response.response=A.buffer}return e.onload(),void e.onend()}if(n&&n.length>0){A=function(e,t){if(0===e.length)return t;var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(A,n),S+=n.length,N.push({ts:Date.now(),bytes:n.length}),m===a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING&&M&&o.findLastTopIsoBoxCompleted(["moof"],A,I).found&&(M=!1,P.push({ts:performance.now(),bytes:n.length}));var l=o.findLastTopIsoBoxCompleted(["moov","mdat"],A,I);if(l.found){var u,f=l.lastCompletedOffset+l.size;m!==a.Z.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING||M||(M=!0,O.push({ts:performance.now(),bytes:A.length})),f===A.length?(u=A,A=new Uint8Array):(u=new Uint8Array(A.subarray(0,f)),A=A.subarray(f)),e.progress({data:u.buffer,lengthComputable:!1,noTrace:!0}),I=0}else I=l.lastCompletedOffset,b||(e.progress({lengthComputable:!1,noTrace:!0}),b=!0)}c(e,t)})}).catch(function(t){e.onerror&&e.onerror(t)})})}function c(e,t){e.reader.read().then(t).catch(function(t){e.onerror&&200===e.response.status&&e.onerror(t)})}function d(e,t){try{if((e=e.filter(function(r){return r.bytes>t/4/e.length})).length>1){var r=0,n=(e[e.length-1].ts-e[0].ts)/e.length;return e.forEach(function(t,i){var a=e[i+1];if(a){var s=a.ts-t.ts;r+=s<n?s:0}}),r}return null}catch(e){return null}}return t={load:function(e){i&&i.modifyRequest?(0,W.k)(e,i).then(function(){return u(e)}):u(e)},abort:function(e){if(e.abortController)e.abortController.abort();else if(e.reader)try{e.reader.cancel(),e.onabort()}catch(e){}},calculateDownloadedTime:d,setup:function(e){r=e.dashMetrics}},t}ce.__dashjs_factory_name="FetchLoader";var de=c.Z.getClassFactory(ce),fe=r(1180);function he(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ge=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.codecs=null,this.mimeType=null,this.codecPrivateData=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.mediaFinishedInformation={numberOfSegments:0,mediaTimeOfLastSignaledSegment:NaN},this.bandwidth=NaN,this.width=NaN,this.height=NaN,this.scanType=null,this.maxPlayoutRate=NaN,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0,this.frameRate=null}var t;return(t=[{key:"hasInitialization",value:function(){return null!==this.initialization||null!==this.range}},{key:"hasSegments",value:function(){return this.segmentInfoType!==s.Z.BASE_URL&&this.segmentInfoType!==s.Z.SEGMENT_BASE&&!this.indexRange}}])&&he(e.prototype,t),e}(),pe=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.period=null,this.index=-1,this.type=null},me=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null,this.nextPeriodId=null};me.DEFAULT_ID="defaultId";var ve=me,ye=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.publishTime=null,this.minimumUpdatePeriod=NaN,this.mediaPresentationDuration=NaN},Ee=r(2610),Te=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type="",this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},_e=function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=r||t||"",this.dvbPriority=n||1,this.dvbWeight=i||1,this.availabilityTimeOffset=0,this.availabilityTimeComplete=!0,this.queryParams={}};_e.DEFAULT_DVB_PRIORITY=1,_e.DEFAULT_DVB_WEIGHT=1;var Se=_e,be=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri="",this.presentationTimeOffset=0},Ae=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.inband=!1,this.type="encoder",this.applicationScheme=null,this.wallClockTime=null,this.presentationTime=NaN,this.UTCTiming=null},Ie=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.defaultServiceLocation=null,this.defaultServiceLocationArray=[],this.queryBeforeStart=!1,this.serverUrl=null,this.clientRequirement=!0};function Re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var we=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri=null,this.value=null,this.id=null}var t;return(t=[{key:"init",value:function(e){return e&&(this.schemeIdUri=e.schemeIdUri?e.schemeIdUri:null,this.value=e.value?e.value:null,this.id=e.id?e.id:null,e[s.Z.DVB_URL]&&(this.dvbUrl=e[s.Z.DVB_URL]),e[s.Z.DVB_MIMETYPE]&&(this.dvbMimeType=e[s.Z.DVB_MIMETYPE]),e[s.Z.DVB_FONTFAMILY]&&(this.dvbFontFamily=e[s.Z.DVB_FONTFAMILY])),this}}])&&Re(e.prototype,t),e}(),De=r(3101),Le=r.n(De);function Ce(){return{areEqual:function(e,t){return Le()(e,t)}}}Ce.__dashjs_factory_name="ObjectUtils";var Ne=c.Z.getSingletonFactory(Ce),Pe=r(7803),Oe=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=r||null,this.queryParams={}},Me=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||"",this.serviceLocation=r||null,this.ttl=n||NaN,this.queryParams={}};function ke(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(r),!0).forEach(function(t){Fe(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ke(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Be(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=Ue(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function Ue(e,t){if(e){if("string"==typeof e)return Ze(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ze(e,t):void 0}}function Ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ge(){var e,t,r,n,i=this.context,o=(0,X.Z)(i).getInstance(),l=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};function u(e,t){if(!e)throw new Error("adaptation is not defined");if(!t)throw new Error("type is not defined");if(e.Representation_asArray&&e.Representation_asArray.length){var r=E(e.Representation_asArray[0]);if(r&&r.length>0&&Pe.Y.indexOf(r[0].schemeIdUri)>=0)return t===a.Z.IMAGE}if(e.ContentComponent_asArray&&e.ContentComponent_asArray.length>0){if(e.ContentComponent_asArray.length>1)return t===a.Z.MUXED;if(e.ContentComponent_asArray[0].contentType===t)return!0}var n=t===a.Z.TEXT?new RegExp("(ttml|vtt|wvtt|stpp)"):new RegExp(t);if(e.Representation_asArray&&e.Representation_asArray.length){var i=e.Representation_asArray[0].codecs;if(n.test(i))return!0}if(e.hasOwnProperty(s.Z.MIME_TYPE))return n.test(e.mimeType);if(e.Representation_asArray)for(var o,l=0;l<e.Representation_asArray.length;l++)if((o=e.Representation_asArray[l]).hasOwnProperty(s.Z.MIME_TYPE))return n.test(o.mimeType);return!1}function c(e){if(!e)throw new Error("adaptation is not defined");if(e.hasOwnProperty(s.Z.SEGMENT_TEMPLATE)||e.hasOwnProperty(s.Z.SEGMENT_TIMELINE)||e.hasOwnProperty(s.Z.SEGMENT_LIST)||e.hasOwnProperty(s.Z.SEGMENT_BASE))return!0;if(e.Representation_asArray&&e.Representation_asArray.length>0){var t=e.Representation_asArray[0];if(t.hasOwnProperty(s.Z.SEGMENT_TEMPLATE)||t.hasOwnProperty(s.Z.SEGMENT_TIMELINE)||t.hasOwnProperty(s.Z.SEGMENT_LIST)||t.hasOwnProperty(s.Z.SEGMENT_BASE))return!0}return!1}function f(e){return u(e,a.Z.VIDEO)}function h(e){return u(e,a.Z.TEXT)}function g(e){return u(e,a.Z.IMAGE)}function p(e){return e&&Array.isArray(e.Representation_asArray)&&e.Representation_asArray.sort(function(e,t){return e.bandwidth-t.bandwidth}),e}function m(e,t){return e&&e.Period_asArray&&l(t)&&e.Period_asArray[t]?e.Period_asArray[t].AdaptationSet_asArray:[]}function v(e){return e&&e.Period_asArray?e.Period_asArray:[]}function y(e){var t=!1;return e&&e.hasOwnProperty("type")&&(t=e.type===s.Z.DYNAMIC),t}function E(e){return e&&e.EssentialProperty_asArray&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map(function(e){return{schemeIdUri:e.schemeIdUri,value:e.value}}):null}function T(e){if(!e||!e.S_asArray)return NaN;var t=e.S_asArray[0],r=e.S_asArray[1];return t.hasOwnProperty("d")?t.d:r.t-t.t}function _(e,t){if(!e)throw new Error("Period cannot be null or undefined");var r=ve.DEFAULT_ID+"_"+t;return e.hasOwnProperty(s.Z.ID)&&e.id.length>0&&"__proto__"!==e.id&&(r=e.id),r}function b(e,t,r){var n,i=[];if(!e)return i;for(n=0;n<e.length;n++){var o=new be;if(o.timescale=1,o.representation=t,!e[n].hasOwnProperty(a.Z.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");o.schemeIdUri=e[n].schemeIdUri,e[n].hasOwnProperty(s.Z.TIMESCALE)&&(o.timescale=e[n].timescale),e[n].hasOwnProperty(s.Z.VALUE)&&(o.value=e[n].value),i.push(o),o.period=r}return i}function A(e){var t=[],r=e.BaseURL_asArray||[e.baseUri],n=!1;return r.some(function(r){if(r){var i=new Se,a=r.__text||r;return o.isRelative(a)&&(n=!0,e.baseUri&&(a=o.resolve(a,e.baseUri))),i.url=a,r.hasOwnProperty(s.Z.SERVICE_LOCATION)&&r.serviceLocation.length?i.serviceLocation=r.serviceLocation:i.serviceLocation=a,r.hasOwnProperty(s.Z.DVB_PRIORITY)&&(i.dvbPriority=r[s.Z.DVB_PRIORITY]),r.hasOwnProperty(s.Z.DVB_WEIGHT)&&(i.dvbWeight=r[s.Z.DVB_WEIGHT]),r.hasOwnProperty(s.Z.AVAILABILITY_TIME_OFFSET)&&(i.availabilityTimeOffset=r[s.Z.AVAILABILITY_TIME_OFFSET]),r.hasOwnProperty(s.Z.AVAILABILITY_TIME_COMPLETE)&&(i.availabilityTimeComplete="false"!==r[s.Z.AVAILABILITY_TIME_COMPLETE]),t.push(i),n}}),t}function I(e){var t=new Ie;return t.serverUrl=e.__text,e.hasOwnProperty(s.Z.DEFAULT_SERVICE_LOCATION)&&(t.defaultServiceLocation=e[s.Z.DEFAULT_SERVICE_LOCATION],t.defaultServiceLocationArray=t.defaultServiceLocation.split(" ")),e.hasOwnProperty(s.Z.QUERY_BEFORE_START)&&(t.queryBeforeStart="true"===e[s.Z.QUERY_BEFORE_START].toLowerCase()),e.hasOwnProperty(s.Z.CLIENT_REQUIREMENT)&&(t.clientRequirement="false"!==e[s.Z.CLIENT_REQUIREMENT].toLowerCase()),t}return e={getIsTypeOf:u,getIsText:h,getIsFragmented:c,getProducerReferenceTimesForAdaptation:function(e){var t=e&&e.hasOwnProperty(s.Z.PRODUCERREFERENCETIME_ASARRAY)?e[s.Z.PRODUCERREFERENCETIME_ASARRAY]:[];(e&&e.hasOwnProperty(s.Z.REPRESENTATION_ASARRAY)?e[s.Z.REPRESENTATION_ASARRAY]:[]).forEach(function(e){var r;e.hasOwnProperty(s.Z.PRODUCERREFERENCETIME_ASARRAY)&&t.push.apply(t,function(e){if(Array.isArray(e))return Ze(e)}(r=e[s.Z.PRODUCERREFERENCETIME_ASARRAY])||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(r)||Ue(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())});var r=[];return t.forEach(function(e){var t=new Ae;e.hasOwnProperty(s.Z.ID)&&(t[s.Z.ID]=e[s.Z.ID],e.hasOwnProperty(s.Z.WALL_CLOCK_TIME)&&(t[s.Z.WALL_CLOCK_TIME]=e[s.Z.WALL_CLOCK_TIME],e.hasOwnProperty(s.Z.PRESENTATION_TIME)&&(t[s.Z.PRESENTATION_TIME]=e[s.Z.PRESENTATION_TIME],e.hasOwnProperty(s.Z.INBAND)&&(t[s.Z.INBAND]="false"!==e[s.Z.INBAND]),e.hasOwnProperty(s.Z.TYPE)&&(t[s.Z.TYPE]=e[s.Z.TYPE]),r.push(t))))}),r},getLanguageForAdaptation:function(e){var t="";return e&&e.hasOwnProperty(s.Z.LANG)&&(t=e.lang),t},getViewpointForAdaptation:function(e){return e&&e.hasOwnProperty(s.Z.VIEWPOINT_ASARRAY)&&e[s.Z.VIEWPOINT_ASARRAY].length?e[s.Z.VIEWPOINT_ASARRAY].map(function(e){return(new we).init(e)}):[]},getRolesForAdaptation:function(e){return e&&e.hasOwnProperty(s.Z.ROLE_ASARRAY)&&e[s.Z.ROLE_ASARRAY].length?e[s.Z.ROLE_ASARRAY].map(function(e){return(new we).init(e)}):[]},getAccessibilityForAdaptation:function(e){return e&&e.hasOwnProperty(s.Z.ACCESSIBILITY_ASARRAY)&&e[s.Z.ACCESSIBILITY_ASARRAY].length?e[s.Z.ACCESSIBILITY_ASARRAY].map(function(e){return(new we).init(e)}):[]},getAudioChannelConfigurationForAdaptation:function(e){return e&&e.hasOwnProperty(s.Z.AUDIOCHANNELCONFIGURATION_ASARRAY)&&e[s.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].length?e[s.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].map(function(e){return(new we).init(e)}):[]},getAudioChannelConfigurationForRepresentation:function(e){return e&&e.hasOwnProperty(s.Z.AUDIOCHANNELCONFIGURATION_ASARRAY)&&e[s.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].length?e[s.Z.AUDIOCHANNELCONFIGURATION_ASARRAY].map(function(e){return(new we).init(e)}):[]},getAdaptationForIndex:function(e,t,r){var n=m(t,r);return n.length>0&&l(e)?n[e]:null},getIndexForAdaptation:function(e,t,r){if(!e)return-1;for(var n=m(t,r),a=0;a<n.length;a++)if(Ne(i).getInstance().areEqual(n[a],e))return a;return-1},getAdaptationForId:function(e,t,r){var n,i,a=m(t,r);for(n=0,i=a.length;n<i;n++)if(a[n].hasOwnProperty(s.Z.ID)&&a[n].id===e)return a[n];return null},getAdaptationsForType:function(e,t,r){var n,i,a=m(e,t),s=[];for(n=0,i=a.length;n<i;n++)u(a[n],r)&&s.push(p(a[n]));return s},getRealPeriods:v,getRealPeriodForIndex:function(e,t){var r=v(t);return r.length>0&&l(e)?r[e]:null},getCodec:function(e,t,r){var n=null;if(e&&e.Representation_asArray&&e.Representation_asArray.length>0){var i=l(t)&&t>=0&&t<e.Representation_asArray.length?e.Representation_asArray[t]:e.Representation_asArray[0];i&&(n=i.mimeType+';codecs="'+i.codecs+'"',r&&void 0!==i.width&&(n+=';width="'+i.width+'";height="'+i.height+'"'))}return n&&(n=n.replace(/\sprofiles=[^;]*/g,"")),n},getSelectionPriority:function(e){try{var t=e&&void 0!==e.selectionPriority?parseInt(e.selectionPriority):1;return isNaN(t)?1:t}catch(e){return 1}},getMimeType:function(e){return e&&e.Representation_asArray&&e.Representation_asArray.length>0?e.Representation_asArray[0].mimeType:null},getKID:function(e){return e&&e.hasOwnProperty(s.Z.CENC_DEFAULT_KID)?e[s.Z.CENC_DEFAULT_KID]:null},getLabelsForAdaptation:function(e){if(!e||!Array.isArray(e.Label_asArray))return[];for(var t=[],r=0;r<e.Label_asArray.length;r++)t.push({lang:e.Label_asArray[r].lang,text:e.Label_asArray[r].__text||e.Label_asArray[r]});return t},getContentProtectionData:function(e){return e&&e.hasOwnProperty(s.Z.CONTENTPROTECTION_ASARRAY)&&0!==e.ContentProtection_asArray.length?e.ContentProtection_asArray:null},getIsDynamic:y,getId:function(e){return e&&e[s.Z.ID]||null},hasProfile:function(e,t){var r=!1;return e&&e.profiles&&e.profiles.length>0&&(r=-1!==e.profiles.indexOf(t)),r},getDuration:function(e){return e&&e.hasOwnProperty(s.Z.MEDIA_PRESENTATION_DURATION)?e.mediaPresentationDuration:e&&"dynamic"==e.type?Number.POSITIVE_INFINITY:Number.MAX_SAFE_INTEGER||Number.MAX_VALUE},getBandwidth:function(e){return e&&e.bandwidth?e.bandwidth:NaN},getManifestUpdatePeriod:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=NaN;return e&&e.hasOwnProperty(s.Z.MINIMUM_UPDATE_PERIOD)&&(r=e.minimumUpdatePeriod),isNaN(r)?r:Math.max(r-t,1)},getPublishTime:function(e){return e&&e.hasOwnProperty(s.Z.PUBLISH_TIME)?new Date(e[s.Z.PUBLISH_TIME]):null},getRepresentationCount:function(e){return e&&Array.isArray(e.Representation_asArray)?e.Representation_asArray.length:0},getBitrateListForAdaptation:function(e){var t=p(e);return(t&&Array.isArray(t.Representation_asArray)?t.Representation_asArray:[]).map(function(e){return{bandwidth:e.bandwidth,width:e.width||0,height:e.height||0,scanType:e.scanType||null,id:e.id||null}})},getRepresentationFor:function(e,t){return t&&t.Representation_asArray&&t.Representation_asArray.length>0&&l(e)?t.Representation_asArray[e]:null},getRepresentationsForAdaptation:function(e){var t,r,n,i,a=[],o=function(e){if(e&&e.period&&l(e.period.index)){var t=e.period.mpd.manifest.Period_asArray[e.period.index];if(t&&t.AdaptationSet_asArray&&l(e.index))return p(t.AdaptationSet_asArray[e.index])}}(e);if(o&&o.Representation_asArray){if(e&&e.period&&l(e.period.index)){var u=A(e.period.mpd.manifest);u&&(r=u[0])}for(var d=0,f=o.Representation_asArray.length;d<f;++d){var g=o.Representation_asArray[d],m=new ge;if(m.index=d,m.adaptation=e,g.hasOwnProperty(s.Z.ID)&&(m.id=g.id),g.hasOwnProperty(s.Z.CODECS)&&(m.codecs=g.codecs),g.hasOwnProperty(s.Z.MIME_TYPE)&&(m.mimeType=g[s.Z.MIME_TYPE]),g.hasOwnProperty(s.Z.CODEC_PRIVATE_DATA)&&(m.codecPrivateData=g.codecPrivateData),g.hasOwnProperty(s.Z.BANDWITH)&&(m.bandwidth=g.bandwidth),g.hasOwnProperty(s.Z.WIDTH)&&(m.width=g.width),g.hasOwnProperty(s.Z.HEIGHT)&&(m.height=g.height),g.hasOwnProperty(s.Z.SCAN_TYPE)&&(m.scanType=g.scanType),g.hasOwnProperty(s.Z.MAX_PLAYOUT_RATE)&&(m.maxPlayoutRate=g.maxPlayoutRate),g.hasOwnProperty(s.Z.SEGMENT_BASE)?(t=g.SegmentBase,m.segmentInfoType=s.Z.SEGMENT_BASE):g.hasOwnProperty(s.Z.SEGMENT_LIST)?(t=g.SegmentList).hasOwnProperty(s.Z.SEGMENT_TIMELINE)?m.segmentInfoType=s.Z.SEGMENT_TIMELINE:m.segmentInfoType=s.Z.SEGMENT_LIST:g.hasOwnProperty(s.Z.SEGMENT_TEMPLATE)?((t=g.SegmentTemplate).hasOwnProperty(s.Z.SEGMENT_TIMELINE)?m.segmentInfoType=s.Z.SEGMENT_TIMELINE:m.segmentInfoType=s.Z.SEGMENT_TEMPLATE,t.hasOwnProperty(s.Z.INITIALIZATION_MINUS)&&(m.initialization=t.initialization.split("$Bandwidth$").join(g.bandwidth).split("$RepresentationID$").join(g.id))):m.segmentInfoType=s.Z.BASE_URL,m.essentialProperties=E(g),t){if(t.hasOwnProperty(s.Z.INITIALIZATION)){var v=t.Initialization;v.hasOwnProperty(s.Z.SOURCE_URL)&&(m.initialization=v.sourceURL),v.hasOwnProperty(s.Z.RANGE)&&(m.range=v.range)}else h(o)&&c(o)&&o.mimeType&&-1===o.mimeType.indexOf("application/mp4")&&(m.range=0);t.hasOwnProperty(s.Z.TIMESCALE)&&(m.timescale=t.timescale),t.hasOwnProperty(s.Z.DURATION)?m.segmentDuration=t.duration/m.timescale:g.hasOwnProperty(s.Z.SEGMENT_TEMPLATE)&&(t=g.SegmentTemplate).hasOwnProperty(s.Z.SEGMENT_TIMELINE)&&(m.segmentDuration=T(t.SegmentTimeline)/m.timescale),t.hasOwnProperty(s.Z.MEDIA)&&(m.media=t.media),t.hasOwnProperty(s.Z.START_NUMBER)&&(m.startNumber=t.startNumber),t.hasOwnProperty(s.Z.INDEX_RANGE)&&(m.indexRange=t.indexRange),t.hasOwnProperty(s.Z.PRESENTATION_TIME_OFFSET)&&(m.presentationTimeOffset=t.presentationTimeOffset/m.timescale),t.hasOwnProperty(s.Z.AVAILABILITY_TIME_OFFSET)?m.availabilityTimeOffset=t.availabilityTimeOffset:r&&void 0!==r.availabilityTimeOffset&&(m.availabilityTimeOffset=r.availabilityTimeOffset),t.hasOwnProperty(s.Z.AVAILABILITY_TIME_COMPLETE)?m.availabilityTimeComplete="false"!==t.availabilityTimeComplete:r&&void 0!==r.availabilityTimeComplete&&(m.availabilityTimeComplete=r.availabilityTimeComplete)}m.MSETimeOffset=(i=(n=m).presentationTimeOffset,n.adaptation.period.start-i),m.path=[e.period.index,e.index,d],a.push(m)}}return a},getAdaptationsForPeriod:function(e){var r,n,i,o=e&&l(e.index)?e.mpd.manifest.Period_asArray[e.index]:null,c=[];if(o&&o.AdaptationSet_asArray)for(i=0;i<o.AdaptationSet_asArray.length;i++)n=o.AdaptationSet_asArray[i],r=new pe,n.hasOwnProperty(s.Z.ID)&&(r.id=n.id),r.index=i,r.period=e,u(n,a.Z.MUXED)?r.type=a.Z.MUXED:u(n,a.Z.AUDIO)?r.type=a.Z.AUDIO:f(n)?r.type=a.Z.VIDEO:h(n)?r.type=a.Z.TEXT:g(n)?r.type=a.Z.IMAGE:t.warn("Unknown Adaptation stream type"),c.push(r);return c},getRegularPeriods:function(e){var n,i,o=!!e&&y(e.manifest),l=[],u=null,c=null,d=null,f=null;for(i=0,n=e&&e.manifest&&e.manifest.Period_asArray?e.manifest.Period_asArray.length:0;i<n;i++)(c=e.manifest.Period_asArray[i]).hasOwnProperty(s.Z.START)?(f=new ve).start=c.start:null!==u&&u.hasOwnProperty(s.Z.DURATION)&&null!==d?(f=new ve).start=parseFloat((d.start+d.duration).toFixed(5)):0!==i||o||((f=new ve).start=0),null!==d&&isNaN(d.duration)&&(null!==f?d.duration=parseFloat((f.start-d.start).toFixed(5)):t.warn("First period duration could not be calculated because lack of start and duration period properties. This will cause timing issues during playback")),null!==f&&(f.id=_(c,i),f.index=i,f.mpd=e,c.hasOwnProperty(s.Z.DURATION)&&(f.duration=c.duration),d&&(d.nextPeriodId=f.id),l.push(f),u=c,d=f),c=null,f=null;return 0===l.length||null!==d&&isNaN(d.duration)&&(d.duration=parseFloat((function(e){!function(){if(!r||!r.hasOwnProperty("error"))throw new Error(a.Z.MISSING_CONFIG_ERROR)}();var t,n=y(e.mpd.manifest);return e.mpd.manifest.mediaPresentationDuration?t=e.mpd.manifest.mediaPresentationDuration:e.duration?t=e.duration:n?t=Number.POSITIVE_INFINITY:r.error(new S.Z(w.MANIFEST_ERROR_ID_PARSE_CODE,"Must have @mediaPresentationDuration on MPD or an explicit @duration on the last period.",e)),t}(d)-d.start).toFixed(5))),l},getMpd:function(e){var t=new ye;return e&&(t.manifest=e,e.hasOwnProperty(s.Z.AVAILABILITY_START_TIME)?t.availabilityStartTime=new Date(e.availabilityStartTime.getTime()):e.loadedTime&&(t.availabilityStartTime=new Date(e.loadedTime.getTime())),e.hasOwnProperty(s.Z.AVAILABILITY_END_TIME)&&(t.availabilityEndTime=new Date(e.availabilityEndTime.getTime())),e.hasOwnProperty(s.Z.MINIMUM_UPDATE_PERIOD)&&(t.minimumUpdatePeriod=e.minimumUpdatePeriod),e.hasOwnProperty(s.Z.MEDIA_PRESENTATION_DURATION)&&(t.mediaPresentationDuration=e.mediaPresentationDuration),e.hasOwnProperty(s.Z.SUGGESTED_PRESENTATION_DELAY)&&(t.suggestedPresentationDelay=e.suggestedPresentationDelay),e.hasOwnProperty(s.Z.TIMESHIFT_BUFFER_DEPTH)&&(t.timeShiftBufferDepth=e.timeShiftBufferDepth),e.hasOwnProperty(s.Z.MAX_SEGMENT_DURATION)&&(t.maxSegmentDuration=e.maxSegmentDuration),e.hasOwnProperty(s.Z.PUBLISH_TIME)&&(t.publishTime=new Date(e.publishTime))),t},getEventsForPeriod:function(e){var t,r,i=e&&e.mpd&&e.mpd.manifest?e.mpd.manifest:null,o=i?i.Period_asArray:null,u=o&&e&&l(e.index)?o[e.index].EventStream_asArray:null,c=[];if(u)for(t=0;t<u.length;t++){var d=new be;if(d.period=e,d.timescale=1,!u[t].hasOwnProperty(a.Z.SCHEME_ID_URI))throw new Error("Invalid EventStream. SchemeIdUri has to be set");for(d.schemeIdUri=u[t][a.Z.SCHEME_ID_URI],u[t].hasOwnProperty(s.Z.TIMESCALE)&&(d.timescale=u[t][s.Z.TIMESCALE]),u[t].hasOwnProperty(s.Z.VALUE)&&(d.value=u[t][s.Z.VALUE]),u[t].hasOwnProperty(s.Z.PRESENTATION_TIME_OFFSET)&&(d.presentationTimeOffset=u[t][s.Z.PRESENTATION_TIME_OFFSET]),r=0;u[t].Event_asArray&&r<u[t].Event_asArray.length;r++){var f=u[t].Event_asArray[r],h=new Te;h.presentationTime=0,h.eventStream=d,f.hasOwnProperty(s.Z.PRESENTATION_TIME)&&(h.presentationTime=f.presentationTime);var g=d.presentationTimeOffset?d.presentationTimeOffset/d.timescale:0;h.calculatedPresentationTime=h.presentationTime/d.timescale+e.start-g,f.hasOwnProperty(s.Z.DURATION)&&(h.duration=f.duration/d.timescale),f.hasOwnProperty(s.Z.ID)?h.id=f.id:h.id=null,f.Signal&&f.Signal.Binary?h.messageData=n.decodeArray(f.Signal.Binary.toString()):h.messageData=f.messageData||f.__cdata||f.__text,c.push(h)}}return c},getEssentialPropertiesForAdaptation:function(e){var t={};if(e&&e.hasOwnProperty(s.Z.ESSENTIAL_PROPERTY_ASARRAY)){var r,n=Be(e.EssentialProperty_asArray);try{for(n.s();!(r=n.n()).done;){var i=r.value;i.hasOwnProperty(a.Z.SCHEME_ID_URI)&&(t[i[a.Z.SCHEME_ID_URI]]=xe({},i))}}catch(e){n.e(e)}finally{n.f()}}return t},getEssentialPropertiesAsArrayForAdaptation:function(e){return e&&e.hasOwnProperty(s.Z.ESSENTIAL_PROPERTY_ASARRAY)&&e.EssentialProperty_asArray.length?e.EssentialProperty_asArray.map(function(e){return(new we).init(e)}):[]},getEssentialPropertiesForRepresentation:E,getEventStreamForAdaptationSet:function(e,t,r){var n,i,a;return e&&e.Period_asArray&&t&&t.period&&l(t.period.index)&&(i=e.Period_asArray[t.period.index])&&i.AdaptationSet_asArray&&l(t.index)&&(a=i.AdaptationSet_asArray[t.index])&&(n=a.InbandEventStream_asArray),b(n,null,r)},getEventStreamForRepresentation:function(e,t,r){var n,i,a,s;return e&&e.Period_asArray&&t&&t.adaptation&&t.adaptation.period&&l(t.adaptation.period.index)&&(i=e.Period_asArray[t.adaptation.period.index])&&i.AdaptationSet_asArray&&l(t.adaptation.index)&&(a=i.AdaptationSet_asArray[t.adaptation.index])&&a.Representation_asArray&&l(t.index)&&(s=a.Representation_asArray[t.index])&&(n=s.InbandEventStream_asArray),b(n,t,r)},getUTCTimingSources:function(e){var t=y(e),r=!!e&&e.hasOwnProperty(s.Z.AVAILABILITY_START_TIME),n=e?e.UTCTiming_asArray:null,i=[];return(t||r)&&n&&n.forEach(function(e){var t=new Ee.Z;e.hasOwnProperty(a.Z.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty(s.Z.VALUE)&&(t.value=e.value.toString(),i.push(t)))}),i},getBaseURLsFromElement:A,getRepresentationSortFunction:function(){return function(e,t){return e.bandwidth-t.bandwidth}},getContentSteering:function(e){if(e&&e.hasOwnProperty(s.Z.CONTENT_STEERING_AS_ARRAY))return I(e[s.Z.CONTENT_STEERING_AS_ARRAY][0])},getLocation:function(e){return e&&e.hasOwnProperty(s.Z.LOCATION_AS_ARRAY)?e[s.Z.LOCATION_AS_ARRAY].map(function(e){var t=e.__text||e,r=e.hasOwnProperty(s.Z.SERVICE_LOCATION)?e[s.Z.SERVICE_LOCATION]:null;return new Oe(t,r)}):[]},getPatchLocation:function(e){return e&&e.hasOwnProperty(s.Z.PATCH_LOCATION_AS_ARRAY)?e[s.Z.PATCH_LOCATION_AS_ARRAY].map(function(e){var t=e.__text||e,r=e.hasOwnProperty(s.Z.SERVICE_LOCATION)?e[s.Z.SERVICE_LOCATION]:null,n=e.hasOwnProperty(s.Z.TTL)?1e3*parseFloat(e[s.Z.TTL]):NaN;return new Me(t,r,n)}):[]},getSuggestedPresentationDelay:function(e){return e&&e.hasOwnProperty(s.Z.SUGGESTED_PRESENTATION_DELAY)?e.suggestedPresentationDelay:null},getAvailabilityStartTime:function(e){return e&&e.hasOwnProperty(s.Z.AVAILABILITY_START_TIME)&&null!==e.availabilityStartTime?e.availabilityStartTime.getTime():null},getServiceDescriptions:function(e){var t=[];if(e&&e.hasOwnProperty(s.Z.SERVICE_DESCRIPTION)){var r,n=Be(e.ServiceDescription_asArray);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=null,o=null,l=null,u=null,c=null,d=null,f=null;for(var h in i)i.hasOwnProperty(h)&&(h===s.Z.ID?a=i[h]:h===s.Z.SERVICE_DESCRIPTION_SCOPE?o=i[h].schemeIdUri:h===s.Z.SERVICE_DESCRIPTION_LATENCY?l={target:parseInt(i[h].target),max:parseInt(i[h].max),min:parseInt(i[h].min),referenceId:parseInt(i[h].referenceId)}:h===s.Z.SERVICE_DESCRIPTION_PLAYBACK_RATE?u={max:parseFloat(i[h].max),min:parseFloat(i[h].min)}:h===s.Z.SERVICE_DESCRIPTION_OPERATING_QUALITY?c={mediaType:i[h].mediaType,max:parseInt(i[h].max),min:parseInt(i[h].min),target:parseInt(i[h].target),type:i[h].type,maxQualityDifference:parseInt(i[h].maxQualityDifference)}:h===s.Z.SERVICE_DESCRIPTION_OPERATING_BANDWIDTH?d={mediaType:i[h].mediaType,max:parseInt(i[h].max),min:parseInt(i[h].min),target:parseInt(i[h].target)}:h===s.Z.CONTENT_STEERING&&(f=I(i[h])));t.push({id:a,schemeIdUri:o,latency:l,playbackRate:u,operatingQuality:c,operatingBandwidth:d,contentSteering:f})}}catch(e){n.e(e)}finally{n.f()}}return t},getSegmentAlignment:function(e){return!(!e||!e.hasOwnProperty(s.Z.SEGMENT_ALIGNMENT))&&"true"===e[s.Z.SEGMENT_ALIGNMENT]},getSubSegmentAlignment:function(e){return!(!e||!e.hasOwnProperty(s.Z.SUB_SEGMENT_ALIGNMENT))&&"true"===e[s.Z.SUB_SEGMENT_ALIGNMENT]},getSupplementalPropertiesForAdaptation:function(e){var t={};if(e&&e.hasOwnProperty(s.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)){var r,n=Be(e.SupplementalProperty_asArray);try{for(n.s();!(r=n.n()).done;){var i=r.value;i.hasOwnProperty(a.Z.SCHEME_ID_URI)&&(t[i[a.Z.SCHEME_ID_URI]]=xe({},i))}}catch(e){n.e(e)}finally{n.f()}}return t},getSupplementalPropertiesAsArrayForAdaptation:function(e){return e&&e.hasOwnProperty(s.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)&&e.SupplementalProperty_asArray.length?e.SupplementalProperty_asArray.map(function(e){return(new we).init(e)}):[]},getSupplementalPropertiesForRepresentation:function(e){var t={};if(e&&e.hasOwnProperty(s.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)){var r,n=Be(e.SupplementalProperty_asArray);try{for(n.s();!(r=n.n()).done;){var i=r.value;i.hasOwnProperty(a.Z.SCHEME_ID_URI)&&(t[i[a.Z.SCHEME_ID_URI]]=xe({},i))}}catch(e){n.e(e)}finally{n.f()}}return t},getSupplementalPropertiesAsArrayForRepresentation:function(e){return e&&e.hasOwnProperty(s.Z.SUPPLEMENTAL_PROPERTY_ASARRAY)&&e.SupplementalProperty_asArray.length?e.SupplementalProperty_asArray.map(function(e){return(new we).init(e)}):[]},setConfig:function(e){e&&(e.errHandler&&(r=e.errHandler),e.BASE64&&(n=e.BASE64))}},t=(0,d.Z)(i).getInstance().getLogger(e),e}Ge.__dashjs_factory_name="DashManifestModel";var He=c.Z.getSingletonFactory(Ge),$e=r(703);function Ve(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Ke(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ke(e,t):void 0}}(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}function Ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function qe(){var e,t,r,n,i,s,o,u,c,d,h=this.context,g=(0,l.Z)(h).getInstance(),p=(0,D.Z)(h).getInstance();function m(){r={pr:1,nor:null,st:null,sf:null,sid:"".concat($e.Z.generateUuid()),cid:null},c={},u={},d={},y()}function v(){y()}function y(){if(s){var e=s.getStreamController();if(e&&"function"==typeof e.getActiveStream){var t=e.getActiveStream();t&&(o=t.getProcessors())}}}function E(e,t){var r,n={},i=Ve(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;e[a]&&(n[a]=e[a])}}catch(e){i.e(e)}finally{i.f()}return n}function T(e){var t=p.get().streaming.cmcd.enabledKeys;return e.filter(function(e){return t.includes(e)})}function _(e){try{return e.type===L.w.MPD_TYPE?((l=S()).ot="m",l):e.type===L.w.MEDIA_SEGMENT_TYPE?(t=e.mediaType,d.hasOwnProperty(t)||(d[t]=!1),u.hasOwnProperty(t)||(u[t]=!1),c.hasOwnProperty(t)||(c[t]=!1),function(e){var t,l=S(),f=function(e){try{var t=e.quality,r=e.mediaInfo.bitrateList;return parseInt(r[t].bandwidth/1e3)}catch(e){return null}}(e),h=function(e){try{return isNaN(e.duration)?NaN:Math.round(1e3*e.duration)}catch(e){return null}}(e),g=function(e){try{return 100*parseInt(n.getThroughputHistory().getSafeAverageThroughput(e)/100)}catch(e){return null}}(e.mediaType),m=function(e){try{var t=r.pr,n=i.getCurrentBufferLevel(e);return isNaN(t)||isNaN(n)?null:100*parseInt(n/t*10)}catch(e){return null}}(e.mediaType),v=b(e.mediaType),y=function(e){try{var t=n.getTopBitrateInfoFor(e);return Math.round(t.bitrate/1e3)}catch(e){return null}}(e.mediaType),E=r.pr,T=function(e){if(o&&0!==o.length){var t,r=Ve(o);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.getType()===e)return n.probeNextRequest()}}catch(e){r.e(e)}finally{r.f()}}}(e.mediaType);e.mediaType===a.Z.VIDEO&&(t="v"),e.mediaType===a.Z.AUDIO&&(t="a"),e.mediaType===a.Z.TEXT&&(t="application/mp4"===e.mediaInfo.mimeType?"tt":"c");var _=p.get().streaming.cmcd.rtp;return _||(_=function(e){try{var t=s.getPlaybackRate();t||(t=1);var r=e.quality,n=e.mediaType,i=e.mediaInfo,a=e.duration;if(!i)return NaN;var o=b(n);0===o&&(o=500);var l=i.bitrateList[r].bandwidth*a/1e3/(o/t/1e3),u=p.get().streaming.cmcd.rtpSafetyFactor&&!isNaN(p.get().streaming.cmcd.rtpSafetyFactor)?p.get().streaming.cmcd.rtpSafetyFactor:5;return 100*(parseInt(l*u/100)+1)}catch(e){return NaN}}(e)),isNaN(_)||(l.rtp=_),T&&(e.url!==T.url?l.nor=encodeURIComponent($e.Z.getRelativeUrl(e.url,T.url)):T.range&&(l.nrr=T.range)),f&&(l.br=f),t&&(l.ot=t),isNaN(h)||(l.d=h),isNaN(g)||(l.mtp=g),isNaN(m)||(l.dl=m),isNaN(v)||(l.bl=v),isNaN(y)||(l.tb=y),isNaN(E)||1===E||(l.pr=E),c[e.mediaType]&&(l.bs=!0,c[e.mediaType]=!1),!u[e.mediaType]&&d[e.mediaType]||(l.su=!0,u[e.mediaType]=!1,d[e.mediaType]=!0),l}(e)):e.type===L.w.INIT_SEGMENT_TYPE?function(){var e=S();return e.ot="i",e.su=!0,e}():e.type===L.w.OTHER_TYPE||e.type===L.w.XLINK_EXPANSION_TYPE?function(){var e=S();return e.ot="o",e}():e.type===L.w.LICENSE?function(){var e=S();return e.ot="k",e}():null}catch(e){return null}var t,l}function S(){var e={},t=p.get().streaming.cmcd.cid?p.get().streaming.cmcd.cid:r.cid;return e.v=1,e.sid=p.get().streaming.cmcd.sid?p.get().streaming.cmcd.sid:r.sid,e.sid="".concat(e.sid),t&&(e.cid="".concat(t)),isNaN(r.pr)||1===r.pr||null===r.pr||(e.pr=r.pr),r.st&&(e.st=r.st),r.sf&&(e.sf=r.sf),e}function b(e){try{var t=i.getCurrentBufferLevel(e);return isNaN(t)?null:100*parseInt(10*t)}catch(e){return null}}function A(e){try{r.pr=e.playbackRate}catch(e){}}function I(t){try{var n=e.getIsDynamic(t.data)?"l":"v",i=t.protocol&&"MSS"===t.protocol?"s":"d";r.st="".concat(n),r.sf="".concat(i)}catch(e){}}function R(e){try{e.state&&e.mediaType&&e.state===f.Z.BUFFER_EMPTY&&(c[e.mediaType]||(c[e.mediaType]=!0),u[e.mediaType]||(u[e.mediaType]=!0))}catch(e){}}function w(){for(var e in c)c.hasOwnProperty(e)&&(c[e]=!0);for(var t in u)u.hasOwnProperty(t)&&(u[t]=!0)}function C(e){try{if(!e)return null;var t=Object.keys(e).sort(function(e,t){return e.localeCompare(t)}),r=t.length,n=t.reduce(function(t,n,i){return"v"===n&&1===e[n]||("string"==typeof e[n]&&"ot"!==n&&"sf"!==n&&"st"!==n?t+="".concat(n,"=").concat(JSON.stringify(e[n])):t+="".concat(n,"=").concat(e[n]),i<r-1&&(t+=",")),t},"");return(n=n.replace(/=true/g,"")).replace(/,\s*$/,"")}catch(e){return null}}return t={getQueryParameter:function(e){try{if(p.get().streaming.cmcd&&p.get().streaming.cmcd.enabled){var t=_(e),r=function(e){try{var t=p.get().streaming.cmcd.enabledKeys;return Object.keys(e).filter(function(e){return t.includes(e)}).reduce(function(t,r){return t[r]=e[r],t},{})}catch(t){return e}}(t),n=C(r);return g.trigger(fe.Z.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,cmcdString:n}),{key:"CMCD",value:n}}return null}catch(e){return null}},getHeaderParameters:function(e){try{if(p.get().streaming.cmcd&&p.get().streaming.cmcd.enabled){var t=_(e),r=E(t,T(["br","d","ot","tb"])),n=E(t,T(["bl","dl","mtp","nor","nrr","su"])),i=E(t,T(["bs","rtp"])),a=E(t,T(["cid","pr","sf","sid","st","v"])),s={"CMCD-Object":C(r),"CMCD-Request":C(n),"CMCD-Status":C(i),"CMCD-Session":C(a)};return g.trigger(fe.Z.CMCD_DATA_GENERATED,{url:e.url,mediaType:e.mediaType,cmcdData:t,headers:s}),s}return null}catch(e){return null}},setConfig:function(e){e&&(e.abrController&&(n=e.abrController),e.dashMetrics&&(i=e.dashMetrics),e.playbackController&&(s=e.playbackController))},reset:function(){g.off(f.Z.PLAYBACK_RATE_CHANGED,A,this),g.off(f.Z.MANIFEST_LOADED,I,this),g.off(f.Z.BUFFER_LEVEL_STATE_CHANGED,R,t),g.off(f.Z.PLAYBACK_SEEKED,w,t),m()},initialize:function(){g.on(f.Z.PLAYBACK_RATE_CHANGED,A,t),g.on(f.Z.MANIFEST_LOADED,I,t),g.on(f.Z.BUFFER_LEVEL_STATE_CHANGED,R,t),g.on(f.Z.PLAYBACK_SEEKED,w,t),g.on(f.Z.PERIOD_SWITCH_COMPLETED,v,t)}},e=He(h).getInstance(),m(),t}qe.__dashjs_factory_name="CmcdModel";var Ye=c.Z.getSingletonFactory(qe);function je(e){return je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},je(e)}function ze(e,t){ze=function(e,t){return new a(e,void 0,t)};var r=Xe(RegExp),n=RegExp.prototype,i=new WeakMap;function a(e,t,n){var a=r.call(this,e,t);return i.set(a,n||i.get(e)),a}function s(e,t){var r=i.get(t);return Object.keys(r).reduce(function(t,n){return t[n]=e[r[n]],t},Object.create(null))}return We(a,r),a.prototype.exec=function(e){var t=n.exec.call(this,e);return t&&(t.groups=s(t,this)),t},a.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var r=i.get(this);return n[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,function(e,t){return"$"+r[t]}))}if("function"==typeof t){var a=this;return n[Symbol.replace].call(this,e,function(){var e=[];return e.push.apply(e,arguments),"object"!==je(e[e.length-1])&&e.push(s(e,a)),t.apply(this,e)})}return n[Symbol.replace].call(this,e,t)},ze.apply(this,arguments)}function We(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&et(e,t)}function Xe(e){var t="function"==typeof Map?new Map:void 0;return Xe=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Qe(e,arguments,tt(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),et(n,e)},Xe(e)}function Qe(e,t,r){return Qe=Je()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&et(i,r.prototype),i},Qe.apply(null,arguments)}function Je(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function et(e,t){return et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},et(e,t)}function tt(e){return tt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},tt(e)}var rt="static",nt="dynamic",it="cmsd-",at=it+rt,st=it+nt,ot="stream",lt=["mb","st","sf","v"],ut={video:"v",audio:"a",text:"tt",stream:ot},ct=/^[-0-9]/;function dt(){var e,t,r,n,i=this.context,a=(0,l.Z)(i).getInstance();function s(){r={},n={}}function o(e){e&&Object.keys(e).forEach(function(t){lt.includes(t)||delete e[t]})}function c(e){return!e||"false"!==e.toLowerCase()&&(ct.test(e)?parseInt(e,10):e.replace(/["]+/g,""))}function f(e){try{for(var r={},n=e.split(","),i=0;i<n.length;i++){var a=n[i].split("="),s=a[0],o=c(a[1]);r[s]=o}return r}catch(e){t.error("Failed to parse CMSD-Static response header value:",e)}}function h(e){try{for(var r={},n=e.split(","),i=n[n.length-1].split(";"),a=1;a<i.length;a++){var s=i[a].split("="),o=s[0],l=c(s[1]);r[o]=l}return r}catch(e){return t.error("Failed to parse CMSD-Dynamic response header value:",e),[]}}function g(e){return ut[e]||"o"}function p(e,t,i){var a=e===rt?r:n,s=a[t]||{},o=a[ot]||{};return s[i]||o[i]}return e={setConfig:function(){},initialize:function(){},reset:function(){s()},parseResponseHeaders:function(e,t){for(var i=null,s=null,l=e.split("\r\n"),c=l.length-1;c>=0;c--){var d=l[c].match(ze(/^((?:(?!:)[\s\S])*):[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*(.*)$/,{key:1,value:2}));if(d&&d.groups){var p=d.groups.key.toLowerCase(),m=d.groups.value;switch(p){case at:i=f(m),a.trigger(u.Z.CMSD_STATIC_HEADER,i);break;case st:s||(s=h(m))}}}var v=ot;return i&&i.ot?v=i.ot:t&&(v=g(t)),o(r[v]),o(n[v]),i&&(r[v]=Object.assign(r[v]||{},i)),s&&(n[v]=Object.assign(n[v]||{},s)),{static:i,dynamic:s}},getMaxBitrate:function(e){var t=g(e);return p(nt,t,"mb")||-1},getEstimatedThroughput:function(e){var t=g(e);return p(nt,t,"etp")||null},getResponseDelay:function(e){var t=g(e);return p(nt,t,"rd")||null},getRoundTripTime:function(e){var t=g(e);return p(nt,t,"rtt")||null}},t=(0,d.Z)(i).getInstance().getLogger(e),s(),e}dt.__dashjs_factory_name="CmsdModel";var ft=c.Z.getSingletonFactory(dt);function ht(){var e,t,r=this.context,n={};function i(){t=(0,d.Z)(r).getInstance().getLogger(e)}function a(e){for(var t={},r=0,n=0,i=0,a=0,s=e.length,o=0;o<s;++o)r+=e[o].chunkDownloadTimeRelativeMS,n+=e[o].bufferLevel,i+=e[o].chunkDownloadTimeRelativeMS*e[o].bufferLevel,a+=e[o].chunkDownloadTimeRelativeMS*e[o].chunkDownloadTimeRelativeMS;return t.m=(i-r*n/s)/(a-r*r/s),t.b=n/s-t.m*r/s,function(e){return t.m*e+t.b}}function s(e){var t,r=!0,n=e.reduce(function(e,t){return e+t.bufferLevelAtSegmentEnd},0)/e.length;return e.forEach(function(e){Math.abs(e.bufferLevelAtSegmentEnd/e.bufferLevelAtSegmentStart)<.95&&(r=!1),e.bufferLevelAtSegmentEnd/n<.8&&(r=!1),t?t>e.bitrate&&(r=!1):t=e.bitrate}),r}return e={setup:i,addMeasurement:function(e,t,r,i,s){e&&e.mediaType&&!n[e.mediaType]&&(n[e.mediaType]=[]);var o=e.mediaInfo.bitrateList.find(function(t){return t.id===e.representationId});n[e.mediaType].push({index:e.index,repId:e.representationId,mediaType:e.mediaType,requestTimeMS:i,adjustedAvailabilityStartTimeMS:e.availabilityStartTime.getTime(),segDurationMS:1e3*e.duration,chunksDurationMS:r.reduce(function(e,t){return e+t.chunkDownloadDurationMS},0),segmentBytes:r.reduce(function(e,t){return e+t.chunkBytes},0),bitrate:o&&o.bandwidth,bitrateList:e.mediaInfo.bitrateList,chunkMeasurements:r,fetchDownloadDurationMS:t,throughputCapacityDelayMS:s,getEstimatedBufferLevel:a(r.slice(1))}),n[e.mediaType].length>10&&n[e.mediaType].shift()},getThroughputCapacityDelayMS:function(e,t){var r=n[e.mediaType]&&n[e.mediaType].slice(-3);return!r||r.length<3?0:s(r)?t/4>250?250:t/4:0},getEstimatedDownloadDurationMS:function(e){var r=n[e.mediaType].slice(-1).pop(),i=n[e.mediaType].slice(-3),a=r.chunkMeasurements.slice(-1).pop().chunkDownloadTimeRelativeMS;r.bufferLevelAtSegmentStart=r.getEstimatedBufferLevel(a/2),r.bufferLevelAtSegmentEnd=r.getEstimatedBufferLevel(a);var o=s(i),l=o?.6:.8;if(r.isBufferStable&&1.05*r.segDurationMS<r.fetchDownloadDurationMS)return r.fetchDownloadDurationMS;if(!o||r.segDurationMS<r.fetchDownloadDurationMS)return.8*r.fetchDownloadDurationMS;if(r.adjustedAvailabilityStartTimeMS<=r.requestTimeMS+r.throughputCapacityDelayMS-r.segDurationMS)return.8*r.fetchDownloadDurationMS;for(var u=r.requestTimeMS+r.throughputCapacityDelayMS-r.adjustedAvailabilityStartTimeMS,c=0,d=0,f=0,h=0;h<r.chunkMeasurements.length;h++){var g=r.chunkMeasurements[h];if(u<d+g.chunkDownloadDurationMS)break;d+=g.chunkDownloadDurationMS,c+=g.chunkBytes,f++}if(u<0&&t.warn("request time was before adjusted availibitly start time"),c&&d&&f>.2*r.chunkMeasurements.length){var p=c/d,m=r.segmentBytes/p;return r.fetchDownloadDurationMS<m?r.fetchDownloadDurationMS*l:m*l}var v=r.bitrate;return r.bitrateList.some(function(e){if(e.bandwidth>r.bitrate)return v=e.bandwidth,!0}),v===r.bitrate?r.fetchDownloadDurationMS*l:l*r.segmentBytes*8*1e3/v}},i(),e}ht.__dashjs_factory_name="LowLatencyThroughputModel";var gt=c.Z.getSingletonFactory(ht),pt=r(5717);function mt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vt(e){e=e||{};var t,r,n,i,s,o,c,f,h,g,p,m=this.context,v=e.errHandler,y=e.dashMetrics,E=e.mediaPlayerModel,T=e.requestModifier,_=e.boxParser,b=e.errors,A=e.requestTimeout||0,I=(0,l.Z)(m).getInstance(),R=(0,D.Z)(m).getInstance();function w(e,t){var l,d=e.request,p=[],b=!0,D=!0,C=new Date,N=C,P=0,O=null,M=null;if(!T||!y||!v)throw new Error("config object is not correct or missing");var k,x=function(e){d.requestStartDate=C,d.requestEndDate=new Date,d.firstByteDate=d.firstByteDate||C,d.fileLoaderType=M;var t=l.response?l.response.responseURL:null,r=l.response?l.response.status:null,n=l.response&&l.response.getAllResponseHeaders?l.response.getAllResponseHeaders():l.response?l.response.responseHeaders:null,i=n&&R.get().streaming.cmsd&&R.get().streaming.cmsd.enabled?c.parseResponseHeaders(n,d.mediaType):null;y.addHttpRequest(d,t,r,n,e?p:null,i)},F=function(e){D=!1,x(e),d.type===L.w.MPD_TYPE&&(y.addManifestUpdate(d),I.trigger(u.Z.MANIFEST_LOADING_FINISHED,{request:d}))},B=function(){if(O&&(clearTimeout(O),O=null),-1!==r.indexOf(l)&&(r.splice(r.indexOf(l),1),D))if(F(!1),t>0){try{R.get().streaming.utcSynchronization.enableBackgroundSyncAfterSegmentDownloadError&&d.type===L.w.MEDIA_SEGMENT_TYPE&&E.getRetryAttemptsForType(L.w.MEDIA_SEGMENT_TYPE)===t&&I.trigger(u.Z.ATTEMPT_BACKGROUND_SYNC)}catch(e){}t--;var n={config:e};i.push(n),n.timeout=setTimeout(function(){-1!==i.indexOf(n)&&(i.splice(i.indexOf(n),1),w(e,t))},E.getRetryIntervalsForType(d.type))}else{if(d.type===L.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE)return;v.error(new S.Z(s[d.type],d.url+" is not available",{request:d,response:l.response})),e.error&&e.error(d,"error",l.response.statusText,l.response),e.complete&&e.complete(d,l.response.statusText)}};d.hasOwnProperty("availabilityTimeComplete")&&!1===d.availabilityTimeComplete&&window.fetch&&"arraybuffer"===d.responseType&&d.type===L.w.MEDIA_SEGMENT_TYPE?((k=de(m).create({requestModifier:T,lowLatencyThroughputModel:h,boxParser:_})).setup({dashMetrics:y}),M=a.Z.FILE_LOADER_TYPES.FETCH):(k=(0,oe.Z)(m).create({requestModifier:T}),M=a.Z.FILE_LOADER_TYPES.XHR);var U=null,Z=T.modifyRequestURL?T.modifyRequestURL(d.url):d.url;if(R.get().streaming.cmcd&&R.get().streaming.cmcd.enabled){var G=R.get().streaming.cmcd.mode;if(G===a.Z.CMCD_MODE_QUERY){var H=function(e){try{var t=[],r=o.getQueryParameter(e);return r&&t.push(r),t}catch(e){return[]}}(d);Z=$e.Z.addAditionalQueryParameterToUrl(Z,H)}else G===a.Z.CMCD_MODE_HEADER&&(U=o.getHeaderParameters(d))}var $=f.getXHRWithCredentialsForType(d.type);if(d.queryParams){var V=Object.keys(d.queryParams).map(function(e){return{key:e,value:d.queryParams[e]}});Z=$e.Z.addAditionalQueryParameterToUrl(Z,V)}d.url=Z,l={url:Z,method:L.w.GET,withCredentials:$,request:d,onload:function(){l.response.status>=200&&l.response.status<=299&&(F(!0),e.success&&e.success(l.response.response,l.response.statusText,l.response.responseURL),e.complete&&e.complete(d,l.response.statusText))},onend:B,onerror:B,progress:function(t){var r=new Date;b&&(b=!1,(!t.lengthComputable||t.lengthComputable&&t.total!==t.loaded)&&(d.firstByteDate=r)),t.lengthComputable&&(d.bytesLoaded=t.loaded,d.bytesTotal=t.total),t.noTrace||(p.push({s:N,d:t.time?t.time:r.getTime()-N.getTime(),b:[t.loaded?t.loaded-P:0]}),N=r,P=t.loaded),O&&(clearTimeout(O),O=null),R.get().streaming.fragmentRequestProgressTimeout>0&&(O=setTimeout(function(){g.warn("Abort request "+l.url+" due to progress timeout"),l.response.onabort=null,l.loader.abort(l),B()},R.get().streaming.fragmentRequestProgressTimeout)),e.progress&&t&&e.progress(t)},onabort:function(){x(!0),O&&(clearTimeout(O),O=null),e.abort&&e.abort(d)},ontimeout:function(e){var t;if(e.lengthComputable){var r=e.loaded/e.total*100;t="Request timeout: loaded: "+e.loaded+", out of: "+e.total+" : "+r.toFixed(3)+"% Completed"}else t="Request timeout: non-computable download size";g.warn(t)},loader:k,timeout:A,headers:U};var K=(new Date).getTime();if(isNaN(d.delayLoadingTime)||K>=d.delayLoadingTime)r.push(l),k.load(l);else{var q={httpRequest:l};n.push(q),q.delayTimeout=setTimeout(function(){if(-1!==n.indexOf(q)){n.splice(n.indexOf(q),1);try{C=new Date,N=C,r.push(q.httpRequest),k.load(q.httpRequest)}catch(e){q.httpRequest.onerror()}}},d.delayLoadingTime-K)}}return t={load:function(e){e.request?w(e,E.getRetryAttemptsForType(e.request.type)):e.error&&e.error(e.request,"error")},abort:function(){i.forEach(function(e){clearTimeout(e.timeout),e.config.request&&e.config.abort&&e.config.abort(e.config.request)}),i=[],n.forEach(function(e){return clearTimeout(e.delayTimeout)}),n=[],r.forEach(function(e){e.request.type!==L.w.MSS_FRAGMENT_INFO_SEGMENT_TYPE&&(e.onloadend=e.onerror=e.onprogress=void 0,e.loader.abort(e))}),r=[]}},g=(0,d.Z)(m).getInstance().getLogger(t),r=[],n=[],i=[],o=Ye(m).getInstance(),c=ft(m).getInstance(),h=gt(m).getInstance(),f=(0,pt.Z)(m).getInstance(),mt(p={},L.w.MPD_TYPE,b.DOWNLOAD_ERROR_ID_MANIFEST_CODE),mt(p,L.w.XLINK_EXPANSION_TYPE,b.DOWNLOAD_ERROR_ID_XLINK_CODE),mt(p,L.w.INIT_SEGMENT_TYPE,b.DOWNLOAD_ERROR_ID_INITIALIZATION_CODE),mt(p,L.w.MEDIA_SEGMENT_TYPE,b.DOWNLOAD_ERROR_ID_CONTENT_CODE),mt(p,L.w.INDEX_SEGMENT_TYPE,b.DOWNLOAD_ERROR_ID_CONTENT_CODE),mt(p,L.w.BITSTREAM_SWITCHING_SEGMENT_TYPE,b.DOWNLOAD_ERROR_ID_CONTENT_CODE),mt(p,L.w.OTHER_TYPE,b.DOWNLOAD_ERROR_ID_CONTENT_CODE),s=p,t}vt.__dashjs_factory_name="HTTPLoader";var yt=c.Z.getClassFactory(vt);function Et(){var e;function t(){e={}}function r(){t()}return r(),{getLoader:function(t){for(var r in e)if(e.hasOwnProperty(r)&&t.startsWith(r))return e[r];return yt},registerLoader:function(t,r){e[t]=r},unregisterLoader:function(t){e[t]&&delete e[t]},unregisterAllLoader:t,reset:r}}Et.__dashjs_factory_name="SchemeLoaderFactory";var Tt=c.Z.getSingletonFactory(Et);function _t(e){e=e||{};var t,r,n=this.context;return t=Tt(n).getInstance(),{load:function(i){if(!r){var a=t.getLoader(i&&i.request?i.request.url:null);r=a(n).create({errHandler:e.errHandler,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,dashMetrics:e.dashMetrics,boxParser:e.boxParser?e.boxParser:null,constants:e.constants?e.constants:null,dashConstants:e.dashConstants?e.dashConstants:null,urlUtils:e.urlUtils?e.urlUtils:null,requestTimeout:isNaN(e.requestTimeout)?0:e.requestTimeout,errors:e.errors})}r.load(i)},abort:function(){r&&r.abort()}}}_t.__dashjs_factory_name="URLLoader";var St=c.Z.getClassFactory(_t);function bt(e){return bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bt(e)}function At(e,t){return At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},At(e,t)}function It(e,t){return!t||"object"!==bt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Rt(e){return Rt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Rt(e)}var wt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=Rt(t);if(r){var i=Rt(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return It(this,e)});function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=n.call(this,e)).checkForExistenceOnly=!0,t}return i}(p.Z);function Dt(e){e=e||{};var t,r,n=this.context,i=e.eventBus,s=e.events,o=e.urlUtils,l=e.errors,u=e.streamId;return t={checkForExistence:function(e){var t=function(t){i.trigger(s.CHECK_FOR_EXISTENCE_COMPLETED,{request:e,exists:t})};if(e){var n=new wt(e.url);r.load({request:n,success:function(){t(!0)},error:function(){t(!1)}})}else t(!1)},load:function(e){var n=function(r,n){i.trigger(s.LOADING_COMPLETED,{request:e,response:r||null,error:n||null,sender:t})};e?r.load({request:e,progress:function(r){i.trigger(s.LOADING_PROGRESS,{request:e,stream:r.stream,streamId:u}),r.data&&i.trigger(s.LOADING_DATA_PROGRESS,{request:e,response:r.data||null,error:null,sender:t})},success:function(e){n(e)},error:function(e,t,r){n(void 0,new S.Z(l.FRAGMENT_LOADER_LOADING_FAILURE_ERROR_CODE,r,t))},abort:function(e){e&&i.trigger(s.LOADING_ABANDONED,{mediaType:e.mediaType,request:e,sender:t})}}):n(void 0,new S.Z(l.FRAGMENT_LOADER_NULL_REQUEST_ERROR_CODE,l.FRAGMENT_LOADER_NULL_REQUEST_ERROR_MESSAGE))},abort:function(){r&&r.abort()},reset:function(){r&&(r.abort(),r=null)}},r=St(n).create({errHandler:e.errHandler,errors:l,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,urlUtils:o,constants:a.Z,boxParser:e.boxParser,dashConstants:e.dashConstants,requestTimeout:e.settings.get().streaming.fragmentRequestTimeout}),t}Dt.__dashjs_factory_name="FragmentLoader";var Lt=c.Z.getClassFactory(Dt);function Ct(){return{modifyResponseAsync:function(e){return Promise.resolve(e)}}}Ct.__dashjs_factory_name="SegmentResponseModifier";var Nt=c.Z.getSingletonFactory(Ct);function Pt(e){e=e||{};var t,r,n,i=this.context,s=(0,l.Z)(i).getInstance(),o=e.errHandler,c=e.mediaPlayerModel,h=e.dashMetrics,g=(0,d.Z)(i).getInstance(),p=Nt(i).getInstance(),m=e.streamInfo;function v(){return m.id}function y(){for(var e in n)n[e].reset();n={}}function E(e){if(e.sender){var t=e.request,n=e.response,i=t.isInitializationRequest(),o=t.mediaInfo.streamInfo;if(e.error&&(t.mediaType===a.Z.AUDIO||t.mediaType===a.Z.VIDEO||t.mediaType===a.Z.TEXT&&t.mediaInfo.isFragmented)&&s.trigger(u.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD,{entry:e.request.serviceLocation}),n&&o){var l=function(e,t,r,n){var i=new se;return i.streamId=r,i.mediaInfo=t.mediaInfo,i.segmentType=t.type,i.start=t.startTime,i.duration=t.duration,i.end=i.start+i.duration,i.bytes=e,i.index=t.index,i.quality=t.quality,i.representationId=t.representationId,i.endFragment=n,i}(n,t,m.id,e.type!==u.Z.FRAGMENT_LOADING_PROGRESS);p.modifyResponseAsync(l).then(function(e){s.trigger(i?u.Z.INIT_FRAGMENT_LOADED:u.Z.MEDIA_FRAGMENT_LOADED,{chunk:e,request:t},{streamId:o.id,mediaType:t.mediaType})}).catch(function(e){r.error(e),s.trigger(i?u.Z.INIT_FRAGMENT_LOADED:u.Z.MEDIA_FRAGMENT_LOADED,{chunk:l,request:t},{streamId:o.id,mediaType:t.mediaType})})}else r.warn("No "+t.mediaType+" bytes to push or stream is inactive.")}}return t={getStreamId:v,getModel:function(t){var r=n[t];return r||(r=_(i).create({streamInfo:m,type:t,dashMetrics:h,fragmentLoader:Lt(i).create({dashMetrics:h,mediaPlayerModel:c,errHandler:o,requestModifier:(0,W.Z)(i).getInstance(),settings:e.settings,boxParser:e.boxParser,eventBus:s,events:u.Z,errors:w,dashConstants:e.dashConstants,urlUtils:e.urlUtils,streamId:v()}),debug:g,eventBus:s,events:u.Z}),n[t]=r),r},reset:function(){s.off(f.Z.FRAGMENT_LOADING_COMPLETED,E,this),s.off(f.Z.FRAGMENT_LOADING_PROGRESS,E,this),y()}},r=g.getLogger(t),y(),s.on(f.Z.FRAGMENT_LOADING_COMPLETED,E,t),s.on(f.Z.FRAGMENT_LOADING_PROGRESS,E,t),t}Pt.__dashjs_factory_name="FragmentController";var Ot=c.Z.getClassFactory(Pt),Mt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=null,this.width=null,this.height=null,this.x=null,this.y=null},kt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.bitrate=null,this.width=null,this.height=null,this.scanType=null,this.qualityIndex=NaN};function xt(e){var t,r,n=this.context,i=e.streamInfo;function s(e){r.setTrackByIndex(e)}function o(){r&&r.reset()}return t={getStreamId:function(){return i.id},initialize:function(){r.addTracks();var e=r.getTracks();e&&e.length>0&&s(0)},provide:function(e,t){if("function"==typeof t){var n,i,a=r.getCurrentTrack();if(!a||a.segmentDuration<=0||null==e)t(null);else{(i=r.getThumbnailRequestForTime(e))&&(a.segmentDuration=i.duration),n=e%a.segmentDuration;var s=Math.floor(n*a.tilesHor*a.tilesVert/a.segmentDuration),o=new Mt;if(o.width=Math.floor(a.widthPerTile),o.height=Math.floor(a.heightPerTile),o.x=Math.floor(s%a.tilesHor)*a.widthPerTile,o.y=Math.floor(s/a.tilesHor)*a.heightPerTile,"readThumbnail"in a)return a.readThumbnail(e,function(e){o.url=e,t(o)});if(i)o.url=i.url,a.segmentDuration=NaN;else{var l=Math.floor(e/a.segmentDuration);o.url=function(e,t){var r=t+e.startNumber,n=(0,K.vi)(e.templateUrl,"Number",r);return n=(0,K.vi)(n,"Time",(r-1)*e.segmentDuration*e.timescale),n=(0,K.vi)(n,"Bandwidth",e.bandwidth),(0,K.eR)(n)}(a,l)}t(o)}}},setTrackByIndex:s,getCurrentTrackIndex:function(){return r.getCurrentTrackIndex()},getBitrateList:function(){var e=r.getTracks(),t=0;return e.map(function(e){var r=new kt;return r.mediaType=a.Z.IMAGE,r.qualityIndex=t++,r.bitrate=e.bitrate,r.width=e.width,r.height=e.height,r})},reset:o},o(),r=(0,Pe.Z)(n).create({streamInfo:i,adapter:e.adapter,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:e.debug,eventBus:e.eventBus,events:e.events,dashConstants:e.dashConstants,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController}),t}xt.__dashjs_factory_name="ThumbnailController";var Ft=c.Z.getClassFactory(xt),Bt=r(7417);function Ut(e){var t;e=e||{};var r=[],n=(0,l.Z)(this.context).getInstance(),i=e.updateEventName,a=e.addBlacklistEventName;function s(e){-1===r.indexOf(e)&&(r.push(e),n.trigger(i,{entry:e}))}return t={add:s,contains:function(e){return!!(r.length&&e&&e.length)&&-1!==r.indexOf(e)},reset:function(){r=[]}},a&&n.on(a,function(e){s(e.entry)},t),t}Ut.__dashjs_factory_name="BlackListController";var Zt=c.Z.getClassFactory(Ut),Gt=[a.Z.VIDEO,a.Z.AUDIO,a.Z.TEXT,a.Z.MUXED,a.Z.IMAGE];function Ht(e){e=e||{};var t,r,n,i,o,c,f,h,g,p,m,v,y,E,T,_,b,A,I=this.context,R=(0,l.Z)(I).getInstance(),D=(0,X.Z)(I).getInstance(),L=e.manifestModel,C=e.mediaPlayerModel,N=e.dashMetrics,P=e.manifestUpdater,O=e.adapter,M=e.timelineConverter,k=e.capabilities,x=e.errHandler,F=e.abrController,B=e.playbackController,U=e.eventController,Z=e.mediaController,G=e.protectionController,H=e.textController,$=e.videoModel,V=e.streamInfo,K=e.settings;function q(e,t){return new Promise(function(i,s){re(),p=!0,ie();var o=$.getElement(),l=[];Gt.forEach(function(t){(t!==a.Z.TEXT||e)&&(t!==a.Z.VIDEO||!o||o&&/^VIDEO$/i.test(o.nodeName))&&l.push(Y(t,e))}),Promise.all(l).then(function(){return e=t,new Promise(function(t){var r={},i=n.map(function(t){return t.createBufferSinks(e)});Promise.all(i).then(function(e){e.forEach(function(e){e&&(r[e.getType()]=e)}),t(r)}).catch(function(){t(r)})});var e}).then(function(t){if(p=!1,0===n.length){var a="No streams to play.";x.error(new S.Z(w.MANIFEST_ERROR_ID_NOSTREAMS_CODE,a,L.getValue())),r.fatal(a)}else se();e&&H.createTracks(V),i(t)}).catch(function(e){s(e)})})}function Y(t,i){var o,l=O.getAllMediaInfoForType(V,t),c=[],d=null;if(!l||0===l.length)return r.info("No "+t+" data."),Promise.resolve();t===a.Z.VIDEO&&(f=!0),t===a.Z.AUDIO&&(h=!0);for(var g=0,p=l.length;g<p;g++)d=l[g],t===a.Z.TEXT&&d.isEmbedded&&(H.addEmbeddedTrack(V,d),c.push(d)),j(d)&&Z.addTrack(d);if(c.length>0&&(Z.setInitialMediaSettingsForType(t,V),H.addMediaInfosToBuffer(V,t,c)),l=l.filter(function(e){return!e.isEmbedded}),0===l.length)return Promise.resolve();if(t===a.Z.IMAGE)return(v=Ft(I).create({streamInfo:V,adapter:O,baseURLController:e.baseURLController,timelineConverter:e.timelineConverter,debug:_,eventBus:R,events:u.Z,dashConstants:s.Z,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController})).initialize(),Promise.resolve();R.trigger(u.Z.STREAM_INITIALIZING,{streamInfo:V,mediaInfo:d}),Z.setInitialMediaSettingsForType(t,V);var E=function(t,r){var i=t&&t.length>0?t[0]:null,s=m.getModel(i?i.type:null),o=i?i.type:null,l=i?i.mimeType:null,u=i?i.isFragmented:null,c=ae(I).create({streamInfo:V,type:o,mimeType:l,timelineConverter:M,adapter:O,manifestModel:L,mediaPlayerModel:C,fragmentModel:s,dashMetrics:e.dashMetrics,baseURLController:e.baseURLController,segmentBaseController:e.segmentBaseController,abrController:F,playbackController:B,mediaController:Z,textController:H,errHandler:x,settings:K,boxParser:T,segmentBlacklistController:y});c.initialize(r,f,u),n.push(c);for(var d=0;d<t.length;d++)c.addMediaInfo(t[d]);return o===a.Z.TEXT&&H.addMediaInfosToBuffer(V,o,t,s),c}(l,i);return(o=Z.getCurrentTrackFor(t,V.id))?(F.updateTopQualityIndex(o),E.selectMediaInfo(t===a.Z.TEXT&&o.isEmbedded?l[0]:o)):Promise.resolve()}function j(e){var t,n=e?e.type:null;return n===a.Z.MUXED?(t="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",r.fatal(t),x.error(new S.Z(w.MANIFEST_ERROR_ID_MULTIPLEXED_CODE,t,L.getValue())),!1):!(n!==a.Z.TEXT&&n!==a.Z.IMAGE&&e.contentProtection&&!k.supportsEncryptedMedia()&&(x.error(new S.Z(w.CAPABILITY_MEDIAKEYS_ERROR_CODE,w.CAPABILITY_MEDIAKEYS_ERROR_MESSAGE)),1))}function z(e){for(var t=n?n.length:0,r=0;r<t;r++){var i=n[r].getFragmentModel();i.abortRequests(),i.resetInitialSettings(),n[r].reset(!1,e)}H&&H.deactivateStream(V),n=[],o=!1,c=!1,me(!1),Q(!1),R.trigger(u.Z.STREAM_DEACTIVATED,{streamInfo:V})}function W(e){z(e),i=!1,f=!1,h=!1,g={},p=!1,b=!1,A=[]}function Q(e){b=e}function J(){return V?V.start:NaN}function ee(){return V?V.id:null}function te(){return V}function re(){if(!$||!F)throw new Error(a.Z.MISSING_CONFIG_ERROR)}function ne(e){e.error&&(x.error(e.error),r.fatal(e.error.message))}function ie(){if(U){var e=O.getEventsFor(V);e&&e.length>0&&U.addInlineEvents(e,V.id)}}function se(){for(var e=n.length,t=g.audio||g.video?new S.Z(w.DATA_UPDATE_FAILED_ERROR_CODE,w.DATA_UPDATE_FAILED_ERROR_MESSAGE):null,r=0;r<e;r++)if(n[r].isUpdating()||p)return;if(G){G.clearMediaInfoArray();for(var s=0;s<e&&n[s];s++){var o=n[s].getType(),l=n[s].getMediaInfo();if(o===a.Z.AUDIO||o===a.Z.VIDEO||o===a.Z.TEXT&&l.isFragmented){var c=n[s].getMediaInfo();c&&G.initializeForMedia(c)}}G.handleKeySystemFromManifest()}t?x.error(t):i||(i=!0,$.waitForReadyState(a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,function(){R.trigger(u.Z.STREAM_INITIALIZED,{streamInfo:V})}))}function oe(){var e=fe(),t=e.length;if(0!==t){for(var n=0;n<t;n++)if(!e[n].isBufferingCompleted()&&(e[n].getType()===a.Z.AUDIO||e[n].getType()===a.Z.VIDEO))return void r.debug("onBufferingCompleted - One streamProcessor has finished but",e[n].getType(),"one is not buffering completed");r.debug("onBufferingCompleted - trigger STREAM_BUFFERING_COMPLETED"),c=!0,R.trigger(u.Z.STREAM_BUFFERING_COMPLETED,{streamInfo:V},{streamInfo:V})}else r.warn("onBufferingCompleted - can't trigger STREAM_BUFFERING_COMPLETED because no streamProcessor is defined")}function le(e){g[e.mediaType]=e.error,se()}function ue(e){U&&U.addInbandEvents(e.events,V.id)}function ce(e){return e&&e.type?de(e.type):null}function de(e){return e?fe().filter(function(t){return t.getType()===e})[0]:null}function fe(){for(var e,t,r=[],i=0;i<n.length;i++)(e=(t=n[i]).getType())!==a.Z.AUDIO&&e!==a.Z.VIDEO&&e!==a.Z.TEXT||r.push(t);return r}function he(e,t){var r=te(),n=t.getStreamInfo();if(!n||!r)return!0;var i=O.getAdaptationForType(n.index,e,n),a=O.getAdaptationForType(r.index,e,r);return i&&a?!(!ge(a)&&ge(i)):!i&&!a}function ge(e){return!!e&&!!(e.ContentProtection||e.Representation_asArray&&e.Representation_asArray.length>0&&e.Representation_asArray[0].ContentProtection)}function pe(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e||!e.hasOwnProperty("getStreamInfo"))return!1;var n=e.getStreamInfo(),i=r?r.getStreamInfo():te();if(!n||!i)return!1;var a=O.getAdaptationForType(n.index,t,n),s=O.getAdaptationForType(i.index,t,i);if(!a||!s)return!a&&!s;var o=a&&s&&a.mimeType===s.mimeType,l=s.Representation_asArray.map(function(e){return e.codecs}),u=a.Representation_asArray.map(function(e){return e.codecs}),c=u.some(function(e){return l.indexOf(e)>-1}),d=u.some(function(e){return l.some(function(t){return k.codecRootCompatibleWithCodec(t,e)})});return c||d&&o}function me(e){E=e}function ve(){return E}return t={initialize:function(){R.on(u.Z.BUFFERING_COMPLETED,oe,t),R.on(u.Z.DATA_UPDATE_COMPLETED,le,t),R.on(u.Z.INBAND_EVENTS,ue,t),G&&(R.on(u.Z.KEY_ERROR,ne,t),R.on(u.Z.SERVER_CERTIFICATE_UPDATED,ne,t),R.on(u.Z.LICENSE_REQUEST_COMPLETE,ne,t),R.on(u.Z.KEY_SYSTEM_SELECTED,ne,t),R.on(u.Z.KEY_SESSION_CREATED,ne,t),R.on(u.Z.KEY_STATUSES_CHANGED,ne,t)),H.initializeForStream(V),R.trigger(u.Z.STREAM_UPDATED,{streamInfo:V})},getStreamId:function(){return V?V.id:null},activate:function(e,t){return new Promise(function(r,n){if(!o)return ve()?(o=!0,R.trigger(u.Z.STREAM_ACTIVATED,{streamInfo:V}),void r(t)):void function(e,t){return q(e,t)}(e,t).then(function(e){o=!0,R.trigger(u.Z.STREAM_ACTIVATED,{streamInfo:V}),r(e)}).catch(function(e){n(e)});r(t)})},deactivate:z,getIsActive:function(){return o},getDuration:function(){return V?V.duration:NaN},getStartTime:J,getId:ee,getStreamInfo:te,getHasAudioTrack:function(){return h},getHasVideoTrack:function(){return f},startPreloading:function(e,t){return new Promise(function(i,a){ve()?a():(r.info("[startPreloading] Preloading next stream with id ".concat(ee())),me(!0),q(e,t).then(function(){for(var e=0;e<n.length&&n[e];e++)n[e].setExplicitBufferingTime(J()),n[e].getScheduleController().startScheduleTimer();i()}).catch(function(){me(!1),a()}))})},initializeForTextWithMediaSource:function(e){return new Promise(function(t,r){Y(a.Z.TEXT,e).then(function(){return(e=de(a.Z.TEXT))?e.createBufferSinks():Promise.resolve();var e}).then(function(){H.createTracks(V),t()}).catch(function(e){r(e)})})},getThumbnailController:function(){return v},getBitrateListFor:function(e){if(re(),e===a.Z.IMAGE)return v?v.getBitrateList():[];var t=function(e){for(var t=null,r=0;r<n.length;r++)if((t=n[r]).getType()===e)return t.getMediaInfo();return null}(e);return F.getBitrateList(t)},updateData:function(e){return new Promise(function(t){p=!0,V=e,U&&ie();for(var r=[],i=0,a=n.length;i<a;i++){var s=n[i],o=s.getMediaInfo();r.push(s.updateStreamInfo(V));var l=O.getAllMediaInfoForType(V,s.getType());if(l=l.filter(function(e){return!e.isEmbedded})){s.clearMediaInfoArray();for(var c=0;c<l.length;c++){var d=l[c];s.addMediaInfo(l[c]),O.areMediaInfosEqual(o,d)&&(F.updateTopQualityIndex(d),r.push(s.selectMediaInfo(d)))}}}Promise.all(r).then(function(){for(r=[];A.length>0;){var e=A.pop(),t=e.newMediaInfo,n=ce(e.oldMediaInfo);if(!n)return;r.push(n.prepareTrackSwitch()),r.push(n.selectMediaInfo(t))}return Promise.all(r)}).then(function(){p=!1,se(),R.trigger(u.Z.STREAM_UPDATED,{streamInfo:V}),t()})})},reset:function(e){m&&(m.reset(),m=null),F&&V&&F.clearDataForStream(V.id),y&&(y.reset(),y=null),W(e),V=null,R.off(u.Z.DATA_UPDATE_COMPLETED,le,t),R.off(u.Z.BUFFERING_COMPLETED,oe,t),R.off(u.Z.INBAND_EVENTS,ue,t),G&&(R.off(u.Z.KEY_ERROR,ne,t),R.off(u.Z.SERVER_CERTIFICATE_UPDATED,ne,t),R.off(u.Z.LICENSE_REQUEST_COMPLETE,ne,t),R.off(u.Z.KEY_SYSTEM_SELECTED,ne,t),R.off(u.Z.KEY_SESSION_CREATED,ne,t),R.off(u.Z.KEY_STATUSES_CHANGED,ne,t))},getProcessors:fe,setMediaSource:function(e){return new Promise(function(t,i){for(var a=[],s=0;s<n.length;)j(n[s].getMediaInfo())?(a.push(n[s].setMediaSource(e)),s++):(n[s].reset(),n.splice(s,1));Promise.all(a).then(function(){for(var e=0;e<n.length;e++)n[e].dischargePreBuffer();if(0===n.length){var i="No streams to play.";x.error(new S.Z(w.MANIFEST_ERROR_ID_NOSTREAMS_CODE,i+"nostreams",L.getValue())),r.fatal(i)}t()}).catch(function(e){r.error(e),i(e)})})},isMediaCodecCompatible:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return pe(e,a.Z.VIDEO,t)&&pe(e,a.Z.AUDIO,t)},isProtectionCompatible:function(e){return!e||he(a.Z.VIDEO,e)&&he(a.Z.AUDIO,e)},getPreloaded:ve,getIsEndedEventSignaled:function(){return b},setIsEndedEventSignaled:Q,getAdapter:function(){return O},getHasFinishedBuffering:function(){return c},setPreloaded:me,startScheduleControllers:function(){for(var e=n.length,t=0;t<e&&n[t];t++)n[t].getScheduleController().startScheduleTimer()},prepareTrackChange:function(e){if(o&&V){c=!1;var t=e.newMediaInfo,n=L.getValue();O.setCurrentMediaInfo(V.id,t.type,t);var i=ce(t);if(i){var s=B.getTime();r.info("Stream -  Process track changed at current time "+s),n.refreshManifestOnSwitchTrack?(A.push(e),P.getIsUpdating()||(r.debug("Stream -  Refreshing manifest for switch track"),P.refreshManifest())):i.selectMediaInfo(t).then(function(){t.type!==a.Z.VIDEO&&t.type!==a.Z.AUDIO||F.updateTopQualityIndex(t),i.prepareTrackSwitch()})}}},prepareQualityChange:function(e){var t=de(e.mediaType);t&&t.prepareQualityChange(e)}},function(){try{_=(0,d.Z)(I).getInstance(),r=_.getLogger(t),W(),T=(0,Bt.Z)(I).getInstance(),y=Zt(I).create({updateEventName:u.Z.SEGMENT_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:u.Z.SEGMENT_LOCATION_BLACKLIST_ADD}),m=Ot(I).create({streamInfo:V,mediaPlayerModel:C,dashMetrics:N,errHandler:x,settings:K,boxParser:T,dashConstants:s.Z,urlUtils:D})}catch(e){throw e}}(),t}Ht.__dashjs_factory_name="Stream";var $t=c.Z.getClassFactory(Ht),Vt=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t||null,this.type=L.w.CONTENT_STEERING_TYPE,this.responseType="json"},Kt=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.version=null,this.ttl=300,this.reloadUri=null,this.pathwayPriority=[],this.pathwayClones=[]};function qt(){var e,t,r,n,i,a,o,l,u,c,h,g,p,m,v,y=this.context,E=(0,X.Z)(y).getInstance();function T(e){I(e,"baseUrl")}function _(e){I(e,"location")}function S(e){if(e&&e.request&&e.request.serviceLocation&&e.request.requestStartDate&&e.request.requestEndDate&&!isNaN(e.request.bytesTotal)){var t=e.request.serviceLocation,r=e.request.requestEndDate.getTime()-e.request.requestStartDate.getTime();A(t,parseInt(8*e.request.bytesTotal/r*1e3))}}function b(e){e&&e.httpRequest&&e.httpRequest._serviceLocation&&!isNaN(e.throughput)&&A(e.httpRequest._serviceLocation,1e3*e.throughput)}function A(e,t){i[e]||(i[e]=[]),i[e].push(t),i[e].length>4&&i[e].shift()}function I(e,t){if(e&&e.request&&e.request.serviceLocation){var r=e.request.serviceLocation;-1===n[t].all.indexOf(r)&&n[t].all.push(r),n[t].current=r}}function R(){var e=h.getValue(),t=v.getContentSteering(e);return t||(t=p.getServiceDescriptionSettings().contentSteering),t}function D(){return new Promise(function(e){try{var a=R();if(!a||!a.serverUrl)return void e();var l=function(e){var t=e.serverUrl;r&&r.reloadUri&&(t=E.isRelative(r.reloadUri)?E.resolve(r.reloadUri,e.serverUrl):r.reloadUri);var a=[],s=n.baseUrl.all.concat(n.location.all);if(s.length>0){var o=s.map(function(e){var t=function(e){if(!e||!i[e]||0===i[e].length)return-1;var t=i[e].reduce(function(e,t){return e+t})/i[e].length;return parseInt(t)}(e);return{serviceLocation:e,throughput:t}});o.sort(function(e,t){return t.throughput-e.throughput});var l="",u="";o.forEach(function(e,t){0!==t&&(l="".concat(l,","),e.throughput>-1&&(u="".concat(u,","))),l="".concat(l).concat(e.serviceLocation),e.throughput>-1&&(u="".concat(u).concat(e.throughput))}),a.push({key:"_DASH_pathway",value:'"'.concat(l,'"')}),a.push({key:"_DASH_throughput",value:u})}return $e.Z.addAditionalQueryParameterToUrl(t,a)}(a),u=new Vt(l);o.load({request:u,success:function(t){!function(e){e&&e[s.Z.CONTENT_STEERING_RESPONSE.VERSION]&&1===parseInt(e[s.Z.CONTENT_STEERING_RESPONSE.VERSION])&&((r=new Kt).version=e[s.Z.CONTENT_STEERING_RESPONSE.VERSION],e[s.Z.CONTENT_STEERING_RESPONSE.TTL]&&!isNaN(e[s.Z.CONTENT_STEERING_RESPONSE.TTL])&&(r.ttl=e[s.Z.CONTENT_STEERING_RESPONSE.TTL]),e[s.Z.CONTENT_STEERING_RESPONSE.RELOAD_URI]&&(r.reloadUri=e[s.Z.CONTENT_STEERING_RESPONSE.RELOAD_URI]),e[s.Z.CONTENT_STEERING_RESPONSE.PATHWAY_PRIORITY]&&(r.pathwayPriority=e[s.Z.CONTENT_STEERING_RESPONSE.PATHWAY_PRIORITY]),e[s.Z.CONTENT_STEERING_RESPONSE.PATHWAY_CLONES]&&(r.pathwayClones=e[s.Z.CONTENT_STEERING_RESPONSE.PATHWAY_CLONES],r.pathwayClones=r.pathwayClones.filter(function(e){return function(e){return e[s.Z.CONTENT_STEERING_RESPONSE.BASE_ID]&&e[s.Z.CONTENT_STEERING_RESPONSE.ID]&&e[s.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT]&&e[s.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][s.Z.CONTENT_STEERING_RESPONSE.HOST]}(e)})),N())}(t),m.trigger(f.Z.CONTENT_STEERING_REQUEST_COMPLETED,{currentSteeringResponseData:r,url:l}),e()},error:function(n,i,a,s){!function(e,n){try{switch(t.warn("Error fetching data from content steering server",e),n.status){case 410:break;case 429:var i=n&&n.getResponseHeader?n.getResponseHeader("retry-after"):null;null!==i&&(r||(r={}),r.ttl=parseInt(i)),N();break;default:N()}}catch(e){t.error(e)}}(n,s),e(n)},complete:function(){n.baseUrl.all=L(n.baseUrl),n.location.all=L(n.location)}})}catch(t){e(t)}})}function L(e){return e.all&&0!==e.all.length&&e.current?e.all.filter(function(t){return t===e.current}):[]}function C(e){try{var n=[];return e&&0!==e.length&&r&&r.pathwayClones&&0!==r.pathwayClones.length?(r.pathwayClones.forEach(function(t){var r=e.filter(function(e){return t[s.Z.CONTENT_STEERING_RESPONSE.BASE_ID]===e.serviceLocation}),i=null;if(r&&r.length>0&&(i=r[0]),i){var a=new URL(i.url),o=t[s.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][s.Z.CONTENT_STEERING_RESPONSE.HOST];o=$e.Z.stringHasProtocol(o)?o:"".concat(a.protocol,"//").concat(o);var l={synthesizedUrl:"".concat(o).concat(a.pathname),serviceLocation:t[s.Z.CONTENT_STEERING_RESPONSE.ID],queryParams:t[s.Z.CONTENT_STEERING_RESPONSE.URI_REPLACEMENT][s.Z.CONTENT_STEERING_RESPONSE.PARAMS],reference:i};n.push(l)}}),n):n}catch(e){return t.error(e),[]}}function N(){r&&r.ttl&&!isNaN(r.ttl)&&(a&&clearTimeout(a),a=setTimeout(function(){D()},1e3*r.ttl))}function P(){a&&clearTimeout(a),a=null}function O(){r=null,i={},n={baseUrl:{current:null,all:[]},location:{current:null,all:[]}},P()}return e={reset:function(){O(),m.off(f.Z.FRAGMENT_LOADING_STARTED,T,e),m.off(f.Z.MANIFEST_LOADING_STARTED,_,e),m.off(f.Z.MANIFEST_LOADING_FINISHED,S,e),m.off(f.Z.THROUGHPUT_MEASUREMENT_STORED,b,e)},setConfig:function(e){e&&(e.adapter&&(v=e.adapter),e.errHandler&&(l=e.errHandler),e.dashMetrics&&(u=e.dashMetrics),e.mediaPlayerModel&&(c=e.mediaPlayerModel),e.requestModifier&&(g=e.requestModifier),e.manifestModel&&(h=e.manifestModel),e.serviceDescriptionController&&(p=e.serviceDescriptionController),e.eventBus&&(m=e.eventBus))},loadSteeringData:D,getCurrentSteeringResponseData:function(){return r},shouldQueryBeforeStart:function(){var e=R();return!!e&&e.queryBeforeStart},getSteeringDataFromManifest:R,stopSteeringRequestTimer:P,getSynthesizedBaseUrlElements:function(e){try{return C(e).map(function(e){var t=new Se(e.synthesizedUrl,e.serviceLocation);return t.queryParams=e.queryParams,t.dvbPriority=e.reference.dvbPriority,t.dvbWeight=e.reference.dvbWeight,t.availabilityTimeOffset=e.reference.availabilityTimeOffset,t.availabilityTimeComplete=e.reference.availabilityTimeComplete,t})}catch(e){return t.error(e),[]}},getSynthesizedLocationElements:function(e){try{return C(e).map(function(e){var t=new Oe(e.synthesizedUrl,e.serviceLocation);return t.queryParams=e.queryParams,t})}catch(e){return t.error(e),[]}},initialize:function(){o=St(y).create({errHandler:l,dashMetrics:u,mediaPlayerModel:c,requestModifier:g,errors:w}),m.on(f.Z.FRAGMENT_LOADING_STARTED,T,e),m.on(f.Z.MANIFEST_LOADING_STARTED,_,e),m.on(f.Z.MANIFEST_LOADING_FINISHED,S,e),m.on(f.Z.THROUGHPUT_MEASUREMENT_STORED,b,e)}},t=(0,d.Z)(y).getInstance().getLogger(e),O(),e}qt.__dashjs_factory_name="ContentSteeringController";var Yt=c.Z.getSingletonFactory(qt);function jt(){var e,t,r,n=this.context,i=(0,D.Z)(n).getInstance();return e={select:function(e){if(!e||0===e.length)return null;var n=null;return i.get().streaming.applyContentSteering&&(n=function(e){var n=r.getCurrentSteeringResponseData();return n&&n.pathwayPriority&&n.pathwayPriority.length>0?function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=0,i=null,a=function(){var a=e[n],s=r.findIndex(function(e){return e.serviceLocation&&e.serviceLocation===a});if(-1!==s&&!t.contains(r[s].serviceLocation))return i=r[s],"break";n+=1};n<e.length&&"break"!==a(););return i}(n.pathwayPriority,e):null}(e)),n||(n=function(e){return e[0]}(e)),n},setConfig:function(e){e.blacklistController&&(t=e.blacklistController),e.contentSteeringController&&(r=e.contentSteeringController)},reset:function(){t.reset()}},t=Zt(n).create({updateEventName:u.Z.SERVICE_LOCATION_LOCATION_BLACKLIST_CHANGED,addBlacklistEventName:u.Z.SERVICE_LOCATION_LOCATION_BLACKLIST_ADD}),r=Yt(n).getInstance(),e}jt.__dashjs_factory_name="LocationSelector";var zt=c.Z.getClassFactory(jt);function Wt(){var e,t,r,n,i,a,o,c,h,g,p,m,v,y,E=this.context,T=(0,l.Z)(E).getInstance(),_=(0,X.Z)(E).getInstance();function S(){r=NaN,o=!1,i=!0,a=!1,b()}function b(){null!==n&&(clearTimeout(n),n=null)}function A(e){b(),a||(isNaN(e)&&!isNaN(r)&&(e=1e3*r),isNaN(e)||(t.debug("Refresh manifest in "+e+" milliseconds."),n=setTimeout(L,e)))}function I(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];o=!0;var t=h.getValue(),r=t.url,n=null,i=p.getPatchLocation(t),a=g.select(i),s=null;if(a&&!e)r=a.url,n=a.serviceLocation,s=a.queryParams;else{var l=R(t),u=g.select(l);u&&(r=u.url,n=u.serviceLocation,s=u.queryParams)}_.isRelative(r)&&(r=_.resolve(r,t.url)),c.load(r,n,s)}function R(e){var t=p.getLocation(e),r=v.getSynthesizedLocationElements(t);return t.concat(r)}function D(e){if(e){if(p.getIsPatch(e)){var n=e;e=h.getValue();var l=p.isPatchValid(e,n),c=l;if(l){var d=p.getPublishTime(e);c=p.applyPatchToManifest(e,n);var f=p.getPublishTime(e);c=d.getTime()!=f.getTime()}if(!c)return t.debug("Patch provided is invalid, performing full manifest refresh"),void I(!0);e.loadedTime=new Date}}else(e=h.getValue()).loadedTime=new Date;if(h.getValue()&&h.getValue().type===s.Z.DYNAMIC&&e.type===s.Z.STATIC)return T.trigger(u.Z.DYNAMIC_TO_STATIC),o=!1,void(a=!0);h.setValue(e);var g=new Date,m=(g.getTime()-e.loadedTime.getTime())/1e3;1e3*(r=p.getManifestUpdatePeriod(e,m))>2147483647&&(r=2147483.647),T.trigger(u.Z.MANIFEST_UPDATED,{manifest:e}),t.info("Manifest has been refreshed at "+g+"["+g.getTime()/1e3+"] "),i||A()}function L(){i||(o?A(y.get().streaming.manifestUpdateRetryInterval):I())}function C(e){e.error?e.error.code===w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE&&m.error(e.error):D(e.manifest)}function N(){i=!1,A()}function P(){(i=!y.get().streaming.scheduling.scheduleWhilePaused)&&b()}function O(){o=!1}return e={initialize:function(){S(),T.on(u.Z.STREAMS_COMPOSED,O,this),T.on(f.Z.PLAYBACK_STARTED,N,this),T.on(f.Z.PLAYBACK_PAUSED,P,this),T.on(u.Z.INTERNAL_MANIFEST_LOADED,C,this)},setManifest:function(e){D(e)},refreshManifest:I,getIsUpdating:function(){return o},setConfig:function(e){e&&(e.manifestModel&&(h=e.manifestModel),e.adapter&&(p=e.adapter),e.manifestLoader&&(c=e.manifestLoader),e.errHandler&&(m=e.errHandler),e.locationSelector&&(g=e.locationSelector),e.settings&&(y=e.settings),e.contentSteeringController&&(v=e.contentSteeringController))},reset:function(){T.off(f.Z.PLAYBACK_STARTED,N,this),T.off(f.Z.PLAYBACK_PAUSED,P,this),T.off(u.Z.STREAMS_COMPOSED,O,this),T.off(u.Z.INTERNAL_MANIFEST_LOADED,C,this),S()}},t=(0,d.Z)(E).getInstance().getLogger(e),g=zt(E).create(),e}Wt.__dashjs_factory_name="ManifestUpdater";var Xt=c.Z.getClassFactory(Wt);function Qt(){var e,t,r,n,i,a,s,o,c,f,h,g,p,m,v,y,E=this.context,T=(0,l.Z)(E).getInstance(),_=(0,X.Z)(E).getInstance();function b(){o=[],c=[],f=null,h=null,p=null,g=NaN,r=!1,n=!1,m=i.get().streaming.utcSynchronization.timeBetweenSyncAttempts}function A(){i.get().streaming.utcSynchronization.enabled&&!r&&!n&&p&&p.value&&p.schemeIdUri&&!isNaN(g)&&!isNaN(i.get().streaming.utcSynchronization.backgroundAttempts)&&(h&&(Date.now()-h)/1e3<30||(o=[],n=!0,I(isNaN(i.get().streaming.utcSynchronization.backgroundAttempts)?2:i.get().streaming.utcSynchronization.backgroundAttempts)))}function I(e){try{if(e<=0)return void Z();var t=Date.now();a[p.schemeIdUri](p.value,function(r){var n=Date.now(),i=D(t,n,r);o.push(i),I(e-1)},function(){Z()})}catch(e){Z()}}function R(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||0;if(!c||0===c.length||e>=c.length)C();else{var t=c[e];if(t)if(a.hasOwnProperty(t.schemeIdUri)){var r=(new Date).getTime();a[t.schemeIdUri](t.value,function(e){var n=(new Date).getTime(),i=D(r,n,e);p=t,C(i)},function(){R(e+1)})}else R(e+1);else C()}}function D(e,t,r){return r-(t-(t-e)/2)}function C(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN,t=isNaN(e);t&&i.get().streaming.utcSynchronization.useManifestDateHeaderTimeSource?B():U(t,e)}function N(e){var t=Date.parse(e);return isNaN(t)&&(t=function(e){var t,r,n=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/.exec(e);return t=Date.UTC(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10),parseInt(n[4],10),parseInt(n[5],10),n[6]&&(parseInt(n[6],10)||0),n[7]&&1e3*parseFloat(n[7])||0),n[9]&&n[10]&&(r=60*parseInt(n[9],10)+parseInt(n[10],10),t+=("+"===n[8]?-1:1)*r*60*1e3),new Date(t).getTime()}(e)),t}function P(e){return Date.parse(e)}function O(e){return Date.parse(e)}function M(e,t,r){r()}function k(e,t,r){var n=N(e);isNaN(n)?r():t(n)}function x(e,t,r,n,i){var a,s,o=!1,l=new XMLHttpRequest,u=i?L.w.HEAD:L.w.GET,c=t.match(/\S+/g);if(t=c.shift(),a=function(){o||(o=!0,c.length?x(e,c.join(" "),r,n,i):n())},s=function(){var t,n;200===l.status&&(t=i?l.getResponseHeader("Date"):l.response,n=e(t),isNaN(n)||(r(n),o=!0))},_.isRelative(t)){var d=y.resolve();d&&(t=_.resolve(t,d.url))}l.open(u,t),l.timeout=5e3,l.onload=s,l.onloadend=a,l.send()}function F(e,t,r){x(O,e,t,r,!0)}function B(){var e=s.getLatestMPDRequestHeaderValueByID("Date"),t=null!==e?new Date(e).getTime():Number.NaN;isNaN(t)?U(!0):U(!1,t-Date.now())}function U(e,n){if(isNaN(g)||isNaN(n)||e||function(e){try{var r,n=G(e),a=isNaN(m)?30:m,s=isNaN(i.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor)?2:i.get().streaming.utcSynchronization.timeBetweenSyncAttemptsAdjustmentFactor,o=isNaN(i.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts)?600:i.get().streaming.utcSynchronization.maximumTimeBetweenSyncAttempts,l=isNaN(i.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts)?2:i.get().streaming.utcSynchronization.minimumTimeBetweenSyncAttempts;n?(r=Math.min(a*s,o),t.debug("Increasing timeBetweenSyncAttempts to ".concat(r))):(r=Math.max(a/s,l),t.debug("Decreasing timeBetweenSyncAttempts to ".concat(r))),m=r}catch(e){}}(n),!e&&!isNaN(n)){f=Date.now(),r=!1;var a=isNaN(g);g=n,a&&A(),t.debug("Completed UTC sync. Setting client - server offset to ".concat(n))}e&&(p=null,r=!1,v.error(new S.Z(w.TIME_SYNC_FAILED_ERROR_CODE,w.TIME_SYNC_FAILED_ERROR_MESSAGE))),T.trigger(u.Z.UPDATE_TIME_SYNC_OFFSET,{offset:n}),T.trigger(u.Z.TIME_SYNCHRONIZATION_COMPLETED)}function Z(){if(o&&0!==o.length){var e=o.reduce(function(e,t){return e+t},0)/o.length;G(e)?t.debug("Completed background UTC sync. Offset is within allowed threshold and is not adjusted."):(t.debug("Completed background UTC sync. Setting client - server offset to ".concat(e)),g=e,T.trigger(u.Z.UPDATE_TIME_SYNC_OFFSET,{offset:g})),n=!1,h=Date.now()}}function G(e){try{if(isNaN(g))return!0;var t=i.get().streaming.utcSynchronization.maximumAllowedDrift&&!isNaN(i.get().streaming.utcSynchronization.maximumAllowedDrift)?i.get().streaming.utcSynchronization.maximumAllowedDrift:100;return e>=g-t&&e<=g+t}catch(e){return!0}}return e={initialize:function(){b(),a={"urn:mpeg:dash:utc:http-head:2014":F,"urn:mpeg:dash:utc:http-xsdate:2014":x.bind(null,N),"urn:mpeg:dash:utc:http-iso:2014":x.bind(null,P),"urn:mpeg:dash:utc:direct:2014":k,"urn:mpeg:dash:utc:http-head:2012":F,"urn:mpeg:dash:utc:http-xsdate:2012":x.bind(null,N),"urn:mpeg:dash:utc:http-iso:2012":x.bind(null,P),"urn:mpeg:dash:utc:direct:2012":k,"urn:mpeg:dash:utc:http-ntp:2014":M,"urn:mpeg:dash:utc:ntp:2014":M,"urn:mpeg:dash:utc:sntp:2014":M}},attemptSync:function(e,t){c=e,r||(function(e){try{if(!e||!i.get().streaming.utcSynchronization.enabled)return!1;var t=isNaN(m)?30:m;return!(f&&t&&!isNaN(t))||(Date.now()-f)/1e3>=t}catch(e){return!0}}(t)?(r=!0,R()):T.trigger(u.Z.TIME_SYNCHRONIZATION_COMPLETED))},setConfig:function(e){e&&(e.dashMetrics&&(s=e.dashMetrics),e.baseURLController&&(y=e.baseURLController),e.errHandler&&(v=e.errHandler),e.settings&&(i=e.settings))},reset:function(){b(),T.off(u.Z.ATTEMPT_BACKGROUND_SYNC,A,e)}},t=(0,d.Z)(E).getInstance().getLogger(e),T.on(u.Z.ATTEMPT_BACKGROUND_SYNC,A,e),e}Qt.__dashjs_factory_name="TimeSyncController";var Jt=c.Z.getSingletonFactory(Qt);Jt.HTTP_TIMEOUT_MS=5e3,c.Z.updateSingletonFactory(Qt.__dashjs_factory_name,Jt);var er=Jt;function tr(){var e,t,r,n,i,a=this.context,s=(0,l.Z)(a).getInstance();return e={attachMediaSource:function(e){var r=window.URL.createObjectURL(t);return e.setSource(r),"managedMediaSource"===n&&(e.setDisableRemotePlayback(!0),t.addEventListener("startstreaming",function(){s.trigger(f.Z.MANAGED_MEDIA_SOURCE_START_STREAMING)}),t.addEventListener("endstreaming",function(){s.trigger(f.Z.MANAGED_MEDIA_SOURCE_END_STREAMING)})),r},createMediaSource:function(){var e="WebKitMediaSource"in window,r="MediaSource"in window;return"ManagedMediaSource"in window?(t=new ManagedMediaSource,n="managedMediaSource",i.info("Created ManagedMediaSource")):r?(t=new MediaSource,n="mediaSource",i.info("Created MediaSource")):e&&(t=new WebKitMediaSource,i.info("Created WebkitMediaSource")),t},detachMediaSource:function(e){e.setSource(null)},setConfig:function(e){e&&e.settings&&(r=e.settings)},setDuration:function e(n){t&&"open"===t.readyState&&(null===n&&isNaN(n)||t.duration!==n&&(n!==1/0||r.get().streaming.buffer.mediaSourceDurationInfinity||(n=Math.pow(2,32)),function(e){for(var t=e.sourceBuffers,r=0;r<t.length;r++)if(t[r].updating)return!0;return!1}(t)?setTimeout(e.bind(null,n),50):(i.info("Set MediaSource duration:"+n),t.duration=n)))},setSeekable:function(e,r){t&&"function"==typeof t.setLiveSeekableRange&&"function"==typeof t.clearLiveSeekableRange&&"open"===t.readyState&&e>=0&&e<r&&(t.clearLiveSeekableRange(),t.setLiveSeekableRange(e,r))},signalEndOfStream:function(e){if(e&&"open"===e.readyState){for(var t=e.sourceBuffers,r=0;r<t.length;r++){if(t[r].updating)return;if(0===t[r].buffered.length)return}i.info("call to mediaSource endOfStream"),e.endOfStream()}}},i=(0,d.Z)(a).getInstance().getLogger(e),e}tr.__dashjs_factory_name="MediaSourceController";var rr=c.Z.getSingletonFactory(tr);function nr(){var e,t,r,n,i,a,s,o,u,c,h,g="urn:mpeg:dash:event:2012",p="discarded",m="updated",v="added",y=this.context,E=(0,l.Z)(y).getInstance();function T(){if(!s||!o)throw new Error("setConfig function has to be called previously")}function _(){h=!1,r={},n={},i=null,c=!1,a=Date.now()/1e3}function S(){try{if(!c){c=!0;var e=o.getTime(),i=e-a;i=a>0?Math.max(0,i):0,b(n,i,e),b(r,i,e),A(n),A(r),a=e,c=!1}}catch(e){c=!1,t.error(e)}}function b(e,r,n){try{D(e,function(i){if(void 0!==i){var a=isNaN(i.duration)?0:i.duration;i.calculatedPresentationTime<=n&&i.calculatedPresentationTime+r+a>=n?C(i,f.Z.EVENT_MODE_ON_START):(L(n,a+r,i.calculatedPresentationTime)||function(e){try{var r=e.eventStream.period.start+e.eventStream.period.duration;return e.calculatedPresentationTime>r}catch(e){return t.error(e),!1}}(i))&&(t.debug("Removing event ".concat(i.id," from period ").concat(i.eventStream.period.id," as it is expired or invalid")),function(e,r){try{var n=r.eventStream.schemeIdUri,i=r.eventStream.period.id,a=r.eventStream.value,s=r.id;e[i][n]=e[i][n].filter(function(e){return a&&e.eventStream.value&&e.eventStream.value!==a||e.id!==s}),0===e[i][n].length&&delete e[i][n]}catch(e){t.error(e)}}(e,i))}})}catch(e){t.error(e)}}function A(e){try{for(var r in e)e.hasOwnProperty(r)&&0===Object.keys(e[r]).length&&delete e[r]}catch(e){t.error(e)}}function I(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.eventStream.schemeIdUri,i=e.eventStream.value,a=e.id,s=p;t[n]||(t[n]=[]);var o=t[n].findIndex(function(e){return(!i||e.eventStream.value&&e.eventStream.value===i)&&e.id===a});if(-1===o)t[n].push(e),e.triggeredReceivedEvent=!1,e.triggeredStartEvent=!1,s=v;else if(r){var l=t[n][o];e.triggeredReceivedEvent=l.triggeredReceivedEvent,e.triggeredStartEvent=l.triggeredStartEvent,t[n][o]=e,s=m}return s}function R(e){try{if(1==e.eventStream.value){var r,n=e.calculatedPresentationTime;r=4294967295==e.calculatedPresentationTime?NaN:e.calculatedPresentationTime+e.duration,E.trigger(f.Z.MANIFEST_VALIDITY_CHANGED,{id:e.id,validUntil:n,newDuration:r,newManifestValidAfter:NaN},{mode:f.Z.EVENT_MODE_ON_START})}}catch(e){t.error(e)}}function w(e){try{var r=o.getTime();D(e,function(e){var t=e.eventStream&&e.eventStream.period&&!isNaN(e.eventStream.period.duration)?e.eventStream.period.duration:NaN,n=e.eventStream&&e.eventStream.period&&!isNaN(e.eventStream.period.start)?e.eventStream.period.start:NaN;if(!isNaN(t)&&!isNaN(n)){var i=e.calculatedPresentationTime;Math.abs(i-r)<300&&C(e,f.Z.EVENT_MODE_ON_START)}})}catch(e){t.error(e)}}function D(e,r){try{if(e)for(var n=Object.keys(e),i=0;i<n.length;i++)for(var a=e[n[i]],s=Object.keys(a),o=0;o<s.length;o++)a[s[o]].forEach(function(e){void 0!==e&&r(e)})}catch(e){t.error(e)}}function L(e,r,n){try{return e-r>n}catch(e){return t.error(e),!1}}function C(e,r){try{var n=o.getTime(),i=e.id;if(r===f.Z.EVENT_MODE_ON_RECEIVE&&!e.triggeredReceivedEvent)return t.debug("Received event ".concat(i)),e.triggeredReceivedEvent=!0,void E.trigger(e.eventStream.schemeIdUri,{event:e},{mode:r});e.triggeredStartEvent||(e.eventStream.schemeIdUri===g&&1==e.eventStream.value?0===e.duration&&0===e.presentationTimeDelta||(t.debug("Starting manifest refresh event ".concat(i," at ").concat(n)),function(){try{T(),s.refreshManifest()}catch(e){t.error(e)}}()):"urn:mpeg:dash:event:callback:2015"===e.eventStream.schemeIdUri&&1==e.eventStream.value?(t.debug("Starting callback event ".concat(i," at ").concat(n)),function(e){try{(0,oe.Z)(y).create({}).load({method:"get",url:e,request:{responseType:"arraybuffer"}})}catch(e){t.error(e)}}(e.messageData)):(t.debug("Starting event ".concat(i," from period ").concat(e.eventStream.period.id," at ").concat(n)),E.trigger(e.eventStream.schemeIdUri,{event:e},{mode:r})),e.triggeredStartEvent=!0)}catch(e){t.error(e)}}return e={addInlineEvents:function(e,n){try{if(T(),r[n]||(r[n]={}),e)for(var i=0;i<e.length;i++){var a=e[i];if(!L(o.getTime(),isNaN(a.duration)?0:a.duration,a.calculatedPresentationTime)){var s=I(a,r[n],!0);s===v?(t.debug("Added inline event with id ".concat(a.id," from period ").concat(n)),C(a,f.Z.EVENT_MODE_ON_RECEIVE)):s===m&&t.debug("Updated inline event with id ".concat(a.id," from period ").concat(n))}}}catch(e){throw e}},addInbandEvents:function(e,r){try{T(),n[r]||(n[r]={});for(var i=0;i<e.length;i++){var a=e[i];L(o.getTime(),isNaN(a.duration)?0:a.duration,a.calculatedPresentationTime)||(I(a,n[r],!1)===v?(a.eventStream.schemeIdUri===g&&R(a),t.debug("Added inband event with id ".concat(a.id," from period ").concat(r)),C(a,f.Z.EVENT_MODE_ON_RECEIVE)):t.debug("Inband event with scheme_id_uri ".concat(a.eventStream.schemeIdUri,", value ").concat(a.eventStream.value,", period id ").concat(r," and event id ").concat(a.id," was ignored because it has been added before.")))}S()}catch(e){throw e}},getInbandEvents:function(){return n},getInlineEvents:function(){return r},start:function(){try{T(),t.debug("Start Event Controller");var e=u.get().streaming.eventControllerRefreshDelay;h||isNaN(e)||(h=!0,i=setInterval(S,e))}catch(e){throw e}},setConfig:function(e){try{if(!e)return;e.manifestUpdater&&(s=e.manifestUpdater),e.playbackController&&(o=e.playbackController),e.settings&&(u=e.settings)}catch(e){throw e}},reset:function(){(function(){try{null!==i&&h&&(clearInterval(i),i=null,h=!1,function(){try{w(n),w(r)}catch(e){t.error(e)}}())}catch(e){throw e}})(),_()}},t=(0,d.Z)(y).getInstance().getLogger(e),_(),e}nr.__dashjs_factory_name="EventController";var ir=c.Z.getSingletonFactory(nr),ar={LEVELS:{WARNING:"Warning",ERROR:"Error"},EVENTS:{NO_UTC_TIMING_ELEMENT:{key:"NO_UTC_TIMING_ELEMENT",message:"No UTCTiming element is present in the manifest. You may experience playback failures. For a detailed validation use https://conformance.dashif.org/"},NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE:{key:"NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE",message:'SMPTE 2052-1:2013 defines the attribute name as "imageType" and does not define "imagetype"'},INVALID_DVR_WINDOW:{key:"INVALID_DVR_WINDOW",message:"No valid segment found when applying a specification compliant DVR window calculation. Using SegmentTimeline entries as a fallback."}}};function sr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function or(){var e,t,r,n,i,s,c,h,g,p,m,v,y,E,T,_,b,A,I,R,D,L,C,N,P,O,M,x,F,B,U,Z,G,H,$,V,K,q,Y,j,z,W,X,Q,te,re,ne,ie,ae=this.context,se=(0,l.Z)(ae).getInstance();function oe(){if(!(s&&s.hasOwnProperty("load")&&D&&D.hasOwnProperty("initialize")&&D.hasOwnProperty("reset")&&D.hasOwnProperty("getClientTimeOffset")&&c&&R&&g&&G))throw new Error(a.Z.MISSING_CONFIG_ERROR)}function le(){if(!i||!i.hasOwnProperty("setManifest"))throw new Error("initialize function has to be called previously")}function ue(){!function(){try{var e=h.getStreamsInfo();if(!C&&0===e.length)throw new Error("There are no periods in the MPD");C&&e.length>0&&g.updateManifestUpdateInfo({currentTime:G.getTime(),buffered:Z.getBufferRange(),presentationStartTime:e[0].start,clientTimeOffset:D.getClientTimeOffset()}),L.length>0&&function(e){0!==e.length?L=L.filter(function(r){var n=e.filter(function(e){return e.id===r.getId()}).length>0||r.getId()===C.getId();return n||(t.debug("Removing stream ".concat(r.getId())),r.reset(!0)),n}):t.warn("No periods included in the current manifest. Skipping the filtering of outdated stream objects.")}(e);for(var r=[],n=0,i=e.length;n<i;n++){var a=e[n];r.push(de(a)),g.addManifestUpdateStreamInfo(a)}Promise.all(r).then(function(){return new Promise(function(t,r){C?t():fe(e,t,r)})}).then(function(){se.trigger(u.Z.STREAMS_COMPOSED),Pe()}).catch(function(e){throw e})}catch(e){R.error(new S.Z(w.MANIFEST_ERROR_ID_NOSTREAMS_CODE,e.message+" nostreamscomposed",c.getValue())),B=!0,Xe()}}()}function ce(){te=!0}function de(e){var t=je(e.id);return t?t.updateData(e):(t=$t(ae).create({manifestModel:c,mediaPlayerModel:$,dashMetrics:g,manifestUpdater:i,adapter:h,timelineConverter:D,capabilities:r,capabilitiesFilter:n,errHandler:R,baseURLController:y,segmentBaseController:E,textController:P,abrController:_,playbackController:G,eventController:A,mediaController:b,protectionController:N,videoModel:Z,streamInfo:e,settings:Q}),L.push(t),t.initialize(),Promise.resolve())}function fe(e,r,n){try{Ae();var i=g.getCurrentDVRInfo().range;if(i.end<i.start){re&&clearTimeout(re);var a=Math.min(1e3*(-1*(i.end-i.start)+2),2147483647);return t.debug("Waiting for ".concat(a," ms before playback can start")),se.trigger(u.Z.AST_IN_FUTURE,{delay:a}),void(re=setTimeout(function(){fe(e,r,n)},a))}Q.get().streaming.applyProducerReferenceTime&&H.calculateProducerReferenceTimeOffsets(e);var s=e[0].manifestInfo;if(Q.get().streaming.applyServiceDescription&&H.applyServiceDescription(s),h.getIsDynamic()){var o=Ze(e,s);G.computeAndSetLiveDelay(o,s)}(Q.get().streaming.applyContentSteering&&v.shouldQueryBeforeStart()?v.loadSteeringData():Promise.resolve()).then(function(){var e=c.getValue();e&&y.update(e),he(),r()}).catch(function(e){t.error(e),he(),r()})}catch(e){n(e)}}function he(){var e=function(){var e;if(h.getIsDynamic()){var r=g.getCurrentDVRInfo();e=(r&&r.range?r.range.end:0)-G.getOriginalLiveDelay();var n=r?r.range:null;if(n){if(isNaN(ne)&&-1===ne.toString().indexOf("posix:")){var i=Fe(!0);isNaN(i)||(t.info("Start time from URI parameters: ".concat(i)),e=Math.min(e,i))}else{t.info("Start time provided by the app: ".concat(ne));var a=Be(!0,ne);isNaN(a)||(e=Math.min(e,a))}var s=Q.get().streaming.timeShiftBuffer.calcFromSegmentTimeline?.1:0;e=Math.max(e,n.start+s)}}else if(e=Je()[0].getStreamInfo().start,isNaN(ne)){var o=Fe(!1);isNaN(o)||(t.info("Start time from URI parameters: ".concat(o)),e=Math.max(e,o))}else{t.info("Start time provided by the app: ".concat(ne));var l=Be(!1,ne);isNaN(l)||(e=Math.max(e,l))}return e}(),r=be(e),n=null!==r?r:L[0];se.trigger(u.Z.INITIAL_STREAM_SWITCH,{startTime:e}),ge(n,null,e),j||(j=setInterval(function(){!x&&G.getTimeToStreamEnd()<=0&&!G.isSeeking()&&se.trigger(u.Z.PLAYBACK_ENDED,{isLast:Ye().isLast})},200))}function ge(e,r,n){try{if(x||!e||r===e&&e.getIsActive())return;x=!0,se.trigger(u.Z.PERIOD_SWITCH_STARTED,{fromStreamInfo:r?r.getStreamInfo():null,toStreamInfo:e.getStreamInfo()});var i=!1;C=e,r&&(i=_e(e,r),r.deactivate(i)),n=isNaN(n)?!i&&r?e.getStreamInfo().start:NaN:n,t.info("Switch to stream ".concat(e.getId(),". Seektime is ").concat(n,", current playback time is ").concat(G.getTime(),". Seamless period switch is set to ").concat(i)),W=W.filter(function(e){return e.getId()!==C.getId()}),G.initialize(Ye(),!!r),Z.getElement()?pe(n,i,!1):me(n,i)}catch(e){x=!1}}function pe(e,r){var n,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];function a(){if(U&&"open"===U.readyState){t.debug("MediaSource is open!"),window.URL.revokeObjectURL(n),U.removeEventListener("sourceopen",a),U.removeEventListener("webkitsourceopen",a),xe();var s=g.getCurrentDVRInfo();p.setSeekable(s.range.start,s.range.end),i?(isNaN(e)||G.seek(e,!0,!0),C.setMediaSource(U).then(function(){C.initializeForTextWithMediaSource(U)})):me(e,r)}}function s(){U.addEventListener("sourceopen",a,!1),U.addEventListener("webkitsourceopen",a,!1),n=p.attachMediaSource(Z),t.debug("MediaSource attached to element.  Waiting on open...")}U?r?me(e,r):(p.detachMediaSource(Z),s()):(U=p.createMediaSource(),s())}function me(e,t){C.activate(U,t?z:void 0,e).then(function(t){if(t){var r=Object.keys(t);r.length>0&&t[r[0]].getBuffer().changeType&&(X=!0),z=t}isNaN(e)||(se.trigger(u.Z.SEEK_TARGET,{time:e},{streamId:C.getId()}),G.seek(e,!1,!0),C.startScheduleControllers()),x=!1,se.trigger(u.Z.PERIOD_SWITCH_COMPLETED,{toStreamInfo:Ye()})})}function ve(e){var t=be(e.seekTime);t&&t!==C?t&&t!==C&&(ye(),function(e,t){var r=e&&!isNaN(e.seekTime)?e.seekTime:NaN,n=C.getProcessors().map(function(t){return t.prepareOuterPeriodPlaybackSeeking(e)});Promise.all(n).then(function(){ge(t,C,r)}).catch(function(e){R.error(e)})}(e,t)):(ye(),function(e){C.getProcessors().forEach(function(t){return t.prepareInnerPeriodPlaybackSeeking(e)}),Ve(ee.USER_REQUEST_STOP_REASON)}(e)),Ke(J.SEEK_START_REASON)}function ye(){Ee()}function Ee(){W&&W.length>0&&(W.forEach(function(e){e.deactivate(!0)}),W=[])}function Te(e){if(e.newMediaInfo.streamInfo.id===C.getId()){if(Ee(),Q.get().streaming.buffer.resetSourceBuffersForTrackSwitch&&e.oldMediaInfo&&e.oldMediaInfo.codec!==e.newMediaInfo.codec){var t=G.getTime();return C.deactivate(!1),void pe(t,!1,!1)}C.prepareTrackChange(e)}}function _e(e,t){try{return Q.get().streaming.buffer.reuseExistingSourceBuffers&&(t.isProtectionCompatible(e)||te)&&(X&&Q.get().streaming.buffer.useChangeTypeForTrackSwitch||t.isMediaCodecCompatible(e,t))}catch(e){return!1}}function Se(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;U&&!e.getPreloaded()&&_e(e,t)&&e.startPreloading(U,z).then(function(){W.push(e)})}function be(e){if(isNaN(e))return null;for(var t=L.length,r=0;r<t;r++){var n=L[r];if(e<parseFloat((n.getStartTime()+n.getDuration()).toFixed(5)))return n}return null}function Ae(){try{var e=h.getIsDynamic(),t=h.getStreamsInfo()[0].manifestInfo,r=G.getTime(),n=D.calcTimeShiftBufferWindow(L,e),i=Me();if(void 0===n.start||void 0===n.end)return;i&&0!==i.length?i.forEach(function(e){g.addDVRInfo(e.getType(),r,t,n)}):g.addDVRInfo(a.Z.VIDEO,r,t,n)}catch(e){}}function Ie(e){if(q&&M){var t=$.getInitialBufferLevel(),r=[a.Z.TEXT];(isNaN(t)||t<=G.getBufferLevel(r)||h.getIsDynamic()&&t>G.getLiveDelay())&&(q=!1,Ke(J.INITIAL_PLAYOUT_START_REASON),G.play())}e&&e.mediaType&&g.addBufferLevel(e.mediaType,new Date,1e3*e.bufferLevel)}function Re(e){e.streamInfo.id===C.getId()&&e.reason&&e.reason.forceReplace&&Ee(),je(e.streamInfo.id).prepareQualityChange(e)}function we(){if(h.getIsDynamic()&&0!==G.getOriginalLiveDelay()&&C){var e=h.getStreamsInfo();if(e.length>0){var t=e[0].manifestInfo,r=Ze(e,t);G.computeAndSetLiveDelay(r,t)}}}function De(){if(He()){var e=Z.getPlaybackQuality();e&&g.addDroppedFrames(e)}}function Le(){t.debug("[onPlaybackStarted]"),!q&&K&&Ke(J.RESUME_FROM_PAUSE_START_REASON),q&&(q=!1),Y&&(Y=!1,Q.get().streaming.applyContentSteering&&!v.shouldQueryBeforeStart()&&v.loadSteeringData()),K=!1}function Ce(e){t.debug("[onPlaybackPaused]"),e.ended||(K=!0,Ve(ee.USER_REQUEST_STOP_REASON))}function Ne(e){t.debug("Stream with id ".concat(e.streamInfo.id," finished buffering"));var r=e.streamInfo.isLast;U&&r?(t.info("[onStreamBufferingCompleted] calls signalEndOfStream of mediaSourceController."),p.signalEndOfStream(U)):Pe()}function Pe(){if(C&&C.getHasFinishedBuffering())for(var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var t=e||C||null;if(t){var r=t.getStreamInfo();return L.filter(function(e){var t=e.getStreamInfo();return t.start>r.start&&r.id!==t.id})}}catch(e){return[]}}(C),t=0;t<e.length;){var r=e[t],n=0===t?C:e[t-1];!r.getPreloaded()&&n.getHasFinishedBuffering()&&U&&Se(r,n),t+=1}}function Oe(){j&&(clearInterval(j),j=null)}function Me(){return C?C.getProcessors():[]}function ke(e){if(C&&!C.getIsEndedEventSignaled()){C.setIsEndedEventSignaled(!0);var r=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||C||null;if(!e)return null;for(var t=e.getStreamInfo(),r=t.start,n=0,i=-1,a=NaN;n<L.length;){var s=L[n].getStreamInfo(),o=s.start-r;o>0&&(isNaN(a)||o<a)&&t.id!==s.id&&(a=o,i=n),n+=1}return i>=0?L[i]:null}();r?(t.debug("StreamController onEnded, found next stream with id ".concat(r.getStreamInfo().id,". Switching from ").concat(C.getStreamInfo().id," to ").concat(r.getStreamInfo().id)),ge(r,C,NaN)):(t.debug("StreamController no next stream found"),C.setIsEndedEventSignaled(!1)),Ve(r?ee.END_OF_PERIOD_STOP_REASON:ee.END_OF_CONTENT_STOP_REASON)}e&&e.isLast&&(Oe(),v.stopSteeringRequestTimer())}function xe(e){var t=e||Ye().manifestInfo.duration;p.setDuration(t)}function Fe(e){var t=T.getURIFragmentData();if(!t||!t.t)return NaN;var r=Je()[0].getStreamInfo().start;return t.t=t.t.split(",")[0],Ue(e,t.t,r)}function Be(e,t){var r=0;return e||(r=Je()[0].getStreamInfo().start),Ue(e,t,r)}function Ue(e,t,r){var n=h.getRegularPeriods()[0],i=t.toString(),a=-1!==i.indexOf("posix:")?"now"===i.substring(6)?Date.now()/1e3:parseFloat(i.substring(6)):NaN;return e&&!isNaN(a)?D.calcPresentationTimeFromWallTime(new Date(1e3*a),n):parseFloat(i)+r}function Ze(e,t){try{var r=NaN;if(t&&!isNaN(t.maxFragmentDuration)&&isFinite(t.maxFragmentDuration))return t.maxFragmentDuration;if(e&&1===e.length){var n=e[0],i=[a.Z.VIDEO,a.Z.AUDIO,a.Z.TEXT].reduce(function(e,t){var r=h.getMediaInfoForType(n,t);return r&&!1!==r.isFragmented&&e.push(r),e},[]).reduce(function(e,t){var r=h.getVoRepresentations(t);return r&&r.length>0&&r.forEach(function(t){t&&e.push(t)}),e},[]).reduce(function(e,t){var r=h.convertRepresentationToRepresentationInfo(t);return r&&r.fragmentDuration&&!isNaN(r.fragmentDuration)&&e.push(r.fragmentDuration),e},[]);r=Math.max.apply(Math,function(e){if(Array.isArray(e))return sr(e)}(s=i)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(s)||function(e,t){if(e){if("string"==typeof e)return sr(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?sr(e,t):void 0}}(s)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}return isFinite(r)?r:NaN}catch(e){return NaN}var s}function Ge(e){if(e.error)B=!0,Xe();else{t.info("Manifest updated... updating data system wide.");var r=e.manifest;h.updatePeriods(r);var i=h.getUTCTimingSources();!h.getIsDynamic()||i&&0!==i.length||se.trigger(f.Z.CONFORMANCE_VIOLATION,{level:ar.LEVELS.WARNING,event:ar.EVENTS.NO_UTC_TIMING_ELEMENT});var a=h.getIsDynamic()?i.concat(V.getUTCTimingSources()):i;n.filterUnsupportedFeatures(r).then(function(){y.initialize(r),m.attemptSync(a,h.getIsDynamic())})}}function He(){return!!C&&C.getHasVideoTrack()}function $e(){return!!C&&C.getHasAudioTrack()}function Ve(e,t){t=t||new Date,Me().forEach(function(r){r.finalisePlayList(t,e)}),g.addPlayList()}function Ke(e){g.createPlaylistMetrics(1e3*G.getTime(),e)}function qe(e){if(e.error){var r="";switch(e.error.code){case 1:r="MEDIA_ERR_ABORTED";break;case 2:r="MEDIA_ERR_NETWORK";break;case 3:r="MEDIA_ERR_DECODE",ie.counts.mediaErrorDecode+=1;break;case 4:r="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:r="MEDIA_ERR_ENCRYPTED";break;default:r="UNKNOWN"}"MEDIA_ERR_DECODE"===r&&Q.get().errors.recoverAttempts.mediaErrorDecode>=ie.counts.mediaErrorDecode?function(){t.warn("A MEDIA_ERR_DECODE occured: Resetting the MediaSource");var e=G.getTime();C.deactivate(!1),t.warn("MediaSource has been resetted. Resuming playback from time ".concat(e)),pe(e,!1,!1)}():(F=!0,e.error.message&&(r+=" ("+e.error.message+")"),e.error.msExtendedCode&&(r+=" (0x"+(e.error.msExtendedCode>>>0).toString(16).toUpperCase()+")"),t.fatal("Video Element Error: "+r),e.error&&t.fatal(e.error),R.error(new S.Z(e.error.code,r)),Xe())}}function Ye(){return C?C.getStreamInfo():null}function je(e){for(var t=0,r=L.length;t<r;t++)if(L[t].getId()===e)return L[t];return null}function ze(e){isNaN(e.newDuration)||xe(e.newDuration)}function We(){L=[],ne=NaN,N=null,x=!1,C=null,F=!1,B=!1,q=!0,Y=!0,K=!1,M=!0,j=null,te=!1,X=!1,W=[],re=null,ie={counts:{mediaErrorDecode:0}}}function Xe(){oe(),m.reset(),Ve(F||B?ee.FAILURE_STOP_REASON:ee.USER_REQUEST_STOP_REASON);for(var t=0,r=L?L.length:0;t<r;t++)L[t].reset(F);se.off(f.Z.PLAYBACK_TIME_UPDATED,De,e),se.off(f.Z.PLAYBACK_SEEKING,ve,e),se.off(f.Z.PLAYBACK_ERROR,qe,e),se.off(f.Z.PLAYBACK_STARTED,Le,e),se.off(f.Z.PLAYBACK_PAUSED,Ce,e),se.off(f.Z.PLAYBACK_ENDED,ke,e),se.off(f.Z.METRIC_ADDED,Qe,e),se.off(f.Z.MANIFEST_VALIDITY_CHANGED,ze,e),se.off(f.Z.BUFFER_LEVEL_UPDATED,Ie,e),se.off(f.Z.QUALITY_CHANGE_REQUESTED,Re,e),u.Z.KEY_SESSION_UPDATED&&se.off(u.Z.KEY_SESSION_UPDATED,ce,e),se.off(u.Z.MANIFEST_UPDATED,Ge,e),se.off(u.Z.STREAM_BUFFERING_COMPLETED,Ne,e),se.off(u.Z.TIME_SYNCHRONIZATION_COMPLETED,ue,e),se.off(u.Z.CURRENT_TRACK_CHANGED,Te,e),se.off(u.Z.SETTING_UPDATED_LIVE_DELAY,we,e),se.off(u.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,we,e),y.reset(),i.reset(),A.reset(),g.clearAllCurrentMetrics(),c.setValue(null),s.reset(),D.reset(),I.reset(),U&&(p.detachMediaSource(Z),U=null),Z=null,N&&(N=null,O=null,c.getValue()&&se.trigger(u.Z.PROTECTION_DESTROYED,{data:c.getValue().url})),Oe(),se.trigger(u.Z.STREAM_TEARDOWN_COMPLETE),We()}function Qe(e){if(e.metric===o.Z.DVR_INFO){var t=$e()?a.Z.AUDIO:a.Z.VIDEO;e.mediaType===t&&p.setSeekable(e.value.range.start,e.value.range.end)}}function Je(){return L}return e={initialize:function(t,r){oe(),M=t,O=r,D.initialize(),(i=Xt(ae).create()).setConfig({manifestModel:c,adapter:h,manifestLoader:s,errHandler:R,settings:Q,contentSteeringController:v}),i.initialize(),(A=ir(ae).getInstance()).setConfig({manifestUpdater:i,playbackController:G,settings:Q}),A.start(),m.setConfig({dashMetrics:g,baseURLController:y,errHandler:R,settings:Q}),m.initialize(),p.setConfig({settings:Q}),N&&(se.trigger(u.Z.PROTECTION_CREATED,{controller:N}),N.setMediaElement(Z.getElement()),O&&N.setProtectionData(O)),se.on(f.Z.PLAYBACK_TIME_UPDATED,De,e),se.on(f.Z.PLAYBACK_SEEKING,ve,e),se.on(f.Z.PLAYBACK_ERROR,qe,e),se.on(f.Z.PLAYBACK_STARTED,Le,e),se.on(f.Z.PLAYBACK_PAUSED,Ce,e),se.on(f.Z.PLAYBACK_ENDED,ke,e),se.on(f.Z.METRIC_ADDED,Qe,e),se.on(f.Z.MANIFEST_VALIDITY_CHANGED,ze,e),se.on(f.Z.BUFFER_LEVEL_UPDATED,Ie,e),se.on(f.Z.QUALITY_CHANGE_REQUESTED,Re,e),u.Z.KEY_SESSION_UPDATED&&se.on(u.Z.KEY_SESSION_UPDATED,ce,e),se.on(u.Z.MANIFEST_UPDATED,Ge,e),se.on(u.Z.STREAM_BUFFERING_COMPLETED,Ne,e),se.on(u.Z.TIME_SYNCHRONIZATION_COMPLETED,ue,e),se.on(u.Z.CURRENT_TRACK_CHANGED,Te,e),se.on(u.Z.SETTING_UPDATED_LIVE_DELAY,we,e),se.on(u.Z.SETTING_UPDATED_LIVE_DELAY_FRAGMENT_COUNT,we,e)},getActiveStreamInfo:Ye,addDVRMetric:Ae,hasVideoTrack:He,hasAudioTrack:$e,getStreamById:je,getStreamForTime:be,getTimeRelativeToStreamId:function(e,t){for(var r=null,n=0,i=0,a=null,s=0;s<L.length;s++){if(i=(r=L[s]).getStartTime(),a=r.getDuration(),Number.isFinite(i)&&(n=i),r.getId()===t)return e-n;Number.isFinite(a)&&(n+=a)}return null},load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;oe(),ne=t,s.load(e)},loadWithManifest:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;le(),ne=t,i.setManifest(e)},getActiveStreamProcessors:Me,setConfig:function(e){e&&(e.capabilities&&(r=e.capabilities),e.capabilitiesFilter&&(n=e.capabilitiesFilter),e.manifestLoader&&(s=e.manifestLoader),e.manifestModel&&(c=e.manifestModel),e.mediaPlayerModel&&($=e.mediaPlayerModel),e.customParametersModel&&(V=e.customParametersModel),e.protectionController&&(N=e.protectionController),e.adapter&&(h=e.adapter),e.dashMetrics&&(g=e.dashMetrics),e.errHandler&&(R=e.errHandler),e.timelineConverter&&(D=e.timelineConverter),e.videoModel&&(Z=e.videoModel),e.playbackController&&(G=e.playbackController),e.serviceDescriptionController&&(H=e.serviceDescriptionController),e.contentSteeringController&&(v=e.contentSteeringController),e.textController&&(P=e.textController),e.abrController&&(_=e.abrController),e.mediaController&&(b=e.mediaController),e.settings&&(Q=e.settings),e.baseURLController&&(y=e.baseURLController),e.uriFragmentModel&&(T=e.uriFragmentModel),e.segmentBaseController&&(E=e.segmentBaseController),e.manifestUpdater&&(i=e.manifestUpdater))},setProtectionData:function(e){O=e,N&&N.setProtectionData(O)},getIsStreamSwitchInProgress:function(){return x},switchToVideoElement:function(e){C&&(G.initialize(Ye()),pe(e,!1,!0))},getHasMediaOrInitialisationError:function(){return F||B},getStreams:Je,getActiveStream:function(){return C},getInitialPlayback:function(){return q},getAutoPlay:function(){return M},refreshManifest:function(){i.getIsUpdating()||i.refreshManifest()},reset:Xe},t=(0,d.Z)(ae).getInstance().getLogger(e),m=er(ae).getInstance(),p=rr(ae).getInstance(),I=k(ae).getInstance(),We(),e}or.__dashjs_factory_name="StreamController";var lr=c.Z.getSingletonFactory(or);function ur(){var e,t,r,n,i,s,o,c,f,h,g,p,m=this.context,v=(0,l.Z)(m).getInstance();function y(){p.debug("Stopping the gap controller"),i&&(clearInterval(i),i=null),function(){v.off(u.Z.WALLCLOCK_TIME_UPDATED,b,this),v.off(u.Z.INITIAL_STREAM_SWITCH,S,this),v.off(u.Z.PLAYBACK_SEEKING,E,this),v.off(u.Z.BUFFER_REPLACEMENT_STARTED,T,e),v.off(u.Z.TRACK_CHANGE_RENDERED,_,e)}(),i=null,s=NaN,n=0,h=null,g={}}function E(){h&&(clearTimeout(h),h=null)}function T(e){try{if(e.streamId!==c.getActiveStreamInfo().id||e.mediaType!==a.Z.VIDEO&&e.mediaType!==a.Z.AUDIO)return;e.streamId===c.getActiveStreamInfo().id&&(g[e.mediaType]=!0)}catch(e){p.error(e)}}function _(e){e&&e.mediaType&&(g[e.mediaType]=!1)}function S(){i||function(){try{i||(p.debug("Starting the gap controller"),i=setInterval(function(){A()&&D(o.getTime())},100))}catch(e){}}()}function b(){if(A(r.get().streaming.gaps.enableSeekFix)&&++n>=10){var e=o.getTime();t===e?D(e,!0):(t=e,s=NaN),n=0}}function A(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!c.getActiveStream())return!1;var t=Object.keys(g).some(function(e){return g[e]}),n=!!e&&I();return!t&&r.get().streaming.gaps.jumpGaps&&c.getActiveStreamProcessors().length>0&&(!o.isSeeking()||n)&&!o.isPaused()&&!c.getIsStreamSwitchInProgress()&&!c.getHasMediaOrInitialisationError()}function I(){var e=c.getActiveStream(),t=parseFloat((e.getStartTime()+e.getDuration()).toFixed(5));return o.getTime()+r.get().streaming.gaps.threshold>=t}function R(e,t){try{if(!e||e.length<=1&&t>0)return NaN;for(var n=NaN,i=0;isNaN(n)&&i<e.length;){var a=i>0?e.end(i-1):0;t<e.start(i)&&a-t<r.get().streaming.gaps.threshold&&(n=i),i+=1}return n}catch(e){return null}}function w(e,t){for(var r=0,n=e.length;r<n;r++)if(t>=e.start(r)&&t<=e.end(r))return!0;return!1}function D(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=r.get().streaming.gaps.enableStallFix,a=r.get().streaming.gaps.stallSeek,l=r.get().streaming.gaps.smallGapLimit,u=r.get().streaming.gaps.jumpLargeGaps,d=f.getBufferRange(),g=NaN,m=!1;if(t=R(d,e),!isNaN(t)){var v=d.start(t),y=v-e;y>0&&(y<=l||u)&&(g=v)}var E=o.getTimeToStreamEnd();if(isNaN(g)&&n&&isFinite(E)&&!isNaN(E)&&E<l&&(g=parseFloat(o.getStreamEndTime().toFixed(5)),m=!0),i&&isNaN(g)&&n&&isNaN(t)&&w(d,e)&&(0===a?(p.warn("Toggle play pause to break stall"),f.pause(),f.play()):(p.warn("Jumping ".concat(a,"s to break stall")),g=e+a)),g>0&&s!==g&&g>e&&!h){var T=g-e;if(m){var _=c.getStreamForTime(g),S=_&&!!_.getPreloaded();p.warn("Jumping to end of stream because of gap from ".concat(e," to ").concat(g,". Gap duration: ").concat(T)),o.seek(g,!0,S)}else{var b=o.getIsDynamic(),A=t>0?d.end(t-1):e,I=b?1e3*Math.max(0,T-.1):0;h=window.setTimeout(function(){o.seek(g,!0,!0),p.warn("Jumping gap occuring in period ".concat(c.getActiveStream().getStreamId()," starting at ").concat(A," and ending at ").concat(g,". Jumping by: ").concat(g-A)),h=null},I)}s=g}}return e={reset:y,setConfig:function(e){e&&(e.settings&&(r=e.settings),e.playbackController&&(o=e.playbackController),e.streamController&&(c=e.streamController),e.videoModel&&(f=e.videoModel))},initialize:function(){!function(){v.on(u.Z.WALLCLOCK_TIME_UPDATED,b,this),v.on(u.Z.INITIAL_STREAM_SWITCH,S,this),v.on(u.Z.PLAYBACK_SEEKING,E,this),v.on(u.Z.BUFFER_REPLACEMENT_STARTED,T,e),v.on(u.Z.TRACK_CHANGE_RENDERED,_,e)}()}},p=(0,d.Z)(m).getInstance().getLogger(e),y(),e}ur.__dashjs_factory_name="GapController";var cr=c.Z.getSingletonFactory(ur);function dr(){var e,t,r,n,i,s,c,h,g,p,m=this.context,v=(0,l.Z)(m).getInstance();function y(){t=!1;var e=$e.Z.parseUserAgent();r=e&&e.browser&&e.browser.name&&"safari"===e.browser.name.toLowerCase()}function E(){t=!1}function T(e){if(e.streamId===s.getActiveStreamInfo().id&&g){var t=c.getLiveDelay();c.getBufferLevel()>t/2&&(g=!1)}}function _(e){e.streamId===s.getActiveStreamInfo().id&&(g=e.state===o.Z.BUFFER_EMPTY)}function S(){h.getCatchupModeEnabled()||n.setPlaybackRate(1)}function b(){c.getIsDynamic()&&h.getCatchupModeEnabled()&&(h.getCatchupPlaybackRates().max>0||h.getCatchupPlaybackRates().min<0)&&!c.isPaused()&&!c.isSeeking()&&function(){try{return!(!c.getTime()>0||t)&&(I()===a.Z.LIVE_CATCHUP_MODE_LOLP?function(e,t){try{return Math.abs(A())>0||e<t}catch(e){return!1}}(c.getBufferLevel(),i.get().streaming.liveCatchup.playbackBufferMin):function(){try{return Math.abs(A())>0}catch(e){return!1}}())}catch(e){return!1}}()&&function(){if(!t&&n){var e,s=n.getPlaybackRate(),o=h.getCatchupPlaybackRates(),l=c.getBufferLevel(),u=A(),d=h.getCatchupMaxDrift();if(!isNaN(d)&&d>0&&u>d)p.info("[CatchupController]: Low Latency catchup mechanism. Latency too high, doing a seek to live point"),t=!0,c.seekToCurrentLive(!0,!1);else{var f=c.getCurrentLiveLatency(),m=c.getLiveDelay();e=I()===a.Z.LIVE_CATCHUP_MODE_LOLP?function(e,t,r,n,i){var a;if(i<n){var s=Math.abs(e.min),o=5*(i-n);a=1-s+2*s/(1+Math.pow(Math.E,-o)),p.debug("[LoL+ playback control_buffer-based] bufferLevel: "+i+", newRate: "+a)}else{if(Math.abs(t-r)<=.02*r)a=1;else{var l=t-r,u=l<0?Math.abs(e.min):e.max,c=5*l;a=1-u+2*u/(1+Math.pow(Math.E,-c))}p.debug("[LoL+ playback control_latency-based] latency: "+t+", newRate: "+a)}return a}(o,f,m,i.get().streaming.liveCatchup.playbackBufferMin,l):function(e,t,r,n){if(g)return 1;var i=t-r,a=i<0?Math.abs(e.min):e.max,s=5*i,o=1-a+2*a/(1+Math.pow(Math.E,-s));return c.getPlaybackStalled()&&n<=r/2&&i>0&&(o=1),o}(o,f,m,l);var v=r?.25:.02/(.5/o.max);e&&Math.abs(s-e)>=v&&(p.debug("[CatchupController]: Setting playback rate to ".concat(e)),n.setPlaybackRate(e))}}}()}function A(){return c.getCurrentLiveLatency()-c.getLiveDelay()}function I(){var e=i.get().streaming.liveCatchup.playbackBufferMin;return i.get().streaming.liveCatchup.mode!==a.Z.LIVE_CATCHUP_MODE_LOLP||null===e||isNaN(e)?a.Z.LIVE_CATCHUP_MODE_DEFAULT:a.Z.LIVE_CATCHUP_MODE_LOLP}function R(){h.getCatchupPlaybackRates(!0)}return e={reset:function(){v.off(f.Z.BUFFER_LEVEL_UPDATED,T,e),v.off(f.Z.BUFFER_LEVEL_STATE_CHANGED,_,e),v.off(f.Z.PLAYBACK_PROGRESS,b,e),v.off(f.Z.PLAYBACK_TIME_UPDATED,b,e),v.off(f.Z.PLAYBACK_SEEKED,E,e),v.off(u.Z.SETTING_UPDATED_CATCHUP_ENABLED,S,e),v.off(u.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,R,e),v.off(u.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX,R,e),v.off(f.Z.STREAM_INITIALIZED,R,e),y(),n.setPlaybackRate(1,!0)},setConfig:function(e){e&&(e.settings&&(i=e.settings),e.videoModel&&(n=e.videoModel),e.streamController&&(s=e.streamController),e.playbackController&&(c=e.playbackController),e.mediaPlayerModel&&(h=e.mediaPlayerModel))},initialize:function(){v.on(f.Z.BUFFER_LEVEL_UPDATED,T,e),v.on(f.Z.BUFFER_LEVEL_STATE_CHANGED,_,e),v.on(f.Z.PLAYBACK_PROGRESS,b,e),v.on(f.Z.PLAYBACK_TIME_UPDATED,b,e),v.on(f.Z.PLAYBACK_SEEKED,E,e),v.on(u.Z.SETTING_UPDATED_CATCHUP_ENABLED,S,e),v.on(u.Z.SETTING_UPDATED_PLAYBACK_RATE_MIN,R,e),v.on(u.Z.SETTING_UPDATED_PLAYBACK_RATE_MAX,R,e),v.on(f.Z.STREAM_INITIALIZED,R,e),R()}},p=(0,d.Z)(m).getInstance().getLogger(e),y(),e}dr.__dashjs_factory_name="CatchupController";var fr=c.Z.getSingletonFactory(dr),hr=[a.Z.SERVICE_DESCRIPTION_DVB_LL_SCHEME],gr="video",pr="audio";function mr(){var e,t,r,n,i,o=this.context;function l(){t={liveDelay:NaN,liveCatchup:{maxDrift:NaN,playbackRate:{min:NaN,max:NaN}},minBitrate:{},maxBitrate:{},initialBitrate:{},contentSteering:null},r=[]}function u(e,r,i){try{t[e][r]=i/1e3}catch(e){n.error(e)}}return e={getServiceDescriptionSettings:function(){return t},getProducerReferenceTimeOffsets:function(){return r},calculateProducerReferenceTimeOffsets:function(e){try{var t=[];if(e&&e.length>0){var o=[a.Z.VIDEO,a.Z.AUDIO,a.Z.TEXT],l=i.getAvailabilityStartTime()/1e3;e.forEach(function(e){var r=o.reduce(function(t,r){return t.concat(i.getAllMediaInfoForType(e,r))},[]).reduce(function(t,r){return i.getProducerReferenceTimes(e,r).forEach(function(n){var a=i.getVoRepresentations(r);if(a&&a.length>0&&a[0].adaptation&&a[0].segmentInfoType===s.Z.SEGMENT_TEMPLATE){var o=a[0],u=new Date(n[s.Z.WALL_CLOCK_TIME]).getTime()/1e3-(n[s.Z.PRESENTATION_TIME]/o[s.Z.TIMESCALE]-o[s.Z.PRESENTATION_TIME_OFFSET]+e.start),c=l-u;t.push({id:n[s.Z.ID],to:c})}}),t},[]);t=t.concat(r)})}r=t}catch(e){n.error(e),r=[]}},applyServiceDescription:function(e){if(e&&e.serviceDescriptions){var i=e.serviceDescriptions.filter(function(e){return hr.includes(e.schemeIdUri)}),s=e.serviceDescriptions.filter(function(e){return null==e.schemeIdUri}),o=i.length>0?i[i.length-1]:s[s.length-1];o&&(o.latency&&o.latency.target>0&&function(e){var i;if(e.schemeIdUri,a.Z.SERVICE_DESCRIPTION_DVB_LL_SCHEME,i=function(e){return{liveDelay:e.latency.target/1e3,maxDrift:!isNaN(e.latency.max)&&e.latency.max>e.latency.target?(e.latency.max-e.latency.target+500)/1e3:NaN,referenceId:e.latency.referenceId||NaN}}(e),r.length>0){var s=function(e){var t,n=0,i=r.filter(function(t){return t.id===e.referenceId});return 0===i.length?(n=r.length>0?r[0].to:0,t=r[0].id||NaN):(n=i[0].to||0,t=i[0].id||NaN),{to:n,id:t}}(i),o=s.to,l=s.id;t.liveDelay=i.liveDelay-o,t.liveCatchup.maxDrift=i.maxDrift,n.debug("\n                Found latency properties coming from service description. Applied time offset of ".concat(o," from ProducerReferenceTime element with id ").concat(l,".\n                Live Delay: ").concat(i.liveDelay-o,", Live catchup max drift: ").concat(i.maxDrift,"\n            "))}else t.liveDelay=i.liveDelay,t.liveCatchup.maxDrift=i.maxDrift,n.debug("Found latency properties coming from service description: Live Delay: ".concat(i.liveDelay,", Live catchup max drift: ").concat(i.maxDrift))}(o),o.playbackRate&&function(e){var r=e.playbackRate.min?Math.round(1e3*(e.playbackRate.min-1))/1e3:NaN,i=e.playbackRate.max?Math.round(1e3*(e.playbackRate.max-1))/1e3:NaN;t.liveCatchup.playbackRate.min=r,t.liveCatchup.playbackRate.max=i,n.debug("Found latency properties coming from service description: Live catchup min playback rate: ".concat(r)),n.debug("Found latency properties coming from service description: Live catchup max playback rate: ".concat(i))}(o),o.operatingQuality,o.operatingBandwidth&&function(e){if(e&&e.operatingBandwidth&&e.operatingBandwidth.mediaType&&"all"!==e.operatingBandwidth.mediaType){var t={};t.minBandwidth=e.operatingBandwidth.min,t.maxBandwidth=e.operatingBandwidth.max,t.targetBandwidth=e.operatingBandwidth.target;var r=[];e.operatingBandwidth.mediaType===gr||e.operatingBandwidth.mediaType===pr?r.push(e.operatingBandwidth.mediaType):"any"===e.operatingBandwidth.mediaType&&(r.push(pr),r.push(gr)),r.forEach(function(e){isNaN(t.minBandwidth)||u("minBitrate",e,t.minBandwidth),isNaN(t.maxBandwidth)||u("maxBitrate",e,t.maxBandwidth),isNaN(t.targetBandwidth)||u("initialBitrate",e,t.targetBandwidth)})}}(o),o.contentSteering&&function(e){t.contentSteering=e.contentSteering}(o))}},reset:function(){l()},setConfig:function(e){e&&e.adapter&&(i=e.adapter)}},n=(0,d.Z)(o).getInstance().getLogger(e),l(),e}mr.__dashjs_factory_name="ServiceDescriptionController";var vr=c.Z.getSingletonFactory(mr),yr=r(3973),Er=r.n(yr),Tr=r(3039);function _r(){var e,t,r,n,i,s,o,c,f=this.context,h=(0,l.Z)(f).getInstance();function g(e,t){return e&&r[t]&&r[t][e]?r[t][e].list:[]}function p(e,t){return e&&r[t]&&r[t][e]?r[t][e].current:null}function m(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&e.streamInfo){var i=e.type,o=e.streamInfo.id,l=p(i,o);if(r[o]&&r[o][i]&&(r[o][i].current=e,r[o][i].current&&(i!==a.Z.TEXT&&!E(e,l)||i===a.Z.TEXT&&e.isFragmented)&&h.trigger(u.Z.CURRENT_TRACK_CHANGED,{oldMediaInfo:l,newMediaInfo:e,switchMode:n.get().streaming.trackSwitchMode[i]},{streamId:o}),!t)){var d=_(e);if(!d||!r[o][i].storeLastSettings)return;d.roles&&(d.role=d.roles[0],delete d.roles),d.accessibility&&(d.accessibility=d.accessibility[0]),d.audioChannelConfiguration&&(d.audioChannelConfiguration=d.audioChannelConfiguration[0]),s[i]=d,c.setSavedMediaSettings(i,d)}}}function v(e,t){e&&t&&(i[e]=t)}function y(e){return e?i[e]:null}function E(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;var r=e.id===t.id,n=e.viewpoint===t.viewpoint,i=JSON.stringify(e.viewpointsWithSchemeIdUri)===JSON.stringify(t.viewpointsWithSchemeIdUri),a=e.lang===t.lang,s=e.codec===t.codec,o=e.roles.toString()===t.roles.toString(),l=JSON.stringify(e.rolesWithSchemeIdUri)===JSON.stringify(t.rolesWithSchemeIdUri),u=e.accessibility.toString()===t.accessibility.toString(),c=JSON.stringify(e.accessibilitiesWithSchemeIdUri)===JSON.stringify(t.accessibilitiesWithSchemeIdUri),d=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString(),f=JSON.stringify(e.audioChannelConfigurationsWithSchemeIdUri)===JSON.stringify(t.audioChannelConfigurationsWithSchemeIdUri);return r&&s&&n&&i&&a&&o&&l&&u&&c&&d&&f}function T(){r={},s={},i={audio:null,video:null,text:null}}function _(e){var t={lang:e.lang,viewpoint:e.viewpoint,roles:e.roles,accessibility:e.accessibility,audioChannelConfiguration:e.audioChannelConfiguration,codec:e.codec};return t.lang||t.viewpoint||t.role&&t.role.length>0||t.accessibility&&t.accessibility.length>0||t.audioChannelConfiguration&&t.audioChannelConfiguration.length>0?t:null}function S(e,t,r){var n=[];return e.forEach(function(e){t(r,e)&&n.push(e)}),0!==n.length?n:e}function b(e,t){try{return!e.lang||e.lang instanceof RegExp?t.lang.match(e.lang):""!==t.lang&&(0,Tr.extendedFilter)(t.lang,Er()(e.lang)).length>0}catch(e){return!1}}function A(e,t){return void 0===e.index||null===e.index||t.index===e.index}function I(e,t){return!e.viewpoint||e.viewpoint===t.viewpoint}function R(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!e.role||!!t.roles.filter(function(t){return t===e.role})[0]||t.type===a.Z.AUDIO&&r}function w(e,t){return e.accessibility?!!t.accessibility.filter(function(t){return t===e.accessibility})[0]:!t.accessibility.length}function D(e,t){return!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter(function(t){return t===e.audioChannelConfiguration})[0]}function L(e,t){return!e.codec||e.codec===t.codec}function C(e){var t,r=0,n=[];return e.forEach(function(e){(t=Math.max.apply(Math,e.bitrateList.map(function(e){return e.bandwidth})))>r?(r=t,n=[e]):t===r&&n.push(e)}),n}function N(e){var t,r=1/0,n=[];return e.forEach(function(e){var i=e.bitrateList.reduce(function(e,t){var r=Math.max(1,t.width*t.height);return e+t.bandwidth/r},0);(t=i/e.bitrateList.length)<r?(r=t,n=[e]):t===r&&n.push(e)}),n}function P(e){var t,r=0,n=[];return e.forEach(function(e){(t=e.representationCount)>r?(r=t,n=[e]):t===r&&n.push(e)}),n}function O(e,r){if(e===a.Z.TEXT)return r[0];var i,s=n.get().streaming.selectionModeForInitialTrack,l=o.getCustomInitialTrackSelectionFunction();if(l&&"function"==typeof l)i=l(r);else switch(s){case a.Z.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY:i=function(e){var t,r,n=(t=0,r=[],e.forEach(function(e){isNaN(e.selectionPriority)||(e.selectionPriority>t?(t=e.selectionPriority,r=[e]):e.selectionPriority===t&&r.push(e))}),r);return n.length>1&&(n=C(n)),n.length>1&&(n=P(n)),n}(r);break;case a.Z.TRACK_SELECTION_MODE_HIGHEST_BITRATE:i=function(e){var t=C(e);return t.length>1&&(t=P(t)),t}(r);break;case a.Z.TRACK_SELECTION_MODE_FIRST_TRACK:i=M(r);break;case a.Z.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY:i=function(e){var t=N(e);return t.length>1&&(t=C(t)),t}(r);break;case a.Z.TRACK_SELECTION_MODE_WIDEST_RANGE:i=function(e){var t=P(e);return t.length>1&&(t=C(e)),t}(r);break;default:t.warn("Track selection mode ".concat(s," is not supported. Falling back to TRACK_SELECTION_MODE_FIRST_TRACK")),i=M(r)}return i.length>0?i[0]:r[0]}function M(e){return e[0]}return e={setInitialMediaSettingsForType:function(e,t){var r=s[e]||y(e),n=g(e,t.id),i=[];r||((r=c.getSavedMediaSettings(e))&&delete r.codec,v(e,r)),n&&0!==n.length&&(r&&(i=S(i=Array.from(n),b,r),i=S(i,A,r),i=S(i,I,r),e===a.Z.AUDIO&&s[e]||(i=S(i,R,r)),i=S(i,w,r),i=S(i,D,r),i=S(i,L,r)),0===i.length?m(O(e,n),!0):i.length>1?m(O(e,i)):m(i[0]))},addTrack:function(e){if(e){var t=e.type;if((i=t)===a.Z.AUDIO||i===a.Z.VIDEO||i===a.Z.TEXT||i===a.Z.IMAGE){var i,s,o=e.streamInfo.id;r[o]||(r[o]={audio:{list:[],storeLastSettings:s=n.get().streaming.saveLastMediaSettingsForCurrentStreamingSession,current:null},video:{list:[],storeLastSettings:s,current:null},text:{list:[],storeLastSettings:s,current:null},image:{list:[],storeLastSettings:s,current:null}});for(var l=r[o][t].list,u=0,c=l.length;u<c;++u)if(E(l[u],e))return;l.push(e)}}},getTracksFor:g,getCurrentTrackFor:p,isCurrentTrack:function(e){if(!e)return!1;var t=e.type,n=e.streamInfo.id;return r[n]&&r[n][t]&&E(r[n][t].current,e)},setTrack:m,selectInitialTrack:O,setInitialSettings:v,getInitialSettings:y,getTracksWithHighestBitrate:C,getTracksWithHighestEfficiency:N,getTracksWithWidestRange:P,isTracksEqual:E,matchSettings:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{var n=!1;if(e.lang){if(e.lang instanceof RegExp)n=t.lang.match(e.lang);else if(""!==t.lang){var i=Er()(e.lang);i&&(n=(0,Tr.extendedFilter)(t.lang,i).length>0)}}else n=!0;var s=void 0===e.index||null===e.index||t.index===e.index,o=!e.viewpoint||e.viewpoint===t.viewpoint,l=!e.role||!!t.roles.filter(function(t){return t===e.role})[0],u=!e.accessibility||!!t.accessibility.filter(function(t){return t===e.accessibility})[0],c=!e.audioChannelConfiguration||!!t.audioChannelConfiguration.filter(function(t){return t===e.audioChannelConfiguration})[0];return n&&s&&o&&(l||t.type===a.Z.AUDIO&&r)&&u&&c}catch(e){return!1}},matchSettingsLang:b,matchSettingsIndex:A,matchSettingsViewPoint:I,matchSettingsRole:R,matchSettingsAccessibility:w,matchSettingsAudioChannelConfig:D,saveTextSettingsDisabled:function(){c.setSavedMediaSettings(a.Z.TEXT,null)},setConfig:function(e){e&&(e.domStorage&&(c=e.domStorage),e.settings&&(n=e.settings),e.customParametersModel&&(o=e.customParametersModel))},reset:T},t=(0,d.Z)(f).getInstance().getLogger(e),T(),e}_r.__dashjs_factory_name="MediaController";var Sr=c.Z.getSingletonFactory(_r);c.Z.updateSingletonFactory(_r.__dashjs_factory_name,Sr);var br=Sr,Ar=NaN,Ir=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data={baseUrls:t||null,selectedIdx:r||Ar},this.children=[]};function Rr(){var e,t,r,n,i=this.context,a=Ne(i).getInstance();function s(e,t,r){var n=o(r);e[t]?a.areEqual(n,e[t].data.baseUrls)||(e[t].data.baseUrls=n,e[t].data.selectedIdx=Ar):e[t]=new Ir(n)}function o(e){var t=r.getBaseURLsFromElement(e),i=n.getSynthesizedBaseUrlElements(t);return i&&i.length>0&&(t=t.concat(i)),t}function l(e,r){var n=r||t;e(n.data),n.children&&n.children.forEach(function(t){return l(e,t)})}function u(){t=new Ir}return e={reset:u,update:function(e){!function(e){!function(){if(!r||!r.hasOwnProperty("getBaseURLsFromElement")||!r.hasOwnProperty("getRepresentationSortFunction"))throw new Error("setConfig function has to be called previously")}();var n=o(e);a.areEqual(n,t.data.baseUrls)||(t.data.baseUrls=n,t.data.selectedIdx=Ar),e&&e.Period_asArray&&e.Period_asArray.forEach(function(e,n){s(t.children,n,e),e.AdaptationSet_asArray&&e.AdaptationSet_asArray.forEach(function(e,i){s(t.children[n].children,i,e),e.Representation_asArray&&e.Representation_asArray.sort(r.getRepresentationSortFunction()).forEach(function(e,r){s(t.children[n].children[i].children,r,e)})})})}(e)},getForPath:function(e){var r=t,n=[r.data];return e&&e.forEach(function(e){(r=r.children[e])&&n.push(r.data)}),n.filter(function(e){return e.baseUrls.length})},invalidateSelectedIndexes:function(e){l(function(t){isNaN(t.selectedIdx)||e===t.baseUrls[t.selectedIdx].serviceLocation&&(t.selectedIdx=Ar)})},setConfig:function(e){e.adapter&&(r=e.adapter),e.contentSteeringController&&(n=e.contentSteeringController)},getBaseUrls:function(e){return o(e)}},u(),e}Rr.__dashjs_factory_name="BaseURLTreeModel";var wr=c.Z.getClassFactory(Rr);function Dr(e){var t=(e=e||{}).blacklistController;return{select:function(e){return e&&function(e){var t,r,n=0,i=[],a=0;if((r=e.sort(function(e,t){var r=e.dvbPriority-t.dvbPriority;return isNaN(r)?0:r}).filter(function(e,t,r){return!t||r[0].dvbPriority&&e.dvbPriority&&r[0].dvbPriority===e.dvbPriority})).length)return r.length>1&&(r.forEach(function(e){n+=e.dvbWeight,i.push(n)}),t=Math.floor(Math.random()*(n-1)),i.every(function(e,r){return a=r,!(t<e)})),r[a]}((r=[],e.filter(function(e){return!t.contains(e.serviceLocation)||(e.dvbPriority&&r.push(e.dvbPriority),!1)}).filter(function(e){return!r.length||!e.dvbPriority||-1===r.indexOf(e.dvbPriority)})));var r}}}Dr.__dashjs_factory_name="DVBSelector";var Lr=c.Z.getClassFactory(Dr);function Cr(e){var t=(e=e||{}).blacklistController;return{select:function(e){var r,n=0;return e&&e.some(function(e,r){return n=r,!t.contains(e.serviceLocation)})&&(r=e[n]),r}}}Cr.__dashjs_factory_name="BasicSelector";var Nr=c.Z.getClassFactory(Cr);function Pr(){var e,t,r,n=this.context;function i(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=0,i=NaN,a=function(){var a=e[n],s=t.findIndex(function(e){return e.serviceLocation&&e.serviceLocation===a});if(-1!==s&&!r.contains(t[s].serviceLocation))return i=s,"break";n+=1};n<e.length&&"break"!==a(););return i}return e={selectBaseUrlIndex:function(e){var r=NaN;if(isNaN(e.selectedIdx)){var n=t.getSteeringDataFromManifest();n&&n.defaultServiceLocationArray.length>0&&(r=i(n.defaultServiceLocationArray,e.baseUrls))}var a=t.getCurrentSteeringResponseData();return e.baseUrls&&e.baseUrls.length&&a&&a.pathwayPriority&&a.pathwayPriority.length&&(r=i(a.pathwayPriority,e.baseUrls)),r},setConfig:function(e){e.blacklistController&&(r=e.blacklistController),e.contentSteeringController&&(t=e.contentSteeringController)}},t=Yt(n).getInstance(),e}Pr.__dashjs_factory_name="ContentSteeringSelector";var Or=c.Z.getClassFactory(Pr);function Mr(){var e,t,r,n,i,a,s=this.context,o=(0,l.Z)(s).getInstance(),c=(0,D.Z)(s).getInstance();function d(){t.reset()}return e={chooseSelector:function(e){(0,j.PS)(e,"boolean"),a=e?n:r},select:function(e){if(e){if(c.get().streaming.applyContentSteering){var t=i.selectBaseUrlIndex(e);isNaN(t)||-1===t||(e.selectedIdx=t)}if(!isNaN(e.selectedIdx))return e.baseUrls[e.selectedIdx];var n=a.select(e.baseUrls);return n?(e.selectedIdx=e.baseUrls.indexOf(n),n):(o.trigger(u.Z.URL_RESOLUTION_FAILED,{error:new S.Z(w.URL_RESOLUTION_FAILED_GENERIC_ERROR_CODE,w.URL_RESOLUTION_FAILED_GENERIC_ERROR_MESSAGE)}),void(a===r&&d()))}},reset:d,setConfig:function(e){e.selector&&(a=e.selector),e.contentSteeringSelector&&(i=e.contentSteeringSelector)}},t=Zt(s).create({updateEventName:u.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,addBlacklistEventName:u.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_ADD}),r=Nr(s).create({blacklistController:t}),n=Lr(s).create({blacklistController:t}),(i=Or(s).create()).setConfig({blacklistController:t}),a=r,e}Mr.__dashjs_factory_name="BaseURLSelector";var kr=c.Z.getClassFactory(Mr);function xr(){var e,t,r,n,i,a=this.context,s=(0,l.Z)(a).getInstance(),o=(0,X.Z)(a).getInstance();function c(e){r.update(e),n.chooseSelector(t.getIsDVB(e)),s.trigger(f.Z.BASE_URLS_UPDATED,{baseUrls:d(e)})}function d(e){return r.getBaseUrls(e)}return e={reset:function(){r.reset(),n.reset()},initialize:function(e){r.setConfig({adapter:t,contentSteeringController:i}),c(e)},resolve:function(e){var t=r.getForPath(e).reduce(function(e,t){var r=n.select(t);return r?(o.isRelative(r.url)?e.url=o.resolve(r.url,e.url):(e.url=r.url,e.serviceLocation=r.serviceLocation),e.availabilityTimeOffset=r.availabilityTimeOffset,e.availabilityTimeComplete=r.availabilityTimeComplete,e.queryParams=r.queryParams,e):new Se},new Se);if(!o.isRelative(t.url))return t},setConfig:function(e){e.baseURLTreeModel&&(r=e.baseURLTreeModel),e.baseURLSelector&&(n=e.baseURLSelector),e.adapter&&(t=e.adapter),e.contentSteeringController&&(i=e.contentSteeringController)},getBaseUrls:d,update:c},r=wr(a).create(),n=kr(a).create(),s.on(u.Z.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,function(e){r.invalidateSelectedIndexes(e.entry)},e),e}xr.__dashjs_factory_name="BaseURLController";var Fr=c.Z.getClassFactory(xr);function Br(e){return Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Br(e)}function Ur(e,t){return Ur=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ur(e,t)}function Zr(e,t){return!t||"object"!==Br(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Gr(e){return Gr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Gr(e)}var Hr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ur(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=Gr(t);if(r){var i=Gr(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return Zr(this,e)});function i(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(r=n.call(this)).url=e||null,r.type=t||null,r.mediaType=a.Z.STREAM,r.responseType="",r}return i}(p.Z);function $r(e){e=e||{};var t=this.context,r=(0,l.Z)(t).getInstance(),n=St(t).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,errors:w});return{load:function(e,t,i){var a=function(n,a){t.resolved=!0,t.resolvedContent=n||null,r.trigger(u.Z.XLINK_ELEMENT_LOADED,{element:t,resolveObject:i,error:n||a?null:new S.Z(w.XLINK_LOADER_LOADING_FAILURE_ERROR_CODE,w.XLINK_LOADER_LOADING_FAILURE_ERROR_MESSAGE+e)})};if("urn:mpeg:dash:resolve-to-zero:2013"===e)a(null,!0);else{var s=new Hr(e,L.w.XLINK_EXPANSION_TYPE);n.load({request:s,success:function(e){a(e)},error:function(){a(null)}})}},reset:function(){n&&(n.abort(),n=null)}}}$r.__dashjs_factory_name="XlinkLoader";var Vr=c.Z.getClassFactory($r),Kr=function(e){function t(e){var t=e.localName;return null==t&&(t=e.baseName),null!=t&&""!=t||(t=e.nodeName),t}function r(e){return"string"==typeof e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}function n(e,t,r,n){for(var i=0;i<e.length;i++){var a=e[i];if("string"==typeof a){if(a==n)break}else if(a instanceof RegExp){if(a.test(n))break}else if("function"==typeof a&&a(t,r,n))break}return i!=e.length}function i(t,r,i){"property"===e.arrayAccessForm&&(t[r]instanceof Array?t[r+"_asArray"]=t[r]:t[r+"_asArray"]=[t[r]]),!(t[r]instanceof Array)&&e.arrayAccessFormPaths.length>0&&n(e.arrayAccessFormPaths,t,r,i)&&(t[r]=[t[r]])}function a(e){var t=e.split(/[-T:+Z]/g),r=new Date(t[0],t[1]-1,t[2]),n=t[5].split(".");if(r.setHours(t[3],t[4],n[0]),n.length>1&&r.setMilliseconds(n[1]),t[6]&&t[7]){var i=60*t[6]+Number(t[7]);i=0+("-"==(/\d\d-\d\d:\d\d$/.test(e)?"-":"+")?-1*i:i),r.setMinutes(r.getMinutes()-i-r.getTimezoneOffset())}else-1!==e.indexOf("Z",e.length-1)&&(r=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())));return r}function s(t,r,i,a){return!(1==r&&e.xmlElementsFilter.length>0)||n(e.xmlElementsFilter,t,i,a)}function o(r,l){if(9==r.nodeType){for(var u=new Object,c=r.childNodes,d=0;d<c.length;d++)1==(h=c[d]).nodeType&&(e.ignoreRoot?u=o(h):(u={})[g=t(h)]=o(h));return u}if(1==r.nodeType){(u=new Object).__cnt=0;var f=[];for(c=r.childNodes,d=0;d<c.length;d++){var h,g=t(h=c[d]);if(8!=h.nodeType){var p=l+"."+g;if(s(u,h.nodeType,g,p))if(u.__cnt++,null==u[g]){var m=o(h,p);("#text"!=g||/[^\s]/.test(m))&&((v={})[g]=m,f.push(v)),u[g]=m,i(u,g,p)}else{var v;null!=u[g]&&(u[g]instanceof Array||(u[g]=[u[g]],i(u,g,p))),m=o(h,p),("#text"!=g||/[^\s]/.test(m))&&((v={})[g]=m,f.push(v)),u[g][u[g].length]=m}}}u.__children=f;for(var y=t(r),E=0;E<r.attributes.length;E++){var T=r.attributes[E];u.__cnt++;for(var _=T.value,S=0,b=e.matchers.length;S<b;S++){var A=e.matchers[S];A.test(T,y)&&(_=A.converter(T.value))}u[e.attributePrefix+T.name]=_}var I=function(e){return e.prefix}(r);return null!=I&&""!=I&&(u.__cnt++,u.__prefix=I),null!=u["#text"]&&(u.__text=u["#text"],u.__text instanceof Array&&(u.__text=u.__text.join("\n")),e.stripWhitespaces&&(u.__text=u.__text.trim()),delete u["#text"],"property"==e.arrayAccessForm&&delete u["#text_asArray"],u.__text=function(t,r,i){if(e.datetimeAccessFormPaths.length>0){var s=i.split(".#")[0];return n(e.datetimeAccessFormPaths,t,r,s)?a(t):t}return t}(u.__text,g,l+"."+g)),null!=u["#cdata-section"]&&(u.__cdata=u["#cdata-section"],delete u["#cdata-section"],"property"==e.arrayAccessForm&&delete u["#cdata-section_asArray"]),0==u.__cnt&&"text"==e.emptyNodeForm?u="":1==u.__cnt&&null!=u.__text?u=u.__text:1!=u.__cnt||null==u.__cdata||e.keepCData?u.__cnt>1&&null!=u.__text&&e.skipEmptyTextNodesForObj&&(e.stripWhitespaces&&""==u.__text||""==u.__text.trim())&&delete u.__text:u=u.__cdata,delete u.__cnt,!e.enableToStringFunc||null==u.__text&&null==u.__cdata||(u.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),u}if(3==r.nodeType||4==r.nodeType)return r.nodeValue}function l(t,n,i,a){var s="<"+(null!=t&&null!=t.__prefix?t.__prefix+":":"")+n;if(null!=i)for(var o=0;o<i.length;o++){var l=i[o],u=t[l];e.escapeMode&&(u=r(u)),s+=" "+l.substr(e.attributePrefix.length)+"=",e.useDoubleQuotes?s+='"'+u+'"':s+="'"+u+"'"}return s+(a?"/>":">")}function u(e,t){return"</"+(null!=e.__prefix?e.__prefix+":":"")+t+">"}function c(t,r){return"property"==e.arrayAccessForm&&(i="_asArray",-1!==(n=r.toString()).indexOf(i,n.length-i.length))||0==r.toString().indexOf(e.attributePrefix)||0==r.toString().indexOf("__")||t[r]instanceof Function;var n,i}function d(e){var t=0;if(e instanceof Object)for(var r in e)c(e,r)||t++;return t}function f(t,r,i){return 0==e.jsonPropertiesFilter.length||""==i||n(e.jsonPropertiesFilter,t,r,i)}function h(t){var r=[];if(t instanceof Object)for(var n in t)-1==n.toString().indexOf("__")&&0==n.toString().indexOf(e.attributePrefix)&&r.push(n);return r}function g(t){var n="";return t instanceof Object?n+=function(t){var n="";return null!=t.__cdata&&(n+="<![CDATA["+t.__cdata+"]]>"),null!=t.__text&&(e.escapeMode?n+=r(t.__text):n+=t.__text),n}(t):null!=t&&(e.escapeMode?n+=r(t):n+=t),n}function p(e,t){return""===e?t:e+"."+t}function m(e,t,r,n){var i="";if(0==e.length)i+=l(e,t,r,!0);else for(var a=0;a<e.length;a++)i+=l(e[a],t,h(e[a]),!1),i+=v(e[a],p(n,t)),i+=u(e[a],t);return i}function v(e,t){var r="";if(d(e)>0)for(var n in e)if(!c(e,n)&&(""==t||f(e,n,p(t,n)))){var i=e[n],a=h(i);null==i||null==i?r+=l(i,n,a,!0):i instanceof Object?i instanceof Array?r+=m(i,n,a,t):i instanceof Date?(r+=l(i,n,a,!1),r+=i.toISOString(),r+=u(i,n)):d(i)>0||null!=i.__text||null!=i.__cdata?(r+=l(i,n,a,!1),r+=v(i,p(t,n)),r+=u(i,n)):r+=l(i,n,a,!0):(r+=l(i,n,a,!1),r+=g(i),r+=u(i,n))}return r+g(e)}void 0===(e=e||{}).escapeMode&&(e.escapeMode=!0),void 0===e.attributePrefix&&(e.attributePrefix="_"),e.arrayAccessForm=e.arrayAccessForm||"none",e.emptyNodeForm=e.emptyNodeForm||"text",void 0===e.enableToStringFunc&&(e.enableToStringFunc=!0),e.arrayAccessFormPaths=e.arrayAccessFormPaths||[],void 0===e.skipEmptyTextNodesForObj&&(e.skipEmptyTextNodesForObj=!0),void 0===e.stripWhitespaces&&(e.stripWhitespaces=!0),e.datetimeAccessFormPaths=e.datetimeAccessFormPaths||[],void 0===e.useDoubleQuotes&&(e.useDoubleQuotes=!1),e.xmlElementsFilter=e.xmlElementsFilter||[],e.jsonPropertiesFilter=e.jsonPropertiesFilter||[],void 0===e.keepCData&&(e.keepCData=!1),void 0===e.ignoreRoot&&(e.ignoreRoot=!1),this.parseXmlString=function(e){var t;if(void 0===e)return null;if(window.DOMParser){var r=new window.DOMParser;try{(t=r.parseFromString(e,"text/xml")).getElementsByTagNameNS("*","parsererror").length>0&&(t=null)}catch(e){t=null}}else 0==e.indexOf("<?")&&(e=e.substr(e.indexOf("?>")+2)),(t=new ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e);return t},this.asArray=function(e){return void 0===e||null==e?[]:e instanceof Array?e:[e]},this.toXmlDateTime=function(e){return e instanceof Date?e.toISOString():"number"==typeof e?new Date(e).toISOString():null},this.asDateTime=function(e){return"string"==typeof e?a(e):e},this.xml2json=function(e){return o(e)},this.xml_str2json=function(e){var t=this.parseXmlString(e);return null!=t?this.xml2json(t):null},this.json2xml_str=function(e){return v(e,"")},this.json2xml=function(e){var t=this.json2xml_str(e);return this.parseXmlString(t)},this.getVersion=function(){return"1.2.0"}},qr="onLoad";function Yr(e){e=e||{};var t,r,n,i,a,o,c=this.context,d=(0,l.Z)(c).getInstance(),f=(0,X.Z)(c).getInstance();function h(e,t,r){var n,i,a={};a.elements=e,a.type=t,a.resolveType=r,0===a.elements.length&&p(a);for(var s=0;s<a.elements.length;s++)n=a.elements[s],i=f.isHTTPURL(n.url)?n.url:n.originalContent.BaseURL+n.url,o.load(i,n,a)}function g(e){var t,r,n="";if(t=e.element,r=e.resolveObject,t.resolvedContent){var i=0;0===t.resolvedContent.indexOf("<?xml")&&(i=t.resolvedContent.indexOf("?>")+2),n=t.resolvedContent.substr(0,i)+"<response>"+t.resolvedContent.substr(i)+"</response>",t.resolvedContent=a.xml_str2json(n)}(function(e){var t;for(t=0;t<e.elements.length;t++)if(!1===e.elements[t].resolved)return!1;return!0})(r)&&p(r)}function p(e){var t,r,a=[];if(function(e){var t,r,a,s,o,l,u=[];for(s=e.elements.length-1;s>=0;s--){if(r=(t=e.elements[s]).type+"_asArray",t.resolvedContent){if(t.resolvedContent)for(o=0;o<t.resolvedContent[r].length;o++)a=t.resolvedContent[r][o],u.push(a)}else delete t.originalContent["xlink:actuate"],delete t.originalContent["xlink:href"],u.push(t.originalContent);for(t.parentElement[r].splice(t.index,1),l=0;l<u.length;l++)t.parentElement[r].splice(t.index+l,0,u[l]);u=[]}e.elements.length>0&&n.run(i)}(e),"onActuate"===e.resolveType&&d.trigger(u.Z.XLINK_READY,{manifest:i}),e.resolveType===qr)switch(e.type){case s.Z.PERIOD:for(t=0;t<i[s.Z.PERIOD+"_asArray"].length;t++)(r=i[s.Z.PERIOD+"_asArray"][t]).hasOwnProperty(s.Z.ADAPTATION_SET+"_asArray")&&(a=a.concat(m(r[s.Z.ADAPTATION_SET+"_asArray"],r,s.Z.ADAPTATION_SET,qr))),r.hasOwnProperty(s.Z.EVENT_STREAM+"_asArray")&&(a=a.concat(m(r[s.Z.EVENT_STREAM+"_asArray"],r,s.Z.EVENT_STREAM,qr)));h(a,s.Z.ADAPTATION_SET,qr);break;case s.Z.ADAPTATION_SET:d.trigger(u.Z.XLINK_READY,{manifest:i})}}function m(e,t,r,n){var i,a,s,o=[];for(a=e.length-1;a>=0;a--)(i=e[a]).hasOwnProperty("xlink:href")&&"urn:mpeg:dash:resolve-to-zero:2013"===i["xlink:href"]&&e.splice(a,1);for(a=0;a<e.length;a++)(i=e[a]).hasOwnProperty("xlink:href")&&i.hasOwnProperty("xlink:actuate")&&i["xlink:actuate"]===n&&(s=v(i["xlink:href"],t,r,a,n,i),o.push(s));return o}function v(e,t,r,n,i,a){return{url:e,parentElement:t,type:r,index:n,resolveType:i,originalContent:a,resolvedContent:null,resolved:!1}}return t={resolveManifestOnLoad:function(e){a=new Kr({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!1,ignoreRoot:!0,matchers:r}),(i=e).Period_asArray?h(m(i.Period_asArray,i,s.Z.PERIOD,qr),s.Z.PERIOD,qr):d.trigger(u.Z.XLINK_READY,{manifest:i})},setMatchers:function(e){e&&(r=e)},setIron:function(e){e&&(n=e)},reset:function(){d.off(u.Z.XLINK_ELEMENT_LOADED,g,t),o&&(o.reset(),o=null)}},d.on(u.Z.XLINK_ELEMENT_LOADED,g,t),o=Vr(c).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),t}Yr.__dashjs_factory_name="XlinkController";var jr=c.Z.getClassFactory(Yr);function zr(e){return zr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},zr(e)}function Wr(e){function t(e,t){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}function r(e,r,n){for(var i=0,a=e.length;i<a;++i){var s=e[i];if(r[s.name])if(n[s.name]){if(s.merge){var o=r[s.name],l=n[s.name];"object"===zr(o)&&"object"===zr(l)?t(o,l):n[s.name]=o+l}}else n[s.name]=r[s.name]}}function n(e,t){for(var i=0,a=e.children.length;i<a;++i){var s=e.children[i],o=t[s.name+"_asArray"];if(o)for(var l=0,u=o.length;l<u;++l){var c=o[l];r(e.properties,t,c),n(s,c)}}}return{run:function(t){if(null===t||"object"!==zr(t))return t;if(t.Period_asArray&&"period"in e)for(var r=e.period,i=t.Period_asArray,a=0,s=i.length;a<s;++a){var o=i[a];if(n(r,o),"adaptationset"in e){var l=o.AdaptationSet_asArray;if(l)for(var u=e.adaptationset,c=0,d=l.length;c<d;++c)n(u,l[c])}}return t}}}Wr.__dashjs_factory_name="ObjectIron";var Xr=c.Z.getClassFactory(Wr);function Qr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Jr=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._test=t,this._converter=r}var t;return(t=[{key:"test",get:function(){return this._test}},{key:"converter",get:function(){return this._converter}}])&&Qr(e.prototype,t),e}();function en(e){return en="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},en(e)}function tn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rn(e,t){return rn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},rn(e,t)}function nn(e,t){return!t||"object"!==en(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function an(e){return an=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},an(e)}var sn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&rn(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=an(t);if(r){var i=an(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return nn(this,e)});function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n.call(this,function(e,t){var r,n=(tn(r={},s.Z.MPD,[s.Z.ID,s.Z.PROFILES]),tn(r,s.Z.PERIOD,[s.Z.ID]),tn(r,s.Z.BASE_URL,[s.Z.SERVICE_LOCATION,s.Z.BYTE_RANGE]),tn(r,s.Z.SEGMENT_BASE,[s.Z.INDEX_RANGE]),tn(r,s.Z.INITIALIZATION,[s.Z.RANGE]),tn(r,s.Z.REPRESENTATION_INDEX,[s.Z.RANGE]),tn(r,s.Z.SEGMENT_LIST,[s.Z.INDEX_RANGE]),tn(r,s.Z.BITSTREAM_SWITCHING,[s.Z.RANGE]),tn(r,s.Z.SEGMENT_URL,[s.Z.MEDIA_RANGE,s.Z.INDEX_RANGE]),tn(r,s.Z.SEGMENT_TEMPLATE,[s.Z.INDEX_RANGE,s.Z.MEDIA,s.Z.INDEX,s.Z.INITIALIZATION_MINUS,s.Z.BITSTREAM_SWITCHING_MINUS]),tn(r,s.Z.ASSET_IDENTIFIER,[s.Z.VALUE,s.Z.ID]),tn(r,s.Z.EVENT_STREAM,[s.Z.VALUE]),tn(r,s.Z.ADAPTATION_SET,[s.Z.PROFILES,s.Z.MIME_TYPE,s.Z.SEGMENT_PROFILES,s.Z.CODECS,s.Z.CONTENT_TYPE]),tn(r,s.Z.FRAME_PACKING,[s.Z.VALUE,s.Z.ID]),tn(r,s.Z.AUDIO_CHANNEL_CONFIGURATION,[s.Z.VALUE,s.Z.ID]),tn(r,s.Z.CONTENT_PROTECTION,[s.Z.VALUE,s.Z.ID]),tn(r,s.Z.ESSENTIAL_PROPERTY,[s.Z.VALUE,s.Z.ID]),tn(r,s.Z.SUPPLEMENTAL_PROPERTY,[s.Z.VALUE,s.Z.ID]),tn(r,s.Z.INBAND_EVENT_STREAM,[s.Z.VALUE,s.Z.ID]),tn(r,s.Z.ACCESSIBILITY,[s.Z.VALUE,s.Z.ID]),tn(r,s.Z.ROLE,[s.Z.VALUE,s.Z.ID]),tn(r,s.Z.RATING,[s.Z.VALUE,s.Z.ID]),tn(r,s.Z.VIEWPOINT,[s.Z.VALUE,s.Z.ID]),tn(r,s.Z.CONTENT_COMPONENT,[s.Z.CONTENT_TYPE]),tn(r,s.Z.REPRESENTATION,[s.Z.ID,s.Z.DEPENDENCY_ID,s.Z.MEDIA_STREAM_STRUCTURE_ID]),tn(r,s.Z.SUBSET,[s.Z.ID]),tn(r,s.Z.METRICS,[s.Z.METRICS_MINUS]),tn(r,s.Z.REPORTING,[s.Z.VALUE,s.Z.ID]),r);if(n.hasOwnProperty(t)){var i=n[t];return void 0!==i&&i.indexOf(e.name)>=0}return!1},function(e){return String(e)})}return i}(Jr);function on(e){return on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},on(e)}function ln(e,t){return ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ln(e,t)}function un(e,t){return!t||"object"!==on(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function cn(e){return cn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},cn(e)}var dn=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,fn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ln(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=cn(t);if(r){var i=cn(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return un(this,e)});function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n.call(this,function(e){for(var t=[s.Z.MIN_BUFFER_TIME,s.Z.MEDIA_PRESENTATION_DURATION,s.Z.MINIMUM_UPDATE_PERIOD,s.Z.TIMESHIFT_BUFFER_DEPTH,s.Z.MAX_SEGMENT_DURATION,s.Z.MAX_SUBSEGMENT_DURATION,s.Z.SUGGESTED_PRESENTATION_DELAY,s.Z.START,a.Z.START_TIME,s.Z.DURATION],r=t.length,n=0;n<r;n++)if(e.nodeName===t[n])return dn.test(e.value);return!1},function(e){var t=dn.exec(e),r=31536e3*parseFloat(t[3]||0)+2592e3*parseFloat(t[5]||0)+86400*parseFloat(t[7]||0)+3600*parseFloat(t[9]||0)+60*parseFloat(t[11]||0)+parseFloat(t[13]||0);return void 0!==t[1]&&(r=-r),r})}return i}(Jr);function hn(e){return hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hn(e)}function gn(e,t){return gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},gn(e,t)}function pn(e,t){return!t||"object"!==hn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function mn(e){return mn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},mn(e)}var vn=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})(?::?)([0-9]{2}))?/,yn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gn(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=mn(t);if(r){var i=mn(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return pn(this,e)});function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n.call(this,function(e){return vn.test(e.value)},function(e){var t,r=vn.exec(e);if(t=Date.UTC(parseInt(r[1],10),parseInt(r[2],10)-1,parseInt(r[3],10),parseInt(r[4],10),parseInt(r[5],10),r[6]&&parseInt(r[6],10)||0,r[7]&&1e3*parseFloat(r[7])||0),r[9]&&r[10]){var n=60*parseInt(r[9],10)+parseInt(r[10],10);t+=("+"===r[8]?-1:1)*n*60*1e3}return new Date(t)})}return i}(Jr);function En(e){return En="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},En(e)}function Tn(e,t){return Tn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Tn(e,t)}function _n(e,t){return!t||"object"!==En(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Sn(e){return Sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Sn(e)}var bn=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,An=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tn(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=Sn(t);if(r){var i=Sn(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return _n(this,e)});function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n.call(this,function(e){return bn.test(e.value)},function(e){return parseFloat(e)})}return i}(Jr);function In(e){return In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},In(e)}function Rn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wn(e,t){return wn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},wn(e,t)}function Dn(e,t){return!t||"object"!==In(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ln(e){return Ln=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ln(e)}var Cn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wn(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=Ln(t);if(r){var i=Ln(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return Dn(this,e)});function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n.call(this,function(e,t){var r,n=(Rn(r={},s.Z.ADAPTATION_SET,[s.Z.LANG]),Rn(r,s.Z.REPRESENTATION,[s.Z.LANG]),Rn(r,s.Z.CONTENT_COMPONENT,[s.Z.LANG]),Rn(r,s.Z.LABEL,[s.Z.LANG]),Rn(r,s.Z.GROUP_LABEL,[s.Z.LANG]),r);if(n.hasOwnProperty(t)){var i=n[t];return void 0!==i&&i.indexOf(e.name)>=0}return!1},function(e){return Er()(e)||String(e)})}return i}(Jr);function Nn(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Pn=function(){function e(t){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t,this._merge=(r=t)&&r.length&&r.charAt(0)===r.charAt(0).toUpperCase()}var t;return(t=[{key:"name",get:function(){return this._name}},{key:"merge",get:function(){return this._merge}}])&&Nn(e.prototype,t),e}();function On(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Mn=function(){function e(t,r,n){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=t||"",this._properties=[],this._children=n||[],Array.isArray(r)&&r.forEach(function(e){i._properties.push(new Pn(e))})}var t;return(t=[{key:"name",get:function(){return this._name}},{key:"children",get:function(){return this._children}},{key:"properties",get:function(){return this._properties}}])&&On(e.prototype,t),e}();function kn(e){return kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kn(e)}function xn(e,t){return xn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},xn(e,t)}function Fn(e,t){return!t||"object"!==kn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bn(e){return Bn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Bn(e)}var Un=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xn(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=Bn(t);if(r){var i=Bn(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return Fn(this,e)});function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var e=[s.Z.PROFILES,s.Z.WIDTH,s.Z.HEIGHT,s.Z.SAR,s.Z.FRAMERATE,s.Z.AUDIO_SAMPLING_RATE,s.Z.MIME_TYPE,s.Z.SEGMENT_PROFILES,s.Z.CODECS,s.Z.MAXIMUM_SAP_PERIOD,s.Z.START_WITH_SAP,s.Z.MAX_PLAYOUT_RATE,s.Z.CODING_DEPENDENCY,s.Z.SCAN_TYPE,s.Z.FRAME_PACKING,s.Z.AUDIO_CHANNEL_CONFIGURATION,s.Z.CONTENT_PROTECTION,s.Z.ESSENTIAL_PROPERTY,s.Z.ESSENTIAL_PROPERTY+"_asArray",s.Z.SUPPLEMENTAL_PROPERTY,s.Z.INBAND_EVENT_STREAM];return n.call(this,s.Z.ADAPTATION_SET,e,[new Mn(s.Z.REPRESENTATION,e,[new Mn(s.Z.SUB_REPRESENTATION,e)])])}return i}(Mn);function Zn(e){return Zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zn(e)}function Gn(e,t){return Gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Gn(e,t)}function Hn(e,t){return!t||"object"!==Zn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function $n(e){return $n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},$n(e)}var Vn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gn(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=$n(t);if(r){var i=$n(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return Hn(this,e)});function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var e=[s.Z.SEGMENT_BASE,s.Z.SEGMENT_TEMPLATE,s.Z.SEGMENT_LIST];return n.call(this,s.Z.PERIOD,e,[new Mn(s.Z.ADAPTATION_SET,e,[new Mn(s.Z.REPRESENTATION,e)])])}return i}(Mn);function Kn(e){e=e||{};var t,r,n,i,a,s=this.context,o=e.debug;return t={parse:function(e){var t,n=window.performance.now();if(!(t=i.xml_str2json(e)))throw new Error("parsing the manifest failed");var s=window.performance.now();t.Patch?((t=t.Patch).add_asArray&&t.add_asArray.forEach(function(e){return a.run(e)}),t.replace_asArray&&t.replace_asArray.forEach(function(e){return a.run(e)})):(t=t.MPD,a.run(t));var o=window.performance.now();return r.info("Parsing complete: ( xml2json: "+(s-n).toPrecision(3)+"ms, objectiron: "+(o-s).toPrecision(3)+"ms, total: "+((o-n)/1e3).toPrecision(3)+"s)"),t.protocol="DASH",t},getMatchers:function(){return n},getIron:function(){return a}},r=o.getLogger(t),n=[new fn,new yn,new An,new Cn,new sn],i=new Kr({escapeMode:!1,attributePrefix:"",arrayAccessForm:"property",emptyNodeForm:"object",stripWhitespaces:!1,enableToStringFunc:!0,ignoreRoot:!1,matchers:n}),a=Xr(s).create({adaptationset:new Un,period:new Vn}),t}Kn.__dashjs_factory_name="DashParser";var qn=c.Z.getClassFactory(Kn);function Yn(e){e=e||{};var t,r,n,i,o,c=this.context,d=e.debug,f=e.settings,h=(0,l.Z)(c).getInstance(),g=(0,X.Z)(c).getInstance(),p=e.mssHandler,m=e.errHandler;function v(e){h.trigger(u.Z.INTERNAL_MANIFEST_LOADED,{manifest:e.manifest})}function y(e){var t=null;return e.indexOf("SmoothStreamingMedia")>-1?(p&&(t=p.createMssParser(),p.createMssFragmentProcessor(),p.registerEvents()),t):e.indexOf("MPD")>-1||e.indexOf("Patch")>-1?qn(c).create({debug:d}):t}return t={load:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=new Date,l=new Hr(e,L.w.MPD_TYPE);t&&(l.serviceLocation=t),a&&(l.queryParams=a),l.requestStartDate||(l.requestStartDate=s),h.trigger(u.Z.MANIFEST_LOADING_STARTED,{request:l}),n.load({request:l,success:function(t,n,a){var s,l,c;if(i)if(a&&a!==e?(l=g.parseBaseUrl(a),s=a):(g.isRelative(e)&&(e=g.resolve(e,window.location.href)),l=g.parseBaseUrl(e)),"No Content"!=n)if(null===o&&(o=y(t)),null!==o){i.setMatchers(o.getMatchers()),i.setIron(o.getIron());try{c=o.parse(t)}catch(t){return void h.trigger(u.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new S.Z(w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))})}if(c){if(c.url=s||e,c.originalUrl||(c.originalUrl=c.url),f&&f.get().streaming.enableManifestDurationMismatchFix&&c.mediaPresentationDuration&&c.Period_asArray.length>1){var d=c.Period_asArray.reduce(function(e,t){return e+t.duration},0);!isNaN(d)&&c.mediaPresentationDuration>d&&(r.warn("Media presentation duration greater than duration of all periods. Setting duration to total period duration"),c.mediaPresentationDuration=d)}c.baseUri=l,c.loadedTime=new Date,i.resolveManifestOnLoad(c),h.trigger(u.Z.ORIGINAL_MANIFEST_LOADED,{originalManifest:t})}else h.trigger(u.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new S.Z(w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))})}else h.trigger(u.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new S.Z(w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_CODE,w.MANIFEST_LOADER_PARSING_FAILURE_ERROR_MESSAGE+"".concat(e))});else h.trigger(u.Z.INTERNAL_MANIFEST_LOADED,{manifest:null})},error:function(t,r,n){h.trigger(u.Z.INTERNAL_MANIFEST_LOADED,{manifest:null,error:new S.Z(w.MANIFEST_LOADER_LOADING_FAILURE_ERROR_CODE,w.MANIFEST_LOADER_LOADING_FAILURE_ERROR_MESSAGE+"".concat(e,", ").concat(n))})}})},reset:function(){h.off(u.Z.XLINK_READY,v,t),p&&p.reset(),i&&(i.reset(),i=null),n&&(n.abort(),n=null)}},r=d.getLogger(t),h.on(u.Z.XLINK_READY,v,t),n=St(c).create({errHandler:e.errHandler,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,urlUtils:g,constants:a.Z,dashConstants:s.Z,errors:w,requestTimeout:e.settings.get().streaming.manifestRequestTimeout}),i=jr(c).create({errHandler:m,dashMetrics:e.dashMetrics,mediaPlayerModel:e.mediaPlayerModel,requestModifier:e.requestModifier,settings:e.settings}),o=null,t}Yn.__dashjs_factory_name="ManifestLoader";var jn=c.Z.getClassFactory(Yn);function zn(){var e=this.context,t=(0,l.Z)(e).getInstance();return{error:function(e){t.trigger(u.Z.ERROR,{error:e})}}}zn.__dashjs_factory_name="ErrorHandler";var Wn=c.Z.getSingletonFactory(zn),Xn=r(1715);function Qn(){var e,t,r,n,i,s,o=this.context,c=(0,l.Z)(o).getInstance();function f(e,n){if(!n||!n.Period_asArray||0===n.Period_asArray.length)return Promise.resolve();var i=[];return n.Period_asArray.forEach(function(n){i.push(function(e,n){return new Promise(function(i){if(e&&e.AdaptationSet_asArray&&0!==e.AdaptationSet_asArray.length){var o=[];e.AdaptationSet_asArray.forEach(function(e){t.getIsTypeOf(e,n)&&o.push(function(e,n){return new Promise(function(i){if(e.Representation_asArray&&0!==e.Representation_asArray.length){var o=[],l=[];e.Representation_asArray.forEach(function(i,s){var u=t.getCodec(e,s,!1),c=function(e,t,r){switch(e){case a.Z.VIDEO:return function(e,t){return{codec:t,width:e.width||null,height:e.height||null,framerate:e.frameRate||null,bitrate:e.bandwidth||null}}(t,r);case a.Z.AUDIO:return function(e,t){var r=e.audioSamplingRate||null;return{codec:t,bitrate:e.bandwidth||null,samplerate:r}}(t,r);default:return null}}(n,i,u);l.push(c),o.push(r.supportsCodec(c,n))}),Promise.all(o).then(function(t){e.Representation_asArray=e.Representation_asArray.filter(function(e,r){return t[r]||s.debug("[Stream] Codec ".concat(l[r].codec," not supported ")),t[r]}),i()}).catch(function(){i()})}else i()})}(e,n))}),Promise.all(o).then(function(){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter(function(e){var t=e.Representation_asArray&&e.Representation_asArray.length>0;return t||(c.trigger(u.Z.ADAPTATION_SET_REMOVED_NO_CAPABILITIES,{adaptationSet:e}),s.warn("AdaptationSet has been removed because of no supported Representation")),t}),i()}).catch(function(){i()})}else i()})}(n,e))}),Promise.all(i)}return e={setConfig:function(e){e&&(e.adapter&&(t=e.adapter),e.capabilities&&(r=e.capabilities),e.settings&&(n=e.settings),e.customParametersModel&&(i=e.customParametersModel))},filterUnsupportedFeatures:function(e){return new Promise(function(o){var l=[];l.push(f(a.Z.VIDEO,e)),l.push(f(a.Z.AUDIO,e)),Promise.all(l).then(function(){n.get().streaming.capabilities.filterUnsupportedEssentialProperties&&function(e){e&&e.Period_asArray&&0!==e.Period_asArray.length&&e.Period_asArray.forEach(function(e){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter(function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter(function(e){var n=t.getEssentialPropertiesForRepresentation(e);if(n&&n.length>0)for(var i=0;i<n.length;){if(!r.supportsEssentialProperty(n[i]))return s.debug("[Stream] EssentialProperty not supported: "+n[i].schemeIdUri),!1;i+=1}return!0}),e.Representation_asArray&&e.Representation_asArray.length>0)})})}(e),function(e){var t=i.getCustomCapabilitiesFilters();t&&0!==t.length&&e&&e.Period_asArray&&0!==e.Period_asArray.length&&e.Period_asArray.forEach(function(e){e.AdaptationSet_asArray=e.AdaptationSet_asArray.filter(function(e){return!e.Representation_asArray||0===e.Representation_asArray.length||(e.Representation_asArray=e.Representation_asArray.filter(function(e){return!t.some(function(t){return!t(e)})}),e.Representation_asArray&&e.Representation_asArray.length>0)})})}(e),o()}).catch(function(){o()})})}},s=(0,d.Z)(o).getInstance().getLogger(e),e}Qn.__dashjs_factory_name="CapabilitiesFilter";var Jn=c.Z.getSingletonFactory(Qn),ei=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null,this.r=null};function ti(){var e;return{initialize:function(t){if(e=new ei,!t)return null;var r=t.indexOf("#");if(-1!==r)for(var n=t.substr(r+1).split("&"),i=0,a=n.length;i<a;++i){var s=n[i],o=s.indexOf("=");if(-1!==o){var l=s.substring(0,o);e.hasOwnProperty(l)&&(e[l]=s.substr(o+1))}}},getURIFragmentData:function(){return e}}}ti.__dashjs_factory_name="URIFragmentModel";var ri=c.Z.getSingletonFactory(ti);function ni(){var e,t=this.context,r=(0,l.Z)(t).getInstance();return{getValue:function(){return e},setValue:function(t){e=t,t&&r.trigger(u.Z.MANIFEST_LOADED,{data:t})}}}ni.__dashjs_factory_name="ManifestModel";var ii=c.Z.getSingletonFactory(ni),ai=-.5;function si(){var e,t,r,n,i=this.context,a=(0,D.Z)(i).getInstance();function s(e,r){return isNaN(e)?0:e>0?(r&&t.warn("Supplied minimum playback rate is a positive value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):e<ai?(r&&t.warn("Supplied minimum playback rate is out of range and will be limited to ".concat(ai,": ").concat(-50,"% playback speed.")),ai):e}function o(e,r){return isNaN(e)?0:e<0?(r&&t.warn("Supplied maximum playback rate is a negative value when it should be negative or 0. The supplied rate will not be applied and set to 0: 100% playback speed."),0):e>1?(r&&t.warn("Supplied maximum playback rate is out of range and will be limited to ".concat(1,": ").concat(200,"% playback speed.")),1):e}function l(){var e=a.get().streaming.buffer.stableBufferTime>0?a.get().streaming.buffer.stableBufferTime:a.get().streaming.buffer.fastSwitchEnabled?20:12,t=r.getLiveDelay();return!isNaN(t)&&t>0?Math.min(e,t):e}return e={getCatchupMaxDrift:function(){if(!isNaN(a.get().streaming.liveCatchup.maxDrift)&&a.get().streaming.liveCatchup.maxDrift>0)return a.get().streaming.liveCatchup.maxDrift;var e=n.getServiceDescriptionSettings();return e&&e.liveCatchup&&!isNaN(e.liveCatchup.maxDrift)&&e.liveCatchup.maxDrift>0?e.liveCatchup.maxDrift:12},getCatchupModeEnabled:function(){return null!==a.get().streaming.liveCatchup.enabled?a.get().streaming.liveCatchup.enabled:r.getInitialCatchupModeActivated()},getStableBufferTime:l,getInitialBufferLevel:function(){var e=a.get().streaming.buffer.initialBufferLevel;return isNaN(e)||e<0?0:Math.min(l(),e)},getRetryAttemptsForType:function(e){var t=isNaN(a.get().streaming.retryAttempts.lowLatencyMultiplyFactor)?5:a.get().streaming.retryAttempts.lowLatencyMultiplyFactor;return r.getLowLatencyModeEnabled()?a.get().streaming.retryAttempts[e]*t:a.get().streaming.retryAttempts[e]},getRetryIntervalsForType:function(e){var t=isNaN(a.get().streaming.retryIntervals.lowLatencyReductionFactor)?10:a.get().streaming.retryIntervals.lowLatencyReductionFactor;return r.getLowLatencyModeEnabled()?a.get().streaming.retryIntervals[e]/t:a.get().streaming.retryIntervals[e]},getCatchupPlaybackRates:function(e){var t=a.get().streaming.liveCatchup.playbackRate;if(!isNaN(t.min)||!isNaN(t.max))return{min:s(t.min,e),max:o(t.max,e)};var r=n.getServiceDescriptionSettings();if(r&&r.liveCatchup&&(!isNaN(r.liveCatchup.playbackRate.min)||!isNaN(r.liveCatchup.playbackRate.max))){var i=r.liveCatchup.playbackRate;return{min:s(i.min,e),max:o(i.max,e)}}return{min:-.5,max:.5}},getAbrBitrateParameter:function(e,t){try{var r=a.get().streaming.abr[e][t];if(!isNaN(r)&&-1!==r)return r;var i=n.getServiceDescriptionSettings();return i&&i[e]&&!isNaN(i[e][t])?i[e][t]:-1}catch(e){return-1}},setConfig:function(e){e.playbackController&&(r=e.playbackController),e.serviceDescriptionController&&(n=e.serviceDescriptionController)},reset:function(){}},t=(0,d.Z)(i).getInstance().getLogger(e),e}si.__dashjs_factory_name="MediaPlayerModel";var oi=c.Z.getSingletonFactory(si),li=r(1767);function ui(e){var t=(e=e||{}).abrController,r=e.switchHistory,n=e.droppedFramesHistory,i=e.currentRequest,a=e.useBufferOccupancyABR,s=e.useL2AABR,o=e.useLoLPABR,l=e.streamProcessor?e.streamProcessor.getScheduleController():null,u=e.streamProcessor?e.streamProcessor.getRepresentationInfo():null,c=e.videoModel?e.videoModel:null;function d(){return u?u.mediaInfo:null}return{getMediaType:function(){var e=d();return e?e.type:null},getMediaInfo:d,getDroppedFramesHistory:function(){return n},getCurrentRequest:function(){return i},getSwitchHistory:function(){return r},getStreamInfo:function(){var e=d();return e?e.streamInfo:null},getScheduleController:function(){return l},getAbrController:function(){return t},getRepresentationInfo:function(){return u},useBufferOccupancyABR:function(){return a},useL2AABR:function(){return s},useLoLPABR:function(){return o},getVideoModel:function(){return c}}}ui.__dashjs_factory_name="RulesContext";var ci=c.Z.getClassFactory(ui),di=r(2068);function fi(){var e=[],t=[];return{push:function(r){r.newValue===di.Z.NO_CHANGE&&(r.newValue=r.oldValue),e[r.oldValue]||(e[r.oldValue]={noDrops:0,drops:0,dropSize:0});var n=r.newValue-r.oldValue,i=n<0?1:0,a=i?-n:0,s=i?0:1;if(e[r.oldValue].drops+=i,e[r.oldValue].dropSize+=a,e[r.oldValue].noDrops+=s,t.push({idx:r.oldValue,noDrop:s,drop:i,dropSize:a}),t.length>8){var o=t.shift();e[o.idx].drops-=o.drop,e[o.idx].dropSize-=o.dropSize,e[o.idx].noDrops-=o.noDrop}},getSwitchRequests:function(){return e},reset:function(){e=[],t=[]}}}fi.__dashjs_factory_name="SwitchRequestHistory";var hi=c.Z.getClassFactory(fi);function gi(){var e={},t={},r={};return{push:function(n,i,a){if(i){e[n]||(e[n]=[],t[n]=0,r[n]=0);var s=a&&a.droppedVideoFrames?a.droppedVideoFrames:0,o=a&&a.totalVideoFrames?a.totalVideoFrames:0,l=s-t[n];t[n]=s;var u=o-r[n];r[n]=o;var c=e[n];isNaN(i)||(c[i]?(c[i].droppedVideoFrames+=l,c[i].totalVideoFrames+=u):c[i]={droppedVideoFrames:l,totalVideoFrames:u})}},getFrameHistory:function(t){return e[t]},clearForStream:function(n){try{delete e[n],delete t[n],delete r[n]}catch(e){}},reset:function(){e={},t={},r={}}}}gi.__dashjs_factory_name="DroppedFramesHistory";var pi=c.Z.getClassFactory(gi);function mi(e){var t,r,n,i,s,o=this.context,u=(e=e||{}).settings,c=(0,l.Z)(o).getInstance();function d(e,t,r,n){var i=Math.pow(.5,r/n.fast);e.fastEstimate=(1-i)*t+i*e.fastEstimate;var a=Math.pow(.5,r/n.slow);e.slowEstimate=(1-a)*t+a*e.slowEstimate,e.totalWeight+=r}function h(e,o,l){return u.get().streaming.abr.movingAverageMethod!==a.Z.MOVING_AVERAGE_SLIDING_WINDOW?function(e,t){var r=e?s.throughputHalfLife:s.latencyHalfLife,a=e?n[t]:i[t];if(!a||a.totalWeight<=0)return NaN;var o=a.fastEstimate/(1-Math.pow(.5,a.totalWeight/r.fast)),l=a.slowEstimate/(1-Math.pow(.5,a.totalWeight/r.slow));return e?Math.min(o,l):Math.max(o,l)}(e,o):function(e,n,i){var a=function(e,n,i){var a,s;if(e?(a=t[n],s=i?3:4):(a=r[n],s=4),a){if(s>=a.length)s=a.length;else if(e)for(var o=1;o<s;++o){var l=a[a.length-o]/a[a.length-o-1];if((l>=1.3||l<=1/1.3)&&(s+=1)===a.length)break}}else s=0;return s}(e,n,i),s=(e?t:r)[n];return 0!==a&&s&&0!==s.length?(s=s.slice(-a)).reduce(function(e,t){return e+t})/s.length:NaN}(e,o,l)}function g(e,t){return h(!0,e,t)}function p(e){t[e]=t[e]||[],r[e]=r[e]||[],n[e]=n[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0},i[e]=i[e]||{fastEstimate:0,slowEstimate:0,totalWeight:0}}function m(){t={},r={},n={},i={}}var v={push:function(e,o,l){if(o.trace&&o.trace.length){var h,g=o.tresponse.getTime()-o.trequest.getTime()||1,m=o._tfinish.getTime()-o.tresponse.getTime()||1,v=o.trace.reduce(function(e,t){return e+t.b[0]},0),y=0;if(0!==(h=o._fileLoaderType&&o._fileLoaderType===a.Z.FILE_LOADER_TYPES.FETCH?o.trace.reduce(function(e,t){return e+t.d},0):l?m:g+m)&&(y=Math.round(8*v/h)),o.cmsd){var E=o.cmsd.dynamic&&o.cmsd.dynamic.etp?o.cmsd.dynamic.etp:null;if(E){var T=u.get().streaming.cmsd.abr.etpWeightRatio;T>0&&T<=1&&(y=y*(1-T)+E*T)}}if(p(e),function(e,t,r){return e===a.Z.VIDEO?r<u.get().streaming.cacheLoadThresholds[a.Z.VIDEO]:e===a.Z.AUDIO?r<u.get().streaming.cacheLoadThresholds[a.Z.AUDIO]:void 0}(e,0,m)){if(t[e].length>0&&!t[e].hasCachedEntries)return;t[e].hasCachedEntries=!0}else t[e]&&t[e].hasCachedEntries&&function(e){delete t[e],delete r[e],delete n[e],delete i[e],p(e)}(e);t[e].push(y),c.trigger(f.Z.THROUGHPUT_MEASUREMENT_STORED,{throughput:y,mediaType:e,httpRequest:o}),t[e].length>20&&t[e].shift(),r[e].push(g),r[e].length>20&&r[e].shift(),d(n[e],y,.001*m,s.throughputHalfLife),d(i[e],g,1,s.latencyHalfLife)}},getAverageThroughput:g,getSafeAverageThroughput:function(e,t){var r=g(e,t);return isNaN(r)||(r*=u.get().streaming.abr.bandwidthSafetyFactor),r},getAverageLatency:function(e){return h(!1,e)},reset:m};return s={throughputHalfLife:{fast:3,slow:8},latencyHalfLife:{fast:1,slow:2}},m(),v}mi.__dashjs_factory_name="ThroughputHistory";var vi=c.Z.getClassFactory(mi);function yi(){var e,t,r,n,i,s,c,h,g,p,m,v,y,E,T,S,b,A,I,R,w,D,C,N,P,O,M,k=this.context,x=(0,d.Z)(k).getInstance(),F=(0,l.Z)(k).getInstance();function B(){i={},s={},h={},c={},R={},C={},N={},P={},void 0===p&&(p=!1),w&&w.reset(),I=void 0,w=void 0,D=void 0,clearTimeout(g),g=null}function U(t){var i=t.request.mediaType,a=t.streamId;if(i&&a&&c[a]&&M.get().streaming.abr.autoSwitchBitrate[i]){var s=c[a][i];if(s){var l=ci(k).create({abrController:e,streamProcessor:s,currentRequest:t.request,useBufferOccupancyABR:C[i],useL2AABR:N[i],useLoLPABR:P[i],videoModel:E}),u=r.shouldAbandonFragment(l,a);u.quality>di.Z.NO_CHANGE&&s.getFragmentModel().getRequests({state:_.FRAGMENT_MODEL_LOADING,index:t.request.index})[0]&&(h[a][i].state=o.Z.ABANDON_LOAD,R[a][i].reset(),R[a][i].push({oldValue:V(i,a),newValue:u.quality,confidence:1,reason:u.reason}),K(i,n.getActiveStreamInfo(),u.quality,u.reason),clearTimeout(g),g=setTimeout(function(){h[a][i].state=o.Z.ALLOW_LOAD,g=null},M.get().streaming.abandonLoadTimeout))}}}function Z(e){e.mediaType===a.Z.VIDEO&&(void 0!==I&&w.push(e.streamId,I,E.getPlaybackQuality()),I=e.newQuality)}function G(e){var r,n;e.metric!==o.Z.HTTP_REQUEST||!e.value||e.value.type!==L.w.MEDIA_SEGMENT_TYPE||e.mediaType!==a.Z.AUDIO&&e.mediaType!==a.Z.VIDEO||D.push(e.mediaType,e.value,M.get().streaming.abr.useDeadTimeLatency),e.metric!==o.Z.BUFFER_LEVEL||e.mediaType!==a.Z.AUDIO&&e.mediaType!==a.Z.VIDEO||(r=e.mediaType,n=.001*e.value.level,M.get().streaming.abr.ABRStrategy===a.Z.ABR_STRATEGY_DYNAMIC&&function(e,r){try{var n=T.getStableBufferTime(),i=n,a=.5*n,s=C[e],o=r>(s?a:i);C[e]=o,o!==s&&(o?t.info("["+e+"] switching from throughput to buffer occupancy ABR rule (buffer: "+r.toFixed(3)+")."):t.info("["+e+"] switching from buffer occupancy to throughput ABR rule (buffer: "+r.toFixed(3)+")."))}catch(e){t.error(e)}}(r,n))}function H(e,r){try{var n;return i[r]=i[r]||{},i[r].hasOwnProperty(e)||(i[r][e]=0),n=function(e,t){var r=i[t][e],n=r;if(!c[t]||!c[t][e])return n;var a=$(e,t);void 0!==a&&(n=Math.max(r,a));var s=function(e,t){try{var r=T.getAbrBitrateParameter("maxBitrate",e);return r>-1?z(c[t][e].getMediaInfo(),r,t):void 0}catch(e){return}}(e,t);return void 0!==s&&(n=Math.min(n,s)),n}(e,r),n=function(e,t,r){var n=i[r][t],a=M.get().streaming.abr.maxRepresentationRatio[t];return isNaN(a)||a>=1||a<0?e:Math.min(e,Math.round(n*a))}(n,e,r),n=function(e,t,r){if(t!==a.Z.VIDEO||!M.get().streaming.abr.limitBitrateByPortal||!c[r]||!c[r][t])return e;p||X();var n=c[r][t].getStreamInfo(),i=y.getAdaptationForType(n.index,t,n).Representation_asArray,s=e;if(m>0&&v>0){for(;s>0&&i[s]&&m<i[s].width&&m-i[s-1].width<i[s].width-m;)s-=1;for(;s<i.length-1&&i[s].width===i[s+1].width;)s+=1}return s}(n,e,r),M.get().streaming.cmsd.enabled&&M.get().streaming.cmsd.abr.applyMb&&(n=function(e,r,n){if("video"!==r)return e;var i=b.getMaxBitrate(r);if(i<0)return e;var a=Y(n,"audio",V("audio",n));i-=a?a.bitrate/1e3:0;var s=z(c[n][r].getMediaInfo(),i,n);return t.debug("Stream ID: "+n+" ["+r+"] Apply max bit rate from CMSD: "+i),Math.min(e,s)}(n,e,r)),n}catch(e){return}}function $(e,t){try{return function(e,t){try{var r=T.getAbrBitrateParameter("minBitrate",e);if(r>-1){var n=c[t][e].getMediaInfo(),i=W(n),a=z(n,r,t);return i[a]&&a<i.length-1&&i[a].bitrate<1e3*r&&a++,a}return}catch(e){return}}(e,t)}catch(e){return}}function V(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return t||(t=n.getActiveStreamInfo().id),e&&c[t]&&c[t][e]&&t?(s[t]=s[t]||{},s[t].hasOwnProperty(e)||(s[t][e]=0),s[t][e]):0}catch(e){return 0}}function K(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t&&t.id&&e){var i=t.id,a=V(e,i);(0,j.SE)(r);var s=H(e,i);r!==a&&r>=0&&r<=s&&q(e,a,r,s,n,i)}}function q(e,r,n,i,a,o){if(e&&c[o]&&c[o][e]){var l=c[o][e].getStreamInfo(),d=l&&l.manifestInfo&&l.manifestInfo.isDynamic,f=O.getCurrentBufferLevel(e);t.info("Stream ID: "+o+" ["+e+"] switch from "+r+" to "+n+"/"+i+" (buffer: "+f+") "+(a?JSON.stringify(a):".")),s[o]=s[o]||{},s[o][e]=n;var h=Y(o,e,n);F.trigger(u.Z.QUALITY_CHANGE_REQUESTED,{oldQuality:r,newQuality:n,reason:a,streamInfo:l,bitrateInfo:h,maxIdx:i,mediaType:e},{streamId:l.id,mediaType:e});var g=D.getAverageThroughput(e,d);isNaN(g)||A.setSavedBitrateSettings(e,g)}}function Y(e,t,r){if(t&&c&&c[e]&&c[e][t]){var n=W(c[e][t].getMediaInfo());return n[r]?n[r]:null}return null}function z(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=e&&e.type?c[r][e.type].getRepresentationInfo():null;if(M.get().streaming.abr.useDeadTimeLatency&&n&&i&&i.fragmentDuration){n/=1e3;var a=i.fragmentDuration;if(n>a)return 0;t*=1-n/a}for(var s=W(e),o=s.length-1;o>=0;o--)if(1e3*t>=s[o].bitrate)return o;return 0}function W(e){var t=[];if(!e||!e.bitrateList)return t;for(var r,n=e.bitrateList,i=e.type,a=0,s=n.length;a<s;a++)(r=new kt).mediaType=i,r.qualityIndex=a,r.bitrate=n[a].bandwidth,r.width=n[a].width,r.height=n[a].height,r.scanType=n[a].scanType,t.push(r);return t}function X(){if(E){var e=M.get().streaming.abr.usePixelRatioInLimitBitrateByPortal&&window.hasOwnProperty("devicePixelRatio")?window.devicePixelRatio:1;m=E.getClientWidth()*e,v=E.getClientHeight()*e}}return e={initialize:function(){w=pi(k).create(),D=vi(k).create({settings:M}),(r=(0,li.Z)(k).create({dashMetrics:O,customParametersModel:S,mediaPlayerModel:T,settings:M})).initialize(),F.on(f.Z.QUALITY_CHANGE_RENDERED,Z,e),F.on(f.Z.METRIC_ADDED,G,e),F.on(u.Z.LOADING_PROGRESS,U,e)},isPlayingAtTopQuality:function(e){var t=e?e.id:null,r=V(a.Z.AUDIO,t),n=V(a.Z.VIDEO,t);return r===H(a.Z.AUDIO,t)&&n===H(a.Z.VIDEO,t)},updateTopQualityIndex:function(e){var t=e.type,r=e.streamInfo.id,n=e.representationCount-1;return i[r]=i[r]||{},i[r][t]=n,n},clearDataForStream:function(e){w&&w.clearForStream(e),c[e]&&delete c[e],R[e]&&delete R[e],h[e]&&delete h[e]},getThroughputHistory:function(){return D},getBitrateList:W,getQualityForBitrate:z,getTopBitrateInfoFor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(t||(t=n.getActiveStreamInfo().id),e&&c&&c[t]&&c[t][e]){var r=H(e,t),i=W(c[t][e].getMediaInfo());return i[r]?i[r]:null}return null},getMinAllowedIndexFor:$,getMaxAllowedIndexFor:H,getInitialBitrateFor:function(e,t){if(function(){if(!A||!A.hasOwnProperty("getSavedBitrateSettings"))throw new Error(a.Z.MISSING_CONFIG_ERROR)}(),e===a.Z.TEXT)return NaN;var r=A.getSavedBitrateSettings(e),n=T.getAbrBitrateParameter("initialBitrate",e),i=M.get().streaming.abr.initialRepresentationRatio[e];if(-1===n)if(i>-1){var s=c[t][e].getStreamInfo(),o=y.getAdaptationForType(s.index,e,s).Representation_asArray;n=Array.isArray(o)?o[Math.max(Math.round(o.length*i)-1,0)].bandwidth/1e3:0}else n=isNaN(r)?e===a.Z.VIDEO?1e3:100:r;return n},getQualityFor:V,getAbandonmentStateFor:function(e,t){return h[e]&&h[e][t]?h[e][t].state:null},setPlaybackQuality:K,checkPlaybackQuality:function(t,n){try{if(!(t&&c&&c[n]&&c[n][t]))return!1;if(w){var i=E.getPlaybackQuality();i&&w.push(n,I,i)}if(!M.get().streaming.abr.autoSwitchBitrate[t])return!1;var a=V(t,n),s=ci(k).create({abrController:e,switchHistory:R[n][t],droppedFramesHistory:w,streamProcessor:c[n][t],currentValue:a,useBufferOccupancyABR:C[t],useL2AABR:N[t],useLoLPABR:P[t],videoModel:E}),l=$(t,n),u=H(t,n),d=r.getMaxQuality(s),f=d.quality;return void 0!==l&&(f>di.Z.NO_CHANGE?f:a)<l&&(f=l),f>u&&(f=u),R[n][t].push({oldValue:a,newValue:f}),f>di.Z.NO_CHANGE&&f!==a&&(h[n][t].state===o.Z.ALLOW_LOAD||f<a)&&(q(t,a,f,u,d.reason,n),!0)}catch(e){return!1}},setElementSize:X,setWindowResizeEventCalled:function(e){p=e},registerStreamType:function(e,t){var r=t.getStreamInfo().id;c[r]||(c[r]={}),R[r]||(R[r]={}),h[r]||(h[r]={}),R[r][e]=hi(k).create(),c[r][e]=t,h[r][e]={},h[r][e].state=o.Z.ALLOW_LOAD,function(e){var t=M.get().streaming.abr.ABRStrategy;t===a.Z.ABR_STRATEGY_L2A?(C[e]=!1,P[e]=!1,N[e]=!0):t===a.Z.ABR_STRATEGY_LoLP?(C[e]=!1,P[e]=!0,N[e]=!1):t===a.Z.ABR_STRATEGY_BOLA?(C[e]=!0,P[e]=!1,N[e]=!1):t===a.Z.ABR_STRATEGY_THROUGHPUT?(C[e]=!1,P[e]=!1,N[e]=!1):t===a.Z.ABR_STRATEGY_DYNAMIC&&(C[e]=!(!C||!C[e])&&C[e],P[e]=!1,N[e]=!1)}(e),e===a.Z.VIDEO&&X()},unRegisterStreamType:function(e,t){try{c[e]&&c[e][t]&&delete c[e][t],R[e]&&R[e][t]&&delete R[e][t],h[e]&&h[e][t]&&delete h[e][t]}catch(e){}},setConfig:function(e){e&&(e.streamController&&(n=e.streamController),e.domStorage&&(A=e.domStorage),e.mediaPlayerModel&&(T=e.mediaPlayerModel),e.customParametersModel&&(S=e.customParametersModel),e.cmsdModel&&(b=e.cmsdModel),e.dashMetrics&&(O=e.dashMetrics),e.adapter&&(y=e.adapter),e.videoModel&&(E=e.videoModel),e.settings&&(M=e.settings))},reset:function(){B(),F.off(u.Z.LOADING_PROGRESS,U,e),F.off(f.Z.QUALITY_CHANGE_RENDERED,Z,e),F.off(f.Z.METRIC_ADDED,G,e),r&&r.reset()}},t=x.getLogger(e),B(),e}yi.__dashjs_factory_name="AbrController";var Ei=c.Z.getSingletonFactory(yi);Ei.QUALITY_DEFAULT=0,c.Z.updateSingletonFactory(yi.__dashjs_factory_name,Ei);var Ti=Ei,_i=new Map([[a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,"loadedmetadata"],[a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_CURRENT_DATA,"loadeddata"],[a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_FUTURE_DATA,"canplay"],[a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_ENOUGH_DATA,"canplaythrough"]]);function Si(){var e,t,r,n,i,s,o,c,f=this.context,h=(0,l.Z)(f).getInstance(),g=[];function p(){r&&(r.playbackRate=1,r.removeEventListener("canplay",p))}function m(){return g.length>0}function v(){if(r&&m()&&0===r.playbackRate){var e=document.createEvent("Event");e.initEvent("waiting",!0,!1),r.dispatchEvent(e)}}function y(e,t){r&&r.addEventListener(e,t)}function E(e,t){r&&r.removeEventListener(e,t)}function T(){return r?r.readyState:NaN}function _(){return r?r.buffered:null}function S(e,t,n,i,a){if(r)for(var s=0;s<r.textTracks.length;s++)if(r.textTracks[s].kind===e&&(!t||r.textTracks[s].label==t)&&r.textTracks[s].language===n&&r.textTracks[s].isTTML===i&&r.textTracks[s].isEmbedded===a)return r.textTracks[s];return null}function b(e,t){return e===a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_NOTHING||T()>=e?(t(),null):function(e,t){var r=function r(){E(e,r),t(e)};return y(e,r),{func:r,event:e}}(_i.get(e),t)}return e={addEventListener:y,addTextTrack:function(e,t,n,i,a){if(!r)return null;var s=S(e,t,n,i,a);return s||((s=r.addTextTrack(e,t,n)).isEmbedded=a,s.isTTML=i),s},appendChild:function(e){r&&(r.appendChild(e),void 0!==e.isTTML&&(r.textTracks[r.textTracks.length-1].isTTML=e.isTTML,r.textTracks[r.textTracks.length-1].isEmbedded=e.isEmbedded))},getBufferRange:_,getClientHeight:function(){return r?r.clientHeight:NaN},getClientWidth:function(){return r?r.clientWidth:NaN},getElement:function(){return r},getEnded:function(){return r?r.ended:null},getPlaybackQuality:function(){if(!r)return null;var e="webkitDroppedFrameCount"in r&&"webkitDecodedFrameCount"in r,t=null;return"getVideoPlaybackQuality"in r?t=r.getVideoPlaybackQuality():e&&(t={droppedVideoFrames:r.webkitDroppedFrameCount,totalVideoFrames:r.webkitDroppedFrameCount+r.webkitDecodedFrameCount,creationTime:new Date}),t},getPlaybackRate:function(){return r?r.playbackRate:null},getPlayedRanges:function(){return r?r.played:null},getReadyState:T,getSource:function(){return r?r.src:null},getTTMLRenderingDiv:function(){return s},getTextTrack:S,getTextTracks:function(){return r?r.textTracks:[]},getTime:function(){return r?isNaN(n)?r.currentTime:n:null},getVideoHeight:function(){return r?r.videoHeight:NaN},getVideoRelativeOffsetLeft:function(){if(r){var e=r.parentNode.host||r.parentNode;return e?r.getBoundingClientRect().left-e.getBoundingClientRect().left:NaN}return NaN},getVideoRelativeOffsetTop:function(){if(r){var e=r.parentNode.host||r.parentNode;return e?r.getBoundingClientRect().top-e.getBoundingClientRect().top:NaN}return NaN},getVideoWidth:function(){return r?r.videoWidth:NaN},getVttRenderingDiv:function(){return o},initialize:function(){h.on(u.Z.PLAYBACK_PLAYING,v,this)},isPaused:function(){return r?r.paused:null},isSeeking:function(){return r?r.seeking||!isNaN(n):null},isStalled:m,pause:function(){r&&(r.pause(),r.autoplay=!1)},play:function(){if(r){r.autoplay=!0;var e=r.play();e&&e.catch&&"undefined"!=typeof Promise&&e.catch(function(e){"NotAllowedError"===e.name&&h.trigger(u.Z.PLAYBACK_NOT_ALLOWED),t.warn("Caught pending play exception - continuing (".concat(e,")"))})}},removeChild:function(e){r&&r.removeChild(e)},removeEventListener:E,reset:function(){clearTimeout(c),h.off(u.Z.PLAYBACK_PLAYING,v,this)},setCurrentTime:function(e,t){r&&(i&&i.func&&i.event&&E(i.event,i.func),n=e,i=b(a.Z.VIDEO_ELEMENT_READY_STATES.HAVE_METADATA,function(){if(r)if(r.currentTime!==n)try{n=t?function(e){var t=_(),r=e,n=9999999999;if(t)for(var i=0;i<t.length;i++){var a=t.start(i),s=t.end(i),o=Math.abs(a-e),l=Math.abs(s-e);if(e>=a&&e<=s)return e;o<n&&(n=o,r=a),l<n&&(n=l,r=s)}return r}(n):n,isNaN(n)||(r.currentTime=n),n=NaN}catch(e){0===r.readyState&&e.code===e.INVALID_STATE_ERR&&(c=setTimeout(function(){r.currentTime=n,n=NaN},400))}else n=NaN}))},setElement:function(e){if(!(null==e||e&&/^(VIDEO|AUDIO)$/i.test(e.nodeName)))throw"element is not video or audio DOM type!";(r=e)&&(r.preload="auto")},setPlaybackRate:function(e){r&&(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&r.readyState<=2&&e>0?r.addEventListener("canplay",p):r.playbackRate=e)},setSource:function(e){r&&(e?r.src=e:(r.removeAttribute("src"),r.load()))},setStallState:function(e,t){!function(e,t){t?function(e){null!==e&&r&&!r.seeking&&-1===g.indexOf(e)&&g.push(e)}(e):function(e){var t=g.indexOf(e);null!==e&&-1!==t&&g.splice(t,1)}(e)}(e,t)},setTTMLRenderingDiv:function(e){(s=e).style.position="absolute",s.style.display="flex",s.style.overflow="hidden",s.style.pointerEvents="none",s.style.top=0,s.style.left=0},setVttRenderingDiv:function(e){o=e},waitForReadyState:b,setDisableRemotePlayback:function(e){r&&(r.disableRemotePlayback=e)}},t=(0,d.Z)(f).getInstance().getLogger(e),n=NaN,e}Si.__dashjs_factory_name="VideoModel";var bi=c.Z.getSingletonFactory(Si),Ai=[{oldKey:"dashjs_vbitrate",newKey:"dashjs_video_bitrate"},{oldKey:"dashjs_abitrate",newKey:"dashjs_audio_bitrate"},{oldKey:"dashjs_vsettings",newKey:"dashjs_video_settings"},{oldKey:"dashjs_asettings",newKey:"dashjs_audio_settings"}],Ii="dashjs_?_bitrate",Ri="dashjs_?_settings",wi="localStorage",Di="lastBitrate",Li="lastMediaSettings";function Ci(e){e=e||{};var t,r,n,i=this.context,s=e.settings;function o(e){if(void 0!==n)return n;var t;n=!1;try{"undefined"!=typeof window&&(t=window[e])}catch(e){return r.warn("DOMStorage access denied: "+e.message),n}if(!t||e!==wi)return n;try{t.setItem("1","1"),t.removeItem("1"),n=!0}catch(e){r.warn("DOMStorage is supported, but cannot be used: "+e.message)}return n}function l(){var e=6e5;return Math.round((new Date).getTime()/e)*e}function u(e,t){return o(e)&&s.get().streaming[t+"CachingInfo"].enabled}function c(){if(!s)throw new Error(a.Z.MISSING_CONFIG_ERROR)}return t={getSavedBitrateSettings:function(e){if(c(),!s.get().streaming.lastBitrateCachingInfo.enabled)return NaN;var t=NaN;if(u(wi,Di)){var n=Ii.replace(/\?/,e);try{var i=JSON.parse(localStorage.getItem(n))||{},a=(new Date).getTime()-parseInt(i.timestamp,10)>=s.get().streaming.lastBitrateCachingInfo.ttl||!1,o=parseFloat(i.bitrate);isNaN(o)||a?a&&localStorage.removeItem(n):(t=o,r.debug("Last saved bitrate for "+e+" was "+o))}catch(e){return null}}return t},setSavedBitrateSettings:function(e,t){if(u(wi,Di)&&t){var n=Ii.replace(/\?/,e);try{localStorage.setItem(n,JSON.stringify({bitrate:t.toFixed(3),timestamp:l()}))}catch(e){r.error(e.message)}}},getSavedMediaSettings:function(e){if(c(),!s.get().streaming.lastMediaSettingsCachingInfo.enabled)return null;var t=null;if(u(wi,Li)){var r=Ri.replace(/\?/,e);try{var n=JSON.parse(localStorage.getItem(r))||{},i=(new Date).getTime()-parseInt(n.timestamp,10)>=s.get().streaming.lastMediaSettingsCachingInfo.ttl||!1;t=n.settings,i&&(localStorage.removeItem(r),t=null)}catch(e){return null}}return t},setSavedMediaSettings:function(e,t){if(u(wi,Li)){var n=Ri.replace(/\?/,e);try{localStorage.setItem(n,JSON.stringify({settings:t,timestamp:l()}))}catch(e){r.error(e.message)}}}},r=(0,d.Z)(i).getInstance().getLogger(t),o(wi)&&Ai.forEach(function(e){var t=localStorage.getItem(e.oldKey);if(t){localStorage.removeItem(e.oldKey);try{localStorage.setItem(e.newKey,t)}catch(e){r.error(e.message)}}}),t}Ci.__dashjs_factory_name="DOMStorage";var Ni=c.Z.getSingletonFactory(Ci),Pi=r(2032),Oi=r(2011);function Mi(){var e,t,r,n,i,a,s,o,l,u,c,d,f,h=this.context;function g(e,r,i,a){var s=null,l=e?f.resolve(e.path):null,u=a||{init:!0,url:l?l.url:void 0,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,mediaType:r};t.debug("Start searching for initialization.");var c=y(u);o.load({request:c,success:function(t){if(u.bytesLoaded=u.range.end,!(s=n.findInitRange(t)))return u.range.end=u.bytesLoaded+u.bytesToLoad,g(e,r,i,u);e.range=s,i(e)},error:function(){i(e)}}),t.debug("Perform init search: "+u.url)}function m(e,r,i,a,s,l){if(i&&(void 0===i.start||void 0===i.end)){var u=i?i.toString().split("-"):null;i=u?{start:parseFloat(u[0]),end:parseFloat(u[1])}:null}s=s||v;var c=null,d=null,h=!!i,g=e?f.resolve(e.path):null,p={init:!1,url:g?g.url:void 0,range:h?i:{start:0,end:1500},searching:!h,bytesLoaded:l?l.bytesLoaded:0,bytesToLoad:1500,mediaType:r},E=y(p);o.load({request:E,success:function(i){var o=p.bytesToLoad,l=i.byteLength;if(p.bytesLoaded=p.range.end-p.range.start,c=n.parse(i),(d=c.getBox("sidx"))&&d.isComplete){var u,f,h=d.references;if(null!=h&&h.length>0&&(u=1===h[0].reference_type),u){var g,v,y,E;t.debug("Initiate multiple SIDX load."),p.range.end=p.range.start+d.size;var T=[],_=0,S=(d.offset||p.range.start)+d.size,b=function(t){t?(T=T.concat(t),++_>=v&&(T.sort(function(e,t){return e.startTime-t.startTime<0?-1:0}),s(T,e,a))):s(null,e,a)};for(g=0,v=h.length;g<v;g++)y=S,E=S+h[g].referenced_size-1,S+=h[g].referenced_size,m(e,r,{start:y,end:E},a,b,p)}else t.debug("Parsing segments from SIDX. representation "+r+" - id: "+e.id+" for range : "+p.range.start+" - "+p.range.end),f=function(e,t){for(var r,n,i,a,s=e.references,o=s.length,l=e.timescale,u=e.earliest_presentation_time,c=t.range.start+e.offset+e.first_offset+e.size,d=[],f=0;f<o;f++)i=s[f].subsegment_duration,a=s[f].referenced_size,(r=new Oi.Z).duration=i,r.startTime=u,r.timescale=l,n=c+a-1,r.mediaRange=c+"-"+n,d.push(r),u+=i,c+=a;return d}(d,p),s(f,e,a)}else{if(d)p.range.start=d.offset||p.range.start,p.range.end=p.range.start+(d.size||o);else{if(l<p.bytesLoaded)return void s(null,e,a);var A=c.getLastBox();A&&A.size?(p.range.start=A.offset+A.size,p.range.end=p.range.start+o):p.range.end+=o}m(e,r,p.range,a,null,p)}},error:function(){s(null,e,a)}}),t.debug("Perform SIDX load for type ".concat(r," : ").concat(p.url," with range ").concat(p.range.start," - ").concat(p.range.end))}function v(e,t,r){r({segments:e,representation:t,error:e?void 0:new S.Z(l.SEGMENT_BASE_LOADER_ERROR_CODE,l.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}function y(e){if(e.url){var t=new p.Z;return t.setInfo(e),t}}return e={setConfig:function(o){o.baseURLController&&(f=o.baseURLController),o.dashMetrics&&(a=o.dashMetrics),o.mediaPlayerModel&&(s=o.mediaPlayerModel),o.errHandler&&(r=o.errHandler),o.boxParser&&(n=o.boxParser),o.debug&&(t=o.debug.getLogger(e)),o.requestModifier&&(i=o.requestModifier),o.errors&&(l=o.errors),o.urlUtils&&(d=o.urlUtils),o.constants&&(u=o.constants),o.dashConstants&&(c=o.dashConstants)},initialize:function(){o=St(h).create({errHandler:r,dashMetrics:a,mediaPlayerModel:s,requestModifier:i,boxParser:n,errors:l,urlUtils:d,constants:u,dashConstants:c})},loadInitialization:function(e,t){return new Promise(function(r){g(e,t,r)})},loadSegments:function(e,t,r){return new Promise(function(n){m(e,t,r,n)})},reset:function(){o&&(o.abort(),o=null)}}}Mi.__dashjs_factory_name="SegmentBaseLoader";var ki=c.Z.getSingletonFactory(Mi);function xi(e){var t;e=e||{};var r=new DataView(e.data),n=0;function i(e,t){var i=!0,a=0;if(void 0===t&&(t=!1),e.tag>16777215?(r.getUint32(n)!==e.tag&&(i=!1),a=4):e.tag>65535?(256*r.getUint16(n)+r.getUint8(n+2)!==e.tag&&(i=!1),a=3):e.tag>255?(r.getUint16(n)!==e.tag&&(i=!1),a=2):(r.getUint8(n)!==e.tag&&(i=!1),a=1),!i&&e.required&&!t)throw new Error("required tag not found");return i&&(n+=a),i}function a(e){var t=1,i=128,a=-1,s=0,o=r.getUint8(n),l=0;for(l=0;l<8;l+=1){if((o&i)===i){s=void 0===e?o&~i:o,a=l;break}i>>=1}for(l=0;l<a;l+=1,t+=1)s=s<<8|255&r.getUint8(n+t);return n+=t,s}return t={getPos:function(){return n},setPos:function(e){n=e},consumeTag:i,consumeTagAndSize:function(e,t){var r=i(e,t);return r&&a(),r},parseTag:function(e){var r;return i(e),r=a(),t[e.parse](r)},skipOverElement:function(e,t){var r,s=i(e,t);return s&&(r=a(),n+=r),s},getMatroskaCodedNum:a,getMatroskaFloat:function(e){var t;switch(e){case 4:t=r.getFloat32(n),n+=4;break;case 8:t=r.getFloat64(n),n+=8}return t},getMatroskaUint:function(e){if(e>4)return function(e){for(var t=Math.floor(Number.MAX_SAFE_INTEGER/256),i=0,a=0;a<e;a+=1){if(i>t)throw new Error("Value exceeds safe integer limit");i*=256;var s=r.getUint8(n+a);if(i>Number.MAX_SAFE_INTEGER-s)throw new Error("Value exceeds safe integer limit");i+=s}return n+=e,i}(e);for(var t=0,i=0;i<e;i+=1)t<<=8,t|=255&r.getUint8(n+i);return n+=e,t>>>0},moreData:function(){return n<r.byteLength}}}xi.__dashjs_factory_name="EBMLParser";var Fi=c.Z.getClassFactory(xi);function Bi(){var e,t,r,n,i,s,o,l,u,c,d=this.context;function f(e){var t=new p.Z;return t.setInfo(e),t}return e={setConfig:function(r){if(!(r.baseURLController&&r.dashMetrics&&r.mediaPlayerModel&&r.errHandler))throw new Error(a.Z.MISSING_CONFIG_ERROR);c=r.baseURLController,s=r.dashMetrics,o=r.mediaPlayerModel,n=r.errHandler,u=r.errors,t=r.debug.getLogger(e),i=r.requestModifier},initialize:function(){l=St(d).create({errHandler:n,dashMetrics:s,mediaPlayerModel:o,requestModifier:i,errors:u})},loadInitialization:function(e,r){return new Promise(function(n){var i=null,a=e?c.resolve(e.path):null,s=e?e.range.split("-"):null,o={range:{start:s?parseFloat(s[0]):null,end:s?parseFloat(s[1]):null},request:i,url:a?a.url:void 0,init:!0,mediaType:r};t.info("Start loading initialization."),i=f(o),l.load({request:i,success:function(){n(e)},error:function(){n(e)}}),t.debug("Perform init load: "+o.url)})},loadSegments:function(e,n,i){return new Promise(function(a){var s=null,o=e?c.resolve(e.path):null,h=o?o.url:void 0;s=f({bytesLoaded:0,bytesToLoad:8192,range:{start:0,end:8192},request:s,url:h,init:!1,mediaType:n}),t.debug("Parsing ebml header"),l.load({request:s,success:function(n){!function(e,n,i,a){if(e&&0!==e.byteLength){var s,o,u,c,h=Fi(d).create({data:e}),g=i?i.split("-"):null,p=null,m={url:n,range:{start:g?parseFloat(g[0]):null,end:g?parseFloat(g[1]):null},request:p};for(t.debug("Parse EBML header: "+m.url),h.skipOverElement(r.EBML),h.consumeTag(r.Segment),u=h.getMatroskaCodedNum(),u+=h.getPos(),c=h.getPos();h.moreData()&&!h.consumeTagAndSize(r.Segment.Info,!0);)if(!(h.skipOverElement(r.Segment.SeekHead,!0)||h.skipOverElement(r.Segment.Tracks,!0)||h.skipOverElement(r.Segment.Cues,!0)||h.skipOverElement(r.Void,!0)))throw new Error("no valid top level element found");for(;void 0===s;){var v=h.getMatroskaCodedNum(!0),y=h.getMatroskaCodedNum();v===r.Segment.Info.Duration.tag?s=h[r.Segment.Info.Duration.parse](y):h.setPos(h.getPos()+y)}p=f(m),l.load({request:p,success:function(e){o=function(e,n,i,a){var s,o,l,u,c,f,h,g;for(l=[],c=0,f=(o=function(e){var t,n,i=[],a=Fi(d).create({data:e});for(a.consumeTagAndSize(r.Segment.Cues);a.moreData()&&a.consumeTagAndSize(r.Segment.Cues.CuePoint,!0);){for((t={}).CueTime=a.parseTag(r.Segment.Cues.CuePoint.CueTime),t.CueTracks=[];a.moreData()&&a.consumeTag(r.Segment.Cues.CuePoint.CueTrackPositions,!0);){var s=a.getMatroskaCodedNum(),o=a.getPos();if((n={}).Track=a.parseTag(r.Segment.Cues.CuePoint.CueTrackPositions.CueTrack),0===n.Track)throw new Error("Cue track cannot be 0");n.ClusterPosition=a.parseTag(r.Segment.Cues.CuePoint.CueTrackPositions.CueClusterPosition),t.CueTracks.push(n),a.setPos(o+s)}if(0===t.CueTracks.length)throw new Error("Mandatory cuetrack not found");i.push(t)}if(0===i.length)throw new Error("mandatory cuepoint not found");return i}(e)).length;c<f;c+=1)u=new Oi.Z,s=c<o.length-1?o[c+1].CueTime-o[c].CueTime:a-o[c].CueTime,u.duration=s,u.startTime=o[c].CueTime,u.timescale=1e3,h=o[c].CueTracks[0].ClusterPosition+n,g=c<o.length-1?o[c+1].CueTracks[0].ClusterPosition+n-1:i-1,u.mediaRange=h+"-"+g,l.push(u);return t.debug("Parsed cues: "+l.length+" cues."),l}(e,c,u,s),a(o)},error:function(){t.error("Download Error: Cues "+m.url),a(null)}}),t.debug("Perform cues load: "+m.url+" bytes="+m.range.start+"-"+m.range.end)}else a(null)}(n,h,i,function(t){a({segments:t,representation:e,error:t?void 0:new S.Z(u.SEGMENT_BASE_LOADER_ERROR_CODE,u.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})})},error:function(){a({representation:e,error:new S.Z(u.SEGMENT_BASE_LOADER_ERROR_CODE,u.SEGMENT_BASE_LOADER_ERROR_MESSAGE)})}})})},reset:function(){l&&(l.abort(),l=null)}},r={EBML:{tag:440786851,required:!0},Segment:{tag:408125543,required:!0,SeekHead:{tag:290298740,required:!0},Info:{tag:357149030,required:!0,TimecodeScale:{tag:2807729,required:!0,parse:"getMatroskaUint"},Duration:{tag:17545,required:!0,parse:"getMatroskaFloat"}},Tracks:{tag:374648427,required:!0},Cues:{tag:475249515,required:!0,CuePoint:{tag:187,required:!0,CueTime:{tag:179,required:!0,parse:"getMatroskaUint"},CueTrackPositions:{tag:183,required:!0,CueTrack:{tag:247,required:!0,parse:"getMatroskaUint"},CueClusterPosition:{tag:241,required:!0,parse:"getMatroskaUint"}}}}},Void:{tag:236,required:!0}},e}Bi.__dashjs_factory_name="WebmSegmentBaseLoader";var Ui=c.Z.getSingletonFactory(Bi);function Zi(e){e=e||{};var t,r,n,i=this.context,a=e.eventBus,s=e.events,o=e.dashMetrics,l=e.mediaPlayerModel,u=e.errHandler,c=e.baseURLController,d=e.debug,f=e.boxParser,h=e.requestModifier,g=e.errors;function p(e){return"webm"===(e?e.split("/")[1]:"").toLowerCase()}return t={initialize:function(){r.initialize(),n.initialize()},getSegmentBaseInitSegment:function(e){return p(e.representation.mimeType)?n.loadInitialization(e.representation,e.mediaType):r.loadInitialization(e.representation,e.mediaType)},getSegmentList:function(e){return p(e.mimeType)?n.loadSegments(e.representation,e.mediaType,e.representation?e.representation.indexRange:null):r.loadSegments(e.representation,e.mediaType,e.representation?e.representation.indexRange:null)},reset:function(){r.reset(),n.reset()}},r=ki(i).getInstance(),n=Ui(i).getInstance(),r.setConfig({baseURLController:c,dashMetrics:o,mediaPlayerModel:l,errHandler:u,eventBus:a,events:s,errors:g,debug:d,boxParser:f,requestModifier:h}),n.setConfig({baseURLController:c,dashMetrics:o,mediaPlayerModel:l,errHandler:u,eventBus:a,events:s,errors:g,debug:d,requestModifier:h}),t}Zi.__dashjs_factory_name="SegmentBaseController";var Gi=c.Z.getSingletonFactory(Zi),Hi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.quality=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},$i=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.representationCount=0,this.labels=null,this.lang=null,this.viewpoint=null,this.viewpointsWithSchemeIdUri=null,this.accessibility=null,this.accessibilitiesWithSchemeIdUri=null,this.audioChannelConfiguration=null,this.audioChannelConfigurationsWithSchemeIdUri=null,this.roles=null,this.rolesWithSchemeIdUri=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null,this.isFragmented=null,this.isEmbedded=null,this.selectionPriority=1,this.supplementalProperties={},this.supplementalPropertiesAsArray=[],this.essentialProperties={},this.essentialPropertiesAsArray=[],this.segmentAlignment=!1,this.subSegmentAlignment=!1},Vi=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0},Ki=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dvrWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null,this.serviceDescriptions=[],this.protocol=null};function qi(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Yi=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.valid="/"==t[0],this.path=t.split("/").filter(function(e){return 0!==e.length}).map(function(e){var t={name:e},n=e.indexOf("[");if(-1!=n){t.name=e.substring(0,n);var i=e.substring(n+1,e.length-1);r.valid=r.valid&&-1==i.indexOf("[");var a=i.indexOf("=");-1!=a?(t.attribute={name:i.substring(1,a),value:i.substring(a+1)},-1!=["'",'"'].indexOf(t.attribute.value[0])&&(t.attribute.value=t.attribute.value.substring(1,t.attribute.value.length-1))):t.position=parseInt(i,10)-1}return t})}var t;return(t=[{key:"isValid",value:function(){return this.valid}},{key:"findsElement",value:function(){return!this.findsAttribute()}},{key:"findsAttribute",value:function(){return this.path[this.path.length-1].name.startsWith("@")}},{key:"findsTextReplace",value:function(){return"text()"===this.path[this.path.length-1].name}},{key:"getMpdTarget",value:function(e,t){for(var r=null,n=e,i=1,a="MPD";i<this.path.length&&null!==n;){r=n;var s=this.path[i];if(a=s.name,i!==this.path.length-1||!a.startsWith("@")&&"text()"!==a){var o=r[a+"_asArray"]||[];0===o.length&&r[a]&&o.push(r[a]),s.position?n=o[s.position]||null:s.attribute?function(){var e=s.attribute;n=o.filter(function(t){return t[e.name]==e.value})[0]||null}():n=o[0]||null}i++}return null===n?null:a.startsWith("@")?{name:a.substring(1),leaf:n,target:n}:"text()"===a?{name:"__text",leaf:n,target:n}:{name:a,leaf:n,target:t?r:n}}}])&&qi(e.prototype,t),e}();function ji(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var zi=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=t,this.xpath=r,this.value=n,this.position=null}var t;return(t=[{key:"getMpdTarget",value:function(e){var t="remove"===this.action||"replace"===this.action||"before"===this.position||"after"===this.position;return this.xpath.getMpdTarget(e,t)}}])&&ji(e.prototype,t),e}();function Wi(){var e,t,r=this.context;return e={getIsPatch:function(e){return e&&e.hasOwnProperty(s.Z.ORIGINAL_MPD_ID)||!1},getPublishTime:function(e){return e&&e.hasOwnProperty(s.Z.PUBLISH_TIME)?new Date(e[s.Z.PUBLISH_TIME]):null},getOriginalPublishTime:function(e){return e&&e.hasOwnProperty(s.Z.ORIGINAL_PUBLISH_TIME)?new Date(e[s.Z.ORIGINAL_PUBLISH_TIME]):null},getMpdId:function(e){return e&&e[s.Z.ORIGINAL_MPD_ID]||null},getPatchOperations:function(e){return e?(e.__children||[]).map(function(e){var r=Object.keys(e)[0];if("add"!==r&&"remove"!==r&&"replace"!==r)return t.warn("Ignoring node of invalid action: ".concat(r)),null;var n=e[r],i=n.sel;if("add"===r&&n.type){if(!n.type.startsWith("@"))return t.warn("Ignoring add action for prefixed namespace declaration: ".concat(n.type,"=").concat(n.__text)),null;i="".concat(i,"/").concat(n.type)}var a=new Yi(i);if(!a.isValid())return t.warn("Ignoring action with invalid selector: ".concat(r," - ").concat(i)),null;var s=null;a.findsAttribute()||a.findsTextReplace()?s=n.__text||"":"remove"!==r&&(s=n.__children.reduce(function(e,t){var r=Object.keys(t)[0];return"#text"!==r&&(e[r]=e[r]||[],e[r].push(t[r])),e},{}));var o=new zi(r,a,s);return"add"===r&&(o.position=n.pos),o}).filter(function(e){return!!e}):[]}},t=(0,d.Z)(r).getInstance().getLogger(e),e}Wi.__dashjs_factory_name="PatchManifestModel";var Xi=c.Z.getSingletonFactory(Wi);function Qi(){var e,t,r,n,i,a,o,l=this.context;function u(e,r,a){var o,l=t.getAdaptationsForType(n[0].mpd.manifest,e,r);if(!l||0===l.length)return null;if(l.length>1&&a){var u=f(a,r);if(i[a.id]&&i[a.id][r])for(var d=0,h=l.length;d<h;d++)if(c(i[a.id][r],u[d]))return l[d];for(var g=0,p=l.length;g<p;g++)if(o=l[g],t.getRolesForAdaptation(o).filter(function(e){return e.value===s.Z.MAIN})[0])return l[g]}return l[0]}function c(e,t){if(!e||!t)return!1;var r=e.id===t.id,n=e.codec===t.codec,i=e.viewpoint===t.viewpoint,a=JSON.stringify(e.viewpointsWithSchemeIdUri)===JSON.stringify(t.viewpointsWithSchemeIdUri),s=e.lang===t.lang,o=e.roles.toString()===t.roles.toString(),l=JSON.stringify(e.rolesWithSchemeIdUri)===JSON.stringify(t.rolesWithSchemeIdUri),u=e.accessibility.toString()===t.accessibility.toString(),c=JSON.stringify(e.accessibilitiesWithSchemeIdUri)===JSON.stringify(t.accessibilitiesWithSchemeIdUri),d=e.audioChannelConfiguration.toString()===t.audioChannelConfiguration.toString(),f=JSON.stringify(e.audioChannelConfigurationsWithSchemeIdUri)===JSON.stringify(t.audioChannelConfigurationsWithSchemeIdUri);return r&&n&&i&&a&&s&&o&&l&&u&&c&&d&&f}function d(e,r,n,i,s,o){var l,u,c,d,f,h,g=[];if(!i||0===i.length)return[];var p=t.getAdaptationsForPeriod(r);for(d=0,h=i.length;d<h;d++)if(l=i[d],u=E(p[c=t.getIndexForAdaptation(l,e,n.index)]),o){var m=u.accessibility.length;for(f=0;f<m;f++)if(u){var v=u.accessibility[f];if(0===v.indexOf("cea-608:")){var y=v.substring(8).split(";");if("CC"===y[0].substring(0,2))for(f=0;f<y.length;f++)u||(u=E.call(this,p[c])),T(u,y[f].substring(0,3),y[f].substring(4)),g.push(u),u=null;else for(f=0;f<y.length;f++)u||(u=E.call(this,p[c])),T(u,"CC"+(f+1),y[f]),g.push(u),u=null}else 0===v.indexOf("cea-608")&&(T(u,a.CC1,"eng"),g.push(u),u=null)}}else s===a.IMAGE?(u.type=a.IMAGE,g.push(u),u=null):u&&g.push(u);return g}function f(e,r,i){var s=n,o=i,l=[];if(o)S(),s=h(o);else{if(!(n.length>0))return l;o=n[0].mpd.manifest}var u=y(e,s),c=t.getAdaptationsForType(o,e?e.index:null,r);return l=d(o,u,e,c,r),r===a.TEXT&&(c=t.getAdaptationsForType(o,e?e.index:null,a.VIDEO),l=l.concat(d(o,u,e,c,r,!0))),l}function h(e){var r=g(e);return t.getRegularPeriods(r)}function g(e){var r=m(e);return t.getMpd(r)}function p(){n=[],i={}}function m(e){return e||(n.length>0?n[0].mpd.manifest:null)}function v(e){try{var r=y(e.streamInfo,n),i=t.getAdaptationsForPeriod(r);return e&&e.streamInfo&&void 0!==e.streamInfo.id&&i?i[e.index]:null}catch(e){return null}}function y(e,t){for(var r=t.length,n=0;n<r;n++){var i=t[n];if(e&&e.id===i.id)return i}return null}function E(e){if(!e)return null;var r,n,i,a,s,l=new $i,u=e.period.mpd.manifest.Period_asArray[e.period.index].AdaptationSet_asArray[e.index];if(l.id=e.id,l.index=e.index,l.type=e.type,l.streamInfo=_(e.period),l.representationCount=t.getRepresentationCount(u),l.labels=t.getLabelsForAdaptation(u),l.lang=t.getLanguageForAdaptation(u),l.segmentAlignment=t.getSegmentAlignment(u),l.subSegmentAlignment=t.getSubSegmentAlignment(u),r=t.getViewpointForAdaptation(u),l.viewpoint=r.length?r[0].value:void 0,l.viewpointsWithSchemeIdUri=r,s=t.getAccessibilityForAdaptation(u),l.accessibility=s.map(function(e){var t=e.value,r=t;return e.schemeIdUri&&e.schemeIdUri.search("cea-608")>=0&&void 0!==o&&(r=t?"cea-608:"+t:"cea-608",l.embeddedCaptions=!0),r}),l.accessibilitiesWithSchemeIdUri=s,n=t.getAudioChannelConfigurationForAdaptation(u),l.audioChannelConfiguration=n.map(function(e){return e.value}),l.audioChannelConfigurationsWithSchemeIdUri=n,0===l.audioChannelConfiguration.length&&Array.isArray(u.Representation_asArray)&&u.Representation_asArray.length>0&&(i=t.getAudioChannelConfigurationForRepresentation(u.Representation_asArray[0]),l.audioChannelConfiguration=i.map(function(e){return e.value}),l.audioChannelConfigurationsWithSchemeIdUri=i),a=t.getRolesForAdaptation(u),l.roles=a.map(function(e){return e.value}),l.rolesWithSchemeIdUri=a,l.codec=t.getCodec(u),l.mimeType=t.getMimeType(u),l.contentProtection=t.getContentProtectionData(u),l.bitrateList=t.getBitrateListForAdaptation(u),l.selectionPriority=t.getSelectionPriority(u),l.contentProtection){var c=l.contentProtection.map(function(e){return t.getKID(e)}).filter(function(e){return null!==e});if(c.length){var d=c[0];l.contentProtection.forEach(function(e){e.keyId=d})}}if(l.isText=t.getIsText(u),l.supplementalProperties=t.getSupplementalPropertiesForAdaptation(u),(!l.supplementalProperties||0===Object.keys(l.supplementalProperties).length)&&Array.isArray(u.Representation_asArray)&&u.Representation_asArray.length>0){var f=u.Representation_asArray.map(function(e){return t.getSupplementalPropertiesForRepresentation(e)});f.every(function(e){return JSON.stringify(e)===JSON.stringify(f[0])})&&(l.supplementalProperties=f[0])}if(l.supplementalPropertiesAsArray=t.getSupplementalPropertiesAsArrayForAdaptation(u),(!l.supplementalPropertiesAsArray||0===l.supplementalPropertiesAsArray.length)&&Array.isArray(u.Representation_asArray)&&u.Representation_asArray.length>0){var h=u.Representation_asArray.map(function(e){return t.getSupplementalPropertiesAsArrayForRepresentation(e)});h.every(function(e){return JSON.stringify(e)===JSON.stringify(h[0])})&&(l.supplementalPropertiesAsArray=h[0])}return l.essentialProperties=t.getEssentialPropertiesForAdaptation(u),l.essentialPropertiesAsArray=t.getEssentialPropertiesAsArrayForAdaptation(u),l.isFragmented=t.getIsFragmented(u),l.isEmbedded=!1,l}function T(e,t,r){e.id=t,e.index=100+parseInt(t.substring(2,3)),e.type=a.TEXT,e.codec="cea-608-in-SEI",e.isEmbedded=!0,e.isFragmented=!1;var n=Er()(r);e.lang=n||r,e.roles=["caption"],e.rolesWithSchemeIdUri=[{schemeIdUri:"urn:mpeg:dash:role:2011",value:"caption"}]}function _(e){var r,n,i=new Vi;return i.id=e.id,i.index=e.index,i.start=e.start,i.duration=e.duration,i.manifestInfo=(r=e.mpd,(n=new Ki).dvrWindowSize=r.timeShiftBufferDepth,n.loadedTime=r.manifest.loadedTime,n.availableFrom=r.availabilityStartTime,n.minBufferTime=r.manifest.minBufferTime,n.maxFragmentDuration=r.maxSegmentDuration,n.duration=t.getDuration(r.manifest),n.isDynamic=t.getIsDynamic(r.manifest),n.serviceDescriptions=t.getServiceDescriptions(r.manifest),n.protocol=r.manifest.protocol,n),i.isLast=1===e.mpd.manifest.Period_asArray.length||Math.abs(i.start+i.duration-i.manifestInfo.duration)<1,i}function S(){if(!a)throw new Error("setConfig function has to be called previously")}function b(e){return n.length>0?n[0].mpd.manifest.Period_asArray[e]:null}function A(e,t,r){var n,i,a,s,o;if(e)for(n=e.AdaptationSet_asArray,s=0;s<n.length;s+=1)for(a=n[s].Representation_asArray,o=0;o<a.length;o+=1)if(t===(i=a[o]).id)return r?o:i;return null}return e={getBandwidthForRepresentation:function(e,t){var r;return(r=A(b(t),e))?r.bandwidth:null},getIndexForRepresentation:function(e,t){return function(e,t){var r=A(e,t,!0);return null!==r?r:-1}(b(t),e)},getMaxIndexForBufferType:function(e,r){return function(e,r){var n,i,a,s;if(!e||!r)return-1;for(i=e.AdaptationSet_asArray,s=0;s<i.length;s+=1)if(a=(n=i[s]).Representation_asArray,t.getIsTypeOf(n,r))return a.length;return-1}(b(r),e)},convertRepresentationToRepresentationInfo:function(e){if(e){var r=new Hi,n=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],i=t.getRepresentationFor(e.index,n);return r.id=e.id,r.quality=e.index,r.bandwidth=t.getBandwidth(i),r.fragmentDuration=e.segmentDuration||(e.segments&&e.segments.length>0?e.segments[0].duration:NaN),r.MSETimeOffset=e.MSETimeOffset,r.mediaInfo=E(e.adaptation),r}return null},getStreamsInfo:function(e,t){var r=[],i=n;if(e&&(S(),i=h(e)),i.length>0){(!t||t>i.length)&&(t=i.length);for(var a=0;a<t;a++)r.push(_(i[a]))}return r},getMediaInfoForType:function(e,r){if(0===n.length||!e)return null;var i=y(e,n);if(!i)return null;var a=t.getAdaptationsForPeriod(i),s=u(e.index,r,e);return s?E(a[t.getIndexForAdaptation(s,n[0].mpd.manifest,e.index)]):null},getAllMediaInfoForType:f,getAdaptationForType:u,getRealAdaptation:function(e,r){var i,a,s=y(e,n);return i=r?r.id:null,n.length>0&&s&&(a=i?t.getAdaptationForId(i,n[0].mpd.manifest,s.index):t.getAdaptationForIndex(r?r.index:null,n[0].mpd.manifest,s.index)),a},getProducerReferenceTimes:function(e,r){var i,a,s=y(e,n);return i=r?r.id:null,n.length>0&&s&&(a=i?t.getAdaptationForId(i,n[0].mpd.manifest,s.index):t.getAdaptationForIndex(r?r.index:null,n[0].mpd.manifest,s.index)),a?t.getProducerReferenceTimesForAdaptation(a):[]},getRealPeriodByIndex:function(e){return t.getRealPeriodForIndex(e,n[0].mpd.manifest)},getEssentialPropertiesForRepresentation:function(e){try{return t.getEssentialPropertiesForRepresentation(e)}catch(e){return[]}},getVoRepresentations:function(e){var r=v(e);return t.getRepresentationsForAdaptation(r)},getEventsFor:function(e,r,i){var a=[];if(n.length>0){var s=n[0].mpd.manifest;if(e instanceof Vi){var o=y(e,n);a=t.getEventsForPeriod(o)}else if(e instanceof $i){var l=y(i,n);a=t.getEventStreamForAdaptationSet(s,v(e),l)}else if(e instanceof Hi){var u=y(i,n);a=t.getEventStreamForRepresentation(s,r,u)}}return a},getEvent:function(e,t,r,n){try{if(!e||!t||isNaN(r)||!n)return null;var i=e.scheme_id_uri,a=e.value;if(!t[i+"/"+a])return null;var s,o=new Te,l=e.timescale||1,u=n.adaptation.period.start,c=t[i+"/"+a],d=isNaN(n.presentationTimeOffset)?isNaN(c.presentationTimeOffset)?0:c.presentationTimeOffset:n.presentationTimeOffset,f=e.presentation_time_delta/l;s=0===e.version?u+r-d+f:u-d+f;var h=e.event_duration/l,g=e.id,p=e.message_data;return o.eventStream=c,o.eventStream.value=a,o.eventStream.timescale=l,o.duration=h,o.id=g,o.calculatedPresentationTime=s,o.messageData=p,o.presentationTimeDelta=f,o}catch(e){return null}},getMpd:g,setConfig:function(e){e&&(e.constants&&(a=e.constants),e.cea608parser&&(o=e.cea608parser),e.errHandler&&t.setConfig({errHandler:e.errHandler}),e.BASE64&&t.setConfig({BASE64:e.BASE64}))},updatePeriods:function(e){if(!e)return null;S(),n=h(e)},getIsTextTrack:function(e){return t.getIsText(e)},getUTCTimingSources:function(){var e=m();return t.getUTCTimingSources(e)},getSuggestedPresentationDelay:function(){var e=n.length>0?n[0].mpd:null;return t.getSuggestedPresentationDelay(e)},getAvailabilityStartTime:function(e){var r=g(e);return t.getAvailabilityStartTime(r)},getIsTypeOf:function(e,r){return t.getIsTypeOf(e,r)},getIsDynamic:function(e){var r=m(e);return t.getIsDynamic(r)},getDuration:function(e){var r=m(e);return t.getDuration(r)},getRegularPeriods:h,getContentSteering:function(e){return t.getContentSteering(e)},getLocation:function(e){return t.getLocation(e)},getPatchLocation:function(e){var r=t.getPatchLocation(e),n=t.getPublishTime(e);return r&&0!==r.length&&n?r.filter(function(e){return isNaN(e.ttl)||n.getTime()+e.ttl>(new Date).getTime()}):[]},getManifestUpdatePeriod:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.getManifestUpdatePeriod(e,r)},getPublishTime:function(e){return t.getPublishTime(e)},getIsDVB:function(e){return t.hasProfile(e,"urn:dvb:dash:profile:dvb-dash:2014")},getIsPatch:function(e){return r.getIsPatch(e)},getBaseURLsFromElement:function(e){return t.getBaseURLsFromElement(e)},getRepresentationSortFunction:function(){return t.getRepresentationSortFunction()},getCodec:function(e,r,n){return t.getCodec(e,r,n)},getPeriodById:function(e){if(!e||0===n.length)return null;var t=n.filter(function(t){return t.id===e});return t&&t.length>0?t[0]:null},setCurrentMediaInfo:function(e,t,r){i[e]=i[e]||{},i[e][t]=i[e][t]||{},i[e][t]=r},isPatchValid:function(e,n){var i=t.getId(e),a=r.getMpdId(n),s=t.getPublishTime(e),o=r.getPublishTime(n),l=r.getOriginalPublishTime(n);return!!(i&&a&&i==a&&s&&l&&s.getTime()==l.getTime()&&o&&s.getTime()<o.getTime())},applyPatchToManifest:function(e,t){r.getPatchOperations(t).forEach(function(t){var r=t.getMpdTarget(e);if(null!==r){var n=r.name,i=r.target,a=r.leaf;if(t.xpath.findsAttribute()||"__text"===n)switch(t.action){case"add":case"replace":i[n]=t.value;break;case"remove":delete i[n]}else{var s=(i[n+"_asArray"]||[]).indexOf(a),o="prepend"===t.position||"before"===t.position;if(("remove"===t.action||"replace"===t.action)&&(delete i[n],-1!=s)){var l=i[n+"_asArray"];l.splice(s,1),l.length>1?i[n]=l:1==l.length?i[n]=l[0]:delete i[n+"_asArray"]}"add"!==t.action&&"replace"!==t.action||Object.keys(t.value).forEach(function(e){var r=t.value[e],a=i[e+"_asArray"]||[];if(0===a.length&&i[e]&&a.push(i[e]),0===a.length)a=r;else{var l=a.length;l=e==n&&-1!=s?s+(o?0:1)+("replace"==t.action?-1:0):o?0:a.length,a.splice.apply(a,[l,0].concat(r))}i[e+"_asArray"]=a,i[e]=1==a.length?a[0]:a})}}})},areMediaInfosEqual:c,reset:p},t=He(l).getInstance(),r=Xi(l).getInstance(),p(),e}Qi.__dashjs_factory_name="DashAdapter";var Ji=c.Z.getSingletonFactory(Qi);function ea(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ta=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return t=[{key:"round10",value:function(e,t){return function(e,t,r){return void 0===r||0==+r?Math[e](t):(r=+r,null===(t=+t)||isNaN(t)||"number"!=typeof r||r%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-r:-r)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+r:r))))}("round",e,t)}}],t&&ea(e,t),e}(),ra=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TcpList=[],this.HttpList=[],this.RepSwitchList=[],this.BufferLevel=[],this.BufferState=[],this.PlayList=[],this.DroppedFrames=[],this.SchedulingInfo=[],this.DVRInfo=[],this.ManifestUpdate=[],this.RequestsQueue=null,this.DVBErrors=[]},na=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.mt=null,this.to=null,this.lto=null},ia=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.t=null,this.level=null},aa=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.target=null,this.state=o.Z.BUFFER_EMPTY},sa=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.range=null,this.manifestInfo=null},oa=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.time=null,this.droppedFrames=null};function la(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var ua=function e(){la(this,e),this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.representationInfo=[]},ca=function e(){la(this,e),this.id=null,this.index=null,this.start=null,this.duration=null},da=function e(){la(this,e),this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},fa=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},ha=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.loadingRequests=[],this.executedRequests=[]};function ga(e){var t,r,n=(e=e||{}).settings,i=this.context,s=(0,l.Z)(i).getInstance();function c(){s.trigger(u.Z.METRICS_CHANGED)}function d(e){s.trigger(u.Z.METRIC_CHANGED,{mediaType:e}),c()}function f(e,t,r){s.trigger(u.Z.METRIC_UPDATED,{mediaType:e,metric:t,value:r}),d(e)}function h(e,t,r){s.trigger(u.Z.METRIC_ADDED,{mediaType:e,metric:t,value:r}),d(e)}function g(e,t){var n=null;return e?(r.hasOwnProperty(e)?n=r[e]:t||(n=new ra,r[e]=n),n):n}function p(e,t,r){var i=g(e);null!==i&&(i[t].push(r),i[t].length>n.get().streaming.metrics.maxListDepth&&i[t].shift())}function m(e,t,r){p(e,t,r),h(e,t,r)}return t={clearCurrentMetricsForType:function(e){delete r[e],d(e)},clearAllCurrentMetrics:function(){r={},c()},getMetricsFor:g,addHttpRequest:function e(t,r,n,i,a,s,l,u,c,d,f,h,g,p,v,y,E){var T=new L.w;null!=s&&s!==i&&(e(t,null,n,i,a,null,null,u,c,null,null,null,g,null,null,y,E),T.actualurl=s),T.tcpid=r,T.type=n,T.url=i,T.range=u,T.trequest=c,T.tresponse=d,T.responsecode=h,T.cmsd=E,T._tfinish=f,T._stream=t,T._mediaduration=g,T._quality=a,T._responseHeaders=p,T._serviceLocation=l,T._fileLoaderType=y,v?v.forEach(function(e){!function(e,t,r,n){var i=new L.O;i.s=t,i.d=r,i.b=n,e.trace.push(i),e.interval||(e.interval=0),e.interval+=r}(T,e.s,e.d,e.b)}):(delete T.interval,delete T.trace),m(t,o.Z.HTTP_REQUEST,T)},addRepresentationSwitch:function(e,t,r,n,i){var a=new na;a.t=t,a.mt=r,a.to=n,i?a.lto=i:delete a.lto,m(e,o.Z.TRACK_SWITCH,a)},addBufferLevel:function(e,t,r){var n=new ia;n.t=t,n.level=r,m(e,o.Z.BUFFER_LEVEL,n)},addBufferState:function(e,t,r){var n=new aa;n.target=r,n.state=t,m(e,o.Z.BUFFER_STATE,n)},addDVRInfo:function(e,t,r,n){var i=new sa;i.time=t,i.range=n,i.manifestInfo=r,m(e,o.Z.DVR_INFO,i)},addDroppedFrames:function(e,t){var r=new oa,n=g(e).DroppedFrames;t&&(r.time=t.creationTime,r.droppedFrames=t.droppedVideoFrames,n.length>0&&n[n.length-1]==r||m(e,o.Z.DROPPED_FRAMES,r))},addSchedulingInfo:function(e,t,r,n,i,a,s,l,u){var c=new fa;c.mediaType=e,c.t=t,c.type=r,c.startTime=n,c.availabilityStartTime=i,c.duration=a,c.quality=s,c.range=l,c.state=u,m(e,o.Z.SCHEDULING_INFO,c)},addRequestsQueue:function(e,t,r){var n=new ha;n.loadingRequests=t,n.executedRequests=r,g(e).RequestsQueue=n,h(e,o.Z.REQUESTS_QUEUE,n)},addManifestUpdate:function(e,t,r,n,i,s,l,u,c,d){var f=new ua;f.mediaType=e,f.type=t,f.requestTime=r,f.fetchTime=n,f.availabilityStartTime=i,f.presentationStartTime=s,f.clientTimeOffset=l,f.currentTime=u,f.buffered=c,f.latency=d,p(a.Z.STREAM,o.Z.MANIFEST_UPDATE,f),h(e,o.Z.MANIFEST_UPDATE,f)},updateManifestUpdateInfo:function(e,t){if(e){for(var r in t)e[r]=t[r];f(e.mediaType,o.Z.MANIFEST_UPDATE,e)}},addManifestUpdateStreamInfo:function(e,t,r,n,i){if(e){var a=new ca;a.id=t,a.index=r,a.start=n,a.duration=i,e.streamInfo.push(a),f(e.mediaType,o.Z.MANIFEST_UPDATE_STREAM_INFO,e)}},addManifestUpdateRepresentationInfo:function(e,t,r,n,i,a,s,l){if(e&&e.representationInfo){var u=new da;u.id=t,u.index=r,u.streamIndex=n,u.mediaType=i,u.startNumber=s,u.fragmentInfoType=l,u.presentationTimeOffset=a,e.representationInfo.push(u),f(e.mediaType,o.Z.MANIFEST_UPDATE_TRACK_INFO,e)}},addPlayList:function(e){e.trace&&Array.isArray(e.trace)?e.trace.forEach(function(e){e.hasOwnProperty("subreplevel")&&!e.subreplevel&&delete e.subreplevel}):delete e.trace,m(a.Z.STREAM,o.Z.PLAY_LIST,e)},addDVBErrors:function(e){m(a.Z.STREAM,o.Z.DVB_ERRORS,e)}},r={},t}ga.__dashjs_factory_name="MetricsModel";var pa=c.Z.getSingletonFactory(ga);function ma(e){e=e||{};var t,r,n,i,s=this.context,l=e.metricsModel;function u(e){var t=l.getMetricsFor(e,!0);if(!t)return null;var r,n=t.HttpList,i=null;if(!n||n.length<=0)return null;for(r=n.length-1;r>=0;){if(n[r].responsecode){i=n[r];break}r--}return i}function c(e){var t=l.getMetricsFor(e,!0);return t&&t.HttpList?t.HttpList:[]}function d(e,t){if(!e)return null;var r=e[t];return r&&0!==r.length?r[r.length-1]:null}return t={getCurrentRepresentationSwitch:function(e){return d(l.getMetricsFor(e,!0),o.Z.TRACK_SWITCH)},getCurrentBufferState:function(e){return d(l.getMetricsFor(e,!0),o.Z.BUFFER_STATE)},getCurrentBufferLevel:function(e){var t=d(l.getMetricsFor(e,!0),o.Z.BUFFER_LEVEL);return t?ta.round10(t.level/1e3,-3):0},getCurrentHttpRequest:u,getHttpRequests:c,getCurrentDroppedFrames:function(){return d(l.getMetricsFor(a.Z.VIDEO,!0),o.Z.DROPPED_FRAMES)},getCurrentSchedulingInfo:function(e){return d(l.getMetricsFor(e,!0),o.Z.SCHEDULING_INFO)},getCurrentDVRInfo:function(e){return d(e?l.getMetricsFor(e,!0):l.getMetricsFor(a.Z.VIDEO,!0)||l.getMetricsFor(a.Z.AUDIO,!0),o.Z.DVR_INFO)},getCurrentManifestUpdate:function(){return d(l.getMetricsFor(a.Z.STREAM),o.Z.MANIFEST_UPDATE)},getLatestFragmentRequestHeaderValueByID:function(e,t){if(!t)return null;var r={},n=u(e);n&&(r=$e.Z.parseHttpHeaders(n._responseHeaders));var i=r[t.toLowerCase()];return void 0===i?null:i},getLatestMPDRequestHeaderValueByID:function(e){if(!e)return null;var t,r,n,i={};for(n=(t=c(a.Z.STREAM)).length-1;n>=0;n--)if((r=t[n]).type===L.w.MPD_TYPE){i=$e.Z.parseHttpHeaders(r._responseHeaders);break}var s=i[e.toLowerCase()];return void 0===s?null:s},addRepresentationSwitch:function(e,t,r,n,i){l.addRepresentationSwitch(e,t,r,n,i)},addDVRInfo:function(e,t,r,n){l.addDVRInfo(e,t,r,n)},updateManifestUpdateInfo:function(e){var t=this.getCurrentManifestUpdate();l.updateManifestUpdateInfo(t,e)},addManifestUpdateStreamInfo:function(e){if(e){var t=this.getCurrentManifestUpdate();l.addManifestUpdateStreamInfo(t,e.id,e.index,e.start,e.duration)}},addManifestUpdateRepresentationInfo:function(e,t){if(e){var r=this.getCurrentManifestUpdate();l.addManifestUpdateRepresentationInfo(r,e.id,e.index,e.streamIndex,t,e.presentationTimeOffset,e.startNumber,e.fragmentInfoType)}},addManifestUpdate:function(e){l.addManifestUpdate(a.Z.STREAM,e.type,e.requestStartDate,e.requestEndDate)},addHttpRequest:function(e,t,r,n,i,a){l.addHttpRequest(e.mediaType,null,e.type,e.url,e.quality,t,e.serviceLocation||null,e.range||null,e.requestStartDate,e.firstByteDate,e.requestEndDate,r,e.duration,n,i,e.fileLoaderType,a)},addSchedulingInfo:function(e,t){l.addSchedulingInfo(e.mediaType,new Date,e.type,e.startTime,e.availabilityStartTime,e.duration,e.quality,e.range,t)},addRequestsQueue:function(e,t,r){l.addRequestsQueue(e,t,r)},addBufferLevel:function(e,t,r){l.addBufferLevel(e,t,r)},addBufferState:function(e,t,r){l.addBufferState(e,t,r)},addDroppedFrames:function(e){l.addDroppedFrames(a.Z.VIDEO,e)},addPlayList:function(){i&&(l.addPlayList(i),i=null)},addDVBErrors:function(e){l.addDVBErrors(e)},createPlaylistMetrics:function(e,t){(i=new J).start=new Date,i.mstart=e,i.starttype=t},createPlaylistTraceMetrics:function(e,t,i){!0===r&&(r=!1,(n=new ee).representationid=e,n.start=new Date,n.mstart=t,n.playbackspeed=null!==i?i.toString():null)},updatePlayListTraceMetrics:function(e){if(n)for(var t in n)n[t]=e[t]},pushPlayListTraceMetrics:function(e,t){if(!1===r&&i&&n&&n.start){var a=n.start,s=e.getTime()-a.getTime();n.duration=s,n.stopreason=t,i.trace.push(n),r=!0}},clearAllCurrentMetrics:function(){l.clearAllCurrentMetrics()}},l=l||pa(s).getInstance({settings:e.settings}),r=!0,n=null,i=null,t}ma.__dashjs_factory_name="DashMetrics";var va=c.Z.getSingletonFactory(ma);function ya(){var e,t,r,n,i=this.context,o=(0,l.Z)(i).getInstance(),c=(0,D.Z)(i).getInstance();function d(e){n=e}function h(e,t,r,n){var i,a=t.adaptation.period.mpd,s=a.availabilityStartTime;if(n)i=r&&a.timeShiftBufferDepth!==Number.POSITIVE_INFINITY?new Date(s.getTime()+1e3*(e+a.timeShiftBufferDepth)):a.availabilityEndTime;else if(r){var o=t.availabilityTimeOffset;i=new Date(s.getTime()+1e3*(e-o))}else i=s;return i}function g(e,t){return(e.getTime()-t.mpd.availabilityStartTime.getTime()+1e3*n)/1e3}function p(e,t){return e+(t.adaptation.period.start-t.presentationTimeOffset)}function m(e){var r={start:NaN,end:NaN},n=e[0].getAdapter().getRegularPeriods()[0],i=g(new Date,n);if(!e||0===e.length)return{range:r,now:i};e.forEach(function(e){var n=e.getAdapter(),o=n.getMediaInfoForType(e.getStreamInfo(),a.Z.VIDEO)||n.getMediaInfoForType(e.getStreamInfo(),a.Z.AUDIO),l=n.getVoRepresentations(o)[0],u={start:NaN,end:NaN};if(l)if(l.segmentInfoType===s.Z.SEGMENT_TIMELINE)u=function(e){var r,n,i,a,s=e.adaptation.period.mpd.manifest.Period_asArray[e.adaptation.period.index].AdaptationSet_asArray[e.adaptation.index],o=t.getRepresentationFor(e.index,s),l=o.SegmentTemplate||o.SegmentList,u=l.SegmentTimeline,c=l.timescale,d=u.S_asArray,f={start:0,end:0},h=d[0].t,g=!isNaN(h),m=g?h:0,v=0;for(g&&(f.start=p(m/c,e)),i=0,a=d.length;i<a;i++)n=0,(r=d[i]).hasOwnProperty("r")&&(n=r.r),v+=r.d*(1+n);return f.end=p((m+v)/c,e),f}(l);else{var c=l.adaptation.period;u.start=c.start,u.end=Math.max(i,c.start+c.duration)}!isNaN(u.start)&&(isNaN(r.start)||r.start>u.start)&&(r.start=u.start),!isNaN(u.end)&&(isNaN(r.end)||r.end<u.end)&&(r.end=u.end)}),r.end=Math.min(i,r.end);var o=y(e,r.end,!0);return r.end=isNaN(o)?r.end:o,r.start=n&&n.mpd&&n.mpd.timeShiftBufferDepth&&!isNaN(n.mpd.timeShiftBufferDepth)&&!isNaN(r.end)?Math.max(r.end-n.mpd.timeShiftBufferDepth,r.start):r.start,r.start=y(e,r.start),{range:r,now:i}}function v(e,t){r=e-t.end}function y(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{for(var n=0,i=!1,a=NaN;!i&&n<e.length;){var s=e[n].getStreamInfo();s.start<=t&&(!isFinite(s.duration)||s.start+s.duration>=t)?(a=t,i=!0):!r&&s.start>t&&(isNaN(a)||s.start<a)?a=s.start:r&&s.start+s.duration<t&&(isNaN(a)||s.start+s.duration>a)&&(a=s.start+s.duration),n+=1}return a}catch(e){return t}}function E(e){void 0===e.offset||isNaN(e.offset)||d(e.offset/1e3)}function T(){n=0,r=0}function _(){o.off(u.Z.UPDATE_TIME_SYNC_OFFSET,E,this),T()}return e={initialize:function(){T(),o.on(u.Z.UPDATE_TIME_SYNC_OFFSET,E,this)},getClientTimeOffset:function(){return n},setClientTimeOffset:d,getClientReferenceTime:function(){return Date.now()-1e3*r+1e3*n},calcAvailabilityStartTimeFromPresentationTime:function(e,t,r){return h(e,t,r)},calcAvailabilityEndTimeFromPresentationTime:function(e,t,r){return h(e,t,r,!0)},calcPresentationTimeFromWallTime:g,calcPresentationTimeFromMediaTime:p,calcPeriodRelativeTimeFromMpdRelativeTime:function(e,t){return t-e.adaptation.period.start},calcMediaTimeFromPresentationTime:function(e,t){return e-t.adaptation.period.start+t.presentationTimeOffset},calcWallTimeForSegment:function(e,t){var r,n,i;return t&&(r=e.representation.adaptation.period.mpd.suggestedPresentationDelay,n=e.presentationStartTime+r,i=new Date(e.availabilityStartTime.getTime()+1e3*n)),i},calcTimeShiftBufferWindow:function(e,t){if(!t)return function(e){var t={start:NaN,end:NaN},r=0,n=NaN;return e.forEach(function(e){var t=e.getStreamInfo();r+=t.duration,(isNaN(n)||t.start<n)&&(n=t.start)}),t.start=n,t.end=n+r,t}(e);if(c.get().streaming.timeShiftBuffer.calcFromSegmentTimeline){var r=m(e);return v(r.now,r.range),r.range}return function(e){var t={start:NaN,end:NaN};if(!e||0===e.length)return t;var r=e[0].getAdapter().getRegularPeriods()[0],n=g(new Date,r),i=r.mpd.timeShiftBufferDepth,a=isNaN(i)?0:n-i;if(t.start=y(e,a),t.end=!isNaN(t.start)&&n<t.start?n:y(e,n,!0),!isNaN(i)&&t.end<n-i&&(t.end=NaN),c.get().streaming.timeShiftBuffer.fallbackToSegmentTimeline){var s=m(e);if(s.range.end<t.start)return o.trigger(f.Z.CONFORMANCE_VIOLATION,{level:ar.LEVELS.WARNING,event:ar.EVENTS.INVALID_DVR_WINDOW}),v(s.now,s.range),s.range}return t}(e)},reset:_},t=He(i).getInstance(),_(),e}ya.__dashjs_factory_name="TimelineConverter";var Ea=c.Z.getSingletonFactory(ya),Ta=r(4593),_a=r(6934);function Sa(e){return Sa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sa(e)}function ba(e,t){return ba=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ba(e,t)}function Aa(e,t){return!t||"object"!==Sa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ia(e){return Ia=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ia(e)}var Ra=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ba(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=Ia(t);if(r){var i=Ia(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return Aa(this,e)});function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=n.call(this)).captionData=null,e.label=null,e.defaultTrack=!1,e.kind=null,e.isFragmented=!1,e.isEmbedded=!1,e.isTTML=null,e}return i}($i),wa=r(2295);function Da(){var e=0;function t(e){for(var t="",r=0;r<e.length;++r)t+=e[r].uchar;return t.length-t.replace(/^\s+/,"").length}function r(e){return"left: "+3.125*e.x+"%; top: "+6.66*e.y1+"%; width: "+(100-3.125*e.x)+"%; height: "+6.66*Math.max(e.y2-1-e.y1,1)+"%; align-items: flex-start; overflow: visible; -webkit-writing-mode: horizontal-tb;"}function n(e){return"red"===e?"rgb(255, 0, 0)":"green"===e?"rgb(0, 255, 0)":"blue"===e?"rgb(0, 0, 255)":"cyan"===e?"rgb(0, 255, 255)":"magenta"===e?"rgb(255, 0, 255)":"yellow"===e?"rgb(255, 255, 0)":"white"===e?"rgb(255, 255, 255)":"black"===e?"rgb(0, 0, 0)":e}function i(e,t){var r=e.videoHeight/15;return t?"font-size: "+r+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; color: "+(t.foreground?n(t.foreground):"rgb(255, 255, 255)")+"; font-style: "+(t.italics?"italic":"normal")+"; text-decoration: "+(t.underline?"underline":"none")+"; white-space: pre; background-color: "+(t.background?n(t.background):"transparent")+";":"font-size: "+r+"px; font-family: Menlo, Consolas, 'Cutive Mono', monospace; justify-content: flex-start; text-align: left; color: rgb(255, 255, 255); font-style: normal; white-space: pre; line-height: normal; font-weight: normal; text-decoration: none; width: 100%; display: flex;"}function a(e){return e.replace(/^\s+/g,"")}function s(e){return e.replace(/\s+$/g,"")}return{createHTMLCaptionsFromScreen:function(n,o,l,u){var c,d,f=null,h=!1,g=-1,p={start:o,end:l,spans:[]},m="style_cea608_white_black",v={},y={},E=[];for(c=0;c<15;++c){var T=u.rows[c],_="",S=null;if(!1===T.isEmpty()){var b=t(T.chars);null===f&&(f={x:b,y1:c,y2:c+1,p:[]}),b!==g&&h&&(f.p.push(p),p={start:o,end:l,spans:[]},f.y2=c,f.name="region_"+f.x+"_"+f.y1+"_"+f.y2,!1===v.hasOwnProperty(f.name)?(E.push(f),v[f.name]=f):v[f.name].p.contat(f.p),f={x:b,y1:c,y2:c+1,p:[]});for(var A=0;A<T.chars.length;++A){var I=T.chars[A],R=I.penState;if(null===S||!R.equals(S)){_.trim().length>0&&(p.spans.push({name:m,line:_,row:c}),_="");var w="style_cea608_"+R.foreground+"_"+R.background;R.underline&&(w+="_underline"),R.italics&&(w+="_italics"),y.hasOwnProperty(w)||(y[w]=JSON.parse(JSON.stringify(R))),S=R,m=w}_+=I.uchar}_.trim().length>0&&p.spans.push({name:m,line:_,row:c}),h=!0,g=b}else h=!1,g=-1,f&&(f.p.push(p),p={start:o,end:l,spans:[]},f.y2=c,f.name="region_"+f.x+"_"+f.y1+"_"+f.y2,!1===v.hasOwnProperty(f.name)?(E.push(f),v[f.name]=f):v[f.name].p.contat(f.p),f=null)}f&&(f.p.push(p),f.y2=c+1,f.name="region_"+f.x+"_"+f.y1+"_"+f.y2,!1===v.hasOwnProperty(f.name)?(E.push(f),v[f.name]=f):v[f.name].p.contat(f.p),f=null);var D=[];for(c=0;c<E.length;++c){var L=E[c],C="sub_cea608_"+e++,N=document.createElement("div");N.id=C;var P=r(L);N.style.cssText="position: absolute; margin: 0; display: flex; box-sizing: border-box; pointer-events: none;"+P;var O=document.createElement("div");O.className="paragraph bodyStyle",O.style.cssText=i(n);var M=document.createElement("div");M.className="cueUniWrapper",M.style.cssText="unicode-bidi: normal; direction: ltr;";for(var k=0;k<L.p.length;++k){var x=L.p[k],F=0;for(d=0;d<x.spans.length;++d){var B=x.spans[d];if(B.line.length>0){if(0!==d&&F!=B.row){var U=document.createElement("br");U.className="lineBreak",M.appendChild(U)}var Z=!1;F===B.row&&(Z=!0),F=B.row;var G=y[B.name],H=document.createElement("span");H.className="spanPadding "+B.name+" customSpanColor",H.style.cssText=i(n,G),0!==d&&Z?d===x.spans.length-1?H.textContent=s(B.line):H.textContent=B.line:x.spans.length>1&&d<x.spans.length-1&&B.row===x.spans[d+1].row?H.textContent=a(B.line):H.textContent=B.line.trim(),M.appendChild(H)}}}O.appendChild(M),N.appendChild(O);var $={bodyStyle:["%",90]};for(var V in y)y.hasOwnProperty(V)&&($[V]=["%",90]);D.push({type:"html",start:o,end:l,cueHTMLElement:N,cueID:C,cellResolution:[32,15],isFromCEA608:!0,fontSize:$,lineHeight:{},linePadding:{}})}return D}}}Da.__dashjs_factory_name="EmbeddedTextHtmlRender";var La=c.Z.getSingletonFactory(Da);function Ca(e){var t,r,n,s,o,c,f,h,g,p,m,v,y,E,T,_,b,A=e.errHandler,I=e.manifestModel,R=e.mediaController,D=e.videoModel,C=e.textTracks,N=e.vttParser,P=e.vttCustomRenderingParser,O=e.ttmlParser,M=e.streamInfo,k=e.settings,x=this.context,F=(0,l.Z)(x).getInstance(),B=!1;function U(){c=null,h=NaN,g=[],p=null,f=!1,o=[],s=null}function Z(e){var t=new Ra;for(var r in e)t[r]=e[r];t.labels=e.labels,t.defaultTrack=function(e){var t=!1;return v.length>1&&e.isEmbedded?t=e.id&&e.id===a.Z.CC1:1===v.length?e.id&&"string"==typeof e.id&&"CC"===e.id.substring(0,2)&&(t=!0):0===v.length&&(t=e.index===o[0].index),t}(e),t.isFragmented=e.isFragmented,t.isEmbedded=!!e.isEmbedded,t.isTTML=function(e){return e.codec&&e.codec.search(a.Z.STPP)>=0||e.mimeType&&e.mimeType.search(a.Z.TTML)>=0}(e),t.kind=function(e,t){var r=e.roles&&e.roles.length>0?t[e.roles[0]]:t.caption;return r===t.caption||r===t.subtitle?r:t.caption}(e,{subtitle:"subtitles",caption:"captions"}),C.addTextTrack(t)}function G(e){var t=e.chunk;t.mediaInfo.embeddedCaptions&&$(t.bytes,t)}function H(e){m=e}function $(e,o){var l=o.mediaInfo,u=l.type,d=l.mimeType,g=l.codec||d;g?-1!==l.codec.indexOf("application/mp4")?function(e,i,o){var l;if("InitializationSegment"===i.segmentType)f=!0,h=n.getMediaTimescaleFromMoov(e);else{if(!f)return;(l=n.getSamplesInfo(e).sampleList).length>0&&(p=l[0].cts-i.start*h),o.search(a.Z.STPP)>=0?function(e,n,i){var o,l;for(s=null!==s?s:q(i),o=0;o<n.length;o++){var u=n[o],d=u.cts,f=K(),g=f+d/h,p=g+u.duration/h;t.buffered.add(g,p);var v=new DataView(e,u.offset,u.subSizes[0]),y=_a.Utils.dataViewToString(v,a.Z.UTF8),E=[],T=u.offset+u.subSizes[0];for(l=1;l<u.subSizes.length;l++){var _=new Uint8Array(e,T,u.subSizes[l]),S=String.fromCharCode.apply(null,_);E.push(S),T+=u.subSizes[l]}try{var b=I.getValue().ttmlTimeIsRelative?d/h:0,A=s.parse(y,b,d/h,(d+u.duration)/h,E);C.addCaptions(m,f,A)}catch(e){c.removeExecutedRequestsBeforeTime(),this.remove(),r.error("TTML parser error: "+e.message)}}}(e,l,o):function(e,n){var i,a,s,o=[];for(i=0;i<n.length;i++){var l=n[i];l.cts-=p;var u=K()+l.cts/h,c=u+l.duration/h;t.buffered.add(u,c);var d=e.slice(l.offset,l.offset+l.size),f=_a.parseBuffer(d);for(a=0;a<f.boxes.length;a++){var g=f.boxes[a];if(r.debug("VTT box1: "+g.type),"vtte"!==g.type&&"vttc"===g.type){r.debug("VTT vttc boxes.length = "+g.boxes.length);var v={styles:{}};for(s=0;s<g.boxes.length;s++){var y=g.boxes[s];if(r.debug("VTT box2: "+y.type),"payl"===y.type)v.start=l.cts/h,v.end=(l.cts+l.duration)/h,v.data=y.cue_text;else if("sttg"===y.type&&y.settings&&""!==y.settings)try{var E=y.settings.split(" ");v.styles=N.getCaptionStyles(E)}catch(e){}}v&&v.data&&(o.push(v),r.debug("VTT  ".concat(v.start," - ").concat(v.end," :  ").concat(v.data)))}}}o.length>0&&C.addCaptions(m,0,o)}(e,l)}}(e,o,g):u===a.Z.VIDEO?function(e,t){var a,s;if(t.segmentType===L.w.INIT_SEGMENT_TYPE)0===y&&(y=n.getMediaTimescaleFromMoov(e));else if(t.segmentType===L.w.MEDIA_SEGMENT_TYPE){if(0===y)return void r.warn("CEA-608: No timescale for embeddedTextTrack yet");var o=(s=n.getSamplesInfo(e)).lastSequenceNumber,l=Math.trunc(t.start),u=Math.trunc(t.end);if(_[0]||_[1]||function(){for(var e,t=0;t<v.length;t++){if(-1===(e=C.getTrackIdxForId(v[t].id)))return void r.warn("CEA-608: data before track is ready.");var n=V(e);_[t]=new(i().Cea608Parser)(t+1,{newCue:n},null)}}(),y){if(function(e,t,r,n,i){return null!==e&&null!==t&&null!==n&&null!==i&&(t===e?n!==i:t!==e+r)}(E,o,s.numSequences,T,l))for(a=0;a<_.length;a++)_[a]&&_[a].reset();for(var c=function(e,t){if(0===t.length)return null;for(var r={splits:[],fields:[[],[]]},n=new DataView(e),a=0;a<t.length;a++)for(var s=t[a],o=i().findCea608Nalus(n,s.offset,s.size),l=null,u=0,c=0;c<o.length;c++)for(var d=i().extractCea608DataFromRange(n,o[c]),f=0;f<2;f++)if(d[f].length>0){s.cts!==l?u=0:u+=1;var h=K();r.fields[f].push([s.cts+h*y,d[f],u]),l=s.cts}return r.fields.forEach(function(e){e.sort(function(e,t){return e[0]===t[0]?e[2]-t[2]:e[0]-t[0]})}),r}(e,s.sampleList),d=0;d<_.length;d++){var f=c.fields[d],h=_[d];if(h)for(a=0;a<f.length;a++)h.addData(f[a][0]/y,f[a][1])}E=o,T=u}}}(e,o):function(e,r,n){var i,s,o=new DataView(e,0,e.byteLength);s=_a.Utils.dataViewToString(o,a.Z.UTF8);try{i=q(n).parse(s,0),C.addCaptions(C.getCurrentTrackIdx(),0,i),t.buffered&&t.buffered.add(r.start,r.end)}catch(e){A.error(new S.Z(w.TIMED_TEXT_ERROR_ID_PARSE_CODE,w.TIMED_TEXT_ERROR_MESSAGE_PARSE+e.message,s))}}(e,o,g):r.error("No text type defined")}function V(e){return function(t,r,n){var i;(i=D.getTTMLRenderingDiv()?b.createHTMLCaptionsFromScreen(D.getElement(),t,r,n):[{start:t,end:r,data:n.getDisplayText(),styles:{}}])&&C.addCaptions(e,0,i)}}function K(){return isNaN(t.timestampOffset)?0:t.timestampOffset}function q(e){var t;return e.search(a.Z.VTT)>=0?t=k.get().streaming.text.webvtt.customRenderingEnabled&&P?P:N:(e.search(a.Z.TTML)>=0||e.search(a.Z.STPP)>=0)&&(t=O),t}function Y(e){v.forEach(function(t){var r=C.getTrackIdxForId(t.id);r>=0&&C.deleteCuesFromTrackIdx(r,e.from,e.to)})}return t={initialize:function(){B||(v=[],m=null,y=0,_=[],E=null,T=null,B=!0,b=La(x).getInstance(),F.on(u.Z.VIDEO_CHUNK_RECEIVED,G,t),F.on(u.Z.BUFFER_CLEARED,Y,t))},addMediaInfos:function(e,r,n){if(o=o.concat(r),e===a.Z.TEXT&&r[0].isFragmented&&!r[0].isEmbedded){c=n,t.buffered=(0,wa.Z)(x).create(),g=R.getTracksFor(a.Z.TEXT,M.id).filter(function(e){return e.isFragmented});for(var i=R.getCurrentTrackFor(a.Z.TEXT,M.id),s=0;s<g.length;s++)if(g[s]===i){H(s);break}}for(var l=0;l<r.length;l++)Z(r[l])},resetMediaInfos:function(){o=[]},getStreamId:function(){return M.id},append:$,abort:function(){},addEmbeddedTrack:function(e){if(B&&e)if(e.id===a.Z.CC1||e.id===a.Z.CC3){for(var t=0;t<v.length;t++)if(v[t].id===e.id)return;v.push(e)}else r.warn("Embedded track "+e.id+" not supported!")},resetEmbedded:function(){F.off(u.Z.VIDEO_CHUNK_RECEIVED,G,t),F.off(u.Z.BUFFER_CLEARED,Y,t),C&&C.deleteAllTextTracks(),B=!1,v=[],_=[null,null],E=null,T=null},getConfig:function(){return{fragmentModel:c,fragmentedTracks:g,videoModel:D}},setCurrentFragmentedTrackIdx:H,remove:function(e,r){void 0===e&&e===r&&(e=t.buffered.start(0),r=t.buffered.end(t.buffered.length-1)),t.buffered.remove(e,r),C.deleteCuesFromTrackIdx(m,e,r)},reset:function(){U(),o=[],n=null}},r=(0,d.Z)(x).getInstance().getLogger(t),n=(0,Bt.Z)(x).getInstance(),U(),t}Ca.__dashjs_factory_name="TextSourceBuffer";var Na=c.Z.getClassFactory(Ca),Pa=r(4403);function Oa(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ma=["text","align","fontSize","id","isd","line","lineAlign","lineHeight","linePadding","position","positionAlign","region","size","snapToLines","vertical"];function ka(e){var t,r,n,i,s,o,c,h,g,p,m,v,y,E,T,_,S,b,A,I,R=this.context,w=(0,l.Z)(R).getInstance(),D=e.videoModel,L=e.streamInfo,C=e.settings;function N(e,t,r,n,i,a){var s=0,o=0;e/t>r/n?s=(o=t)/n*r:o=(s=e)/r*n;var l,u,c=0,d=0;return s/o>i?(d=o,c=o*i):(c=s,d=s/i),l=(e-c)/2,u=(t-d)/2,a?{x:l+.1*c,y:u+.1*d,w:.8*c,h:.8*d}:{x:l,y:u,w:c,h:d}}function P(e,t){var r=D.getClientWidth(),n=D.getClientHeight(),i=D.getVideoWidth(),a=D.getVideoHeight(),s=D.getVideoRelativeOffsetTop(),o=D.getVideoRelativeOffsetLeft();if(0!==i&&0!==a){var l=i/a,u=!1;e.isFromCEA608&&(l=3.5/3,u=!0);var d=N.call(this,r,n,i,a,l,u),v=d.w,y=d.h,_=d.x,b=d.y;if(v!=g||y!=p||_!=c||b!=h||t){if(c=_+o,h=b+s,g=v,p=y,m){var A=m.style;A&&(A.left=c+"px",A.top=h+"px",A.width=g+"px",A.height=p+"px",A.zIndex=E&&document[E]||T?S:null,w.trigger(f.Z.CAPTION_CONTAINER_RESIZE))}var I=e.activeCues;if(I)for(var R=I.length,L=0;L<R;++L){var C=I[L];C.scaleCue(C)}}}}function O(e){var t,r,n,i,a,s=g,o=p;if(e.cellResolution){var l=[s/e.cellResolution[0],o/e.cellResolution[1]];if(e.linePadding)for(t in e.linePadding)if(e.linePadding.hasOwnProperty(t)){r=(e.linePadding[t]*l[0]).toString();for(var u=document.getElementsByClassName("spanPadding"),c=0;c<u.length;c++)u[c].style.cssText=u[c].style.cssText.replace(/(padding-left\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+r),u[c].style.cssText=u[c].style.cssText.replace(/(padding-right\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+r)}if(e.fontSize){for(t in e.fontSize)if(e.fontSize.hasOwnProperty(t)){"%"===e.fontSize[t][0]?n=e.fontSize[t][1]/100:"c"===e.fontSize[t][0]&&(n=e.fontSize[t][1]),r=(n*l[1]).toString(),a="defaultFontSize"!==t?document.getElementsByClassName(t):document.getElementsByClassName("paragraph");for(var d=0;d<a.length;d++)a[d].style.cssText=a[d].style.cssText.replace(/(font-size\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+r)}if(e.lineHeight)for(t in e.lineHeight)if(e.lineHeight.hasOwnProperty(t)){"%"===e.lineHeight[t][0]?i=e.lineHeight[t][1]/100:"c"===e.fontSize[t][0]&&(i=e.lineHeight[t][1]),r=(i*l[1]).toString(),a=document.getElementsByClassName(t);for(var f=0;f<a.length;f++)a[f].style.cssText=a[f].style.cssText.replace(/(line-height\s*:\s*)[\d.,]+(?=\s*px)/gi,"$1"+r)}}}if(e.isd){var h=document.getElementById(e.cueID);h&&m.removeChild(h),k(e)}}function M(e,t){var r=/^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/,n=/^#(.*)$/;if(r.test(t)){var i=r.exec(t),a=parseInt(i[4],10)-1;return"data:image/png;base64,"+btoa(e.images[a])}if(n.test(t)){var s=n.exec(t)[1];return"data:image/png;base64,"+e.embeddedImages[s]}return t}function k(e){if(m){ie.call(this);var t=document.createElement("div");m.appendChild(t),_=(0,Pa.renderHTML)(e.isd,t,function(t){return M(e,t)},m.clientHeight,m.clientWidth,C.get().streaming.text.imsc.displayForcedOnlyMode,function(e){r.info("renderCaption :",e)},_,C.get().streaming.text.imsc.enableRollUp),t.id=e.cueID,w.trigger(f.Z.CAPTION_RENDERED,{captionDiv:t,currentTrackIdx:o})}}function x(e,t){return!!t&&t.endTime>=e.startTime}function F(e,t){return!!C.get().streaming.text.extendSegmentedCues&&!!function(e,t,r){for(var n=0;n<r.length;n++){var i=r[n];if(JSON.stringify(e[i])!==JSON.stringify(t[i]))return!1}return!0}(t,e,Ma)&&(t.endTime=Math.max(t.endTime,e.endTime),!0)}function B(e,t){t&&t.forEach(function(t){t.kind&&"image"===t.kind&&(t.src=M(e,t.src)),B(e,t.contents)})}function U(e,t,n){var i=z(e),s=C.get().streaming.text.dispatchForManualRendering;if(i&&Array.isArray(n)&&0!==n.length)for(var o=0;o<n.length;o++){var l=null,u=n[o];i.cellResolution=u.cellResolution,i.isFromCEA608=u.isFromCEA608,isNaN(u.start)||isNaN(u.end)||(s?l=Z(u,t):K(u)&&m?l=$(u,t,i):u.data&&(l=V(u,t,i)));try{if(l){if(!Q(i,l))if(C.get().streaming.text.webvtt.customRenderingEnabled)i.manualCueList||(i.manualCueList=[]),i.manualCueList.push(l);else{var c=void 0;i.cues&&0!==i.cues.length&&(c=i.cues[i.cues.length-1]),x(l,c)?F(l,c)||(c.isd&&(c.onexit=function(){}),i.mode!==a.Z.TEXT_DISABLED&&i.addCue(l)):i.mode!==a.Z.TEXT_DISABLED&&i.addCue(l)}var d=C.get().streaming.buffer.bufferToKeep;ee(i,0,D.getTime()-d)}else r.error("Impossible to display subtitles. You might have missed setting a TTML rendering div via player.attachTTMLRenderingDiv(TTMLRenderingDiv)")}catch(e){throw te(i),i.addCue(l),e}}}function Z(e,t){var r=q(e,t);return r.onenter=function(){K(e)&&I&&I.cueID!==r.cueID&&H(I),delete r.type,I=r,G(r)},r.onexit=function(){H(r),I=null},r}function G(e){w.trigger(f.Z.CUE_ENTER,e)}function H(e){w.trigger(f.Z.CUE_EXIT,{cueID:e.cueID})}function $(e,t,n){var i=this,s=q(e,t);return m.style.left=c+"px",m.style.top=h+"px",m.style.width=g+"px",m.style.height=p+"px",s.onenter=function(){var e=this;n.mode===a.Z.TEXT_SHOWING&&(this.isd?(A?requestAnimationFrame(function(){return k(e)}):k(this),r.debug("Cue enter id:"+this.cueID)):(m.appendChild(this.cueHTMLElement),O.call(i,this),w.trigger(f.Z.CAPTION_RENDERED,{captionDiv:this.cueHTMLElement,currentTrackIdx:o})))},s.onexit=function(){if(m)for(var e=m.childNodes,t=0;t<e.length;++t)e[t].id===this.cueID&&(r.debug("Cue exit id:"+e[t].id),m.removeChild(e[t]),--t)},s}function V(e,t,n){var i=q(e,t);if(i.isActive=!1,e.styles)try{void 0!==e.styles.align&&"align"in i&&(i.align=e.styles.align),void 0!==e.styles.line&&"line"in i&&(i.line=e.styles.line),void 0!==e.styles.snapToLines&&"snapToLines"in i&&(i.snapToLines=e.styles.snapToLines),void 0!==e.styles.position&&"position"in i&&(i.position=e.styles.position),void 0!==e.styles.size&&"size"in i&&(i.size=e.styles.size)}catch(e){r.error(e)}return i.onenter=function(){n.mode===a.Z.TEXT_SHOWING&&w.trigger(f.Z.CAPTION_RENDERED,{currentTrackIdx:o})},i}function K(e){return"html"===e.type}function q(e,t){return K(e)?function(e,t){var r=new n(e.start+t,e.end+t,"");return r.cueHTMLElement=e.cueHTMLElement,r.isd=e.isd,r.images=e.images,r.embeddedImages=e.embeddedImages,r.cueID=e.cueID,r.scaleCue=O.bind(self),r.cellResolution=e.cellResolution,r.lineHeight=e.lineHeight,r.linePadding=e.linePadding,r.fontSize=e.fontSize,r.isd&&B(r,r.isd.contents),r}(e,t):function(e,t){var r=new n(e.start-t,e.end-t,e.data);return r.cueID="".concat(r.startTime,"_").concat(r.endTime),r}(e,t)}function Y(e){if(v)for(var t=v.childNodes,r=0;r<t.length;++r)t[r].id===e.cueID&&(v.removeChild(t[r]),--r)}function j(){var e,t=[],r=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return Oa(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Oa(e,t):void 0}}(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}(D.getTextTracks());try{for(r.s();!(e=r.n()).done;){var n=e.value;n.manualMode===a.Z.TEXT_SHOWING&&t.push(n)}}catch(e){r.e(e)}finally{r.f()}return t}function z(e){return e>=0&&i[e]?D.getTextTrack(i[e].kind,i[e].id,i[e].lang,i[e].isTTML,i[e].isEmbedded):null}function W(e){var t=this;if(e!==o){var r=z(o=e);X.call(this,r),y&&(clearInterval(y),y=null),r&&"html"===r.renderingType&&(P.call(this,r,!0),window.ResizeObserver?(b=new window.ResizeObserver(function(){P.call(t,r,!0)})).observe(D.getElement()):y=setInterval(P.bind(this,r),500))}}function X(e){ie.call(this),e&&"html"===e.renderingType?re.call(this):ne.call(this)}function Q(e,t){if(!e.cues)return!1;for(var r=0;r<e.cues.length;r++)if(e.cues[r].startTime===t.startTime&&e.cues[r].endTime===t.endTime)return!0;return!1}function J(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return!!e&&(isNaN(t)||(n?e.startTime:e.endTime)>=t)&&(isNaN(r)||(n?e.endTime:e.startTime)<=r)}function ee(e,t,r){var n,i;if(!(r<t)&&e&&(e.cues||e.manualCueList)){var a=e.cues&&e.cues.length>0?"native":"custom",s="native"===a?e.cues:e.manualCueList;if(!s||0===s.length)return;for(var o=s.length-1;o>=0;o--)!J(s[o],t,r,!0)||(n=s[o],i=D.getTime(),n.startTime>=i&&n.endTime<=i)||("native"===a?e.removeCue(s[o]):(Y(s[o]),delete e.manualCueList[o]))}}function te(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e&&(e.cues||e.manualCueList)){var i=e.cues&&e.cues.length>0?"native":"custom",a="native"===i?e.cues:e.manualCueList;if(!a||0===a.length)return;for(var s=a.length-1;s>=0;s--)J(a[s],t,r,n)&&("native"===i?(a[s].onexit&&a[s].onexit(),e.removeCue(a[s])):(Y(a[s]),delete e.manualCueList[s]))}}function re(){var e=document.getElementById("native-cue-style");if(!e){(e=document.createElement("style")).id="native-cue-style",document.head.appendChild(e);var t=e.sheet,n=D.getElement();try{n&&(n.id?t.insertRule("#"+n.id+"::cue {background: transparent}",0):0!==n.classList.length?t.insertRule("."+n.className+"::cue {background: transparent}",0):t.insertRule("video::cue {background: transparent}",0))}catch(e){r.info(""+e.message)}}}function ne(){var e=document.getElementById("native-cue-style");e&&document.head.removeChild(e)}function ie(){if(m)for(;m.firstChild;)m.removeChild(m.firstChild)}return t={initialize:function(){"undefined"!=typeof window&&"undefined"!=typeof navigator&&(n=window.VTTCue||window.TextTrackCue,i=[],s=[],o=-1,c=0,h=0,g=0,p=0,m=null,v=null,y=null,T=!1,S=2147483647,_=null,A="requestAnimationFrame"in window,void 0!==document.fullscreenElement?E="fullscreenElement":void 0!==document.webkitIsFullScreen?E="webkitIsFullScreen":document.msFullscreenElement?E="msFullscreenElement":document.mozFullScreen&&(E="mozFullScreen"))},getStreamId:function(){return L.id},addTextTrack:function(e){i.push(e)},addCaptions:U,createTracks:function(){var e=C.get().streaming.text.dispatchForManualRendering;i.sort(function(e,t){return e.index-t.index}),m=D.getTTMLRenderingDiv(),v=D.getVttRenderingDiv();for(var t,r,n,l,c,d,h=-1,g=0;g<i.length;g++){var p=(r=(t=i[g]).kind,n=void 0!==t.id?t.id:t.lang,l=t.lang,c=t.isTTML,d=t.isEmbedded,D.addTextTrack(r,n,l,c,d));s.push(p),i[g].defaultTrack&&(p.default=!0,h=g);var y=z(g);y&&(y.mode=a.Z.TEXT_SHOWING,m&&(i[g].isTTML||i[g].isEmbedded)?y.renderingType="html":y.renderingType="default"),U(g,0,i[g].captionData),w.trigger(f.Z.TEXT_TRACK_ADDED)}if(W.call(this,h),h>=0){w.on(f.Z.PLAYBACK_METADATA_LOADED,function e(){var t=z(h);t&&"html"===t.renderingType&&P.call(this,t,!0),w.off(f.Z.PLAYBACK_METADATA_LOADED,e,this)},this);for(var E=0;E<i.length;E++){var T=z(E);T&&(T.mode=E!==h||e?a.Z.TEXT_HIDDEN:a.Z.TEXT_SHOWING,T.manualMode=E===h?a.Z.TEXT_SHOWING:a.Z.TEXT_HIDDEN)}}w.trigger(u.Z.TEXT_TRACKS_QUEUE_INITIALIZED,{index:o,tracks:i,streamId:L.id})},getCurrentTrackIdx:function(){return o},setCurrentTrackIdx:W,getTrackIdxForId:function(e){for(var t=-1,r=0;r<i.length;r++)if(i[r].id===e){t=r;break}return t},getCurrentTrackInfo:function(){return i[o]},setModeForTrackIdx:function(e,t){var r=z(e);r&&r.mode!==t&&(r.mode=t),r&&r.manualMode!==t&&(r.manualMode=t)},deleteCuesFromTrackIdx:function(e,t,r){var n=z(e);n&&te(n,t,r)},deleteAllTextTracks:function(){for(var e=s?s.length:0,t=0;t<e;t++){var r=z(t);r&&te.call(this,r,L.start,L.start+L.duration,!1)}s=[],i=[],y&&(clearInterval(y),y=null),b&&D&&(b.unobserve(D.getElement()),b=null),o=-1,ie.call(this)},manualCueProcessing:function(e){var t=j();if(t&&t.length>0){var r=t[0].manualCueList;r&&r.length>0&&r.forEach(function(t){t.startTime<=e&&t.endTime>=e&&!t.isActive?(t.isActive=!0,C.get().streaming.text.dispatchForManualRendering?G(t):WebVTT.processCues(window,[t],v,t.cueID)):t.isActive&&(t.startTime>e||t.endTime<e)&&(t.isActive=!1,C.get().streaming.text.dispatchForManualRendering?H(t):Y(t))})}},disableManualTracks:function(){var e=j();if(e&&e.length>0){var t=e[0].manualCueList;t&&t.length>0&&t.forEach(function(e){if(e.isActive)if(e.isActive=!1,C.get().streaming.text.dispatchForManualRendering)H(e);else if(v)for(var t=v.childNodes,r=0;r<t.length;++r)t[r].id===e.cueID&&(v.removeChild(t[r]),--r)})}}},r=(0,d.Z)(R).getInstance().getLogger(t),t}ka.__dashjs_factory_name="TextTracks";var xa=c.Z.getClassFactory(ka);function Fa(){var e,t,r,n,i,a,s=this.context;function o(e){var t=e.split(":"),r=t.length-1;return e=60*parseInt(t[r-1],10)+parseFloat(t[r]),2===r&&(e+=3600*parseInt(t[0],10)),e}function l(e){var t=e.split(n),r=t[1].split(a);return r.shift(),t[1]=r[0],r.shift(),{cuePoints:t,styles:u(r)}}function u(e){var t={};return e.forEach(function(e){if(e.split(/:/).length>1){var r=e.split(/:/)[1],n=!1;r&&-1!=r.search(/%/)&&(n=!0,r=parseInt(r.replace(/%/,""),10)),(e.match(/align/)||e.match(/A/))&&(t.align=r),(e.match(/line/)||e.match(/L/))&&(t.line="auto"===r?r:parseInt(r,10),n&&(t.snapToLines=!1)),(e.match(/position/)||e.match(/P/))&&(t.position=r),(e.match(/size/)||e.match(/S/))&&(t.size=r)}}),t}function c(e,t){for(var r,i=t,a="",s="";""!==e[i]&&i<e.length;)i++;if((r=i-t)>1)for(var o=0;o<r;o++){if((s=e[t+o]).match(n)){a="";break}a+=s,o!==r-1&&(a+="\n")}else(s=e[t]).match(n)||(a=s);return a}return e={parse:function(e){var a,s,u=[];if(!e)return u;a=(e=e.split(r)).length,s=-1;for(var d=0;d<a;d++){var f=e[d];if(f.length>0&&"WEBVTT"!==f&&f.match(n)){var h=l(f),g=h.cuePoints,p=h.styles,m=c(e,d+1),v=o(g[0].replace(i,"")),y=o(g[1].replace(i,""));!isNaN(v)&&!isNaN(y)&&v>=s&&y>v?""!==m?(s=v,u.push({start:v,end:y,data:m,styles:p})):t.error("Skipping cue due to empty/malformed cue text"):t.error("Skipping cue due to incorrect cue timing")}}return u},getCaptionStyles:u},t=(0,d.Z)(s).getInstance().getLogger(e),r=/(?:\r\n|\r|\n)/gm,n=/-->/,i=/(^[\s]+|[\s]+$)/g,a=/\s\b/g,e}Fa.__dashjs_factory_name="VTTParser";var Ba=c.Z.getSingletonFactory(Fa);function Ua(){var e,t;return e={parse:function(e){var r=[];return t.oncue=function(e){e.start=e.startTime,e.end=e.endTime,e.data=e.text,e.styles={align:e.align,line:e.line,position:e.position,size:e.size},r.push(e)},t.parse(e),r}},function(){try{window&&window.WebVTT&&window.WebVTT.Parser&&(t=new window.WebVTT.Parser(window,window.vttjs,window.WebVTT.StringDecoder()))}catch(e){}}(),e}Ua.__dashjs_factory_name="VttCustomRenderingParser";var Za=c.Z.getSingletonFactory(Ua);function Ga(){var e,t,r=this.context,n=(0,l.Z)(r).getInstance(),i=0;return e={parse:function(e,r,a,s,o){var l,c,d,h="",g=[],p={},m={},v="",y="",E={onOpenTag:function(e,r,i){if(i[" imagetype"]&&!i[" imageType"]&&(n.trigger(f.Z.CONFORMANCE_VIOLATION,{level:ar.LEVELS.ERROR,event:ar.EVENTS.NON_COMPLIANT_SMPTE_IMAGE_ATTRIBUTE}),i[" imageType"]=i[" imagetype"]),"image"===r&&("http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt"===e||"http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt"===e)){if(!i[" imageType"]||"PNG"!==i[" imageType"].value)return void t.warn("smpte-tt imageType != PNG. Discarded");v=i["http://www.w3.org/XML/1998/namespace id"].value}},onCloseTag:function(){v&&(m[v]=y.trim()),y="",v=""},onText:function(e){v&&(y+=e)}};if(!e)throw h="no ttml data to parse",new Error(h);p.data=e,n.trigger(u.Z.TTML_TO_PARSE,p);var T=(0,Pa.fromXML)(p.data,function(e){h=e},E);n.trigger(u.Z.TTML_PARSED,{ttmlString:p.data,ttmlDoc:T});var _,S=T.getMediaTimeEvents();for(d=0;d<S.length;d++){var b=(0,Pa.generateISD)(T,S[d],function(e){h=e});b.contents.some(function(e){return e.contents.length})&&(l=S[d]+r)<(c=S[d+1]+r)&&g.push({start:l,end:c,type:"html",cueID:(_="cue_TTML_"+i,i++,_),isd:b,images:o,embeddedImages:m})}if(""!==h)throw t.error(h),new Error(h);return g}},t=(0,d.Z)(r).getInstance().getLogger(e),e}Ga.__dashjs_factory_name="TTMLParser";var Ha=c.Z.getSingletonFactory(Ga);function $a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Va(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$a(Object(r),!0).forEach(function(t){Ka(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Ka(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qa(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Ya(e){var t,r,n,i=this.context,s=(0,l.Z)(i).getInstance(),o=(0,X.Z)(i).getInstance(),u=e.adapter,c=e.baseURLController;function h(e,t){var r,i,s=!1;if(c.resolve()){var l=u.getVoRepresentations(e);l&&l.length>0&&(r=c.resolve(l[0].path).url)}var d=e.essentialPropertiesAsArray.filter(function(e){return e.schemeIdUri&&e.schemeIdUri===a.Z.FONT_DOWNLOAD_DVB_SCHEME}),f=e.supplementalPropertiesAsArray.filter(function(e){return e.schemeIdUri&&e.schemeIdUri===a.Z.FONT_DOWNLOAD_DVB_SCHEME});d.length>0?(s=!0,i=d):i=f,i.forEach(function(i){if(function(e){return!(!(e.value&&"1"===e.value&&e.dvbUrl&&e.dvbUrl.length>0&&e.dvbFontFamily&&e.dvbFontFamily.length>0&&e.dvbMimeType)||e.dvbMimeType!==a.Z.OFF_MIMETYPE&&e.dvbMimeType!==a.Z.WOFF_MIMETYPE)}(i)){var l=(u=i.dvbUrl,c=r,o.isPathAbsolute(u)?u:o.isRelative(u)?c?o.resolve(u,c):o.resolve(u):u);n.push({fontFamily:i.dvbFontFamily,url:l,mimeType:i.dvbMimeType,trackId:e.id,streamId:t,isEssential:s,status:"unloaded",fontFace:new FontFace(i.dvbFontFamily,"url(".concat(l,")"),{display:"swap"})})}var u,c})}function g(e,t){var r=n[e];n[e]=Va(Va({},r),{},{status:t})}function p(){n=[]}return t={addFontsFromTracks:function(e,t){if(e&&Array.isArray(e)&&t)for(var r=0;r<e.length;r++)h(e[r],t)},downloadFonts:function(){for(var e=function(e){var t=n[e];document.fonts.add(t.fontFace),s.trigger(f.Z.DVB_FONT_DOWNLOAD_ADDED,t),t.fontFace.load().then(function(){g(e,"loaded"),s.trigger(f.Z.DVB_FONT_DOWNLOAD_COMPLETE,t)},function(n){g(e,"error"),r.debug("Font download error: ",n),s.trigger(f.Z.DVB_FONT_DOWNLOAD_FAILED,t)})},t=0;t<n.length;t++)e(t)},getFonts:function(){return n},getFontsForTrackId:function(e){return n.filter(function(t){return t.trackId&&t.trackId===e})},reset:function(){!function(){var e,t=function(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return qa(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qa(e,t):void 0}}(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==r.return||r.return()}finally{if(o)throw a}}}}(n);try{for(t.s();!(e=t.n()).done;){var i=e.value,a=document.fonts.delete(i.fontFace);r.debug("Removal of fontFamily: ".concat(i.fontFamily," was ").concat(a?"successful":"unsuccessful"))}}catch(e){t.e(e)}finally{t.f()}}(),p()}},r=(0,d.Z)(i).getInstance().getLogger(t),p(),t}Ya.__dashjs_factory_name="DVBFonts";var ja=c.Z.getClassFactory(Ya);function za(e){var t,r,n,i,s,o,c,h,g,p,m,v,y,E,T=this.context,_=e.adapter,S=e.errHandler,b=e.manifestModel,A=e.mediaController,I=e.baseURLController,R=e.videoModel,w=e.settings;function D(e){if(E.error("Could not download ".concat(e.isEssential?"an essential":"a"," font - fontFamily: ").concat(e.fontFamily,", url: ").concat(e.url)),e.isEssential){var t=i[e.streamId].getTrackIdxForId(e.trackId);i[e.streamId].setModeForTrackIdx(t,a.Z.TEXT_DISABLED)}}function L(e){if(E.debug("Successfully downloaded ".concat(e.isEssential?"an essential":"a"," font - fontFamily: ").concat(e.fontFamily,", url: ").concat(e.url)),e.isEssential){var t=i[e.streamId].getTrackIdxForId(e.trackId);t===i[e.streamId].getCurrentTrackIdx()?i[e.streamId].setModeForTrackIdx(t,a.Z.TEXT_SHOWING):i[e.streamId].setModeForTrackIdx(t,a.Z.TEXT_HIDDEN)}}function C(e){var t=e.tracks,n=e.index,s=e.streamId;if(!1===w.get().streaming.text.defaultEnabled&&!O()||v)M(s,-1);else{var o=A.getCurrentTrackFor(a.Z.TEXT,s);if(o){var l={lang:o.lang,role:o.roles[0],index:o.index,codec:o.codec,accessibility:o.accessibility[0]};t.some(function(e,t){if(A.matchSettings(l,e))return M(s,t),n=t,!0})}g=!1}r[s].lastEnabledIndex=n,h.trigger(f.Z.TEXT_TRACKS_ADDED,{enabled:O(),index:n,tracks:t,streamId:s}),m=!0,y.addFontsFromTracks(t,s),y.getFonts().forEach(function(e){if(e.isEssential){var t=i[e.streamId].getTrackIdxForId(e.trackId);i[e.streamId].setModeForTrackIdx(t,a.Z.TEXT_DISABLED)}}),y.downloadFonts()}function N(e){try{var t=e.streamId;if(!i[t]||isNaN(e.time))return;i[t].manualCueProcessing(e.time)}catch(e){}}function P(e){try{var t=e.streamId;if(!i[t])return;i[t].disableManualTracks()}catch(e){}}function O(){var e=!0;return g&&!p&&(e=!1),e}function M(e,t){(g=-1===t)&&A&&A.saveTextSettingsDisabled();var r=k(e);if(r!==t&&i[e]){i[e].disableManualTracks();var s=i[e].getCurrentTrackInfo(),o=s?R.getTextTrack(s.kind,s.id,s.lang,s.isTTML,s.isEmbedded):null;o&&o.mode!==a.Z.TEXT_DISABLED&&i[e].setModeForTrackIdx(r,a.Z.TEXT_HIDDEN),i[e].setCurrentTrackIdx(t),s=i[e].getCurrentTrackInfo();var l=w.get().streaming.text.dispatchForManualRendering;s&&!l&&s.mode!==a.Z.TEXT_DISABLED&&i[e].setModeForTrackIdx(t,a.Z.TEXT_SHOWING),s&&s.isFragmented&&!s.isEmbedded?function(e,t,r){if(n[e])for(var s=n[e].getConfig().fragmentedTracks,o=0;o<s.length;o++){var l=s[o];if(t.lang===l.lang&&(l.id?t.id===l.id:t.index===l.index)){var c=A.getCurrentTrackFor(a.Z.TEXT,e);(l.id?c.id!==l.id:c.index!==l.index)?(i[e].deleteCuesFromTrackIdx(r),n[e].setCurrentFragmentedTrackIdx(o)):-1===r&&h.trigger(u.Z.SET_FRAGMENTED_TEXT_AFTER_DISABLED,{},{streamId:e,mediaType:a.Z.TEXT})}}}(e,s,r):s&&!s.isFragmented&&function(e,t){h.trigger(u.Z.SET_NON_FRAGMENTED_TEXT,{currentTrackInfo:t},{streamId:e,mediaType:a.Z.TEXT})}(e,s),A.setTrack(s)}}function k(e){return i[e].getCurrentTrackIdx()}function x(){n={},i={},r={},g=!0,m=!1,v=!1}return t={deactivateStream:function(e){if(e){var t=e.id;n[t]&&n[t].resetMediaInfos(),i[t]&&i[t].deleteAllTextTracks()}},initialize:function(){y=ja(T).create({adapter:_,baseURLController:I}),h.on(u.Z.TEXT_TRACKS_QUEUE_INITIALIZED,C,t),h.on(u.Z.DVB_FONT_DOWNLOAD_FAILED,D,t),h.on(u.Z.DVB_FONT_DOWNLOAD_COMPLETE,L,t),w.get().streaming.text.webvtt.customRenderingEnabled&&(h.on(u.Z.PLAYBACK_TIME_UPDATED,N,t),h.on(u.Z.PLAYBACK_SEEKING,P,t))},initializeForStream:function(e){var t=e.id,a=xa(T).create({videoModel:R,settings:w,streamInfo:e});a.initialize(),i[t]=a;var l=Na(T).create({errHandler:S,adapter:_,dvbFonts:y,manifestModel:b,mediaController:A,videoModel:R,textTracks:a,vttParser:s,vttCustomRenderingParser:o,ttmlParser:c,streamInfo:e,settings:w});l.initialize(),n[t]=l,r[t]={},r[t].lastEnabledIndex=-1},createTracks:function(e){var t=e.id;i[t]&&i[t].createTracks()},getTextSourceBuffer:function(e){var t=e.id;if(n&&n[t])return n[t]},getAllTracksAreDisabled:function(){return g},addEmbeddedTrack:function(e,t){var r=e.id;n[r]&&n[r].addEmbeddedTrack(t)},enableText:function(e,t){return(0,j.PS)(t,"boolean"),O()!==t&&(t&&M(e,r[e].lastEnabledIndex),t||(r[e].lastEnabledIndex=k(e),m?M(e,-1):v=!0)),!0},isTextEnabled:O,setTextTrack:M,getCurrentTrackIdx:k,enableForcedTextStreaming:function(e){return(0,j.PS)(e,"boolean"),p=e,!0},addMediaInfosToBuffer:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=e.id;n[a]&&n[a].addMediaInfos(t,r,i)},reset:function(){y.reset(),x(),h.off(u.Z.TEXT_TRACKS_QUEUE_INITIALIZED,C,t),h.off(u.Z.DVB_FONT_DOWNLOAD_FAILED,D,t),h.off(u.Z.DVB_FONT_DOWNLOAD_COMPLETE,L,t),w.get().streaming.text.webvtt.customRenderingEnabled&&(h.off(u.Z.PLAYBACK_TIME_UPDATED,N,t),h.off(u.Z.PLAYBACK_SEEKING,P,t)),Object.keys(n).forEach(function(e){n[e].resetEmbedded(),n[e].reset()})}},p=!1,m=!1,v=!1,s=Ba(T).getInstance(),o=Za(T).getInstance(),c=Ha(T).getInstance(),h=(0,l.Z)(T).getInstance(),E=(0,d.Z)(T).getInstance().getLogger(t),x(),t}za.__dashjs_factory_name="TextController";var Wa=c.Z.getClassFactory(za);function Xa(){var e,t,r,n,h,p,m,v,y,E,T,_,b,A,I,R,C,N,P,O,M,k,x,F,B,U,Z,G,H,$,V,K,q,Y,z,Q,J,ee,te,re="You must first call initialize() and set a source before calling this method",ne="You must first call initialize() and set a valid source and view before calling this method",ie="You must first call attachView() to set the video element before calling this method",ae="You must first call attachSource() with a valid source before calling this method",se="MediaPlayer not initialized!",oe=this.context,le=(0,l.Z)(oe).getInstance(),ue=(0,D.Z)(oe).getInstance(),ce=(0,d.Z)(oe).getInstance({settings:ue});function de(){Ie(null),be(null),n=null,A&&(A.reset(),A=null),I&&(I.reset(),I=null),O&&O.reset(),ue.reset(),C&&(C.reset(),C=null)}function fe(){return!!r&&!!Q.getElement()}function he(){return(0,Pi.e)()}function ge(){if(!m)throw ne;return G.isPaused()}function pe(){if(!m)throw ne;return G.getIsDynamic()}function me(e){var t=B&&B.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,r=K.getCurrentDVRInfo(t);if(!r)return 0;var n=G.getOriginalLiveDelay(),i=r.range.start+e;return i>r.range.end-n&&(i=r.range.end-n),i}function ve(e){if(!m)throw ne;var t=Se().currentTime;if(void 0!==e)t=B.getTimeRelativeToStreamId(t,e);else if(G.getIsDynamic()){var r=B&&B.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,n=K.getCurrentDVRInfo(r);t=null===n||0===t?0:Math.max(0,t-n.range.start)}return t}function ye(){if(!m)throw ne;var e=Se().duration;if(G.getIsDynamic()){var t=B&&B.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,r=K.getCurrentDVRInfo(t);e=r?r.range.end-r.range.start:0}return e}function Ee(e){(0,j.PS)(e,"boolean"),v=e}function Te(){O.restoreDefaultUTCTimingSources()}function _e(){return K}function Se(){if(!Q.getElement())throw ie;return Q.getElement()}function be(e){if(!h)throw se;Q.setElement(e),e&&(Ce(),function(){if(!I){var e=dashjs.MetricsReporting;if("function"==typeof e){var t=e(oe).create();I=t.createMetricsReporting({debug:ce,eventBus:le,mediaElement:Se(),adapter:N,dashMetrics:K,mediaPlayerModel:P,events:u.Z,constants:a.Z,metricsConstants:o.Z})}}}(),function(){if(!R){var e=dashjs.MssHandler;"function"==typeof e&&(w.extend(e.errors),R=e(oe).create({eventBus:le,mediaPlayerModel:P,dashMetrics:K,manifestModel:q,playbackController:G,streamController:B,protectionController:A,baseURLController:k,errHandler:M,events:u.Z,constants:a.Z,debug:ce,initSegmentType:L.w.INIT_SEGMENT_TYPE,BASE64:Ta,ISOBoxer:_a,settings:ue}))}}(),B&&B.switchToVideoElement(y)),m&&we(),Oe(y)}function Ae(e){if(!p)throw re;var t=B.getActiveStreamInfo();return t?b.getTracksFor(e,t.id):[]}function Ie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN;if(!h)throw se;"string"==typeof e&&J.initialize(e),null==t&&(t=NaN),isNaN(t)||(t=Math.max(0,t)),y=t,r=e,(p||m)&&we(),fe()&&Oe(y)}function Re(){if(!p)throw re;var e=B.getActiveStreamInfo();return e?B.getStreamById(e.id):null}function we(){m=!1,p=!1,N.reset(),B.reset(),Z.reset(),V.reset(),G.reset(),H.reset(),$.reset(),E.reset(),b.reset(),te.reset(),A&&(ue.get().streaming.protection.keepProtectionMediaKeys?A.stop():(A.reset(),A=null,Ce())),U.reset(),Y.reset(),z.reset()}function De(){var e=Le();B||(B=lr(oe).getInstance()),U||(U=Wa(oe).create({errHandler:M,manifestModel:q,adapter:N,mediaController:b,baseURLController:k,videoModel:Q,settings:ue})),F.setConfig({capabilities:x,customParametersModel:O,adapter:N,settings:ue,manifestModel:q,errHandler:M}),B.setConfig({capabilities:x,capabilitiesFilter:F,manifestLoader:e,manifestModel:q,mediaPlayerModel:P,customParametersModel:O,protectionController:A,textController:U,adapter:N,dashMetrics:K,errHandler:M,timelineConverter:_,videoModel:Q,playbackController:G,serviceDescriptionController:H,contentSteeringController:$,abrController:E,mediaController:b,settings:ue,baseURLController:k,uriFragmentModel:J,segmentBaseController:te}),Z.setConfig({settings:ue,playbackController:G,streamController:B,videoModel:Q,timelineConverter:_,adapter:N}),G.setConfig({streamController:B,serviceDescriptionController:H,dashMetrics:K,adapter:N,videoModel:Q,timelineConverter:_,settings:ue}),V.setConfig({streamController:B,playbackController:G,mediaPlayerModel:P,videoModel:Q,settings:ue}),E.setConfig({streamController:B,domStorage:ee,mediaPlayerModel:P,customParametersModel:O,cmsdModel:z,dashMetrics:K,adapter:N,videoModel:Q,settings:ue}),Y.setConfig({abrController:E,dashMetrics:K,playbackController:G}),z.setConfig({}),E.initialize(),B.initialize(v,n),U.initialize(),Z.initialize(),V.initialize(),Y.initialize(),z.initialize(),$.initialize(),te.initialize()}function Le(){return jn(oe).create({debug:ce,errHandler:M,dashMetrics:K,mediaPlayerModel:P,requestModifier:(0,W.Z)(oe).getInstance(),mssHandler:R,settings:ue})}function Ce(){if(A)return A;var e=dashjs.Protection;if("function"==typeof e){var t=e(oe).create();return u.Z.extend(e.events),f.Z.extend(e.events,{publicOnly:!0}),w.extend(e.errors),x||(x=(0,Xn.Z)(oe).getInstance()),A=t.createProtectionSystem({debug:ce,errHandler:M,videoModel:Q,customParametersModel:O,capabilities:x,eventBus:le,events:u.Z,BASE64:Ta,constants:a.Z,cmcdModel:Y,settings:ue})}return null}function Ne(){if(!h)throw se;if(C)return C;var e=dashjs.OfflineController;if("function"==typeof e){u.Z.extend(e.events),f.Z.extend(e.events,{publicOnly:!0}),w.extend(e.errors);var t=Le(),r=Xt(oe).create();return r.setConfig({manifestModel:q,adapter:N,manifestLoader:t,errHandler:M,contentSteeringController:$}),C=e(oe).create({debug:ce,manifestUpdater:r,baseURLController:k,manifestLoader:t,manifestModel:q,mediaPlayerModel:P,abrController:E,playbackController:G,adapter:N,errHandler:M,dashMetrics:K,timelineConverter:_,segmentBaseController:te,schemeLoaderFactory:T,eventBus:le,events:u.Z,errors:w,constants:a.Z,settings:ue,dashConstants:s.Z,urlUtils:(0,X.Z)(oe).getInstance()})}return null}function Pe(e){var t=B&&B.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,r=K.getCurrentDVRInfo(t);return r?e+(r.manifestInfo.availableFrom.getTime()/1e3+r.range.start):0}function Oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:NaN;C&&C.resetRecords(),!p&&r&&(p=!0,t.info("Streaming Initialized"),De(),"string"==typeof r?B.load(r,e):B.loadWithManifest(r,e)),!m&&fe()&&(m=!0,t.info("Playback Initialized"))}return e={initialize:function(e,r,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN;x||(x=(0,Xn.Z)(oe).getInstance()).setConfig({settings:ue}),M||(M=Wn(oe).getInstance()),x.supportsMediaSource()?(h||(h=!0,_=Ea(oe).getInstance(),E||(E=Ti(oe).getInstance()).setConfig({settings:ue}),T||(T=Tt(oe).getInstance()),G||(G=g(oe).getInstance()),b||(b=br(oe).getInstance()),B||(B=lr(oe).getInstance()),Z||(Z=cr(oe).getInstance()),V||(V=fr(oe).getInstance()),H||(H=vr(oe).getInstance()),$||($=Yt(oe).getInstance()),F||(F=Jn(oe).getInstance()),N=Ji(oe).getInstance(),q=ii(oe).getInstance(),Y=Ye(oe).getInstance(),z=ft(oe).getInstance(),K=va(oe).getInstance({settings:ue}),ee=Ni(oe).getInstance({settings:ue}),N.setConfig({constants:a.Z,cea608parser:i(),errHandler:M,BASE64:Ta}),k||(k=Fr(oe).create()),k.setConfig({adapter:N,contentSteeringController:$}),H.setConfig({adapter:N}),te||(te=Gi(oe).getInstance({dashMetrics:K,mediaPlayerModel:P,errHandler:M,baseURLController:k,events:u.Z,eventBus:le,debug:ce,boxParser:(0,Bt.Z)(oe).getInstance(),requestModifier:(0,W.Z)(oe).getInstance(),errors:w})),b.setConfig({domStorage:ee,settings:ue,customParametersModel:O}),P.setConfig({playbackController:G,serviceDescriptionController:H}),$.setConfig({adapter:N,errHandler:M,dashMetrics:K,mediaPlayerModel:P,manifestModel:q,serviceDescriptionController:H,eventBus:le,requestModifier:(0,W.Z)(oe).getInstance()}),Te(),Ee(void 0===n||n),Ne()),e&&be(e),r&&Ie(r,s),t.info("[dash.js "+he()+"] MediaPlayer has been initialized")):M.error(new S.Z(w.CAPABILITY_MEDIASOURCE_ERROR_CODE,w.CAPABILITY_MEDIASOURCE_ERROR_MESSAGE))},setConfig:function(e){e&&(e.capabilities&&(x=e.capabilities),e.capabilitiesFilter&&(F=e.capabilitiesFilter),e.streamController&&(B=e.streamController),e.textController&&(U=e.textController),e.gapController&&(Z=e.gapController),e.playbackController&&(G=e.playbackController),e.serviceDescriptionController&&(H=e.serviceDescriptionController),e.contentSteeringController&&($=e.contentSteeringController),e.catchupController&&(V=e.catchupController),e.mediaPlayerModel&&(P=e.mediaPlayerModel),e.customParametersModel&&(O=e.customParametersModel),e.abrController&&(E=e.abrController),e.schemeLoaderFactory&&(T=e.schemeLoaderFactory),e.mediaController&&(b=e.mediaController),e.settings&&(ue=e.settings))},on:function(e,t,r,n){le.on(e,t,r,n)},off:function(e,t,r){le.off(e,t,r)},extend:function(e,t,r){c.Z.extend(e,t,r,oe)},attachView:be,attachSource:Ie,refreshManifest:function(e){if(!h)throw se;if(!fe())return e(null,ae);var t=this;"function"==typeof e&&le.on(u.Z.INTERNAL_MANIFEST_LOADED,function r(n){le.off(u.Z.INTERNAL_MANIFEST_LOADED,r,t),n.error?e(null,n.error):e(n.manifest)},t),B.refreshManifest()},isReady:fe,preload:function(){if(!Q.getElement()&&!p){if(!r)throw ae;Oe(y)}},play:function(){if(!m)throw ne;(!v||ge()&&m)&&G.play(!0)},isPaused:ge,pause:function(){if(!m)throw ne;G.pause()},isSeeking:function(){if(!m)throw ne;return G.isSeeking()},isDynamic:pe,getLowLatencyModeEnabled:function(){if(!m)throw ne;return G.getLowLatencyModeEnabled()},seek:function(e){if(!m)throw ne;if((0,j.PS)(e,"number"),isNaN(e))throw a.Z.BAD_ARGUMENT_ERROR;e<0&&(e=0);var t=G.getIsDynamic()?me(e):e,r=Se();!G.getIsDynamic()&&r.duration&&(t=Math.min(r.duration,t)),G.seek(t,!1,!1,!0)},seekToOriginalLive:function(){m&&pe()&&G.seekToOriginalLive()},setPlaybackRate:function(e){Se().playbackRate=e},getPlaybackRate:function(){return Se().playbackRate},setMute:function(e){(0,j.PS)(e,"boolean"),Se().muted=e},isMuted:function(){return Se().muted},setVolume:function(e){if("number"!=typeof e||isNaN(e)||e<0||e>1)throw a.Z.BAD_ARGUMENT_ERROR;Se().volume=e},getVolume:function(){return Se().volume},time:ve,duration:ye,timeAsUTC:function(){if(!m)throw ne;return ve()<0?NaN:Pe(ve())},durationAsUTC:function(){if(!m)throw ne;return Pe(ye())},getActiveStream:Re,getDVRWindowSize:function(){var e=B&&B.hasVideoTrack()?a.Z.VIDEO:a.Z.AUDIO,t=K.getCurrentDVRInfo(e);return t?t.manifestInfo.dvrWindowSize:0},getDVRSeekOffset:me,getAvailableBaseUrls:function(){var e=q.getValue();return e?k.getBaseUrls(e):[]},getAvailableLocations:function(){var e=q.getValue();if(!e)return[];var t=N.getLocation(e),r=$.getSynthesizedLocationElements(t);return t.concat(r)},getTargetLiveDelay:function(){if(!m)throw ne;return G.getOriginalLiveDelay()},convertToTimeCode:function(e){e=Math.max(e,0);var t=Math.floor(e/3600),r=Math.floor(e%3600/60),n=Math.floor(e%3600%60);return(0===t?"":t<10?"0"+t.toString()+":":t.toString()+":")+(r<10?"0"+r.toString():r.toString())+":"+(n<10?"0"+n.toString():n.toString())},formatUTC:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=new Date(1e3*e),a=i.toLocaleDateString(t),s=i.toLocaleTimeString(t,{hour12:r});return n?s+" "+a:s},getVersion:he,getDebug:function(){return ce},getBufferLength:function(e){var r=[a.Z.VIDEO,a.Z.AUDIO,a.Z.TEXT];if(e)return-1!==r.indexOf(e)?_e().getCurrentBufferLevel(e)||NaN:(t.warn("getBufferLength requested for invalid type"),NaN);var n=r.map(function(e){return Ae(e).length>0?_e().getCurrentBufferLevel(e):Number.MAX_VALUE}).reduce(function(e,t){return Math.min(e,t)});return n===Number.MAX_VALUE?NaN:n},getTTMLRenderingDiv:function(){return Q?Q.getTTMLRenderingDiv():null},getVideoElement:Se,getSource:function(){if(!r)throw ae;return r},updateSource:function(e){r=e,B.load(r)},getCurrentLiveLatency:function(){if(!h)throw se;return m?G.getCurrentLiveLatency():NaN},getTopBitrateInfoFor:function(e){if(!p)throw re;return E.getTopBitrateInfoFor(e)},setAutoPlay:Ee,getAutoPlay:function(){return v},getDashMetrics:_e,getQualityFor:function(e){if(!p)throw re;if(e===a.Z.IMAGE){var t=Re();if(!t)return-1;var r=t.getThumbnailController();return r?r.getCurrentTrackIndex():-1}return E.getQualityFor(e)},setQualityFor:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!p)throw re;if(e===a.Z.IMAGE){var n=Re();if(!n)return;var i=n.getThumbnailController();i&&i.setTrackByIndex(t)}E.setPlaybackQuality(e,B.getActiveStreamInfo(),t,{forceReplace:r})},updatePortalSize:function(){E.setElementSize(),E.setWindowResizeEventCalled(!0)},enableText:function(e){var t=B.getActiveStreamInfo();return!(!t||!U)&&U.enableText(t.id,e)},enableForcedTextStreaming:function(e){return!(!B.getActiveStreamInfo()||!U)&&U.enableForcedTextStreaming(e)},isTextEnabled:function(){var e=B.getActiveStreamInfo();return!(!e||!U)&&U.isTextEnabled(e)},setTextTrack:function(e){if(!m)throw ne;var t=B.getActiveStreamInfo();t&&U&&U.setTextTrack(t.id,e)},getBitrateInfoListFor:function(e){if(!p)throw re;var t=Re();return t?t.getBitrateListFor(e):[]},getStreamsFromManifest:function(e){if(!p)throw re;return N.getStreamsInfo(e)},getTracksFor:Ae,getTracksForTypeFromManifest:function(e,t,r){if(!p)throw re;return(r=r||N.getStreamsInfo(t,1)[0])?N.getAllMediaInfoForType(r,e,t):[]},getCurrentTrackFor:function(e){if(!p)throw re;var t=B.getActiveStreamInfo();return b.getCurrentTrackFor(e,t.id)},setInitialMediaSettingsFor:function(e,t){if(!h)throw se;b.setInitialSettings(e,t)},getInitialMediaSettingsFor:function(e){if(!h)throw se;return b.getInitialSettings(e)},setCurrentTrack:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!p)throw re;b.setTrack(e,t)},addABRCustomRule:function(e,t,r){O.addAbrCustomRule(e,t,r)},removeABRCustomRule:function(e){O.removeAbrCustomRule(e)},removeAllABRCustomRule:function(){O.removeAllAbrCustomRule()},getABRCustomRules:function(){return O.getAbrCustomRules()},getAverageThroughput:function(e){var t=E.getThroughputHistory(),r=G.getIsDynamic();return t?t.getAverageThroughput(e,r):0},retrieveManifest:function(e,t){var r=Le(),n=this;le.on(u.Z.INTERNAL_MANIFEST_LOADED,function e(i){i.error?t(null,i.error):t(i.manifest),le.off(u.Z.INTERNAL_MANIFEST_LOADED,e,n),r.reset()},n),J.initialize(e),r.load(e)},addUTCTimingSource:function(e,t){O.addUTCTimingSource(e,t)},removeUTCTimingSource:function(e,t){O.removeUTCTimingSource(e,t)},clearDefaultUTCTimingSources:function(){O.clearDefaultUTCTimingSources()},restoreDefaultUTCTimingSources:Te,setXHRWithCredentialsForType:function(e,t){O.setXHRWithCredentialsForType(e,t)},getXHRWithCredentialsForType:function(e){return O.getXHRWithCredentialsForType(e)},getProtectionController:function(){return Ce()},attachProtectionController:function(e){A=e},setProtectionData:function(e){n=e,B&&B.setProtectionData(n)},registerLicenseRequestFilter:function(e){O.registerLicenseRequestFilter(e)},registerLicenseResponseFilter:function(e){O.registerLicenseResponseFilter(e)},unregisterLicenseRequestFilter:function(e){O.unregisterLicenseRequestFilter(e)},unregisterLicenseResponseFilter:function(e){O.unregisterLicenseResponseFilter(e)},registerCustomCapabilitiesFilter:function(e){O.registerCustomCapabilitiesFilter(e)},unregisterCustomCapabilitiesFilter:function(e){O.unregisterCustomCapabilitiesFilter(e)},setCustomInitialTrackSelectionFunction:function(e){O.setCustomInitialTrackSelectionFunction(e)},resetCustomInitialTrackSelectionFunction:function(){O.resetCustomInitialTrackSelectionFunction(null)},attachTTMLRenderingDiv:function(e){if(!Q.getElement())throw ie;Q.setTTMLRenderingDiv(e)},attachVttRenderingDiv:function(e){if(!Q.getElement())throw ie;Q.setVttRenderingDiv(e)},getCurrentTextTrackIndex:function(){var e=B.getActiveStreamInfo();if(e&&U)return U.getCurrentTrackIdx(e.id)},provideThumbnail:function(e,t){if("function"==typeof t)if(e<0)t(null);else{var r=G.getIsDynamic()?me(e):e,n=B.getStreamForTime(r);if(null!==n){var i=n.getThumbnailController();if(i)return i.provide(r,t);t(null)}else t(null)}},getDashAdapter:function(){return N},getOfflineController:function(){return Ne()},triggerSteeringRequest:function(){if($)return $.loadSteeringData()},getCurrentSteeringResponseData:function(){if($)return $.getCurrentSteeringResponseData()},getSettings:function(){return ue.get()},updateSettings:function(e){ue.update(e)},resetSettings:function(){ue.reset()},reset:de,destroy:function(){de(),c.Z.deleteSingletonInstances(oe)}},t=ce.getLogger(e),h=!1,m=!1,p=!1,v=!0,y=NaN,A=null,C=null,n=null,N=null,te=null,u.Z.extend(f.Z),P=oi(oe).getInstance(),O=(0,pt.Z)(oe).getInstance(),Q=bi(oe).getInstance(),J=ri(oe).getInstance(),e}Xa.__dashjs_factory_name="MediaPlayer";var Qa=c.Z.getClassFactory(Xa);Qa.events=f.Z,Qa.errors=w,c.Z.updateClassFactory(Xa.__dashjs_factory_name,Qa);var Ja=Qa},8825:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}var o=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=s(t);if(r){var i=s(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return a(this,e)});function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=n.call(this)).AST_IN_FUTURE="astInFuture",e.BASE_URLS_UPDATED="baseUrlsUpdated",e.BUFFER_EMPTY="bufferStalled",e.BUFFER_LOADED="bufferLoaded",e.BUFFER_LEVEL_STATE_CHANGED="bufferStateChanged",e.BUFFER_LEVEL_UPDATED="bufferLevelUpdated",e.DVB_FONT_DOWNLOAD_ADDED="dvbFontDownloadAdded",e.DVB_FONT_DOWNLOAD_COMPLETE="dvbFontDownloadComplete",e.DVB_FONT_DOWNLOAD_FAILED="dvbFontDownloadFailed",e.DYNAMIC_TO_STATIC="dynamicToStatic",e.ERROR="error",e.FRAGMENT_LOADING_COMPLETED="fragmentLoadingCompleted",e.FRAGMENT_LOADING_PROGRESS="fragmentLoadingProgress",e.FRAGMENT_LOADING_STARTED="fragmentLoadingStarted",e.FRAGMENT_LOADING_ABANDONED="fragmentLoadingAbandoned",e.LOG="log",e.MANIFEST_LOADING_STARTED="manifestLoadingStarted",e.MANIFEST_LOADING_FINISHED="manifestLoadingFinished",e.MANIFEST_LOADED="manifestLoaded",e.METRICS_CHANGED="metricsChanged",e.METRIC_CHANGED="metricChanged",e.METRIC_ADDED="metricAdded",e.METRIC_UPDATED="metricUpdated",e.PERIOD_SWITCH_STARTED="periodSwitchStarted",e.PERIOD_SWITCH_COMPLETED="periodSwitchCompleted",e.QUALITY_CHANGE_REQUESTED="qualityChangeRequested",e.QUALITY_CHANGE_RENDERED="qualityChangeRendered",e.TRACK_CHANGE_RENDERED="trackChangeRendered",e.STREAM_INITIALIZING="streamInitializing",e.STREAM_UPDATED="streamUpdated",e.STREAM_ACTIVATED="streamActivated",e.STREAM_DEACTIVATED="streamDeactivated",e.STREAM_INITIALIZED="streamInitialized",e.STREAM_TEARDOWN_COMPLETE="streamTeardownComplete",e.TEXT_TRACKS_ADDED="allTextTracksAdded",e.TEXT_TRACK_ADDED="textTrackAdded",e.CUE_ENTER="cueEnter",e.CUE_EXIT="cueExit",e.THROUGHPUT_MEASUREMENT_STORED="throughputMeasurementStored",e.TTML_PARSED="ttmlParsed",e.TTML_TO_PARSE="ttmlToParse",e.CAPTION_RENDERED="captionRendered",e.CAPTION_CONTAINER_RESIZE="captionContainerResize",e.CAN_PLAY="canPlay",e.CAN_PLAY_THROUGH="canPlayThrough",e.PLAYBACK_ENDED="playbackEnded",e.PLAYBACK_ERROR="playbackError",e.PLAYBACK_NOT_ALLOWED="playbackNotAllowed",e.PLAYBACK_METADATA_LOADED="playbackMetaDataLoaded",e.PLAYBACK_LOADED_DATA="playbackLoadedData",e.PLAYBACK_PAUSED="playbackPaused",e.PLAYBACK_PLAYING="playbackPlaying",e.PLAYBACK_PROGRESS="playbackProgress",e.PLAYBACK_RATE_CHANGED="playbackRateChanged",e.PLAYBACK_SEEKED="playbackSeeked",e.PLAYBACK_SEEKING="playbackSeeking",e.PLAYBACK_STALLED="playbackStalled",e.PLAYBACK_STARTED="playbackStarted",e.PLAYBACK_TIME_UPDATED="playbackTimeUpdated",e.PLAYBACK_VOLUME_CHANGED="playbackVolumeChanged",e.PLAYBACK_WAITING="playbackWaiting",e.MANIFEST_VALIDITY_CHANGED="manifestValidityChanged",e.EVENT_MODE_ON_START="eventModeOnStart",e.EVENT_MODE_ON_RECEIVE="eventModeOnReceive",e.CONFORMANCE_VIOLATION="conformanceViolation",e.REPRESENTATION_SWITCH="representationSwitch",e.ADAPTATION_SET_REMOVED_NO_CAPABILITIES="adaptationSetRemovedNoCapabilities",e.CONTENT_STEERING_REQUEST_COMPLETED="contentSteeringRequestCompleted",e.INBAND_PRFT="inbandPrft",e.MANAGED_MEDIA_SOURCE_START_STREAMING="managedMediaSourceStartStreaming",e.MANAGED_MEDIA_SOURCE_END_STREAMING="managedMediaSourceEndStreaming",e}return o}(r(8342).Z));t.Z=o},3393:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.CONTENT_STEERING="contentSteering",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.ABR_FETCH_THROUGHPUT_CALCULATION_AAST="abrFetchThroughputCalculationAAST",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY="highestSelectionPriority",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.TEXT_DISABLED="disabled",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_DVB_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.FONT_DOWNLOAD_DVB_SCHEME="urn:dvb:dash:fontdownload:2014",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability",this.OFF_MIMETYPE="application/font-sfnt",this.WOFF_MIMETYPE="application/font-woff",this.VIDEO_ELEMENT_READY_STATES={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},this.FILE_LOADER_TYPES={FETCH:"fetch_loader",XHR:"xhr_loader"}}}])&&r(e.prototype,t),e}());t.Z=n},3860:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.TCP_CONNECTION="TcpList",this.HTTP_REQUEST="HttpList",this.TRACK_SWITCH="RepSwitchList",this.BUFFER_LEVEL="BufferLevel",this.BUFFER_LOADED="bufferLoaded",this.ABANDON_LOAD="abandonload",this.ALLOW_LOAD="allowload",this.BUFFER_EMPTY="bufferStalled",this.BUFFER_STATE="BufferState",this.DVR_INFO="DVRInfo",this.DROPPED_FRAMES="DroppedFrames",this.SCHEDULING_INFO="SchedulingInfo",this.REQUESTS_QUEUE="RequestsQueue",this.MANIFEST_UPDATE="ManifestUpdate",this.MANIFEST_UPDATE_STREAM_INFO="ManifestUpdatePeriodInfo",this.MANIFEST_UPDATE_TRACK_INFO="ManifestUpdateRepresentationInfo",this.PLAY_LIST="PlayList",this.DVB_ERRORS="DVBErrors",this.HTTP_REQUEST_DVB_REPORTING_TYPE="DVBReporting"}}])&&r(e.prototype,t),e}());t.Z=n},8080:function(e,t,r){r.d(t,{default:function(){return q}});var n=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mpdurl=null,this.errorcode=null,this.terror=null,this.url=null,this.ipaddress=null,this.servicelocation=null};n.SSL_CONNECTION_FAILED_PREFIX="SSL",n.DNS_RESOLUTION_FAILED="C00",n.HOST_UNREACHABLE="C01",n.CONNECTION_REFUSED="C02",n.CONNECTION_ERROR="C03",n.CORRUPT_MEDIA_ISOBMFF="M00",n.CORRUPT_MEDIA_OTHER="M01",n.BASE_URL_CHANGED="F00",n.BECAME_REPORTER="S00";var i=n,a=r(1180);function s(e){var t,r,n=(e=e||{}).eventBus,s=e.dashMetrics,o=e.metricsConstants,l=e.events;function u(e){var t=new i;if(r){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.mpdurl||(t.mpdurl=r.originalUrl||r.url),t.terror||(t.terror=new Date),s.addDVBErrors(t)}}function c(e){e.error||(r=e.manifest)}function d(e){u({errorcode:i.BASE_URL_CHANGED,servicelocation:e.entry})}function f(){u({errorcode:i.BECAME_REPORTER})}function h(e){var t;e.metric===o.HTTP_REQUEST&&(0===(t=e.value).responsecode||null==t.responsecode||t.responsecode>=400||t.responsecode<100||t.responsecode>=600)&&u({errorcode:t.responsecode||i.CONNECTION_ERROR,url:t.url,terror:t.tresponse,servicelocation:t._serviceLocation})}function g(e){var t;switch(e.error?e.error.code:0){case MediaError.MEDIA_ERR_NETWORK:t=i.CONNECTION_ERROR;break;case MediaError.MEDIA_ERR_DECODE:t=i.CORRUPT_MEDIA_OTHER;break;default:return}u({errorcode:t})}return t={initialize:function(){n.on(l.MANIFEST_UPDATED,c,t),n.on(l.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,d,t),n.on(l.METRIC_ADDED,h,t),n.on(l.METRIC_UPDATED,h,t),n.on(l.PLAYBACK_ERROR,g,t),n.on(a.Z.BECAME_REPORTING_PLAYER,f,t)},reset:function(){n.off(l.MANIFEST_UPDATED,c,t),n.off(l.SERVICE_LOCATION_BASE_URL_BLACKLIST_CHANGED,d,t),n.off(l.METRIC_ADDED,h,t),n.off(l.METRIC_UPDATED,h,t),n.off(l.PLAYBACK_ERROR,g,t),n.off(a.Z.BECAME_REPORTING_PLAYER,f,t)}}}s.__dashjs_factory_name="DVBErrorsTranslator";var o=dashjs.FactoryMaker.getSingletonFactory(s),l=r(2295);function u(e){e=e||{};var t,r,n=!1,i=this.context,a=e.mediaElement;return t={initialize:function(e){e&&e.length&&(e.forEach(function(e){var t=e.starttime,n=t+e.duration;r.add(t,n)}),n=!!e[0]._useWallClockTime)},reset:function(){r.clear()},isEnabled:function(){var e,t=r.length;if(!t)return!0;e=n?(new Date).getTime()/1e3:a.currentTime;for(var i=0;i<t;i+=1){var s=r.start(i),o=r.end(i);if(s<=e&&e<o)return!0}return!1}},r=(0,l.Z)(i).create(),t}u.__dashjs_factory_name="RangeController";var c=dashjs.FactoryMaker.getClassFactory(u);function d(){return{serialise:function e(t){var r,n,i=[],a=[];for(r in t)if(t.hasOwnProperty(r)&&0!==r.indexOf("_")){if(null==(n=t[r])&&(n=""),Array.isArray(n)){if(!n.length)continue;a=[],n.forEach(function(t){var r="Object"!==Object.prototype.toString.call(t).slice(8,-1);a.push(r?t:e(t))}),n=a.map(encodeURIComponent).join(",")}else"string"==typeof n?n=encodeURIComponent(n):n instanceof Date?n=n.toISOString():"number"==typeof n&&(n=Math.round(n));i.push(r+"="+n)}return i.join("&")}}}d.__dashjs_factory_name="MetricSerialiser";var f=dashjs.FactoryMaker.getSingletonFactory(d);function h(){var e,t,r,n=window.crypto||window.msCrypto,i=Uint32Array,a=Math.pow(2,8*i.BYTES_PER_ELEMENT)-1;function s(){n&&(e||(e=new i(10)),n.getRandomValues(e),t=0)}return r={random:function(r,i){var o;return r||(r=0),i||(i=1),n?(t===e.length&&s(),o=e[t]/a,t+=1):o=Math.random(),o*(i-r)+r}},s(),r}h.__dashjs_factory_name="RNG";var g=dashjs.FactoryMaker.getSingletonFactory(h),p=r(5717);function m(e){var t;e=e||{};var r,n,i,a,s,o,l,u=this.context,c=[],d=e.metricsConstants;function h(){a=!1,s=!1,o=null,l=null}return t={report:function(e,t){Array.isArray(t)||(t=[t]),s&&l.isEnabled()&&t.forEach(function(t){var i=r.serialise(t);e!==d.DVB_ERRORS&&(i="metricname=".concat(e,"&").concat(i)),function(e,t,r){var i=new XMLHttpRequest;i.withCredentials=n.getXHRWithCredentialsForType(d.HTTP_REQUEST_DVB_REPORTING_TYPE);var a=function(){var e=c.indexOf(i);-1!==e&&(c.splice(e,1),!(i.status>=200&&i.status<300)&&r&&r())};c.push(i);try{i.open("GET",e),i.onloadend=a,i.onerror=a,i.send()}catch(e){i.onerror()}}(i="".concat(o,"?").concat(i),0,function(){s=!1})})},initialize:function(e,t){var r;if(l=t,!(o=e.dvbReportingUrl))throw new Error("required parameter missing (dvb:reportingUrl)");a||((r=e.dvbProbability)&&(1e3===r||r/1e3>=i.random())&&(s=!0),a=!0)},reset:function(){h()}},r=f(u).getInstance(),i=g(u).getInstance(),n=(0,p.Z)(u).getInstance(),h(),t}m.__dashjs_factory_name="DVBReporting";var v=dashjs.FactoryMaker.getClassFactory(m);function y(e){e=e||{};var t,r={"urn:dvb:dash:reporting:2014":v},n=this.context,i=e.debug?e.debug.getLogger(t):{},a=e.metricsConstants,s=e.mediaPlayerModel||{};return{create:function(e,t){var o;try{(o=r[e.schemeIdUri](n).create({metricsConstants:a,mediaPlayerModel:s})).initialize(e,t)}catch(t){o=null,i.error("ReportingFactory: could not create Reporting with schemeIdUri ".concat(e.schemeIdUri," (").concat(t.message,")"))}return o},register:function(e,t){r[e]=t},unregister:function(e){delete r[e]}}}y.__dashjs_factory_name="ReportingFactory";var E=dashjs.FactoryMaker.getSingletonFactory(y);function T(e){var t=[],r=E(this.context).getInstance(e);return{initialize:function(e,n){e.some(function(e){var i=r.create(e,n);if(i)return t.push(i),!0})},reset:function(){t.forEach(function(e){return e.reset()}),t=[]},report:function(e,r){t.forEach(function(t){return t.report(e,r)})}}}T.__dashjs_factory_name="ReportingController";var _=dashjs.FactoryMaker.getClassFactory(T);function S(){return{reconstructFullMetricName:function(e,t,r){var n=e;return t&&(n+="("+t,r&&r.length&&(n+=","+r),n+=")"),n},validateN:function(e){if(!e)throw new Error("missing n");if(isNaN(e))throw new Error("n is NaN");if(e<0)throw new Error("n must be positive");return e}}}S.__dashjs_factory_name="HandlerHelpers";var b=dashjs.FactoryMaker.getSingletonFactory(S);function A(e){var t,r,n,i,a;e=e||{};var s=this.context,o=b(s).getInstance(),l=[],u=e.metricsConstants;function c(){var e=function(){try{return Object.keys(l).map(function(e){return l[e]}).reduce(function(e,t){return e.level<t.level?e:t})}catch(e){return}}();e&&a!==e.t&&(a=e.t,t.report(n,e))}return{initialize:function(e,a,s){a&&(r=o.validateN(s),t=a,n=o.reconstructFullMetricName(e,s),i=setInterval(c,r))},reset:function(){clearInterval(i),i=null,r=0,t=null,a=null},handleNewMetric:function(e,t,r){e===u.BUFFER_LEVEL&&(l[r]=t)}}}A.__dashjs_factory_name="BufferLevelHandler";var I=dashjs.FactoryMaker.getClassFactory(A),R=dashjs.FactoryMaker.getClassFactory(function(e){var t,r=(e=e||{}).eventBus,n=e.metricsConstants;function i(){r.off(a.Z.METRICS_INITIALISATION_COMPLETE,i,this),r.trigger(a.Z.BECAME_REPORTING_PLAYER)}return{initialize:function(e,n){n&&(t=n,r.on(a.Z.METRICS_INITIALISATION_COMPLETE,i,this))},reset:function(){t=null},handleNewMetric:function(e,r){e===n.DVB_ERRORS&&t&&t.report(e,r)}}});function w(e){var t,r,n,i,a;e=e||{};var s=[],o=b(this.context).getInstance(),l=e.metricsConstants;function u(){var e=s;e.length&&t&&t.report(i,e),s=[]}return{initialize:function(e,s,l,c){s&&(r=o.validateN(l),t=s,c&&c.length&&(n=c),i=o.reconstructFullMetricName(e,l,c),a=setInterval(u,r))},reset:function(){clearInterval(a),a=null,r=null,n=null,s=[],t=null},handleNewMetric:function(e,t){e===l.HTTP_REQUEST&&(n&&n!==t.type||s.push(t))}}}w.__dashjs_factory_name="HttpListHandler";var D=dashjs.FactoryMaker.getClassFactory(w);function L(){var e,t;return{initialize:function(r,n){e=r,t=n},reset:function(){t=null,e=void 0},handleNewMetric:function(r,n){r===e&&t&&t.report(e,n)}}}L.__dashjs_factory_name="GenericMetricHandler";var C=dashjs.FactoryMaker.getClassFactory(L);function N(e){var t,r=(e=e||{}).debug?e.debug.getLogger(t):{},n=/([a-zA-Z]*)(\(([0-9]*)(\,\s*([a-zA-Z]*))?\))?/,i=this.context,a={BufferLevel:I,DVBErrors:R,HttpList:D,PlayList:C,RepSwitchList:C,TcpList:C};return{create:function(t,s){var o,l=t.match(n);if(l){try{(o=a[l[1]](i).create({eventBus:e.eventBus,metricsConstants:e.metricsConstants})).initialize(l[1],s,l[3],l[5])}catch(e){o=null,r.error("MetricsHandlerFactory: Could not create handler for type ".concat(l[1]," with args ").concat(l[3],", ").concat(l[5]," (").concat(e.message,")"))}return o}},register:function(e,t){a[e]=t},unregister:function(e){delete a[e]}}}N.__dashjs_factory_name="MetricsHandlerFactory";var P=dashjs.FactoryMaker.getSingletonFactory(N);function O(e){e=e||{};var t,r=[],n=this.context,i=e.eventBus,a=e.events,s=P(n).getInstance({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants});function o(e){r.forEach(function(t){t.handleNewMetric(e.metric,e.value,e.mediaType)})}return t={initialize:function(e,n){e.split(",").forEach(function(e,t,i){var a;if(-1!==e.indexOf("(")&&-1===e.indexOf(")")){var o=i[t+1];o&&-1===o.indexOf("(")&&-1!==o.indexOf(")")&&(e+=","+o,delete i[t+1])}(a=s.create(e,n))&&r.push(a)}),i.on(a.METRIC_ADDED,o,t),i.on(a.METRIC_UPDATED,o,t)},reset:function(){i.off(a.METRIC_ADDED,o,t),i.off(a.METRIC_UPDATED,o,t),r.forEach(function(e){return e.reset()}),r=[]}}}O.__dashjs_factory_name="MetricsHandlersController";var M=dashjs.FactoryMaker.getClassFactory(O);function k(e){var t,r,n;e=e||{};var i=this.context;function a(){t&&t.reset(),r&&r.reset(),n&&n.reset()}return{initialize:function(s){try{(n=c(i).create({mediaElement:e.mediaElement})).initialize(s.Range),(r=_(i).create({debug:e.debug,metricsConstants:e.metricsConstants,mediaPlayerModel:e.mediaPlayerModel})).initialize(s.Reporting,n),(t=M(i).create({debug:e.debug,eventBus:e.eventBus,metricsConstants:e.metricsConstants,events:e.events})).initialize(s.metrics,r)}catch(e){throw a(),e}},reset:a}}k.__dashjs_factory_name="MetricsController";var x=dashjs.FactoryMaker.getClassFactory(k),F=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.metrics="",this.Range=[],this.Reporting=[]},B=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.starttime=0,this.duration=1/0,this._useWallClockTime=!1},U=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.schemeIdUri="",this.value="",this.dvbReportingUrl="",this.dvbProbability=1e3};function Z(e){var t=(e=e||{}).adapter,r=e.constants;return{getMetrics:function(e){var n=[];return e&&e.Metrics_asArray&&e.Metrics_asArray.forEach(function(i){var a=new F,s=t.getIsDynamic(e);i.hasOwnProperty("metrics")&&(a.metrics=i.metrics,i.Range_asArray&&i.Range_asArray.forEach(function(n){var i=new B;i.starttime=function(e,n,i){var a,s,o=0;return n?o=t.getAvailabilityStartTime(e)/1e3:(a=t.getRegularPeriods(e)).length&&(o=a[0].start),s=o,i&&i.hasOwnProperty(r.START_TIME)&&(s+=i.starttime),s}(e,s,n),n.hasOwnProperty("duration")?i.duration=n.duration:i.duration=t.getDuration(e),i._useWallClockTime=s,a.Range.push(i)}),i.Reporting_asArray&&(i.Reporting_asArray.forEach(function(e){var t=new U;e.hasOwnProperty(r.SCHEME_ID_URI)&&(t.schemeIdUri=e.schemeIdUri,e.hasOwnProperty("value")&&(t.value=e.value),e.hasOwnProperty(r.DVB_REPORTING_URL)&&(t.dvbReportingUrl=e[r.DVB_REPORTING_URL]),e.hasOwnProperty(r.DVB_PROBABILITY)&&(t.dvbProbability=e[r.DVB_PROBABILITY]),a.Reporting.push(t))}),n.push(a)))}),n}}}Z.__dashjs_factory_name="ManifestParsing";var G=dashjs.FactoryMaker.getSingletonFactory(Z);function H(e){var t;e=e||{};var r={},n=this.context,i=e.eventBus,s=e.events;function o(t){if(!t.error){var s=Object.keys(r);G(n).getInstance({adapter:e.adapter,constants:e.constants}).getMetrics(t.manifest).forEach(function(t){var i=JSON.stringify(t);if(r.hasOwnProperty(i))s.splice(i,1);else try{var a=x(n).create(e);a.initialize(t),r[i]=a}catch(e){}}),s.forEach(function(e){r[e].reset(),delete r[e]}),i.trigger(a.Z.METRICS_INITIALISATION_COMPLETE)}}function l(){Object.keys(r).forEach(function(e){r[e].reset()}),r={}}return t={reset:function(){i.off(s.MANIFEST_UPDATED,o,t),i.off(s.STREAM_TEARDOWN_COMPLETE,l,t)}},i.on(s.MANIFEST_UPDATED,o,t),i.on(s.STREAM_TEARDOWN_COMPLETE,l,t),t}H.__dashjs_factory_name="MetricsCollectionController";var $=dashjs.FactoryMaker.getClassFactory(H);function V(){var e=this.context;return{createMetricsReporting:function(t){return o(e).getInstance({eventBus:t.eventBus,dashMetrics:t.dashMetrics,metricsConstants:t.metricsConstants,events:t.events}).initialize(),$(e).create(t)},getReportingFactory:function(){return E(e).getInstance()},getMetricsHandlerFactory:function(){return P(e).getInstance()}}}V.__dashjs_factory_name="MetricsReporting";var K=dashjs.FactoryMaker.getClassFactory(V);K.events=a.Z,dashjs.FactoryMaker.updateClassFactory(V.__dashjs_factory_name,K);var q=K},1180:function(e,t,r){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}var o=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(o,e);var t,r,n=(t=o,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=s(t);if(r){var i=s(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return a(this,e)});function o(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(e=n.call(this)).METRICS_INITIALISATION_COMPLETE="internal_metricsReportingInitialized",e.BECAME_REPORTING_PLAYER="internal_becameReportingPlayer",e.CMCD_DATA_GENERATED="cmcdDataGenerated",e}return o}(r(8342).Z));t.Z=o},5717:function(e,t,r){var n=r(2610),i=r(5448),a=r(1264),s=r(3106),o=r(1767),l=r(3393);function u(){var e,t,r,i,u,c,d,f,h=this.context,g=(0,a.Z)(h).getInstance();function p(){i=[],u=[],c=[],f=[],d=null,t=[]}function m(e,t){var r=-1;e.some(function(e,n){if(e===t)return r=n,!0}),r<0||e.splice(r,1)}function v(e){var t;for(t=0;t<f.length;t++)if(f[t].rulename===e)return t;return-1}function y(e,r){E(e,r);var i=new n.Z;i.schemeIdUri=e,i.value=r,t.push(i)}function E(e,r){(0,s.PS)(e,"string"),(0,s.PS)(r,"string"),t.forEach(function(n,i){n.schemeIdUri===e&&n.value===r&&t.splice(i,1)})}return e={getCustomInitialTrackSelectionFunction:function(){return d},setCustomInitialTrackSelectionFunction:function(e){d=e},resetCustomInitialTrackSelectionFunction:function(){d=null},getLicenseResponseFilters:function(){return u},getLicenseRequestFilters:function(){return i},getCustomCapabilitiesFilters:function(){return c},registerCustomCapabilitiesFilter:function(e){c.push(e)},registerLicenseResponseFilter:function(e){u.push(e)},registerLicenseRequestFilter:function(e){i.push(e)},unregisterCustomCapabilitiesFilter:function(e){m(c,e)},unregisterLicenseResponseFilter:function(e){m(u,e)},unregisterLicenseRequestFilter:function(e){m(i,e)},addAbrCustomRule:function(e,t,r){if("string"!=typeof e||e!==o.Z.ABANDON_FRAGMENT_RULES&&e!==o.Z.QUALITY_SWITCH_RULES||"string"!=typeof t)throw l.Z.BAD_ARGUMENT_ERROR;var n=v(t);-1===n?f.push({type:e,rulename:t,rule:r}):(f[n].type=e,f[n].rule=r)},removeAllAbrCustomRule:function(){f=[]},removeAbrCustomRule:function(e){if(e){var t=v(e);-1!==t&&f.splice(t,1)}else f=[]},getAbrCustomRules:function(){return f},addUTCTimingSource:y,removeUTCTimingSource:E,getUTCTimingSources:function(){return t},clearDefaultUTCTimingSources:function(){t=[]},restoreDefaultUTCTimingSources:function(){var e=g.get().streaming.utcSynchronization.defaultTimingSource;y(e.scheme,e.value)},setXHRWithCredentialsForType:function e(t,n){t?r[t]=!!n:Object.keys(r).forEach(function(t){e(t,n)})},getXHRWithCredentialsForType:function(e){var t=r[e];return void 0===t?r.default:t},setConfig:function(){},reset:function(){p()}},r={default:!1},p(),e}u.__dashjs_factory_name="CustomParametersModel",t.Z=i.Z.getSingletonFactory(u)},9032:function(e,t,r){var n=r(5448),i=r(7473);function a(e){var t=(e=e||{}).requestModifier;function r(e){var r=new Date,n=e.request,i=new XMLHttpRequest;if(i.open(e.method,e.url,!0),n.responseType&&(i.responseType=n.responseType),n.range&&i.setRequestHeader("Range","bytes="+n.range),n.requestStartDate||(n.requestStartDate=r),t&&t.modifyRequestHeader&&(i=t.modifyRequestHeader(i,{url:e.url})),e.headers)for(var a in e.headers){var s=e.headers[a];s&&i.setRequestHeader(a,s)}i.withCredentials=e.withCredentials,i.onload=e.onload,i.onloadend=e.onend,i.onerror=e.onerror,i.onprogress=e.progress,i.onabort=e.onabort,i.ontimeout=e.ontimeout,i.timeout=e.timeout,i.send(),e.response=i}return{load:function(e){t&&t.modifyRequest?(0,i.k)(e,t).then(function(){return r(e)}):r(e)},abort:function(e){var t=e.response;t.onloadend=t.onerror=t.onprogress=void 0,t.abort()}}}a.__dashjs_factory_name="XHRLoader";var s=n.Z.getClassFactory(a);t.Z=s},1737:function(e,t,r){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r.d(t,{default:function(){return be}});var i={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]},a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t;return t=[{key:"findCencContentProtection",value:function(e){for(var t=null,r=0;r<e.length;++r){var n=e[r];"urn:mpeg:dash:mp4protection:2011"!==n.schemeIdUri.toLowerCase()||"cenc"!==n.value.toLowerCase()&&"cbcs"!==n.value.toLowerCase()||(t=n)}return t}},{key:"getPSSHData",value:function(e){var t=8,r=new DataView(e),n=r.getUint8(t);return t+=20,n>0&&(t+=4+16*r.getUint32(t)),t+=4,e.slice(t)}},{key:"getPSSHForKeySystem",value:function(t,r){var n=e.parsePSSHList(r);return t&&n.hasOwnProperty(t.uuid.toLowerCase())?n[t.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(e,t){return"pssh"in e?(e.pssh.__text=e.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),t.decodeArray(e.pssh.__text).buffer):null}},{key:"parsePSSHList",value:function(e){if(null==e)return[];for(var t=new DataView(e.buffer||e),r={},n=0;;){var i,a,s=void 0,o=n;if(n>=t.buffer.byteLength)break;if(i=n+t.getUint32(n),n+=4,1886614376===t.getUint32(n))if(n+=4,0===(a=t.getUint8(n))||1===a){n++,n+=3,s="";var l=void 0,u=void 0;for(l=0;l<4;l++)s+=1===(u=t.getUint8(n+l).toString(16)).length?"0"+u:u;for(n+=4,s+="-",l=0;l<2;l++)s+=1===(u=t.getUint8(n+l).toString(16)).length?"0"+u:u;for(n+=2,s+="-",l=0;l<2;l++)s+=1===(u=t.getUint8(n+l).toString(16)).length?"0"+u:u;for(n+=2,s+="-",l=0;l<2;l++)s+=1===(u=t.getUint8(n+l).toString(16)).length?"0"+u:u;for(n+=2,s+="-",l=0;l<6;l++)s+=1===(u=t.getUint8(n+l).toString(16)).length?"0"+u:u;n+=6,n+=4,r[s=s.toLowerCase()]=t.buffer.slice(o,i),n=i}else n=i;else n=i}return r}},{key:"getLicenseServerUrlFromMediaInfo",value:function(e,t){try{if(!e||0===e.length)return null;for(var r=0,n=null;r<e.length&&!n;){var a=e[r];if(a&&a.contentProtection&&a.contentProtection.length>0){var s=a.contentProtection.filter(function(e){return e.schemeIdUri&&e.schemeIdUri===t});if(s&&s.length>0)for(var o=0;o<s.length&&!n;){for(var l=s[o],u=0;u<i.attributes.length&&!n;){for(var c=0,d=i.attributes[u];c<i.prefixes.length&&!n;){var f=i.prefixes[c];l[d]&&l[d].__prefix&&l[d].__prefix===f&&l[d].__text&&(n=l[d].__text),c+=1}u+=1}o+=1}}r+=1}return n}catch(e){return null}}}],t&&n(e,t),e}(),s=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contentType=t,this.robustness=r},o=function e(t,r,n,i,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initDataTypes=["cenc"],t&&t.length&&(this.audioCapabilities=t),r&&r.length&&(this.videoCapabilities=r),this.distinctiveIdentifier=n,this.persistentState=i,this.sessionTypes=a};function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function c(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}var f=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=d(t);if(r){var i=d(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return c(this,e)});function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=n.call(this)).MEDIA_KEYERR_CODE=100,e.MEDIA_KEYERR_UNKNOWN_CODE=101,e.MEDIA_KEYERR_CLIENT_CODE=102,e.MEDIA_KEYERR_SERVICE_CODE=103,e.MEDIA_KEYERR_OUTPUT_CODE=104,e.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,e.MEDIA_KEYERR_DOMAIN_CODE=106,e.MEDIA_KEY_MESSAGE_ERROR_CODE=107,e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,e.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,e.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,e.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,e.KEY_SESSION_CREATED_ERROR_CODE=113,e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,e.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",e.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",e.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",e.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",e.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",e.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",e.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",e.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",e.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",e.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",e.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --",e}return i}(r(2230).Z)),h=r(5459),g=function e(t,r,n,i,a,s,o,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.method=r,this.responseType=n,this.headers=i,this.withCredentials=a,this.messageType=s,this.sessionId=o,this.data=l},p=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.headers=r,this.data=n},m=r(7855),v=r(703),y=r(3393),E=r(5448);function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function _(e){var t,r,n,i,l,u,c,d,E,_,S,b=(e=e||{}).protectionKeyController,A=e.protectionModel,I=e.eventBus,R=e.events,w=e.debug,D=e.BASE64,L=e.constants,C=[],N=e.cmcdModel,P=e.settings,O=e.customParametersModel;function M(){if(!(I&&I.hasOwnProperty("on")&&b&&b.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}function k(e,t){d||E?d&&x():function(e,t){if(!E){E=!0;var n,i=[];e=e.sort(function(t,r){return(l&&l[t.ks.systemString]&&l[t.ks.systemString].priority>=0?l[t.ks.systemString].priority:e.length)-(l&&l[r.ks.systemString]&&l[r.ks.systemString].priority>=0?l[r.ks.systemString].priority:e.length)});for(var a=0;a<e.length;a++){var s=$(e[a]);i.push({ks:e[a].ks,configs:[s],protData:e[a].protData})}A.requestKeySystemAccess(i).then(function(e){var t=(n=e.data).mksa&&n.mksa.selectedSystemString?n.mksa.selectedSystemString:n.keySystem.systemString;return r.info("DRM: KeySystem Access Granted for system string ("+t+")!  Selecting key system..."),A.selectKeySystem(n)}).then(function(e){if(d=e,E=!1,A){I.trigger(R.KEY_SYSTEM_SELECTED,{data:n});var t=Z(d);t&&t.serverCertificate&&t.serverCertificate.length>0&&A.setServerCertificate(D.decodeArray(t.serverCertificate).buffer),x()}}).catch(function(e){d=null,E=!1,t||I.trigger(R.KEY_SYSTEM_SELECTED,{data:null,error:new h.Z(f.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,f.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+e.error)})})}}(e,t)}function x(){for(var e,t=0;t<n.length;t++)for(e=0;e<n[t].length;e++)if(d===n[t][e].ks){F(n[t][e]);break}n=[]}function F(e){if(b.isClearKey(d)&&e.protData&&e.protData.hasOwnProperty("clearkeys")&&0!==Object.keys(e.protData.clearkeys).length){var t={kids:Object.keys(e.protData.clearkeys)};e.initData=(new TextEncoder).encode(JSON.stringify(t))}e.sessionId?B(e):null!==e.initData&&U(e)}function B(e){M(),A.loadKeySession(e)}function U(e){var t=a.getPSSHForKeySystem(d,e?e.initData:null);if(t){if(function(e){if(!e)return!1;try{for(var t=A.getSessions(),r=0;r<t.length;r++)if(t[r].getKeyId()===e)return!0;return!1}catch(e){return!1}}(e.keyId))return;if(G(t))return;try{e.initData=t,A.createKeySession(e)}catch(e){I.trigger(R.KEY_SESSION_CREATED,{data:null,error:new h.Z(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+e.message)})}}else e&&e.initData?A.createKeySession(e):I.trigger(R.KEY_SESSION_CREATED,{data:null,error:new h.Z(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(d?d.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function Z(e){if(e){var t=e.systemString;if(l)return t in l?l[t]:null}return null}function G(e){if(!e)return!1;try{for(var t=A.getAllInitData(),n=0;n<t.length;n++)if(b.initDataEquals(e,t[n]))return r.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch(e){return!1}}function H(e){M(),e?(A.setMediaElement(e),I.on(R.NEED_KEY,Q,t)):null===e&&(A.setMediaElement(e),I.off(R.NEED_KEY,Q,t))}function $(e){var t=e.protData,r=[],n=[],a=t&&t.audioRobustness&&t.audioRobustness.length>0?t.audioRobustness:c,l=t&&t.videoRobustness&&t.videoRobustness.length>0?t.videoRobustness:c,u=e.sessionType,d=t&&t.distinctiveIdentifier?t.distinctiveIdentifier:"optional",f=t&&t.persistentState?t.persistentState:"temporary"===u?"optional":"required";return i.forEach(function(e){e.type===L.AUDIO?r.push(new s(e.codec,a)):e.type===L.VIDEO&&n.push(new s(e.codec,l))}),new o(r,n,d,f,[u])}function V(e){e.error?I.trigger(R.KEY_STATUSES_CHANGED,{data:null,error:e.error}):r.debug("DRM: key status = "+e.status)}function K(e){r.debug("DRM: onKeyMessage");var t=e.data;I.trigger(R.KEY_MESSAGE,{data:t});var n=t.messageType?t.messageType:"license-request",s=t.message,o=t.sessionToken,l=Z(d),u=b.getLicenseServerModelInstance(d,l,n),c={sessionToken:o,messageType:n};if(s&&0!==s.byteLength){if(!u)return r.debug("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+o.getSessionId()),void q(c);if(b.isClearKey(d)){var y=b.processClearKeyLicenseRequest(d,l,s);if(y&&y.keyPairs&&y.keyPairs.length>0)return r.debug("DRM: ClearKey license request handled by application!"),q(c),void A.updateKeySession(o,y)}!function(e,t,r){var n=e.sessionToken,s=e.messageType?e.messageType:"license-request",o={sessionToken:n,messageType:s},l=d?d.systemString:null,u=function(e,t,r,n,s){var o=null,l=n.message;if(e&&e.serverURL){var u=e.serverURL;"string"==typeof u&&""!==u?o=u:"object"===T(u)&&u.hasOwnProperty(t)&&(o=u[t])}else if(e&&e.laURL&&""!==e.laURL)o=e.laURL;else if(!(o=a.getLicenseServerUrlFromMediaInfo(i,d.schemeIdURI))&&!b.isClearKey(d)){var c=a.getPSSHData(r.initData);(o=d.getLicenseServerURLFromInitData(c))||(o=n.laURL)}return s.getServerURLFromMessage(o,l,t)}(r,s,n,e,t);if(u){var c={},y=!1;r&&z(c,r.httpRequestHeaders);var E=e.message;z(c,d.getRequestHeadersFromMessage(E)),Object.keys(c).forEach(function(e){"authorization"===e.toLowerCase()&&(y=!0)}),r&&"boolean"==typeof r.withCredentials&&(y=r.withCredentials);var _=function(e){if(A)if(e.status>=200&&e.status<=299){var r=v.Z.parseHttpHeaders(e.getAllResponseHeaders?e.getAllResponseHeaders():null),i=new p(e.responseURL,r,e.response);X(O.getLicenseResponseFilters(),i).then(function(){var r=t.getLicenseMessage(i.data,l,s);null!==r?(q(o),A.updateKeySession(n,r)):W(e,o,l,s,t)})}else W(e,o,l,s,t)},S=function(e){q(o,new h.Z(f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+l+' update, XHR aborted. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},I=function(e){q(o,new h.Z(f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+l+' update, XHR error. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},R=d.getLicenseRequestFromMessage(E),w=t.getHTTPMethod(s),D=t.getResponseType(l,s),L=r&&!isNaN(r.httpTimeout)?r.httpTimeout:8e3,C=n.getSessionId()||null,N=new g(u,w,D,c,y,s,C,R),M=isNaN(P.get().streaming.retryAttempts[m.w.LICENSE])?3:P.get().streaming.retryAttempts[m.w.LICENSE];X(O.getLicenseRequestFilters(),N).then(function(){Y(N,M,L,_,S,I)})}else q(o,new h.Z(f.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,f.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE))}(t,u,l)}else q(c,new h.Z(f.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,f.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function q(e,t){I.trigger(R.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function Y(e,t,n,i,a,s){var o=new XMLHttpRequest;if(P.get().streaming.cmcd&&P.get().streaming.cmcd.enabled&&P.get().streaming.cmcd.mode===y.Z.CMCD_MODE_QUERY){var l=N.getQueryParameter({url:e.url,type:m.w.LICENSE});l&&(e.url=v.Z.addAditionalQueryParameterToUrl(e.url,[l]))}for(var u in o.open(e.method,e.url,!0),o.responseType=e.responseType,o.withCredentials=e.withCredentials,n>0&&(o.timeout=n),e.headers)o.setRequestHeader(u,e.headers[u]);if(P.get().streaming.cmcd&&P.get().streaming.cmcd.enabled&&P.get().streaming.cmcd.mode===y.Z.CMCD_MODE_HEADER){var c=N.getHeaderParameters({url:e.url,type:m.w.LICENSE});if(c)for(var d in c){var f=c[d];f&&o.setRequestHeader(d,f)}}var h=function(){t--;var r=isNaN(P.get().streaming.retryIntervals[m.w.LICENSE])?1e3:P.get().streaming.retryIntervals[m.w.LICENSE];S=setTimeout(function(){Y(e,t,n,i,a,s)},r)};o.onload=function(){_=null,this.status>=200&&this.status<=299||t<=0?i(this):(r.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+t),h())},o.ontimeout=o.onerror=function(){_=null,t<=0?s(this):(r.warn("License request network request failed . Retrying it... Pending retries: "+t),h())},o.onabort=function(){a(this)},I.trigger(R.LICENSE_REQUEST_SENDING,{url:e.url,headers:e.headers,payload:e.data,sessionId:e.sessionId}),_=o,o.send(e.data)}function j(){_&&(_.onloadend=_.onerror=_.onprogress=void 0,_.abort(),_=null),S&&(clearTimeout(S),S=null)}function z(e,t){if(t)for(var r in t)e[r]=t[r]}function W(e,t,r,n,i){var a="NONE",s=null;e.response&&(a=i.getErrorResponse(e.response,r,n),s={serverResponse:e.response||null,responseCode:e.status||null,responseText:e.statusText||null}),q(t,new h.Z(f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+r+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+a,s))}function X(e,t){return e?e.reduce(function(e,r){return e.then(function(){return r(t)})},Promise.resolve()):Promise.resolve()}function Q(e,t){if(!P.get().streaming.protection.ignoreEmeEncryptedEvent){if(r.debug("DRM: onNeedKey"),"cenc"!==e.key.initDataType)return void r.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType);if(0===i.length&&(r.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(t=void 0===t?1:t+1)<5))return void C.push(setTimeout(function(){Q(e,t)},500));var s=e.key.initData;if(ArrayBuffer.isView(s)&&(s=s.buffer),d){var o=a.getPSSHForKeySystem(d,s);if(o&&G(o))return}r.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(s)));var c=b.getSupportedKeySystemsFromSegmentPssh(s,l,u);if(0===c.length)return void r.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!");!function(e){n.push(e),k(e,!1)}(c)}}return t={initializeForMedia:function(e){if(!e)throw new Error("mediaInfo can not be null or undefined");M(),i.push(e)},clearMediaInfoArray:function(){i=[]},handleKeySystemFromManifest:function(){if(i&&0!==i.length){var e=[];i.forEach(function(t){var r=b.getSupportedKeySystemsFromContentProtection(t.contentProtection,l,u);r.length>0&&(0===e.length&&(e=r),n.push(r))}),e&&e.length>0&&k(e,!0)}},createKeySession:U,loadKeySession:B,removeKeySession:function(e){M(),A.removeKeySession(e)},closeKeySession:function(e){M(),A.closeKeySession(e)},setServerCertificate:function(e){M(),A.setServerCertificate(e)},setMediaElement:H,setSessionType:function(e){u=e},setRobustnessLevel:function(e){c=e},setProtectionData:function(e){l=e,b.setProtectionData(e)},getSupportedKeySystemsFromContentProtection:function(e){return M(),b.getSupportedKeySystemsFromContentProtection(e,l,u)},getKeySystems:function(){return b?b.getKeySystems():[]},setKeySystems:function(e){b&&b.setKeySystems(e)},stop:function(){j(),A&&A.stop()},reset:function(){I.off(R.INTERNAL_KEY_MESSAGE,K,t),I.off(R.INTERNAL_KEY_STATUS_CHANGED,V,t),M(),j(),H(null),d=null,E=!1,A&&(A.reset(),A=null),C.forEach(function(e){return clearTimeout(e)}),C=[],i=[],n=[]}},r=w.getLogger(t),n=[],i=[],u="temporary",c="",_=null,S=null,I.on(R.INTERNAL_KEY_MESSAGE,K,t),I.on(R.INTERNAL_KEY_STATUS_CHANGED,V,t),t}_.__dashjs_factory_name="ProtectionController";var S=E.Z.getClassFactory(_),b=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyID=t,this.key=r};function A(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var I=function(){function e(t,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r&&"persistent"!==r&&"temporary"!==r)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=t,this.type=r}var t;return(t=[{key:"toJWK",value:function(){var e,t=this.keyPairs.length,r={keys:[]};for(e=0;e<t;e++){var n={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};r.keys.push(n)}this.type&&(r.type=this.type);var i=JSON.stringify(r),a=i.length,s=new ArrayBuffer(a),o=new Uint8Array(s);for(e=0;e<a;e++)o[e]=i.charCodeAt(e);return s}}])&&A(e.prototype,t),e}();function R(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var w=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t;return(t=[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready",this.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING="com.microsoft.playready.recommendation",this.INITIALIZATION_DATA_TYPE_CENC="cenc",this.INITIALIZATION_DATA_TYPE_KEYIDS="keyids",this.INITIALIZATION_DATA_TYPE_WEBM="webm"}}])&&R(e.prototype,t),e}()),D="e2719d58-a985-b3c9-781a-b030af78d30e",L=w.CLEARKEY_KEYSTEM_STRING,C="urn:uuid:"+D;function N(e){var t=(e=e||{}).BASE64;return{uuid:D,schemeIdURI:C,systemString:L,getInitData:function(e,r){try{var n=a.parseInitDataFromContentProtection(e,t);if(!n&&r){var i={kids:[function(e){try{var t=e.replace(/-/g,"");return(t=btoa(t.match(/\w{2}/g).map(function(e){return String.fromCharCode(parseInt(e,16))}).join(""))).replace(/=/g,"").replace(/\//g,"_").replace(/\+/g,"-")}catch(e){return null}}(r["cenc:default_KID"])]};n=(new TextEncoder).encode(JSON.stringify(i))}return n}catch(e){return null}},getRequestHeadersFromMessage:function(){return{"Content-Type":"application/json"}},getLicenseRequestFromMessage:function(e){return JSON.stringify(JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e))))},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(e,t){var r=null;if(e){for(var n=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),i=[],a=0;a<n.kids.length;a++){var s=n.kids[a],o=e.clearkeys&&e.clearkeys.hasOwnProperty(s)?e.clearkeys[s]:null;if(!o)throw new Error("DRM: ClearKey keyID ("+s+") is not known!");i.push(new b(s,o))}r=new I(i)}return r}}}N.__dashjs_factory_name="KeySystemClearKey";var P=dashjs.FactoryMaker.getSingletonFactory(N),O="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",M=w.CLEARKEY_KEYSTEM_STRING,k="urn:uuid:"+O;function x(e){var t,r=e.BASE64,n=e.debug.getLogger(t);return{uuid:O,schemeIdURI:k,systemString:M,getInitData:function(e){return a.parseInitDataFromContentProtection(e,r)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getClearKeysFromProtectionData:function(e,t){var r=null;if(e){for(var i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),a=[],s=0;s<i.kids.length;s++){var o=i.kids[s],l=e.clearkeys&&e.clearkeys.hasOwnProperty(o)?e.clearkeys[o]:null;if(!l)throw new Error("DRM: ClearKey keyID ("+o+") is not known!");a.push(new b(o,l))}r=new I(a),n.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return r}}}x.__dashjs_factory_name="KeySystemW3CClearKey";var F=dashjs.FactoryMaker.getSingletonFactory(x),B="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",U=w.WIDEVINE_KEYSTEM_STRING,Z="urn:uuid:"+B;function G(e){var t=(e=e||{}).BASE64;return{uuid:B,schemeIdURI:Z,systemString:U,getInitData:function(e){return a.parseInitDataFromContentProtection(e,t)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null}}}G.__dashjs_factory_name="KeySystemWidevine";var H=dashjs.FactoryMaker.getSingletonFactory(G),$="9a04f079-9840-4286-ab92-e65be0885f95",V=w.PLAYREADY_KEYSTEM_STRING,K="urn:uuid:"+$;function q(e){var t="utf-16",r=(e=e||{}).BASE64,n=e.settings;function i(){if(!r||!r.hasOwnProperty("decodeArray")||!r.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return{uuid:$,schemeIdURI:K,systemString:V,getInitData:function(e){var t,n,s,o,l,u=new Uint8Array([112,115,115,104,0,0,0,0]),c=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),d=0,f=null;if(i(),!e)return null;if("pssh"in e)return a.parseInitDataFromContentProtection(e,r);if("pro"in e)f=r.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;f=r.decodeArray(e.prheader.__text)}return t=f.length,n=4+u.length+c.length+4+t,s=new ArrayBuffer(n),o=new Uint8Array(s),(l=new DataView(s)).setUint32(d,n),d+=4,o.set(u,d),d+=u.length,o.set(c,d),d+=c.length,l.setUint32(d,t),d+=4,o.set(f,d),d+=t,o.buffer},getRequestHeadersFromMessage:function(e){var r,i,a={},s=new DOMParser;if(n&&n.get().streaming.protection.detectPlayreadyMessageFormat&&"utf-16"===t&&e&&e.byteLength%2==1)return a["Content-Type"]="text/xml; charset=utf-8",a;var o="utf-16"===t?new Uint16Array(e):new Uint8Array(e);r=String.fromCharCode.apply(null,o);for(var l=(i=s.parseFromString(r,"application/xml")).getElementsByTagName("name"),u=i.getElementsByTagName("value"),c=0;c<l.length;c++)a[l[c].childNodes[0].nodeValue]=u[c].childNodes[0].nodeValue;return a.hasOwnProperty("Content")&&(a["Content-Type"]=a.Content,delete a.Content),a.hasOwnProperty("Content-Type")||(a["Content-Type"]="text/xml; charset=utf-8"),a},getLicenseRequestFromMessage:function(e){var a=null,s=new DOMParser;if(n&&n.get().streaming.protection.detectPlayreadyMessageFormat&&"utf-16"===t&&e&&e.byteLength%2==1)return e;var o="utf-16"===t?new Uint16Array(e):new Uint8Array(e);i();var l=String.fromCharCode.apply(null,o),u=s.parseFromString(l,"application/xml");if(!u.getElementsByTagName("PlayReadyKeyMessage")[0])return e;var c=u.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;return c&&(a=r.decode(c)),a},getLicenseServerURLFromInitData:function(e){if(e)for(var t=new DataView(e),r=t.getUint16(4,!0),n=6,i=new DOMParser,a=0;a<r;a++){var s=t.getUint16(n,!0);n+=2;var o=t.getUint16(n,!0);if(n+=2,1===s){var l=e.slice(n,n+o),u=String.fromCharCode.apply(null,new Uint16Array(l)),c=i.parseFromString(u,"application/xml");if(c.getElementsByTagName("LA_URL")[0]){var d=c.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(d)return d}if(c.getElementsByTagName("LUI_URL")[0]){var f=c.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(f)return f}}else n+=o}return null},getCDMData:function(e){var t,n,a,s;if(i(),!e)return null;for(t=[],s=0;s<e.length;++s)t.push(e.charCodeAt(s)),t.push(0);for(t=String.fromCharCode.apply(null,t),t=r.encode(t),n='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",t),a=[],s=0;s<n.length;++s)a.push(n.charCodeAt(s)),a.push(0);return new Uint8Array(a).buffer},setPlayReadyMessageFormat:function(e){if("utf-8"!==e&&"utf-16"!==e)throw new Error('Specified message format is not one of "utf-8" or "utf-16"');t=e}}}q.__dashjs_factory_name="KeySystemPlayReady";var Y=dashjs.FactoryMaker.getSingletonFactory(q);function j(e){var t=(e=e||{}).BASE64,r={};return r[w.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(e){return t.decodeArray(e.license)},getErrorResponse:function(e){return e}},r[w.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(e){return r[e].responseType},getLicenseMessage:function(e,n){return function(){if(!t||!t.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),r[n].getLicenseMessage(e)},getErrorResponse:function(e,t){return r[t].getErrorResponse(e)}}}j.__dashjs_factory_name="DRMToday";var z=dashjs.FactoryMaker.getSingletonFactory(j);function W(){var e="http://schemas.xmlsoap.org/soap/envelope/";function t(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}function r(r){if(window.DOMParser){var n=t(r),i=(new window.DOMParser).parseFromString(n,"text/xml"),a=i?i.getElementsByTagNameNS(e,"Envelope")[0]:null,s=a?a.getElementsByTagNameNS(e,"Body")[0]:null;if(s&&s.getElementsByTagNameNS(e,"Fault")[0])return null}return r}function n(r){var n="",i="",a="",s=-1,o=-1;if(window.DOMParser){var l=t(r),u=(new window.DOMParser).parseFromString(l,"text/xml"),c=u?u.getElementsByTagNameNS(e,"Envelope")[0]:null,d=c?c.getElementsByTagNameNS(e,"Body")[0]:null,f=d?d.getElementsByTagNameNS(e,"Fault")[0]:null,h=f?f.getElementsByTagName("detail")[0]:null,g=h?h.getElementsByTagName("Exception")[0]:null,p=null;if(null===f)return l;n=(p=f.getElementsByTagName("faultstring")[0].firstChild)?p.nodeValue:null,null!==g&&(i=(p=g.getElementsByTagName("StatusCode")[0])?p.firstChild.nodeValue:null,s=(a=(p=g.getElementsByTagName("Message")[0])?p.firstChild.nodeValue:null)?a.lastIndexOf("[")+1:-1,o=a?a.indexOf("]"):-1,a=a?a.substring(s,o):"")}var m="code: ".concat(i,", name: ").concat(n);return a&&(m+=", message: ".concat(a)),m}return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return r.call(this,e)},getErrorResponse:function(e){return n.call(this,e)}}}W.__dashjs_factory_name="PlayReady";var X=E.Z.getSingletonFactory(W);function Q(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}Q.__dashjs_factory_name="Widevine";var J=dashjs.FactoryMaker.getSingletonFactory(Q);function ee(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"json"},getLicenseMessage:function(e){if(!e.hasOwnProperty("keys"))return null;for(var t=[],r=0;r<e.keys.length;r++){var n=e.keys[r],i=n.kid.replace(/=/g,""),a=n.k.replace(/=/g,"");t.push(new b(i,a))}return new I(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}ee.__dashjs_factory_name="ClearKey";var te=dashjs.FactoryMaker.getSingletonFactory(ee);function re(){var e,t,r,n,i,s,o,l,u=this.context;function c(e,t){return t&&e in t?t[e]:null}function d(e,t){return e&&e.sessionId?e.sessionId:t&&t.sessionId?t.sessionId:null}function f(e,t){return e&&e.sessionType?e.sessionType:t}return e={initialize:function(){var e;n=[],e=Y(u).getInstance({BASE64:i,settings:s}),n.push(e),e=H(u).getInstance({BASE64:i}),n.push(e),e=P(u).getInstance({BASE64:i}),n.push(e),o=e,e=F(u).getInstance({BASE64:i,debug:t}),n.push(e),l=e},setProtectionData:function(e){for(var t,r,i=0;i<n.length;i++){var a=n[i];a.hasOwnProperty("init")&&a.init((t=a.systemString,r=void 0,r=null,e&&(r=t in e?e[t]:null),r))}},isClearKey:function(e){return e===o||e===l},initDataEquals:function(e,t){if(e.byteLength===t.byteLength){for(var r=new Uint8Array(e),n=new Uint8Array(t),i=0;i<r.length;i++)if(r[i]!==n[i])return!1;return!0}return!1},getKeySystems:function(){return n},setKeySystems:function(e){n=e},getKeySystemBySystemString:function(e){for(var t=0;t<n.length;t++)if(n[t].systemString===e)return n[t];return null},getSupportedKeySystemsFromContentProtection:function(e,t,r){var i,s,o,l,u=[];if(e){var h=a.findCencContentProtection(e);for(o=0;o<n.length;++o){var g=c((s=n[o]).systemString,t);for(l=0;l<e.length;++l)if((i=e[l]).schemeIdUri.toLowerCase()===s.schemeIdURI){var p=s.getInitData(i,h);u.push({ks:n[o],keyId:i.keyId,initData:p,protData:g,cdmData:s.getCDMData(g?g.cdmData:null),sessionId:d(g,i),sessionType:f(g,r)})}}}return u},getSupportedKeySystemsFromSegmentPssh:function(e,t,r){for(var i,s=[],o=a.parsePSSHList(e),l=0;l<n.length;++l){var u=c((i=n[l]).systemString,t);i.uuid in o&&s.push({ks:i,initData:o[i.uuid],protData:u,cdmData:i.getCDMData(u?u.cdmData:null),sessionId:d(u),sessionType:f(u,r)})}return s},getLicenseServerModelInstance:function(e,t,r){if("license-release"===r||"individualization-request"===r)return null;var n=null;return t&&t.hasOwnProperty("drmtoday")?n=z(u).getInstance({BASE64:i}):e.systemString===w.WIDEVINE_KEYSTEM_STRING?n=J(u).getInstance():e.systemString===w.PLAYREADY_KEYSTEM_STRING?n=X(u).getInstance():e.systemString===w.CLEARKEY_KEYSTEM_STRING&&(n=te(u).getInstance()),n},processClearKeyLicenseRequest:function(e,t,n){try{return e.getClearKeysFromProtectionData(t,n)}catch(e){return r.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(n){n&&(n.debug&&(t=n.debug,r=t.getLogger(e)),n.BASE64&&(i=n.BASE64),n.settings&&(s=n.settings))}},e}re.__dashjs_factory_name="ProtectionKeyController";var ne=dashjs.FactoryMaker.getSingletonFactory(re);function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function ae(e,t){return ae=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ae(e,t)}function se(e,t){return!t||"object"!==ie(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function oe(e){return oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},oe(e)}var le=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ae(e,t)}(i,e);var t,r,n=(t=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,n=oe(t);if(r){var i=oe(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return se(this,e)});function i(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(e=n.call(this)).INTERNAL_KEY_MESSAGE="internalKeyMessage",e.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",e.KEY_ADDED="public_keyAdded",e.KEY_ERROR="public_keyError",e.KEY_MESSAGE="public_keyMessage",e.KEY_SESSION_CLOSED="public_keySessionClosed",e.KEY_SESSION_CREATED="public_keySessionCreated",e.KEY_SESSION_REMOVED="public_keySessionRemoved",e.KEY_STATUSES_CHANGED="public_keyStatusesChanged",e.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",e.KEY_SYSTEM_SELECTED="public_keySystemSelected",e.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",e.LICENSE_REQUEST_SENDING="public_licenseRequestSending",e.NEED_KEY="needkey",e.PROTECTION_CREATED="public_protectioncreated",e.PROTECTION_DESTROYED="public_protectiondestroyed",e.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",e.TEARDOWN_COMPLETE="protectionTeardownComplete",e.VIDEO_ELEMENT_SELECTED="videoElementSelected",e.KEY_SESSION_UPDATED="public_keySessionUpdated",e}return i}(r(8342).Z)),ue=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initData=t,this.initDataType=r},ce=function e(t,r,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sessionToken=t,this.message=r,this.defaultURL=n,this.messageType=i||"license-request"},de=function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keySystem=t,this.ksConfiguration=r},fe={};function he(e){e=e||{};var t,r,n,i,a,s,o,l,u=this.context,c=e.eventBus,d=e.events,g=e.debug;function p(e,t,r,n){if(void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess){var i="Insecure origins are not allowed";return c.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{error:i}),void n({error:i})}var a=e[t].protData&&e[t].protData.systemStringPriority?e[t].protData.systemStringPriority:null,s=e[t].configs,o=e[t].ks,l=o.systemString;(function(e,t){return new Promise(function(r,n){m(e,t,0,r,n)})})(a||(fe[l]?fe[l]:[l]),s).then(function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,n=new de(o,t);n.mksa=e,c.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{data:n}),r({data:n})}).catch(function(i){if(t+1<e.length)p(e,t+1,r,n);else{var a="Key system access denied! ";c.trigger(d.KEY_SYSTEM_ACCESS_COMPLETE,{error:a+i.message}),n({error:a+i.message})}})}function m(e,t,n,i,a){var s=e[n];r.debug("Requesting key system access for system string ".concat(s)),navigator.requestMediaKeySystemAccess(s,t).then(function(e){e.selectedSystemString=s,i(e)}).catch(function(r){n+1<e.length?m(e,t,n+1,i,a):a(r)})}function v(e){if(!e||!e.session)return Promise.resolve;var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function y(e){for(var t=0;t<s.length;t++)if(s[t]===e){s.splice(t,1);break}}function E(e){var t,r;return e&&e.length>0&&(e[0]&&("string"==typeof e[0]?t=e[0]:r=e[0]),e[1]&&("string"==typeof e[1]?t=e[1]:r=e[1])),{status:t,keyId:r}}function T(e,t){var n={session:e,keyId:t.keyId,initData:t.initData,sessionId:t.sessionId,sessionType:t.sessionType,handleEvent:function(e){switch(e.type){case"keystatuseschange":c.trigger(d.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach(function(){var e=E(arguments);"expired"===e.status?c.trigger(d.INTERNAL_KEY_STATUS_CHANGED,{error:new h.Z(f.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,f.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)}):c.trigger(d.INTERNAL_KEY_STATUS_CHANGED,e)});break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;c.trigger(d.INTERNAL_KEY_MESSAGE,{data:new ce(this,t,void 0,e.messageType)})}},getKeyId:function(){return this.keyId},getSessionId:function(){return e.sessionId},getSessionType:function(){return this.sessionType},getExpirationTime:function(){return e.expiration},getKeyStatuses:function(){return e.keyStatuses},getUsable:function(){var t=!1;return e.keyStatuses.forEach(function(){"usable"===E(arguments).status&&(t=!0)}),t}};return e.addEventListener("keystatuseschange",n),e.addEventListener("message",n),e.closed.then(function(){y(n),r.debug("DRM: Session closed.  SessionID = "+n.getSessionId()),c.trigger(d.KEY_SESSION_CLOSED,{data:n.getSessionId()})}),s.push(n),n}return t={getAllInitData:function(){for(var e=[],t=0;t<s.length;t++)s[t].initData&&e.push(s[t].initData);return e},getSessions:function(){return s},requestKeySystemAccess:function(e){return new Promise(function(t,r){p(e,0,t,r)})},selectKeySystem:function(e){return new Promise(function(t,r){e.mksa.createMediaKeys().then(function(t){return n=e.keySystem,a=t,i?i.setMediaKeys(a):Promise.resolve()}).then(function(){t(n)}).catch(function(){r({error:"Error selecting keys system ("+e.keySystem.systemString+")! Could not create MediaKeys -- TODO"})})})},setMediaElement:function(e){i!==e&&(i&&(i.removeEventListener("encrypted",o),i.setMediaKeys&&i.setMediaKeys(null)),(i=e)&&(i.addEventListener("encrypted",o),i.setMediaKeys&&a&&i.setMediaKeys(a)))},setServerCertificate:function(e){if(!n||!a)throw new Error("Can not set server certificate until you have selected a key system");a.setServerCertificate(e).then(function(){r.info("DRM: License server certificate successfully updated."),c.trigger(d.SERVER_CERTIFICATE_UPDATED)}).catch(function(e){c.trigger(d.SERVER_CERTIFICATE_UPDATED,{error:new h.Z(f.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,f.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+e.name)})})},createKeySession:function(e){if(!n||!a)throw new Error("Can not create sessions until you have selected a key system");var t=a.createSession(e.sessionType),i=T(t,e),s=n.systemString===w.CLEARKEY_KEYSTEM_STRING&&(e.initData||e.protData&&e.protData.clearkeys)?w.INITIALIZATION_DATA_TYPE_KEYIDS:w.INITIALIZATION_DATA_TYPE_CENC;t.generateRequest(s,e.initData).then(function(){r.debug("DRM: Session created.  SessionID = "+i.getSessionId()),c.trigger(d.KEY_SESSION_CREATED,{data:i})}).catch(function(e){y(i),c.trigger(d.KEY_SESSION_CREATED,{data:null,error:new h.Z(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+e.name)})})},updateKeySession:function(e,t){var r=e.session;l.isClearKey(n)&&(t=t.toJWK()),r.update(t).then(function(){c.trigger(d.KEY_SESSION_UPDATED)}).catch(function(t){c.trigger(d.KEY_ERROR,{error:new h.Z(f.MEDIA_KEYERR_CODE,"Error sending update() message! "+t.name,e)})})},loadKeySession:function(e){if(!n||!a)throw new Error("Can not load sessions until you have selected a key system");for(var t=e.sessionId,i=0;i<s.length;i++)if(t===s[i].sessionId)return void r.warn("DRM: Ignoring session ID because we have already seen it!");var o=a.createSession(e.sessionType),l=T(o,e);o.load(t).then(function(e){e?(r.debug("DRM: Session loaded.  SessionID = "+l.getSessionId()),c.trigger(d.KEY_SESSION_CREATED,{data:l})):(y(l),c.trigger(d.KEY_SESSION_CREATED,{data:null,error:new h.Z(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+t+")")}))}).catch(function(e){y(l),c.trigger(d.KEY_SESSION_CREATED,{data:null,error:new h.Z(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+t+")! "+e.name)})})},removeKeySession:function(e){e.session.remove().then(function(){r.debug("DRM: Session removed.  SessionID = "+e.getSessionId()),c.trigger(d.KEY_SESSION_REMOVED,{data:e.getSessionId()})},function(t){c.trigger(d.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+e.getSessionId()+"). "+t.name})})},closeKeySession:function(e){v(e).catch(function(t){y(e),c.trigger(d.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.getSessionId()+") "+t.name})})},stop:function(){for(var e,t=0;t<s.length;t++)(e=s[t]).getUsable()||(v(e),y(e))},reset:function(){var e,t=s.length;0!==t?function(){for(var r=function(e){y(e),0===s.length&&(i?(i.removeEventListener("encrypted",o),i.setMediaKeys(null).then(function(){c.trigger(d.TEARDOWN_COMPLETE)})):c.trigger(d.TEARDOWN_COMPLETE))},n=0;n<t;n++)!function(t){v(e),r(t)}(e=s[n])}():c.trigger(d.TEARDOWN_COMPLETE)}},r=g.getLogger(t),n=null,i=null,a=null,s=[],l=ne(u).getInstance(),o={handleEvent:function(e){if("encrypted"===e.type&&e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;c.trigger(d.NEED_KEY,{key:new ue(t,e.initDataType)})}}},t}fe[w.PLAYREADY_KEYSTEM_STRING]=[w.PLAYREADY_KEYSTEM_STRING,w.PLAYREADY_RECOMMENDATION_KEYSTEM_STRING],fe[w.WIDEVINE_KEYSTEM_STRING]=[w.WIDEVINE_KEYSTEM_STRING],fe[w.CLEARKEY_KEYSTEM_STRING]=[w.CLEARKEY_KEYSTEM_STRING],he.__dashjs_factory_name="ProtectionModel_21Jan2015";var ge=dashjs.FactoryMaker.getClassFactory(he);function pe(e){e=e||{};var t,r,n,i,a,s,l,u,c,d=this.context,g=e.eventBus,p=e.events,m=e.debug,v=e.api;function y(){try{for(var e=0;e<l.length;e++)E(l[e]);n&&n.removeEventListener(v.needkey,u),g.trigger(p.TEARDOWN_COMPLETE)}catch(e){g.trigger(p.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+e.message})}}function E(e){var t=e.session;t.removeEventListener(v.error,e),t.removeEventListener(v.message,e),t.removeEventListener(v.ready,e),t.removeEventListener(v.close,e);for(var r=0;r<l.length;r++)if(l[r]===e){l.splice(r,1);break}t[v.release]()}function T(){var e=null,t=function(){n.removeEventListener("loadedmetadata",e),n[v.setMediaKeys](a),g.trigger(p.VIDEO_ELEMENT_SELECTED)};n.readyState>=1?t():(e=t.bind(this),n.addEventListener("loadedmetadata",e))}return t={getAllInitData:function(){for(var e=[],t=0;t<l.length;t++)e.push(l[t].initData);return e},getSessions:function(){return l},requestKeySystemAccess:function(e){return new Promise(function(t,r){for(var n=!1,i=0;i<e.length;i++)for(var a=e[i].ks.systemString,s=e[i].configs,l=null,u=null,d=0;d<s.length;d++){var f=s[d].audioCapabilities,h=s[d].videoCapabilities;if(f&&0!==f.length){l=[];for(var m=0;m<f.length;m++)window[v.MediaKeys].isTypeSupported(a,f[m].contentType)&&l.push(f[m])}if(h&&0!==h.length){u=[];for(var y=0;y<h.length;y++)window[v.MediaKeys].isTypeSupported(a,h[y].contentType)&&u.push(h[y])}if(!(!l&&!u||l&&0===l.length||u&&0===u.length)){n=!0;var E=new o(l,u),T=c.getKeySystemBySystemString(a),_=new de(T,E);g.trigger(p.KEY_SYSTEM_ACCESS_COMPLETE,{data:_}),t({data:_});break}}if(!n){var S="Key system access denied! -- No valid audio/video content configurations detected!";g.trigger(p.KEY_SYSTEM_ACCESS_COMPLETE,{error:S}),r({error:S})}})},selectKeySystem:function(e){return new Promise(function(t,r){try{a=e.mediaKeys=new window[v.MediaKeys](e.keySystem.systemString),i=e.keySystem,s=e,n&&T(),t(i)}catch(e){r({error:"Error selecting keys system ("+i.systemString+")! Could not create MediaKeys -- TODO"})}})},setMediaElement:function(e){n!==e&&(n&&n.removeEventListener(v.needkey,u),(n=e)&&(n.addEventListener(v.needkey,u),a&&T()))},createKeySession:function(e){if(!i||!a||!s)throw new Error("Can not create sessions until you have selected a key system");var t=null;if(s.ksConfiguration.videoCapabilities&&s.ksConfiguration.videoCapabilities.length>0&&(t=s.ksConfiguration.videoCapabilities[0]),null===t&&s.ksConfiguration.audioCapabilities&&s.ksConfiguration.audioCapabilities.length>0&&(t=s.ksConfiguration.audioCapabilities[0]),null===t)throw new Error("Can not create sessions for unknown content types.");var n=t.contentType,o=a.createSession(n,new Uint8Array(e.initData),e.cdmData?new Uint8Array(e.cdmData):null),u=function(e,t){return{session:e,keyId:t.keyId,initData:t.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case v.error:g.trigger(p.KEY_ERROR,{error:new h.Z(f.MEDIA_KEYERR_CODE,"KeyError",this)});break;case v.message:var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;g.trigger(p.INTERNAL_KEY_MESSAGE,{data:new ce(this,t,e.destinationURL)});break;case v.ready:r.debug("DRM: Key added."),g.trigger(p.KEY_ADDED);break;case v.close:r.debug("DRM: Session closed.  SessionID = "+this.getSessionId()),g.trigger(p.KEY_SESSION_CLOSED,{data:this.getSessionId()})}}}}(o,e);o.addEventListener(v.error,u),o.addEventListener(v.message,u),o.addEventListener(v.ready,u),o.addEventListener(v.close,u),l.push(u),r.debug("DRM: Session created.  SessionID = "+u.getSessionId()),g.trigger(p.KEY_SESSION_CREATED,{data:u})},updateKeySession:function(e,t){var r=e.session;c.isClearKey(i)?r.update(new Uint8Array(t.toJWK())):r.update(new Uint8Array(t)),g.trigger(p.KEY_SESSION_UPDATED)},closeKeySession:E,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:y,reset:y},r=m.getLogger(t),n=null,i=null,a=null,s=null,l=[],c=ne(d).getInstance(),u={handleEvent:function(e){if(e.type===v.needkey&&e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;g.trigger(p.NEED_KEY,{key:new ue(t,"cenc")})}}},t}pe.__dashjs_factory_name="ProtectionModel_3Feb2014";var me=dashjs.FactoryMaker.getClassFactory(pe);function ve(e){e=e||{};var t,r,n,i,a,s,l,u,c,d=this.context,g=e.eventBus,p=e.events,m=e.debug,v=e.api,y=e.errHandler;function E(){n&&S();for(var e=0;e<l.length;e++)T(l[e]);g.trigger(p.TEARDOWN_COMPLETE)}function T(e){try{n[v.cancelKeyRequest](i.systemString,e.sessionId)}catch(t){g.trigger(p.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.sessionId+") "+t.message})}}function _(e,t){if(t&&e){for(var r=e.length,n=0;n<r;n++)if(e[n].sessionId==t)return e[n];return null}return null}function S(){n.removeEventListener(v.keyerror,c),n.removeEventListener(v.needkey,c),n.removeEventListener(v.keymessage,c),n.removeEventListener(v.keyadded,c)}return t={getAllInitData:function(){for(var e=[],t=0;t<s.length;t++)e.push(s[t].initData);for(var r=0;r<l.length;r++)e.push(l[r].initData);return e},getSessions:function(){return l.concat(s)},requestKeySystemAccess:function(e){return new Promise(function(t,r){var i=n;i||(i=document.createElement("video"));for(var s=!1,l=0;l<e.length;l++)for(var u=e[l].ks.systemString,c=e[l].configs,d=null,f=0;f<c.length;f++){var h=c[f].videoCapabilities;if(h&&0!==h.length){d=[];for(var m=0;m<h.length;m++)""!==i.canPlayType(h[m].contentType,u)&&d.push(h[m])}if(d&&(!d||0!==d.length)){s=!0;var v=new o(null,d),y=a.getKeySystemBySystemString(u),E=new de(y,v);g.trigger(p.KEY_SYSTEM_ACCESS_COMPLETE,{data:E}),t({data:E});break}}if(!s){var T="Key system access denied! -- No valid audio/video content configurations detected!";g.trigger(p.KEY_SYSTEM_ACCESS_COMPLETE,{error:T}),r({error:T})}})},selectKeySystem:function(e){return i=e.keySystem,Promise.resolve(i)},setMediaElement:function(e){if(n!==e){if(n){S();for(var t=0;t<l.length;t++)T(l[t]);l=[]}(n=e)&&(n.addEventListener(v.keyerror,c),n.addEventListener(v.needkey,c),n.addEventListener(v.keymessage,c),n.addEventListener(v.keyadded,c),g.trigger(p.VIDEO_ELEMENT_SELECTED))}},createKeySession:function(e){if(!i)throw new Error("Can not create sessions until you have selected a key system");if(u||0===l.length){var t={sessionId:null,keyId:e.keyId,initData:e.initData,getKeyId:function(){return this.keyId},getSessionId:function(){return this.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return s.push(t),n[v.generateKeyRequest](i.systemString,new Uint8Array(e.initData)),t}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,t){var r=e.sessionId;if(a.isClearKey(i))for(var s=0;s<t.keyPairs.length;s++)n[v.addKey](i.systemString,t.keyPairs[s].key,t.keyPairs[s].keyID,r);else n[v.addKey](i.systemString,new Uint8Array(t),new Uint8Array(e.initData),r);g.trigger(p.KEY_SESSION_UPDATED)},closeKeySession:T,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:E,reset:E},r=m.getLogger(t),n=null,i=null,s=[],l=[],a=ne(d).getInstance(),c={handleEvent:function(e){var t=null;switch(e.type){case v.needkey:var n=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;g.trigger(p.NEED_KEY,{key:new ue(n,"cenc")});break;case v.keyerror:if((t=_(l,e.sessionId))||(t=_(s,e.sessionId)),t){var i=f.MEDIA_KEYERR_CODE,a="";switch(e.errorCode.code){case 1:i=f.MEDIA_KEYERR_UNKNOWN_CODE,a+="MEDIA_KEYERR_UNKNOWN - "+f.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:i=f.MEDIA_KEYERR_CLIENT_CODE,a+="MEDIA_KEYERR_CLIENT - "+f.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:i=f.MEDIA_KEYERR_SERVICE_CODE,a+="MEDIA_KEYERR_SERVICE - "+f.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:i=f.MEDIA_KEYERR_OUTPUT_CODE,a+="MEDIA_KEYERR_OUTPUT - "+f.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:i=f.MEDIA_KEYERR_HARDWARECHANGE_CODE,a+="MEDIA_KEYERR_HARDWARECHANGE - "+f.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:i=f.MEDIA_KEYERR_DOMAIN_CODE,a+="MEDIA_KEYERR_DOMAIN - "+f.MEDIA_KEYERR_DOMAIN_MESSAGE}a+="  System Code = "+e.systemCode,g.trigger(p.KEY_ERROR,{error:new h.Z(i,a,t)})}else r.error("No session token found for key error");break;case v.keyadded:(t=_(l,e.sessionId))||(t=_(s,e.sessionId)),t?(r.debug("DRM: Key added."),g.trigger(p.KEY_ADDED,{data:t})):r.debug("No session token found for key added");break;case v.keymessage:if((u=null!==e.sessionId&&void 0!==e.sessionId)?!(t=_(l,e.sessionId))&&s.length>0&&(t=s.shift(),l.push(t),t.sessionId=e.sessionId,g.trigger(p.KEY_SESSION_CREATED,{data:t})):s.length>0&&(t=s.shift(),l.push(t),0!==s.length&&y.error(new h.Z(f.MEDIA_KEY_MESSAGE_ERROR_CODE,f.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),t){var o=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=o,g.trigger(p.INTERNAL_KEY_MESSAGE,{data:new ce(t,o,e.defaultURL)})}else r.warn("No session token found for key message")}}},t}ve.__dashjs_factory_name="ProtectionModel_01b";var ye=dashjs.FactoryMaker.getClassFactory(ve),Ee=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],Te=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function _e(){var e,t=this.context;function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];if("function"==typeof e[n[Object.keys(n)[0]]])return n}return null}return e={createProtectionSystem:function(n){var i=null,a=ne(t).getInstance();a.setConfig({debug:n.debug,BASE64:n.BASE64,settings:n.settings}),a.initialize();var s=function(n){var i=n.debug,a=i.getLogger(e),s=n.eventBus,o=n.errHandler,l=n.videoModel?n.videoModel.getElement():null;return l&&void 0===l.onencrypted||l&&void 0===l.mediaKeys?r(l,Te)?(a.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),me(t).create({debug:i,eventBus:s,events:n.events,api:r(l,Te)})):r(l,Ee)?(a.info("EME detected on this user agent! (ProtectionModel_01b)"),ye(t).create({debug:i,eventBus:s,errHandler:o,events:n.events,api:r(l,Ee)})):(a.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(a.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),ge(t).create({debug:i,eventBus:s,events:n.events}))}(n);return!i&&s&&(i=S(t).create({protectionModel:s,protectionKeyController:a,eventBus:n.eventBus,debug:n.debug,events:n.events,BASE64:n.BASE64,constants:n.constants,cmcdModel:n.cmcdModel,customParametersModel:n.customParametersModel,settings:n.settings}),n.capabilities.setEncryptedMediaSupported(!0)),i}}}_e.__dashjs_factory_name="Protection";var Se=dashjs.FactoryMaker.getClassFactory(_e);Se.events=le,Se.errors=f,dashjs.FactoryMaker.updateClassFactory(_e.__dashjs_factory_name,Se);var be=Se},2068:function(e,t,r){var n=r(5448),i={DEFAULT:.5,STRONG:1,WEAK:0};function a(e,t,r){var n,a;return n=void 0===e?-1:e,a=function(e){var t=i.DEFAULT;return e!==i.DEFAULT&&e!==i.STRONG&&e!==i.WEAK||(t=e),t}(r),{quality:n,reason:void 0===t?null:t,priority:a}}a.__dashjs_factory_name="SwitchRequest";var s=n.Z.getClassFactory(a);s.NO_CHANGE=-1,s.PRIORITY=i,n.Z.updateClassFactory(a.__dashjs_factory_name,s),t.Z=s},1767:function(e,t,r){var n=r(5628),i=r(6535),a=r(7423),s=r(895),o=r(6070),l=r(3112),u=r(1914),c=r(5435),d=r(5448),f=r(2068),h=r(3393),g="qualitySwitchRules",p="abandonFragmentRules";function m(e){e=e||{};var t,r,d=this.context,m=e.mediaPlayerModel,v=e.customParametersModel,y=e.dashMetrics,E=e.settings;function T(e){return e.filter(function(e){return e.quality>f.Z.NO_CHANGE})}function _(e){var t,r,n,i,a,s={},o=null;if(0!==e.length){for(s[f.Z.PRIORITY.STRONG]={quality:f.Z.NO_CHANGE,reason:null},s[f.Z.PRIORITY.WEAK]={quality:f.Z.NO_CHANGE,reason:null},s[f.Z.PRIORITY.DEFAULT]={quality:f.Z.NO_CHANGE,reason:null},t=0,r=e.length;t<r;t+=1)(n=e[t]).quality!==f.Z.NO_CHANGE&&(s[n.priority].quality===f.Z.NO_CHANGE||s[n.priority].quality>n.quality)&&(s[n.priority].quality=n.quality,s[n.priority].reason=n.reason||null);return s[f.Z.PRIORITY.WEAK].quality!==f.Z.NO_CHANGE&&(o=s[f.Z.PRIORITY.WEAK]),s[f.Z.PRIORITY.DEFAULT].quality!==f.Z.NO_CHANGE&&(o=s[f.Z.PRIORITY.DEFAULT]),s[f.Z.PRIORITY.STRONG].quality!==f.Z.NO_CHANGE&&(o=s[f.Z.PRIORITY.STRONG]),o&&(i=o.quality,a=o.reason),(0,f.Z)(d).create(i,a)}}return{initialize:function(){t=[],r=[],E.get().streaming.abr.useDefaultABRRules&&(E.get().streaming.abr.ABRStrategy===h.Z.ABR_STRATEGY_L2A?t.push((0,u.Z)(d).create({dashMetrics:y,settings:E})):E.get().streaming.abr.ABRStrategy===h.Z.ABR_STRATEGY_LoLP?t.push((0,c.Z)(d).create({dashMetrics:y})):(t.push((0,l.Z)(d).create({dashMetrics:y,mediaPlayerModel:m,settings:E})),t.push((0,n.Z)(d).create({dashMetrics:y})),E.get().streaming.abr.additionalAbrRules.insufficientBufferRule&&t.push((0,i.Z)(d).create({dashMetrics:y,settings:E})),E.get().streaming.abr.additionalAbrRules.switchHistoryRule&&t.push((0,o.Z)(d).create()),E.get().streaming.abr.additionalAbrRules.droppedFramesRule&&t.push((0,s.Z)(d).create()),E.get().streaming.abr.additionalAbrRules.abandonRequestsRule&&r.push((0,a.Z)(d).create({dashMetrics:y,mediaPlayerModel:m,settings:E})))),v.getAbrCustomRules().forEach(function(e){e.type===g&&t.push(e.rule(d).create()),e.type===p&&r.push(e.rule(d).create())})},reset:function(){[t,r].forEach(function(e){e&&e.length&&e.forEach(function(e){return e.reset&&e.reset()})}),t=[],r=[]},getMaxQuality:function(e){return _(T(t.map(function(t){return t.getMaxIndex(e)})))||(0,f.Z)(d).create()},getMinSwitchRequest:_,shouldAbandonFragment:function(e,t){var n=_(T(r.map(function(r){return r.shouldAbandon(e,t)})));return n&&(n.reason.forceAbandon=!0),n||(0,f.Z)(d).create()},getQualitySwitchRules:function(){return t}}}m.__dashjs_factory_name="ABRRulesCollection";var v=d.Z.getClassFactory(m);v.QUALITY_SWITCH_RULES=g,v.ABANDON_FRAGMENT_RULES=p,d.Z.updateSingletonFactory(m.__dashjs_factory_name,v),t.Z=v},7423:function(e,t,r){var n=r(2068),i=r(5448),a=r(6398);function s(e){e=e||{};var t,r,i,o,l,u=this.context,c=e.mediaPlayerModel,d=e.dashMetrics,f=e.settings;function h(){i={},o={},l=[]}return t={shouldAbandon:function(e){var t=(0,n.Z)(u).create(n.Z.NO_CHANGE,{name:s.__dashjs_factory_name});if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getCurrentRequest")&&e.hasOwnProperty("getRepresentationInfo")&&e.hasOwnProperty("getAbrController")))return t;var a,h,g=e.getMediaInfo(),p=e.getMediaType(),m=e.getStreamInfo(),v=m?m.id:null,y=e.getCurrentRequest();if(!isNaN(y.index)){a=p,h=y.index,i[a]=i[a]||{},i[a][h]=i[a][h]||{};var E=c.getStableBufferTime();if(d.getCurrentBufferLevel(p)>E)return t;var T=i[p][y.index];if(null===T||null===y.firstByteDate||o.hasOwnProperty(T.id))return t;if(void 0===T.firstByteTime&&(l[p]=[],T.firstByteTime=y.firstByteDate.getTime(),T.segmentDuration=y.duration,T.bytesTotal=y.bytesTotal,T.id=y.index),T.bytesLoaded=y.bytesLoaded,T.elapsedTime=(new Date).getTime()-T.firstByteTime,T.bytesLoaded>0&&T.elapsedTime>0&&function(e,t){l[e]=l[e]||[],l[e].push(t)}(p,Math.round(8*T.bytesLoaded/T.elapsedTime)),l[p].length>=f.get().streaming.abr.abrRulesParameters.abandonRequestsRule.minLengthToAverage&&T.elapsedTime>f.get().streaming.abr.abrRulesParameters.abandonRequestsRule.graceTimeThreshold&&T.bytesLoaded<T.bytesTotal){var _=l[p].reduce(function(e,t){return e+t},0);if(T.measuredBandwidthInKbps=Math.round(_/l[p].length),T.estimatedTimeOfDownload=+(8*T.bytesTotal/T.measuredBandwidthInKbps/1e3).toFixed(2),T.estimatedTimeOfDownload<T.segmentDuration*f.get().streaming.abr.abrRulesParameters.abandonRequestsRule.abandonMultiplier||0===e.getRepresentationInfo().quality)return t;if(!o.hasOwnProperty(T.id)){var S=e.getAbrController(),b=T.bytesTotal-T.bytesLoaded,A=S.getBitrateList(g),I=S.getQualityForBitrate(g,T.measuredBandwidthInKbps*f.get().streaming.abr.bandwidthSafetyFactor,v),R=S.getMinAllowedIndexFor(p,v),w=void 0!==R?Math.max(R,I):I;b>T.bytesTotal*A[w].bitrate/A[S.getQualityFor(p,v)].bitrate&&(t.quality=w,t.reason.throughput=T.measuredBandwidthInKbps,t.reason.fragmentID=T.id,t.reason.rule=this.getClassName(),o[T.id]=T,r.debug("["+p+"] frag id",T.id," is asking to abandon and switch to quality to ",w," measured bandwidth was",T.measuredBandwidthInKbps),delete i[p][T.id])}}else T.bytesLoaded===T.bytesTotal&&delete i[p][T.id]}return t},reset:h},r=(0,a.Z)(u).getInstance().getLogger(t),h(),t}s.__dashjs_factory_name="AbandonRequestsRule",t.Z=i.Z.getClassFactory(s)},3112:function(e,t,r){var n=r(3860),i=r(2068),a=r(5448),s=r(7855),o=r(5595),l=r(8512),u=r(6398),c=r(8825),d=r(3393),f=10;function h(e){e=e||{};var t,r,a,h=this.context,g=e.dashMetrics,p=e.mediaPlayerModel,m=(0,o.Z)(h).getInstance();function v(e,t,r){var n=r.reduce(function(e,t,n){return t>r[e]?n:e},0);if(0===n)return null;var i=Math.max(e,f+2*t.length),a=(r[n]-1)/(i/f-1);return{gp:a,Vp:f/a}}function y(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN}function E(e,t){var r=p.getStableBufferTime();if(e.stableBufferTime!==r){var n=v(r,e.bitrates,e.utilities);if(n.Vp!==e.Vp||n.gp!==e.gp){var i=g.getCurrentBufferLevel(t),a=i+e.placeholderBuffer;a-=f,a*=n.Vp/e.Vp,a+=f,e.stableBufferTime=r,e.Vp=n.Vp,e.gp=n.gp,e.placeholderBuffer=Math.max(0,a-i)}}}function T(e,t){return e.Vp*(e.utilities[t]+e.gp)}function _(e,t){for(var r=e.bitrates[t],n=e.utilities[t],i=0,a=t-1;a>=0;--a)if(e.utilities[a]<e.utilities[t]){var s=e.bitrates[a],o=e.utilities[a],l=e.Vp*(e.gp+(r*o-s*n)/(r-s));i=Math.max(i,l)}return i}function S(e){var t=e.mediaType===d.Z.AUDIO?[d.Z.AUDIO]:a;for(var r in t)a.hasOwnProperty(r)&&2===a[r].state&&(a[r].placeholderBuffer=0)}function b(){for(var e in a)if(a.hasOwnProperty(e)){var t=a[e];0!==t.state&&(t.state=1,y(t))}}function A(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=a[e.chunk.mediaInfo.type];if(t&&0!==t.state){var r=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||r>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=r,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=r,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,R(t,e.chunk.mediaInfo.type)}}}function I(e){if(e&&e.metric===n.Z.HTTP_REQUEST&&e.value&&e.value.type===s.w.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=a[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),R(t,e.mediaType))}}function R(e,t){if(!isNaN(e.lastSegmentStart)&&!isNaN(e.lastSegmentRequestTimeMs)&&!isNaN(e.placeholderBuffer)){if(e.placeholderBuffer*=.99,!isNaN(e.lastSegmentFinishTimeMs)){var r=g.getCurrentBufferLevel(t)+.001*(e.lastSegmentFinishTimeMs-e.lastSegmentRequestTimeMs),n=T(e,e.lastQuality),i=Math.max(0,n-r);e.placeholderBuffer=Math.min(i,e.placeholderBuffer)}e.lastSegmentWasReplacement&&!isNaN(e.lastSegmentDurationS)&&(e.placeholderBuffer+=e.lastSegmentDurationS),e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN}}function w(e){if(e){var t=a[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function D(e){if(e){var t=a[e.mediaType];if(t&&0!==t.state){var r,n=g.getCurrentBufferLevel(e.mediaType);r=t.abrQuality>0?_(t,t.abrQuality):f;var i=Math.max(0,r-n);t.placeholderBuffer=Math.min(t.placeholderBuffer,i)}}}function L(){a={}}return t={getMaxIndex:function(e){var t=(0,i.Z)(h).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useBufferOccupancyABR")))return t;var n=e.getMediaInfo(),s=e.getMediaType(),o=e.getScheduleController(),l=e.getStreamInfo(),u=e.getAbrController(),c=u.getThroughputHistory(),d=l?l.id:null,f=l&&l.manifestInfo&&l.manifestInfo.isDynamic,m=e.useBufferOccupancyABR();if(t.reason=t.reason||{},!m)return t;o.setTimeToLoadDelay(0);var S=function(e){var t=e.getMediaType(),r=a[t];return r?0!==r.state&&E(r,t):(r=function(e){var t={},r=e.getMediaInfo().bitrateList.map(function(e){return e.bandwidth}),n=function(e){return e.map(function(e){return Math.log(e)})}(r);n=n.map(function(e){return e-n[0]+1});var i=p.getStableBufferTime(),a=v(i,r,n);return a?(t.state=1,t.bitrates=r,t.utilities=n,t.stableBufferTime=i,t.Vp=a.Vp,t.gp=a.gp,t.lastQuality=0,y(t)):t.state=0,t}(e),a[t]=r),r}(e);if(0===S.state)return t;var b,A=g.getCurrentBufferLevel(s),I=c.getAverageThroughput(s,f),R=c.getSafeAverageThroughput(s,f),w=c.getAverageLatency(s);if(t.reason.state=S.state,t.reason.throughput=I,t.reason.latency=w,isNaN(I))return t;switch(S.state){case 1:b=u.getQualityForBitrate(n,R,d,w),t.quality=b,t.reason.throughput=R,S.placeholderBuffer=Math.max(0,_(S,b)-A),S.lastQuality=b,!isNaN(S.lastSegmentDurationS)&&A>=S.lastSegmentDurationS&&(S.state=2);break;case 2:!function(e,t){var r=Date.now();if(isNaN(e.lastSegmentFinishTimeMs)){if(!isNaN(e.lastCallTimeMs)){var n=.001*(r-e.lastCallTimeMs);e.placeholderBuffer+=Math.max(0,n)}}else{var i=.001*(r-e.lastSegmentFinishTimeMs);e.placeholderBuffer+=Math.max(0,i)}e.lastCallTimeMs=r,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,E(e,t)}(S,s),b=function(e,t){for(var r=e.bitrates.length,n=NaN,i=NaN,a=0;a<r;++a){var s=(e.Vp*(e.utilities[a]+e.gp)-t)/e.bitrates[a];(isNaN(i)||s>=i)&&(i=s,n=a)}return n}(S,A+S.placeholderBuffer);var D=u.getQualityForBitrate(n,R,d,w);b>S.lastQuality&&b>D&&(b=Math.max(D,S.lastQuality));var L=Math.max(0,A+S.placeholderBuffer-T(S,b));L<=S.placeholderBuffer?(S.placeholderBuffer-=L,L=0):(L-=S.placeholderBuffer,S.placeholderBuffer=0,b<u.getMaxAllowedIndexFor(s,d)?o.setTimeToLoadDelay(1e3*L):L=0),t.quality=b,t.reason.throughput=I,t.reason.latency=w,t.reason.bufferLevel=A,t.reason.placeholderBuffer=S.placeholderBuffer,t.reason.delay=L,S.lastQuality=b;break;default:r.debug("BOLA ABR rule invoked in bad state."),t.quality=u.getQualityForBitrate(n,R,d,w),t.reason.state=S.state,t.reason.throughput=R,t.reason.latency=w,S.state=1,y(S)}return t},reset:function(){L(),m.off(c.Z.BUFFER_EMPTY,S,t),m.off(c.Z.PLAYBACK_SEEKING,b,t),m.off(c.Z.METRIC_ADDED,I,t),m.off(c.Z.QUALITY_CHANGE_REQUESTED,w,t),m.off(c.Z.FRAGMENT_LOADING_ABANDONED,D,t),m.off(l.Z.MEDIA_FRAGMENT_LOADED,A,t)}},r=(0,u.Z)(h).getInstance().getLogger(t),L(),m.on(c.Z.BUFFER_EMPTY,S,t),m.on(c.Z.PLAYBACK_SEEKING,b,t),m.on(c.Z.METRIC_ADDED,I,t),m.on(c.Z.QUALITY_CHANGE_REQUESTED,w,t),m.on(c.Z.FRAGMENT_LOADING_ABANDONED,D,t),m.on(l.Z.MEDIA_FRAGMENT_LOADED,A,t),t}h.__dashjs_factory_name="BolaRule",t.Z=a.Z.getClassFactory(h)},895:function(e,t,r){var n=r(5448),i=r(2068),a=r(6398);function s(){var e,t,r=this.context;return e={getMaxIndex:function(e){var n=(0,i.Z)(r).create();if(!e||!e.hasOwnProperty("getDroppedFramesHistory"))return n;var a=e.getDroppedFramesHistory(),s=e.getStreamInfo().id;if(a){var o=a.getFrameHistory(s);if(!o||0===o.length)return n;for(var l=0,u=0,c=i.Z.NO_CHANGE,d=1;d<o.length;d++)if(o[d]&&(l=o[d].droppedVideoFrames,(u=o[d].totalVideoFrames)>375&&l/u>.15)){c=d-1,t.debug("index: "+c+" Dropped Frames: "+l+" Total Frames: "+u);break}return(0,i.Z)(r).create(c,{droppedFrames:l})}return n}},t=(0,a.Z)(r).getInstance().getLogger(e),e}s.__dashjs_factory_name="DroppedFramesRule",t.Z=n.Z.getClassFactory(s)},6535:function(e,t,r){var n=r(5595),i=r(8512),a=r(5448),s=r(6398),o=r(2068),l=r(3393),u=r(3860),c=r(8825);function d(e){e=e||{};var t,r,a,d=this.context,f=(0,n.Z)(d).getInstance(),h=e.dashMetrics;function g(){(a={})[l.Z.VIDEO]={ignoreCount:2},a[l.Z.AUDIO]={ignoreCount:2}}function p(){g()}function m(e){isNaN(e.startTime)||e.mediaType!==l.Z.AUDIO&&e.mediaType!==l.Z.VIDEO||a[e.mediaType].ignoreCount>0&&a[e.mediaType].ignoreCount--}return t={getMaxIndex:function(e){var t=(0,o.Z)(d).create();if(!e||!e.hasOwnProperty("getMediaType"))return t;!function(){if(!h||!h.hasOwnProperty("getCurrentBufferLevel")||!h.hasOwnProperty("getCurrentBufferState"))throw new Error(l.Z.MISSING_CONFIG_ERROR)}();var n=e.getMediaType(),i=h.getCurrentBufferState(n),s=e.getRepresentationInfo().fragmentDuration,c=e.getStreamInfo(),f=c?c.id:null,g=e.getScheduleController(),p=c&&c.manifestInfo&&c.manifestInfo.isDynamic;if(function(e,t){return!e&&a[t].ignoreCount>0}(g.getPlaybackController().getLowLatencyModeEnabled(),n)||!s)return t;if(i&&i.state===u.Z.BUFFER_EMPTY)r.debug("["+n+"] Switch to index 0; buffer is empty."),t.quality=0,t.reason="InsufficientBufferRule: Buffer is empty";else{var m=e.getMediaInfo(),v=e.getAbrController(),y=v.getThroughputHistory(),E=h.getCurrentBufferLevel(n),T=y.getAverageThroughput(n,p),_=y.getAverageLatency(n),S=T*(E/s)*.5;t.quality=v.getQualityForBitrate(m,S,f,_),t.reason="InsufficientBufferRule: being conservative to avoid immediate rebuffering"}return t},reset:function(){g(),f.off(c.Z.PLAYBACK_SEEKING,p,t),f.off(i.Z.BYTES_APPENDED_END_FRAGMENT,m,t)}},r=(0,s.Z)(d).getInstance().getLogger(t),g(),f.on(c.Z.PLAYBACK_SEEKING,p,t),f.on(i.Z.BYTES_APPENDED_END_FRAGMENT,m,t),t}d.__dashjs_factory_name="InsufficientBufferRule",t.Z=a.Z.getClassFactory(d)},1914:function(e,t,r){var n=r(3860),i=r(2068),a=r(5448),s=r(7855),o=r(5595),l=r(8512),u=r(6398),c=r(3393);function d(e){e=e||{};var t,r,a,d,f=this.context,h=e.dashMetrics,g=(0,o.Z)(f).getInstance();function p(e){e.placeholderBuffer=0,e.mostAdvancedSegmentStart=NaN,e.lastSegmentWasReplacement=!1,e.lastSegmentStart=NaN,e.lastSegmentDurationS=NaN,e.lastSegmentRequestTimeMs=NaN,e.lastSegmentFinishTimeMs=NaN,e.lastSegmentUrl=""}function m(){for(var e in r)if(r.hasOwnProperty(e)){var t=r[e];0!==t.state&&(t.state=1,p(t))}}function v(e){if(e&&e.chunk&&e.chunk.mediaInfo){var t=r[e.chunk.mediaInfo.type],n=a[e.chunk.mediaInfo.type];if(t&&0!==t.state){var i=e.chunk.start;isNaN(t.mostAdvancedSegmentStart)||i>t.mostAdvancedSegmentStart?(t.mostAdvancedSegmentStart=i,t.lastSegmentWasReplacement=!1):t.lastSegmentWasReplacement=!0,t.lastSegmentStart=i,t.lastSegmentDurationS=e.chunk.duration,t.lastQuality=e.chunk.quality,E(t,n)}}}function y(e){if(e&&e.metric===n.Z.HTTP_REQUEST&&e.value&&e.value.type===s.w.MEDIA_SEGMENT_TYPE&&e.value.trace&&e.value.trace.length){var t=r[e.mediaType],i=a[e.mediaType];t&&0!==t.state&&(t.lastSegmentRequestTimeMs=e.value.trequest.getTime(),t.lastSegmentFinishTimeMs=e.value._tfinish.getTime(),E(t,i))}}function E(e,t){isNaN(e.lastSegmentStart)||isNaN(e.lastSegmentRequestTimeMs)||(t.segment_request_start_s=.001*e.lastSegmentRequestTimeMs,t.segment_download_finish_s=.001*e.lastSegmentFinishTimeMs,e.lastSegmentStart=NaN,e.lastSegmentRequestTimeMs=NaN)}function T(e){if(e&&e.mediaType){var t=r[e.mediaType];t&&0!==t.state&&(t.abrQuality=e.newQuality)}}function _(e,t){if(e.length!==t.length)return-1;for(var r=0,n=0;n<e.length;n++)r+=e[n]*t[n];return r}function S(){r={},a={}}return t={getMaxIndex:function(e){var t,n=(0,i.Z)(f).create(),o=Math.pow(4,.99),l=Math.max(Math.pow(4,1),o*Math.sqrt(4)),u=e.getMediaInfo(),g=e.getMediaType(),m=u.bitrateList.map(function(e){return e.bandwidth}),v=m.length,y=e.getScheduleController(),E=e.getStreamInfo(),T=e.getAbrController(),S=T.getThroughputHistory(),b=E&&E.manifestInfo&&E.manifestInfo.isDynamic,A=e.useL2AABR(),I=h.getCurrentBufferLevel(g,!0),R=S.getSafeAverageThroughput(g,b),w=S.getAverageThroughput(g,b),D=S.getAverageLatency(g),L=e.getVideoModel().getPlaybackRate();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("getScheduleController")&&e.hasOwnProperty("getStreamInfo")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("useL2AABR")))return n;if(n.reason=n.reason||{},!A||g===c.Z.AUDIO)return n;y.setTimeToLoadDelay(0);var C=function(e){var t=e.getMediaType(),n=r[t];return n||(n=function(e){var t={},r=e.getMediaInfo(),n=r.bitrateList.map(function(e){return e.bandwidth/1e3});return t.state=1,t.bitrates=n,t.lastQuality=0,function(e){e&&e.type&&(a[e.type]={},a[e.type].w=[],a[e.type].prev_w=[],a[e.type].Q=0,a[e.type].segment_request_start_s=0,a[e.type].segment_download_finish_s=0,a[e.type].B_target=1.5)}(r),p(t),t}(e),r[t]=n),n}(e);if(0===C.state)return n;var N=a[g];if(!N)return n;if(n.reason.state=C.state,n.reason.throughput=w,n.reason.latency=D,isNaN(w))return n;switch(C.state){case 1:if(t=T.getQualityForBitrate(u,R,E.id,D),n.quality=t,n.reason.throughput=R,C.lastQuality=t,!isNaN(C.lastSegmentDurationS)&&I>=N.B_target){C.state=2,N.Q=o;for(var P=0;P<v;++P)P===C.lastQuality?N.prev_w[P]=1:N.prev_w[P]=0}break;case 2:var O=[],M=h.getCurrentHttpRequest(g).trace.reduce(function(e,t){return e+t.d},0),k=h.getCurrentHttpRequest(g).trace.reduce(function(e,t){return e+t.b[0]},0),x=Math.round(8*k/M),F=h.getCurrentHttpRequest(g);if(x<1&&(x=1),F.url===C.lastSegmentUrl||F.type===s.w.INIT_SEGMENT_TYPE)t=C.lastQuality;else{for(var B=C.lastSegmentDurationS,U=1,Z=0;Z<v;++Z)m[Z]=m[Z]/1e3,L*m[Z]>x&&(U=-1),N.w[Z]=N.prev_w[Z]+U*(B/(2*l))*((N.Q+o)*(L*m[Z]/x));N.w=function(e){for(var t=e.length,r=!1,n=[],i=0;i<t;++i)n[i]=e[i];for(var a=e.sort(function(e,t){return t-e}),s=0,o=0,l=[],u=0;u<t-1;++u)if((o=((s+=a[u])-1)/(u+1))>=a[u+1]){r=!0;break}r||(o=(s+a[t-1]-1)/t);for(var c=0;c<t;++c)l[c]=Math.max(n[c]-o,0);return l}(N.w);for(var G=0;G<v;++G)O[G]=N.w[G]-N.prev_w[G],N.prev_w[G]=N.w[G];N.Q=Math.max(0,N.Q-B+B*L*((_(m,N.prev_w)+_(m,O))/x));for(var H=[],$=0;$<v;++$)H[$]=Math.abs(m[$]-_(N.w,m));(t=H.indexOf(Math.min.apply(Math,H)))>C.lastQuality&&m[C.lastQuality+1]<=x&&(t=C.lastQuality+1),m[t]>=x&&(N.Q=2*Math.max(o,N.Q)),C.lastSegmentUrl=F.url}n.quality=t,n.reason.throughput=w,n.reason.latency=D,n.reason.bufferLevel=I,C.lastQuality=n.quality;break;default:d.debug("L2A ABR rule invoked in bad state."),n.quality=T.getQualityForBitrate(u,R,E.id,D),n.reason.state=C.state,n.reason.throughput=R,n.reason.latency=D,C.state=1,p(C)}return n},reset:function(){S(),g.off(l.Z.PLAYBACK_SEEKING,m,t),g.off(l.Z.MEDIA_FRAGMENT_LOADED,v,t),g.off(l.Z.METRIC_ADDED,y,t),g.off(l.Z.QUALITY_CHANGE_REQUESTED,T,t)}},d=(0,u.Z)(f).getInstance().getLogger(t),S(),g.on(l.Z.PLAYBACK_SEEKING,m,t),g.on(l.Z.MEDIA_FRAGMENT_LOADED,v,t),g.on(l.Z.METRIC_ADDED,y,t),g.on(l.Z.QUALITY_CHANGE_REQUESTED,T,t),t}d.__dashjs_factory_name="L2ARule",t.Z=a.Z.getClassFactory(d)},6070:function(e,t,r){var n=r(5448),i=r(6398),a=r(2068);function s(){var e,t,r=this.context;return e={getMaxIndex:function(e){for(var n=e?e.getSwitchHistory():null,i=n?n.getSwitchRequests():[],s=0,o=0,l=0,u=(0,a.Z)(r).create(),c=0;c<i.length;c++)if(void 0!==i[c]&&(s+=i[c].drops,o+=i[c].noDrops,l+=i[c].dropSize,s+o>=6&&s/o>.075)){u.quality=c>0&&i[c].drops>0?c-1:c,u.reason={index:u.quality,drops:s,noDrops:o,dropSize:l},t.debug("Switch history rule index: "+u.quality+" samples: "+(s+o)+" drops: "+s);break}return u}},t=(0,i.Z)(r).getInstance().getLogger(e),e}s.__dashjs_factory_name="SwitchHistoryRule",t.Z=n.Z.getClassFactory(s)},5628:function(e,t,r){var n=r(5448),i=r(2068),a=r(3393),s=r(3860);function o(e){e=e||{};var t=this.context,r=e.dashMetrics;return{getMaxIndex:function(e){var n=(0,i.Z)(t).create();if(!(e&&e.hasOwnProperty("getMediaInfo")&&e.hasOwnProperty("getMediaType")&&e.hasOwnProperty("useBufferOccupancyABR")&&e.hasOwnProperty("getAbrController")&&e.hasOwnProperty("getScheduleController")))return n;!function(){if(!r||!r.hasOwnProperty("getCurrentBufferState"))throw new Error(a.Z.MISSING_CONFIG_ERROR)}();var o=e.getMediaInfo(),l=e.getMediaType(),u=r.getCurrentBufferState(l),c=e.getScheduleController(),d=e.getAbrController(),f=e.getStreamInfo(),h=f?f.id:null,g=f&&f.manifestInfo?f.manifestInfo.isDynamic:null,p=d.getThroughputHistory(),m=p.getSafeAverageThroughput(l,g),v=p.getAverageLatency(l),y=e.useBufferOccupancyABR();return isNaN(m)||!u||y||d.getAbandonmentStateFor(h,l)!==s.Z.ABANDON_LOAD&&(u.state===s.Z.BUFFER_LOADED||g)&&(n.quality=d.getQualityForBitrate(o,m,h,v),c.setTimeToLoadDelay(0),n.reason={throughput:m,latency:v}),n},reset:function(){}}}o.__dashjs_factory_name="ThroughputRule",t.Z=n.Z.getClassFactory(o)},4722:function(e,t,r){var n=r(5448),i=r(6398);function a(){var e,t,r,n,a,s,o,l,u,c=this.context;function d(){r=null,n=1,a=100,s=0,o=null,l=null,u="dynamic_weight_selection"}function f(){var e=0;if(r)for(var t=0;t<r.length;t++){var n=r[t];n.state.throughput>e&&(e=n.state.throughput)}return e}function h(e,t,r){var n=e.map(function(e,n){return r[n]*Math.pow(e-t[n],2)}).reduce(function(e,t){return e+t});return(n<0?-1:1)*Math.sqrt(Math.abs(n))}function g(e,t){return h([e.state.throughput,e.state.latency,e.state.rebuffer,e.state.switch],[t.state.throughput,t.state.latency,t.state.rebuffer,t.state.switch],[1,1,1,1])}function p(e,t,r){for(var n=0;n<t.length;n++){var i=t[n],a=g(i,e);m(i,r,Math.exp(-1*Math.pow(a,2)/(2*Math.pow(.1,2))))}}function m(e,t,r){var n=e.state,i=[.01,.01,.01,.01];n.throughput=n.throughput+(t[0]-n.throughput)*i[0]*r,n.latency=n.latency+(t[1]-n.latency)*i[1]*r,n.rebuffer=n.rebuffer+(t[2]-n.rebuffer)*i[2]*r,n.switch=n.switch+(t[3]-n.switch)*i[3]*r}return e={getNextQuality:function(e,i,c,d,g,m,v){var y=c,E=d,T=i,_=function(e){if(!r){r=[];var t=e.bitrateList,i=[];s=t[0].bandwidth,t.forEach(function(e){i.push(e.bandwidth),e.bandwidth<s&&(s=e.bandwidth)}),u=i.map(function(e){return Math.pow(e,2)}).reduce(function(e,t){return e+t}),n=Math.sqrt(u);for(var a=0;a<t.length;a++){var o={qualityIndex:a,bitrate:t[a].bandwidth,state:{throughput:t[a].bandwidth/n,latency:0,rebuffer:0,switch:0}};r.push(o)}l=function(e){var t=[],r=function(e){for(var t=[],r=0;r<e;r++){var n=[Math.random()*f(),Math.random(),Math.random(),Math.random()];t.push(n)}return t}(Math.pow(e.length,2));t.push(r[0]);for(var n=[1,1,1,1],i=1;i<e.length;i++){for(var a=null,s=null,o=0;o<r.length;o++){for(var l=r[o],u=null,c=0;c<t.length;c++){var d=h(l,t[c],n);(null===u||d<u)&&(u=d)}(null===s||u>s)&&(a=l,s=u)}t.push(a)}for(var g=null,p=null,m=0;m<t.length;m++){for(var v=0,y=0;y<t.length;y++)m!==y&&(v+=h(t[m],t[y],n));(null===g||v>g)&&(g=v,p=m)}var E=[];for(E.push(t[p]),t.splice(p,1);t.length>0;){for(var T=null,_=null,S=0;S<t.length;S++){var b=h(E[0],t[S],n);(null===T||b<T)&&(T=b,_=S)}E.push(t[_]),t.splice(_,1)}return E}(r)}var u;return r}(e),S=i/n;S>1&&(S=f()),c/=a,t.debug("getNextQuality called throughput:".concat(S," latency:").concat(c," bufferSize:").concat(d," currentQualityIndex:").concat(m," playbackRate:").concat(g));var b=_[m],A=b.bitrate*v.getSegmentDuration()/T,I=Math.max(0,A-E);if(E-A<v.getMinBuffer())return t.debug("Buffer is low for bitrate= ".concat(b.bitrate," downloadTime=").concat(A," currentBuffer=").concat(E," rebuffer=").concat(I)),function(e,t){var n=0,i=e;if(r)for(var a=0;a<r.length;a++){var s=r[a];s.bitrate<e.bitrate&&s.bitrate>n&&t>s.bitrate&&(n=s.bitrate,i=s)}return i}(b,T).qualityIndex;switch(u){case"manual_weight_selection":o=[.4,.4,.4,.4];break;case"random_weight_selection":!function(e){o=function(e){for(var t=[],r=Math.sqrt(2/e),n=0;n<4;n++)t.push(Math.random()*r);return o=t}(e.length)}(_);break;default:!function(e,t,r,n,i,a,s){o||(o=l[l.length-1]);var u=e.findWeightVector(t,r,n,i,a,s);null!==u&&-1!==u&&(o=u)}(v,_,y,E,I,T,g)}for(var R=null,w=null,D=null,L=0;L<_.length;L++){var C=_[L],N=C.state,P=[N.throughput,N.latency,N.rebuffer,N.switch],O=o.slice(),M=v.getNextBufferWithBitrate(C.bitrate,E,T),k=M<v.getMinBuffer();k&&t.debug("Buffer is low for bitrate=".concat(C.bitrate," downloadTime=").concat(A," currentBuffer=").concat(E," nextBuffer=").concat(M)),(C.bitrate>i-1e4||k)&&C.bitrate!==s&&(O[0]=100);var x=h(P,[S,0,0,0],O);(null===R||x<R)&&(R=x,w=C.qualityIndex,D=C)}var F=Math.abs(b.bitrate-D.bitrate)/n;return p(b,_,[S,c,I,F]),p(D,_,[S,0,0,F]),w},reset:function(){d()}},t=(0,i.Z)(c).getInstance().getLogger(e),d(),e}a.__dashjs_factory_name="LearningAbrController",t.Z=n.Z.getClassFactory(a)},5317:function(e,t,r){var n=r(5448),i=r(2298);function a(){var e,t,r,n,a;function s(){t=null,r=null,n=null,a=null}function o(e,t,r,n){var a=new i.Z;return a.type=e,a.weights.bitrateReward=t||1,a.weights.bitrateSwitchPenalty=1,a.weights.rebufferPenalty=r||1e3,a.weights.latencyPenalty=[],a.weights.latencyPenalty.push({threshold:1.1,penalty:.05*n}),a.weights.latencyPenalty.push({threshold:1e8,penalty:.1*r}),a.weights.playbackSpeedPenalty=n||200,a}function l(e,t,r,n,i){i.bitrateWSum+=i.weights.bitrateReward*e,i.lastBitrate&&(i.bitrateSwitchWSum+=i.weights.bitrateSwitchPenalty*Math.abs(e-i.lastBitrate)),i.lastBitrate=e,i.rebufferWSum+=i.weights.rebufferPenalty*t;for(var a=0;a<i.weights.latencyPenalty.length;a++){var s=i.weights.latencyPenalty[a];if(r<=s.threshold){i.latencyWSum+=s.penalty*r;break}}i.playbackSpeedWSum+=i.weights.playbackSpeedPenalty*Math.abs(1-n),i.totalQoe=i.bitrateWSum-i.bitrateSwitchWSum-i.rebufferWSum-i.latencyWSum-i.playbackSpeedWSum}return e={setupPerSegmentQoe:function(e,i,s){t=o("segment",e,i,s),r=e,n=i,a=s},logSegmentMetrics:function(e,r,n,i){t&&l(e,r,n,i,t)},getPerSegmentQoe:function(){return t},calculateSingleUseQoe:function(e,t,i,s){var u=null;return r&&n&&a&&(u=o("segment",r,n,a)),u?(l(e,t,i,s,u),u.totalQoe):0},reset:function(){s()}},s(),e}a.__dashjs_factory_name="LoLpQoeEvaluator",t.Z=n.Z.getClassFactory(a)},5435:function(e,t,r){var n=r(6398),i=r(5448),a=r(4722),s=r(5317),o=r(2068),l=r(3860),u=r(6523),c=r(3393);function d(e){var t,r,i,d,f=(e=e||{}).dashMetrics,h=this.context;return r={getMaxIndex:function(e){try{var r=(0,o.Z)(h).create(),n=e.getMediaInfo().type,a=e.getAbrController(),s=e.getStreamInfo(),g=a.getQualityFor(n,s.id),p=e.getMediaInfo(),m=f.getCurrentBufferState(n),v=e.getScheduleController(),y=f.getCurrentBufferLevel(n,!0),E=s&&s.manifestInfo?s.manifestInfo.isDynamic:null,T=v.getPlaybackController(),_=T.getCurrentLiveLatency();if(!e.useLoLPABR()||n===c.Z.AUDIO)return r;_||(_=0);var S=T.getPlaybackRate(),b=a.getThroughputHistory().getSafeAverageThroughput(n,E);if(t.debug("Throughput ".concat(Math.round(b)," kbps")),isNaN(b)||!m)return r;if(a.getAbandonmentStateFor(s.id,n)===l.Z.ABANDON_LOAD)return r;for(var A=p.bitrateList,I=e.getRepresentationInfo().fragmentDuration,R=A[0].bandwidth/1e3,w=A[A.length-1].bandwidth/1e3,D=0;D<A.length;D++){var L=A[D].bandwidth/1e3;L>w?w=L:L<R&&(R=L)}var C=A[g].bandwidth/1e3,N=f.getCurrentHttpRequest(n,!0),P=(N.tresponse.getTime()-N.trequest.getTime())/1e3,O=P>I?P-I:0;d.setupPerSegmentQoe(I,w,R),d.logSegmentMetrics(C,O,_,S);var M=(0,u.Z)(h).create({targetLatency:1.5,bufferMin:.3,segmentDuration:I,qoeEvaluator:d});return r.quality=i.getNextQuality(p,1e3*b,_,y,S,g,M),r.reason={throughput:b,latency:_},r.priority=o.Z.PRIORITY.STRONG,v.setTimeToLoadDelay(0),r.quality!==g&&t.debug("[TgcLearningRule]["+n+"] requesting switch to index: ",r.quality,"Average throughput",Math.round(b),"kbps"),r}catch(e){throw e}},reset:function(){i.reset(),d.reset()}},t=(0,n.Z)(h).getInstance().getLogger(r),i=(0,a.Z)(h).create(),d=(0,s.Z)(h).create(),r}d.__dashjs_factory_name="LoLPRule",t.Z=i.Z.getClassFactory(d)},6523:function(e,t,r){var n=r(5448);function i(e){var t,r,n,i,a=e.targetLatency,s=e.bufferMin,o=e.segmentDuration,l=e.qoeEvaluator;function u(){return o}function c(e,t){var r=u();return t>r?e-r:e+r-t}return t={getMinBuffer:function(){return s},getSegmentDuration:u,getNextBufferWithBitrate:function(e,t,r){return c(t,e*o/r)},getNextBuffer:c,findWeightVector:function(e,t,i,u,d,f){var h=null,g=null,p=null,m=Math.abs(t-n);return e.forEach(function(e){r.forEach(function(r){r[0];var n=r[1],u=r[2],v=(r[3],e.bitrate*o/d),y=c(i,v),E=(0===u?10:1/u)*Math.max(1e-5,v-y),T=(0===n?10:1/n)*e.state.latency,_=l.calculateSingleUseQoe(e.bitrate,E,T,f);(null===h||_>h)&&function(e,t,r){return!(e>a+r)&&t>=s}(t,y,m)&&(h=_,g=r,p=e.bitrate)})}),null===g&&null===p&&(g=-1),n=t,g}},r=function e(t,r,n){if(n===r)return t;for(var a=t.length,s=0;s<a;s++)for(var o=t.shift(),l=0;l<i.length;l++)t.push(o.concat(i[l]));return e(t,r,n+1)}((i=[.2,.4,.6,.8,1]).map(function(e){return[e]}),4,1),n=0,t}i.__dashjs_factory_name="LoLpWeightSelector",t.Z=n.Z.getClassFactory(i)},2298:function(e,t){t.Z=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=null,this.lastBitrate=null,this.weights={},this.weights.bitrateReward=null,this.weights.bitrateSwitchPenalty=null,this.weights.rebufferPenalty=null,this.weights.latencyPenalty=null,this.weights.playbackSpeedPenalty=null,this.bitrateWSum=0,this.bitrateSwitchWSum=0,this.rebufferWSum=0,this.latencyWSum=0,this.playbackSpeedWSum=0,this.totalQoe=0}},7803:function(e,t,r){r.d(t,{Y:function(){return h}});var n=r(3393),i=r(1553),a=r(5448),s=r(2128),o=r(2594),l=r(7387),u=r(7417),c=r(9032),d=r(9326),f=r(7802),h=["http://dashif.org/thumbnail_tile","http://dashif.org/guidelines/thumbnail_tile"];function g(e){var t,r,a,g,p,m,v,y,E=this.context,T=e.adapter,_=e.baseURLController,S=e.streamInfo,b=e.timelineConverter,A=e.debug,I=e.eventBus,R=e.events,w=e.dashConstants,D=(0,o.Z)(E).getInstance();function L(e,t){var n=new s.Z;n.id=e.id,n.bitrate=e.bandwidth,n.width=e.width,n.height=e.height,n.tilesHor=1,n.tilesVert=1,e.essentialProperties&&e.essentialProperties.forEach(function(e){if(h.indexOf(e.schemeIdUri)>=0&&e.value){var t=e.value.split("x");2!==t.length||isNaN(t[0])||isNaN(t[1])||(n.tilesHor=parseInt(t[0],10),n.tilesVert=parseInt(t[1],10))}}),t?m.updateSegmentData(e).then(function(t){!function(e,t,r){var n=[],i=function(e,t){var r,n,i,a,s=[],o=0;for(r=0,n=e.segments.length;r<n;r++)i=e.segments[r],(a=(0,l.TJ)(b,T.getIsDynamic(),t,i.startTime,i.duration,i.timescale,i.media,i.mediaRange,o))&&(s.push(a),a=null,o++);return s}(r,t);t.segments=i,e.segmentDuration=t.segments[0].duration,e.readThumbnail=function(e,r){var i=null;n.some(function(t){if(t.start<=e&&t.end>e)return i=t.url,!0}),i?r(i):t.segments.some(function(i){if(i.mediaStartTime<=e&&i.mediaStartTime+i.duration>e){var a=_.resolve(t.path);return v.load({method:"get",url:a.url,request:{range:i.mediaRange,responseType:"arraybuffer"},onload:function(e){var t=y.getSamplesInfo(e.target.response),a=new Blob([e.target.response.slice(t.sampleList[0].offset,t.sampleList[0].offset+t.sampleList[0].size)],{type:"image/jpeg"}),s=window.URL.createObjectURL(a);n.push({start:i.mediaStartTime,end:i.mediaStartTime+i.duration,url:s}),r&&r(s)}}),!0}})}}(n,e,t)}):(n.startNumber=e.startNumber,n.segmentDuration=e.segmentDuration,n.timescale=e.timescale,n.templateUrl=function(e){var t=D.isRelative(e.media)?D.resolve(e.media,_.resolve(e.path).url):e.media;return t?(0,l.Aj)(t,e.id):""}(e)),n.tilesHor>0&&n.tilesVert>0&&(n.widthPerTile=n.width/n.tilesHor,n.heightPerTile=n.height/n.tilesVert,r.push(n))}function C(){r=[],g=-1,p=null}return t={getTracks:function(){return r},addTracks:function(){if(S&&T&&(p=T.getMediaInfoForType(S,n.Z.IMAGE))){var e=T.getVoRepresentations(p);e&&e.length>0&&e.forEach(function(e){(e.segmentInfoType===i.Z.SEGMENT_TEMPLATE&&e.segmentDuration>0&&e.media||e.segmentInfoType===i.Z.SEGMENT_TIMELINE)&&L(e),e.segmentInfoType===i.Z.SEGMENT_BASE&&L(e,!0)}),r.length>0&&r.sort(function(e,t){return e.bitrate-t.bitrate})}},reset:C,setTrackByIndex:function(e){r&&0!==r.length&&(e>=r.length&&(e=r.length-1),g=e)},getCurrentTrack:function(){return g<0?null:r[g]},getCurrentTrackIndex:function(){return g},getThumbnailRequestForTime:function(e){for(var t,n=T.getVoRepresentations(p),i=0;i<n.length;i++)if(r[g].id===n[i].id){t=n[i];break}return a.getSegmentRequestForTime(p,t,e)}},C(),v=(0,c.Z)(E).create({}),y=(0,u.Z)(E).getInstance(),m=(0,f.Z)(E).create({events:R,eventBus:I,streamInfo:S,timelineConverter:b,dashConstants:w,dashMetrics:e.dashMetrics,segmentBaseController:e.segmentBaseController,type:n.Z.IMAGE}),(a=(0,d.Z)(E).create({streamInfo:S,type:n.Z.IMAGE,timelineConverter:b,segmentsController:m,baseURLController:_,debug:A,eventBus:I,events:R,dashConstants:w,urlUtils:D})).initialize(!!T&&T.getIsDynamic()),t}g.__dashjs_factory_name="ThumbnailTracks",t.Z=a.Z.getClassFactory(g)},7417:function(e,t,r){var n=r(6398),i=r(8260),a=r(5448),s=r(6934),o=r(9597);function l(){var e,t,r=this.context;function a(e){if(!e)return null;void 0===e.fileStart&&(e.fileStart=0);var t=s.parseBuffer(e),n=(0,i.Z)(r).create();return n.setData(t),n}function l(e,t){return e[t+3]>>>0|e[t+2]<<8>>>0|e[t+1]<<16>>>0|e[t]<<24>>>0}function u(e,t){return String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t++])+String.fromCharCode(e[t])}return t={parse:a,findLastTopIsoBoxCompleted:function(e,t,r){if(void 0===r&&(r=0),!t||r+8>=t.byteLength)return new o.Z(0,!1);for(var n,i=t instanceof ArrayBuffer?new Uint8Array(t):t,a=0;r<i.byteLength;){var s=l(i,r),c=u(i,r+4);if(0===s)break;r+s<=i.byteLength&&(e.indexOf(c)>=0?n=new o.Z(r,!0,s):a=r+s),r+=s}return n||new o.Z(a,!1)},getMediaTimescaleFromMoov:function(e){var t=a(e),r=t?t.getBox("mdhd"):void 0;return r?r.timescale:NaN},getSamplesInfo:function(e){if(!e||0===e.byteLength)return{sampleList:[],lastSequenceNumber:NaN,totalDuration:NaN,numSequences:NaN};var t,r,n,i,s,o,l,u,c,d,f,h,g,p,m,v,y=a(e),E=y.getBoxes("moof"),T=y.getBoxes("mfhd");m=y.getBoxes("moof").length,p=T[T.length-1].sequence_number,r=0,s=[];var _=-1,S=-1;for(d=0;d<E.length;d++){var b=E[d],A=b.getChildBoxes("traf");for(u=0;u<A.length;u++){var I=A[u],R=I.getChildBox("tfhd"),w=I.getChildBox("tfdt");i=w.baseMediaDecodeTime;var D=I.getChildBoxes("trun"),L=I.getChildBoxes("subs");for(c=0;c<D.length;c++){var C=D[c];for(r=C.sample_count,g=(R.base_data_offset||0)+(C.data_offset||0),l=0;l<r;l++){t=void 0!==(o=C.samples[l]).sample_duration?o.sample_duration:R.default_sample_duration,n=void 0!==o.sample_size?o.sample_size:R.default_sample_size;var N={dts:i,cts:i+(void 0!==o.sample_composition_time_offset?o.sample_composition_time_offset:0),duration:t,offset:b.offset+g,size:n,subSizes:[n]};if(L)for(f=0;f<L.length;f++){var P=L[f];if(_<P.entry_count-1&&l>S&&(_++,S+=P.entries[_].sample_delta),l==S){N.subSizes=[];var O=P.entries[_];for(h=0;h<O.subsample_count;h++)N.subSizes.push(O.subsamples[h].subsample_size)}}s.push(N),g+=n,i+=t}}v=i-w.baseMediaDecodeTime}}return{sampleList:s,lastSequenceNumber:p,totalDuration:v,numSequences:m}},findInitRange:function(t){var r=null,n=a(t);if(!n)return r;var i=n.getBox("ftyp"),s=n.getBox("moov");return e.debug("Searching for initialization."),s&&s.isComplete&&(r=(i?i.offset:s.offset)+"-"+(s.offset+s.size-1),e.debug("Found the initialization.  Range: "+r)),r},parsePayload:function(e,t,r){if(void 0===r&&(r=0),!t||r+8>=t.byteLength)return new o.Z(0,!1);for(var n,i=t instanceof ArrayBuffer?new Uint8Array(t):t,a=0;r<i.byteLength;){var s=l(i,r),c=u(i,r+4);if(0===s)break;r+s<=i.byteLength&&(e.indexOf(c)>=0?n=new o.Z(r,!0,s,c):a=r+s),r+=s}return n||new o.Z(a,!1)}},e=(0,n.Z)(r).getInstance().getLogger(t),t}l.__dashjs_factory_name="BoxParser",t.Z=a.Z.getSingletonFactory(l)},1715:function(e,t,r){r.d(t,{B:function(){return o}});var n=r(5448),i=r(7803),a=r(3393),s=[{codec:"avc1",compatibleCodecs:["avc3"]},{codec:"avc3",compatibleCodecs:["avc1"]}];function o(){var e="ManagedMediaSource"in window,t="WebKitMediaSource"in window,r="MediaSource"in window;return e||t||r}function l(){var e,t,r;return e={setConfig:function(e){e&&e.settings&&(t=e.settings)},supportsMediaSource:o,supportsEncryptedMedia:function(){return r},supportsCodec:function(e,r){return r!==a.Z.AUDIO&&r!==a.Z.VIDEO?Promise.resolve(!0):function(e,r){return t.get().streaming.capabilities.useMediaCapabilitiesApi&&navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo&&(e.codec&&r===a.Z.AUDIO||r===a.Z.VIDEO&&e.codec&&e.width&&e.height&&e.bitrate&&e.framerate)}(e,r)?function(e,t){return new Promise(function(r){if(e&&e.codec){var n={type:"media-source"};n[t]={},n[t].contentType=e.codec,n[t].width=e.width,n[t].height=e.height,n[t].bitrate=parseInt(e.bitrate),n[t].framerate=parseFloat(e.framerate),navigator.mediaCapabilities.decodingInfo(n).then(function(e){r(e.supported)}).catch(function(){r(!1)})}else r(!1)})}(e,r):function(e){return new Promise(function(t){if(e&&e.codec){var r=e.codec;e.width&&e.height&&(r+=';width="'+e.width+'";height="'+e.height+'"'),"ManagedMediaSource"in window&&ManagedMediaSource.isTypeSupported(r)||"MediaSource"in window&&MediaSource.isTypeSupported(r)||"WebKitMediaSource"in window&&WebKitMediaSource.isTypeSupported(r)?t(!0):t(!1)}else t(!1)})}(e)},setEncryptedMediaSupported:function(e){r=e},supportsEssentialProperty:function(e){try{return-1!==i.Y.indexOf(e.schemeIdUri)||a.Z.FONT_DOWNLOAD_DVB_SCHEME===e.schemeIdUri}catch(e){return!0}},codecRootCompatibleWithCodec:function(e,t){for(var r,n=e.split(".")[0],i=0===t.indexOf(n),a=0;a<s.length;a++)if(s[a].codec===n){r=s[a];break}return r?i||r.compatibleCodecs.some(function(e){return 0===t.indexOf(e)}):i}},r=!1,e}l.__dashjs_factory_name="Capabilities",t.Z=n.Z.getSingletonFactory(l)},2295:function(e,t,r){var n=r(5448),i=r(3106);function a(){return{customTimeRangeArray:[],length:0,add:function(e,t){var r;for(r=0;r<this.customTimeRangeArray.length&&e>this.customTimeRangeArray[r].start;r++);for(this.customTimeRangeArray.splice(r,0,{start:e,end:t}),r=0;r<this.customTimeRangeArray.length-1;r++)this.mergeRanges(r,r+1)&&r--;this.length=this.customTimeRangeArray.length},clear:function(){this.customTimeRangeArray=[],this.length=0},remove:function(e,t){for(var r=0;r<this.customTimeRangeArray.length;r++)if(e<=this.customTimeRangeArray[r].start&&t>=this.customTimeRangeArray[r].end)this.customTimeRangeArray.splice(r,1),r--;else{if(e>this.customTimeRangeArray[r].start&&t<this.customTimeRangeArray[r].end){this.customTimeRangeArray.splice(r+1,0,{start:t,end:this.customTimeRangeArray[r].end}),this.customTimeRangeArray[r].end=e;break}e>this.customTimeRangeArray[r].start&&e<this.customTimeRangeArray[r].end?this.customTimeRangeArray[r].end=e:t>this.customTimeRangeArray[r].start&&t<this.customTimeRangeArray[r].end&&(this.customTimeRangeArray[r].start=t)}this.length=this.customTimeRangeArray.length},mergeRanges:function(e,t){var r=this.customTimeRangeArray[e],n=this.customTimeRangeArray[t];return r.start<=n.start&&n.start<=r.end&&r.end<=n.end?(r.end=n.end,this.customTimeRangeArray.splice(t,1),!0):n.start<=r.start&&r.start<=n.end&&n.end<=r.end?(r.start=n.start,this.customTimeRangeArray.splice(t,1),!0):n.start<=r.start&&r.start<=n.end&&r.end<=n.end?(this.customTimeRangeArray.splice(e,1),!0):r.start<=n.start&&n.start<=r.end&&n.end<=r.end&&(this.customTimeRangeArray.splice(t,1),!0)},start:function(e){return(0,i.SE)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].start},end:function(e){return(0,i.SE)(e),e>=this.customTimeRangeArray.length||e<0?NaN:this.customTimeRangeArray[e].end}}}a.__dashjs_factory_name="CustomTimeRanges",t.Z=n.Z.getClassFactory(a)},5:function(e,t,r){var n=r(5448);function i(){var e,t=/^[a-z][a-z0-9+\-_.]*:/i,r=/^https?:\/\//i,n=/^https:\/\//i,i=/^([a-z][a-z0-9+\-_.]*:\/\/[^\/]+)\/?/i,a=function(e,t){try{return new window.URL(e,t).toString()}catch(t){return e}},s=function(e,t){var r=o;if(!t)return e;if(!c(e))return e;d(e)&&(r=l),f(e)&&(r=u);var n=r(t),i="/"!==n.charAt(n.length-1)&&"/"!==e.charAt(0)?"/":"";return[n,e].join(i)};function o(e){var t=e.indexOf("/"),r=e.lastIndexOf("/");return-1!==t?r===t+1?e:(-1!==e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),e.substring(0,r+1)):""}function l(e){var t=e.match(i);return t?t[1]:""}function u(e){var r=e.match(t);return r?r[0]:""}function c(e){return!t.test(e)}function d(e){return c(e)&&"/"===e.charAt(0)}function f(e){return 0===e.indexOf("//")}return function(){try{new window.URL("x","http://y"),e=a}catch(e){}finally{e=e||s}}(),{parseBaseUrl:o,parseOrigin:l,parseScheme:u,isRelative:c,isPathAbsolute:d,isSchemeRelative:f,isHTTPURL:function(e){return r.test(e)},isHTTPS:function(e){return n.test(e)},removeHostname:function(e){return/^(?:\w+\:\/\/)?([^\/]+)(.*)$/.exec(e)[2].substring(1)},resolve:function(t,r){return e(t,r)}}}i.__dashjs_factory_name="DefaultURLUtils",t.Z=n.Z.getSingletonFactory(i)},8260:function(e,t,r){var n=r(2839),i=r(5448);function a(){var e;function t(t){var n=[];if(!t||!e||"function"!=typeof e.fetchAll)return n;for(var i,a=e.fetchAll(t),s=0,o=a.length;s<o;s++)(i=r(a[s]))&&n.push(i);return n}function r(e){if(!e)return null;var t=new n.Z(e);return e.hasOwnProperty("_incomplete")&&(t.isComplete=!e._incomplete),t}return{getBox:function(t){return t&&e&&e.boxes&&0!==e.boxes.length&&"function"==typeof e.fetch?r(e.fetch(t)):null},getBoxes:t,setData:function(t){e=t},getLastBox:function(){if(!e||!e.boxes||!e.boxes.length)return null;var r=t(e.boxes[e.boxes.length-1].type);return r.length>0?r[r.length-1]:null}}}a.__dashjs_factory_name="IsoFile",t.Z=i.Z.getClassFactory(a)},7473:function(e,t,r){r.d(t,{k:function(){return i}});var n=r(5448);function i(e,t){var r={url:e.url,method:e.method,headers:Object.assign({},e.headers),credentials:e.withCredentials?"include":void 0,range:e.request.range};return Promise.resolve(t.modifyRequest(r)).then(function(){return Object.assign(e,r,{withCredentials:"include"===r.credentials})})}function a(){return{modifyRequest:null,modifyRequestURL:function(e){return e},modifyRequestHeader:function(e,t){return t.url,e}}}a.__dashjs_factory_name="RequestModifier",t.Z=n.Z.getSingletonFactory(a)},3106:function(e,t,r){r.d(t,{PS:function(){return a},SE:function(){return s}});var n=r(3393);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){if(i(e)!==t)throw n.Z.BAD_ARGUMENT_ERROR}function s(e){if(null===e||isNaN(e)||e%1!=0)throw n.Z.BAD_ARGUMENT_ERROR+" : argument is not an integer"}},2594:function(e,t,r){var n=r(5448),i=r(5);function a(){var e,t=[],r=this.context;function n(r,n,i){var a=function(r){var n;for(n=0;n<t.length;n++)if(t[n].regex.test(r))return t[n].utils;return e}(i||n);return a&&"function"==typeof a[r]?a[r](n,i):e[r](n,i)}return e=(0,i.Z)(r).getInstance(),{registerUrlRegex:function(e,r){t.push({regex:e,utils:r})},parseBaseUrl:function(e){return n("parseBaseUrl",e)},parseOrigin:function(e){return n("parseOrigin",e)},parseScheme:function(e){return n("parseScheme",e)},isRelative:function(e){return n("isRelative",e)},isPathAbsolute:function(e){return n("isPathAbsolute",e)},isSchemeRelative:function(e){return n("isSchemeRelative",e)},isHTTPURL:function(e){return n("isHTTPURL",e)},isHTTPS:function(e){return n("isHTTPS",e)},removeHostname:function(e){return n("removeHostname",e)},resolve:function(e,t){return n("resolve",e,t)}}}a.__dashjs_factory_name="URLUtils";var s=n.Z.getSingletonFactory(a);t.Z=s},5459:function(e,t){t.Z=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t||null,this.message=r||null,this.data=n||null}},3186:function(e,t,r){var n=r(7855);function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.action=e.ACTION_DOWNLOAD,this.startTime=NaN,this.mediaStartTime=NaN,this.mediaType=null,this.mediaInfo=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=t||null,this.serviceLocation=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN,this.delayLoadingTime=NaN,this.responseType="arraybuffer",this.representationId=null}var t;return(t=[{key:"isInitializationRequest",value:function(){return this.type&&this.type===n.w.INIT_SEGMENT_TYPE}},{key:"setInfo",value:function(e){this.type=e&&e.init?n.w.INIT_SEGMENT_TYPE:n.w.MEDIA_SEGMENT_TYPE,this.url=e&&e.url?e.url:null,this.range=e&&e.range?e.range.start+"-"+e.range.end:null,this.mediaType=e&&e.mediaType?e.mediaType:null}}])&&i(e.prototype,t),e}();a.ACTION_DOWNLOAD="download",a.ACTION_COMPLETE="complete",t.Z=a},2839:function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var n=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.offset=t._offset,this.type=t.type,this.size=t.size,this.boxes=[],t.boxes)for(var r=0;r<t.boxes.length;r++)this.boxes.push(new e(t.boxes[r]));switch(this.isComplete=!0,t.type){case"sidx":if(this.timescale=t.timescale,this.earliest_presentation_time=t.earliest_presentation_time,this.first_offset=t.first_offset,this.references=t.references,t.references){this.references=[];for(var n=0;n<t.references.length;n++){var i={reference_type:t.references[n].reference_type,referenced_size:t.references[n].referenced_size,subsegment_duration:t.references[n].subsegment_duration};this.references.push(i)}}break;case"emsg":this.id=t.id,this.version=1===t.version?1:0,this.value=t.value,this.timescale=t.timescale,this.scheme_id_uri=t.scheme_id_uri,this.presentation_time_delta=1===t.version?t.presentation_time:t.presentation_time_delta,this.event_duration=t.event_duration,this.message_data=t.message_data;break;case"mdhd":this.timescale=t.timescale;break;case"mfhd":this.sequence_number=t.sequence_number;break;case"subs":this.entry_count=t.entry_count,this.entries=t.entries;break;case"tfhd":this.base_data_offset=t.base_data_offset,this.sample_description_index=t.sample_description_index,this.default_sample_duration=t.default_sample_duration,this.default_sample_size=t.default_sample_size,this.default_sample_flags=t.default_sample_flags,this.flags=t.flags;break;case"tfdt":this.version=t.version,this.baseMediaDecodeTime=t.baseMediaDecodeTime,this.flags=t.flags;break;case"trun":if(this.sample_count=t.sample_count,this.first_sample_flags=t.first_sample_flags,this.data_offset=t.data_offset,this.flags=t.flags,this.samples=t.samples,t.samples){this.samples=[];for(var a=0,s=t.samples.length;a<s;a++){var o={sample_size:t.samples[a].sample_size,sample_duration:t.samples[a].sample_duration,sample_composition_time_offset:t.samples[a].sample_composition_time_offset};this.samples.push(o)}}break;case"prft":this.version=t.version,this.reference_track_ID=t.reference_track_ID,this.ntp_timestamp_sec=t.ntp_timestamp_sec,this.ntp_timestamp_frac=t.ntp_timestamp_frac,this.media_time=t.media_time,this.flags=t.flags}}var t;return(t=[{key:"getChildBox",value:function(e){for(var t=0;t<this.boxes.length;t++)if(this.boxes[t].type===e)return this.boxes[t]}},{key:"getChildBoxes",value:function(e){for(var t=[],r=0;r<this.boxes.length;r++)this.boxes[r].type===e&&t.push(this.boxes[r]);return t}}])&&r(e.prototype,t),e}();t.Z=n},9597:function(e,t){t.Z=function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastCompletedOffset=t,this.found=r,this.size=n}},2128:function(e,t){t.Z=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bitrate=0,this.width=0,this.height=0,this.tilesHor=0,this.tilesVert=0,this.widthPerTile=0,this.heightPerTile=0,this.startNumber=0,this.segmentDuration=0,this.timescale=0,this.templateUrl="",this.id=""}},7855:function(e,t,r){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.d(t,{O:function(){return a},w:function(){return i}});var i=function e(){n(this,e),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this.cmsd=null,this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null,this._fileLoaderType=null},a=function e(){n(this,e),this.s=null,this.d=null,this.b=[]};i.GET="GET",i.HEAD="HEAD",i.MPD_TYPE="MPD",i.XLINK_EXPANSION_TYPE="XLinkExpansion",i.INIT_SEGMENT_TYPE="InitializationSegment",i.INDEX_SEGMENT_TYPE="IndexSegment",i.MEDIA_SEGMENT_TYPE="MediaSegment",i.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",i.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",i.DVB_REPORTING_TYPE="DVBReporting",i.LICENSE="license",i.CONTENT_STEERING_TYPE="ContentSteering",i.OTHER_TYPE="other"},3039:function(e,t){function r(e,t){return function(r,i){for(var a,s,o,l=n(r,"tag"),u=n(null==i?"*":i,"range"),c=[],d=-1;++d<u.length;)if(a=u[d].toLowerCase(),t||"*"!==a){for(s=-1,o=[];++s<l.length;)if(e(l[s].toLowerCase(),a)){if(!t)return l[s];c.push(l[s])}else o.push(l[s]);l=o}return t?c:void 0}}function n(e,t){var r=e&&"string"==typeof e?[e]:e;if(!r||"object"!=typeof r||!("length"in r))throw new Error("Invalid "+t+" `"+r+"`, expected non-empty string");return r}t.basicFilter=r(function(e,t){return"*"===t||e===t||e.indexOf(t+"-")>-1},!0),t.extendedFilter=r(function(e,t){var r=e.split("-"),n=t.split("-"),i=0,a=0;if("*"!==n[a]&&r[i]!==n[a])return!1;for(i++,a++;a<n.length;)if("*"!==n[a]){if(!r[i])return!1;if(r[i]!==n[a]){if(1===r[i].length)return!1;i++}else i++,a++}else a++;return!0},!0),t.lookup=r(function(e,t){for(var r,n=t;;){if("*"===n||e===n)return!0;if((r=n.lastIndexOf("-"))<0)return!1;"-"===n.charAt(r-2)&&(r-=2),n=n.slice(0,r)}})},3973:function(e,t,r){e.exports=r(3854)},3854:function(e,t,r){var n=r(2415),i=r(3039),a=r(7778),s=r(5813),o=r(3165),l=r(9460);e.exports=function(e,t){var r,c=t||{},m=n.parse(String(e||"").toLowerCase(),c),v=n.stringify(m),y=-1;if(!v)return v;for(;++y<a.length;)i.extendedFilter(v,a[y].from).length&&(f(m,a[y].from,a[y].to),v=n.stringify(m));for(y=-1;++y<s.length;)h(m,s[y].from.field,s[y].from.value)&&g(m,s[y].to.field,s[y].to.value);for(v=n.stringify(Object.assign({},m,d)),y=-1;++y<o.length;)v===o[y]&&(f(m,o[y],o[y].split("-").slice(0,-1).join("-")),v=n.stringify(Object.assign({},m,d)));if(m.extensions.sort(p),c.warning)for(r in l)u.call(l[r],m[r])&&c.warning("Deprecated "+r+" `"+m[r]+"`, expected one of `"+l[r][m[r]].join("`, `")+"`",null,7);return m.script&&(m.script=m.script.charAt(0).toUpperCase()+m.script.slice(1)),m.region&&(m.region=m.region.toUpperCase()),n.stringify(m)};var u={}.hasOwnProperty,c=new Intl.Collator,d={variants:[],extensions:[],privateuse:[],irregular:null,regular:null};function f(e,t,r){var i,a=n.parse(t),s=n.parse(r),o=[];for(i in a)a[i]&&a[i].length&&h(e,i,a[i])&&o.push(i);for(i in s)s[i]&&s[i].length&&(o.indexOf(i)>-1||!e[i]||!e[i].length)&&g(e,i,s[i])}function h(e,t,r){var n,i,a,s,o=!1;if(r){if(i=n=e[t],n&&"object"==typeof n)for(i=[],a=-1;++a<n.length;)s=n[a],r.indexOf(s)<0?i.push(s):o=!0;else n===r&&(i=null,o=!0);e[t]=i}return o}function g(e,t,r){var n,i,a,s=e[t];if(s&&"object"==typeof s)for(n=[].concat(r),i=-1;++i<n.length;)a=n[i],s.indexOf(a)<0&&s.push(a);else e[t]=r}function p(e,t){return c.compare(e.singleton,t.singleton)}},2415:function(e,t,r){t.parse=r(6903),t.stringify=r(6713)},6903:function(e,t,r){var n=r(2219),i=r(3516),a=r(395),s=r(858),o=r(8589);e.exports=function e(t,r){var u,c,d,f=r||{},h={language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null},g=String(t),p=g.toLowerCase(),m=0;if(null==t)throw new Error("Expected string, got `"+t+"`");if(l.call(o,p))return(null==f.normalize||f.normalize)&&o[p]?e(o[p]):(h[-1===s.indexOf(p)?"irregular":"regular"]=g,h);for(;i(p.charCodeAt(m))&&m<9;)m++;if(m>1&&m<9){if(h.language=g.slice(0,m),m<4)for(c=0;45===p.charCodeAt(m)&&i(p.charCodeAt(m+1))&&i(p.charCodeAt(m+2))&&i(p.charCodeAt(m+3))&&!i(p.charCodeAt(m+4));){if(c>2)return v(m,3,"Too many extended language subtags, expected at most 3 subtags");h.extendedLanguageSubtags.push(g.slice(m+1,m+4)),m+=4,c++}for(45===p.charCodeAt(m)&&i(p.charCodeAt(m+1))&&i(p.charCodeAt(m+2))&&i(p.charCodeAt(m+3))&&i(p.charCodeAt(m+4))&&!i(p.charCodeAt(m+5))&&(h.script=g.slice(m+1,m+5),m+=5),45===p.charCodeAt(m)&&(i(p.charCodeAt(m+1))&&i(p.charCodeAt(m+2))&&!i(p.charCodeAt(m+3))?(h.region=g.slice(m+1,m+3),m+=3):a(p.charCodeAt(m+1))&&a(p.charCodeAt(m+2))&&a(p.charCodeAt(m+3))&&!a(p.charCodeAt(m+4))&&(h.region=g.slice(m+1,m+4),m+=4));45===p.charCodeAt(m);){for(d=u=m+1;n(p.charCodeAt(d));){if(d-u>7)return v(d,1,"Too long variant, expected at most 8 characters");d++}if(!(d-u>4||d-u>3&&a(p.charCodeAt(u))))break;h.variants.push(g.slice(u,d)),m=d}for(;45===p.charCodeAt(m)&&120!==p.charCodeAt(m+1)&&n(p.charCodeAt(m+1))&&45===p.charCodeAt(m+2)&&n(p.charCodeAt(m+3));){for(d=m+2,c=0;45===p.charCodeAt(d)&&n(p.charCodeAt(d+1))&&n(p.charCodeAt(d+2));)for(d=(u=d+1)+2,c++;n(p.charCodeAt(d));){if(d-u>7)return v(d,2,"Too long extension, expected at most 8 characters");d++}if(!c)return v(d,4,"Empty extension, extensions must have at least 2 characters of content");h.extensions.push({singleton:g.charAt(m+1),extensions:g.slice(m+3,d).split("-")}),m=d}}else m=0;if(0===m&&120===p.charCodeAt(m)||45===p.charCodeAt(m)&&120===p.charCodeAt(m+1))for(d=m=m?m+2:1;45===p.charCodeAt(d)&&n(p.charCodeAt(d+1));){for(d=u=m+1;n(p.charCodeAt(d));){if(d-u>7)return v(d,5,"Too long private-use area, expected at most 8 characters");d++}h.privateuse.push(g.slice(m+1,d)),m=d}return m!==g.length?v(m,6,"Found superfluous content after tag"):h;function v(e,t,r){return f.warning&&f.warning(r,t,e),f.forgiving?h:{language:null,extendedLanguageSubtags:[],script:null,region:null,variants:[],extensions:[],privateuse:[],irregular:null,regular:null}}};var l={}.hasOwnProperty},6713:function(e){e.exports=function(e){var t,r,n,i=e||{},a=[];if(i.irregular||i.regular)return i.irregular||i.regular;if(i.language)for(a=a.concat(i.language,i.extendedLanguageSubtags||[],i.script||[],i.region||[],i.variants||[]),t=i.extensions||[],r=-1;++r<t.length;)(n=t[r]).singleton&&n.extensions&&n.extensions.length&&(a=a.concat(n.singleton,n.extensions));return i.privateuse&&i.privateuse.length&&(a=a.concat("x",i.privateuse)),a.join("-")}},1549:function(e,t,r){var n=r(6693),i=r(2165),a="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=function(e){return+e!=e&&(e=0),l.alloc(+e)},t.INSPECT_MAX_BYTES=50;var s=2147483647;function o(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return d(e)}return u(e,t,r)}function u(e,t,r){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|p(e,t),n=o(r),i=n.write(e,t);return i!==r&&(n=n.slice(0,i)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(G(e,Uint8Array)){var t=new Uint8Array(e);return h(t.buffer,t.byteOffset,t.byteLength)}return f(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return h(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(G(e,SharedArrayBuffer)||e&&G(e.buffer,SharedArrayBuffer)))return h(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return l.from(n,t,r);var i=function(e){if(l.isBuffer(e)){var t=0|g(e.length),r=o(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||H(e.length)?o(0):f(e):"Buffer"===e.type&&Array.isArray(e.data)?f(e.data):void 0}(e);if(i)return i;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e){return c(e),o(e<0?0:0|g(e))}function f(e){for(var t=e.length<0?0:0|g(e.length),r=o(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function h(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,l.prototype),n}function g(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return B(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return U(e).length;default:if(i)return n?-1:B(e).length;t=(""+t).toLowerCase(),i=!0}}function m(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return C(this,t,r);case"utf8":case"utf-8":return R(this,t,r);case"ascii":return D(this,t,r);case"latin1":case"binary":return L(this,t,r);case"base64":return I(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function v(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function y(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),H(r=+r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=l.from(t,n)),l.isBuffer(t))return 0===t.length?-1:E(e,t,r,n,i);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):E(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function E(e,t,r,n,i){var a,s=1,o=e.length,l=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,o/=2,l/=2,r/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var c=-1;for(a=r;a<o;a++)if(u(e,a)===u(t,-1===c?0:a-c)){if(-1===c&&(c=a),a-c+1===l)return c*s}else-1!==c&&(a-=a-c),c=-1}else for(r+l>o&&(r=o-l),a=r;a>=0;a--){for(var d=!0,f=0;f<l;f++)if(u(e,a+f)!==u(t,f)){d=!1;break}if(d)return a}return-1}function T(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=t.length;n>a/2&&(n=a/2);for(var s=0;s<n;++s){var o=parseInt(t.substr(2*s,2),16);if(H(o))return s;e[r+s]=o}return s}function _(e,t,r,n){return Z(B(t,e.length-r),e,r,n)}function S(e,t,r,n){return Z(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function b(e,t,r,n){return Z(U(t),e,r,n)}function A(e,t,r,n){return Z(function(e,t){for(var r,n,i,a=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,i=r%256,a.push(i),a.push(n);return a}(t,e.length-r),e,r,n)}function I(e,t,r){return 0===t&&r===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,r))}function R(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var a,s,o,l,u=e[i],c=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=r)switch(d){case 1:u<128&&(c=u);break;case 2:128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)>127&&(c=l);break;case 3:a=e[i+1],s=e[i+2],128==(192&a)&&128==(192&s)&&(l=(15&u)<<12|(63&a)<<6|63&s)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:a=e[i+1],s=e[i+2],o=e[i+3],128==(192&a)&&128==(192&s)&&128==(192&o)&&(l=(15&u)<<18|(63&a)<<12|(63&s)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,d=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=d}return function(e){var t=e.length;if(t<=w)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=w));return r}(n)}t.kMaxLength=s,l.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,r){return u(e,t,r)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,r){return function(e,t,r){return c(e),e<=0?o(e):void 0!==t?"string"==typeof r?o(e).fill(t,r):o(e).fill(t):o(e)}(e,t,r)},l.allocUnsafe=function(e){return d(e)},l.allocUnsafeSlow=function(e){return d(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(G(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,i=0,a=Math.min(r,n);i<a;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=l.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var a=e[r];if(G(a,Uint8Array))i+a.length>n.length?l.from(a).copy(n,i):Uint8Array.prototype.set.call(n,a,i);else{if(!l.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i)}i+=a.length}return n},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},l.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?R(this,0,e):m.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},a&&(l.prototype[a]=l.prototype.inspect),l.prototype.compare=function(e,t,r,n,i){if(G(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),o=Math.min(a,s),u=this.slice(n,i),c=e.slice(t,r),d=0;d<o;++d)if(u[d]!==c[d]){a=u[d],s=c[d];break}return a<s?-1:s<a?1:0},l.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},l.prototype.indexOf=function(e,t,r){return y(this,e,t,r,!0)},l.prototype.lastIndexOf=function(e,t,r){return y(this,e,t,r,!1)},l.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return T(this,e,t,r);case"utf8":case"utf-8":return _(this,e,t,r);case"ascii":case"latin1":case"binary":return S(this,e,t,r);case"base64":return b(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var w=4096;function D(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function L(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function C(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",a=t;a<r;++a)i+=$[e[a]];return i}function N(e,t,r){for(var n=e.slice(t,r),i="",a=0;a<n.length-1;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function P(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,r,n,i,a){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function M(e,t,r,n,i,a){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function k(e,t,r,n,a){return t=+t,r>>>=0,a||M(e,0,r,4),i.write(e,t,r,n,23,4),r+4}function x(e,t,r,n,a){return t=+t,r>>>=0,a||M(e,0,r,8),i.write(e,t,r,n,52,8),r+8}l.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,l.prototype),n},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);for(var n=this[e],i=1,a=0;++a<t&&(i*=256);)n+=this[e+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},l.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||P(e,t,this.length);for(var n=t,i=1,a=this[e+--n];n>0&&(i*=256);)a+=this[e+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},l.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return e>>>=0,t||P(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||P(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||P(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||P(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||O(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[t]=255&e;++a<r&&(i*=256);)this[t+a]=e/i&255;return t+r},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||O(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+r},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);O(this,e,t,r,i-1,-i)}var a=0,s=1,o=0;for(this[t]=255&e;++a<r&&(s*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/s|0)-o&255;return t+r},l.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var i=Math.pow(2,8*r-1);O(this,e,t,r,i-1,-i)}var a=r-1,s=1,o=0;for(this[t+a]=255&e;--a>=0&&(s*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/s|0)-o&255;return t+r},l.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeFloatLE=function(e,t,r){return k(this,e,t,!0,r)},l.prototype.writeFloatBE=function(e,t,r){return k(this,e,t,!1,r)},l.prototype.writeDoubleLE=function(e,t,r){return x(this,e,t,!0,r)},l.prototype.writeDoubleBE=function(e,t,r){return x(this,e,t,!1,r)},l.prototype.copy=function(e,t,r,n){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),i},l.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!l.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var i=e.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var a;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var s=l.isBuffer(e)?e:l.from(e,n),o=s.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<r-t;++a)this[a+t]=s[a%o]}return this};var F=/[^+/0-9A-Za-z-_]/g;function B(e,t){var r;t=t||1/0;for(var n=e.length,i=null,a=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;a.push(r)}else if(r<2048){if((t-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function U(e){return n.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Z(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function H(e){return e!=e}var $=function(){for(var e="0123456789abcdef",t=new Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)t[n+i]=e[r]+e[i];return t}()},6693:function(e,t){t.byteLength=function(e){var t=l(e),r=t[0],n=t[1];return 3*(r+n)/4-n},t.toByteArray=function(e){var t,r,a=l(e),s=a[0],o=a[1],u=new i(function(e,t,r){return 3*(t+r)/4-r}(0,s,o)),c=0,d=o>0?s-4:s;for(r=0;r<d;r+=4)t=n[e.charCodeAt(r)]<<18|n[e.charCodeAt(r+1)]<<12|n[e.charCodeAt(r+2)]<<6|n[e.charCodeAt(r+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===o&&(t=n[e.charCodeAt(r)]<<2|n[e.charCodeAt(r+1)]>>4,u[c++]=255&t),1===o&&(t=n[e.charCodeAt(r)]<<10|n[e.charCodeAt(r+1)]<<4|n[e.charCodeAt(r+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],s=16383,o=0,l=n-i;o<l;o+=s)a.push(u(e,o,o+s>l?l:o+s));return 1===i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),a.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,o=a.length;s<o;++s)r[s]=a[s],n[a.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function u(e,t,n){for(var i,a,s=[],o=t;o<n;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),s.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return s.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},2165:function(e,t){t.read=function(e,t,r,n,i){var a,s,o=8*i-n-1,l=(1<<o)-1,u=l>>1,c=-7,d=r?i-1:0,f=r?-1:1,h=e[t+d];for(d+=f,a=h&(1<<-c)-1,h>>=-c,c+=o;c>0;a=256*a+e[t+d],d+=f,c-=8);for(s=a&(1<<-c)-1,a>>=-c,c+=n;c>0;s=256*s+e[t+d],d+=f,c-=8);if(0===a)a=1-u;else{if(a===l)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,n),a-=u}return(h?-1:1)*s*Math.pow(2,a-n)},t.write=function(e,t,r,n,i,a){var s,o,l,u=8*a-i-1,c=(1<<u)-1,d=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:a-1,g=n?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+d>=1?f/l:f*Math.pow(2,1-d))*l>=2&&(s++,l/=2),s+d>=c?(o=0,s=c):s+d>=1?(o=(t*l-1)*Math.pow(2,i),s+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[r+h]=255&o,h+=g,o/=256,i-=8);for(s=s<<i|o,u+=i;u>0;e[r+h]=255&s,h+=g,s/=256,u-=8);e[r+h-g]|=128*p}},6934:function(e,t){var r={parseBuffer:function(e){return new n(e).parse()},addBoxProcessor:function(e,t){"string"==typeof e&&"function"==typeof t&&(i.prototype._boxProcessors[e]=t)},createFile:function(){return new n},createBox:function(e,t,r){var n=i.create(e);return t&&t.append(n,r),n},createFullBox:function(e,t,n){var i=r.createBox(e,t,n);return i.version=0,i.flags=0,i},Utils:{}};r.Utils.dataViewToString=function(e,t){var r=t||"utf-8";if("undefined"!=typeof TextDecoder)return new TextDecoder(r).decode(e);var n=[],i=0;if("utf-8"===r)for(;i<e.byteLength;){var a=e.getUint8(i++);a<128||(a<224?(a=(31&a)<<6,a|=63&e.getUint8(i++)):a<240?(a=(15&a)<<12,a|=(63&e.getUint8(i++))<<6,a|=63&e.getUint8(i++)):(a=(7&a)<<18,a|=(63&e.getUint8(i++))<<12,a|=(63&e.getUint8(i++))<<6,a|=63&e.getUint8(i++))),n.push(String.fromCharCode(a))}else for(;i<e.byteLength;)n.push(String.fromCharCode(e.getUint8(i++)));return n.join("")},r.Utils.utf8ToByteArray=function(e){var t,r;if("undefined"!=typeof TextEncoder)t=(new TextEncoder).encode(e);else for(t=[],r=0;r<e.length;++r){var n=e.charCodeAt(r);n<128?t.push(n):n<2048?(t.push(192|n>>6),t.push(128|63&n)):n<65536?(t.push(224|n>>12),t.push(128|63&n>>6),t.push(128|63&n)):(t.push(240|n>>18),t.push(128|63&n>>12),t.push(128|63&n>>6),t.push(128|63&n))}return t},r.Utils.appendBox=function(e,t,r){if(t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,-1!==r)if(null!=r){var n,i=-1;if("number"==typeof r)i=r;else{if("string"==typeof r)n=r;else{if("object"!=typeof r||!r.type)return void e.boxes.push(t);n=r.type}for(var a=0;a<e.boxes.length;a++)if(n===e.boxes[a].type){i=a+1;break}}e.boxes.splice(i,0,t)}else e.boxes.push(t)},t.parseBuffer=r.parseBuffer,t.addBoxProcessor=r.addBoxProcessor,t.createFile=r.createFile,t.createBox=r.createBox,t.createFullBox=r.createFullBox,t.Utils=r.Utils,r.Cursor=function(e){this.offset=void 0===e?0:e};var n=function(e){this._cursor=new r.Cursor,this.boxes=[],e&&(this._raw=new DataView(e))};n.prototype.fetch=function(e){var t=this.fetchAll(e,!0);return t.length?t[0]:null},n.prototype.fetchAll=function(e,t){var r=[];return n._sweep.call(this,e,r,t),r},n.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var e=i.parse(this);if(void 0===e.type)break;this.boxes.push(e)}return this},n._sweep=function(e,t,r){for(var i in this.type&&this.type==e&&t.push(this),this.boxes){if(t.length&&r)return;n._sweep.call(this.boxes[i],e,t,r)}},n.prototype.write=function(){var e,t=0;for(e=0;e<this.boxes.length;e++)t+=this.boxes[e].getLength(!1);var r=new Uint8Array(t);for(this._rawo=new DataView(r.buffer),this.bytes=r,this._cursor.offset=0,e=0;e<this.boxes.length;e++)this.boxes[e].write();return r.buffer},n.prototype.append=function(e,t){r.Utils.appendBox(this,e,t)};var i=function(){this._cursor=new r.Cursor};i.parse=function(e){var t=new i;return t._offset=e._cursor.offset,t._root=e._root?e._root:e,t._raw=e._raw,t._parent=e,t._parseBox(),e._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},i.create=function(e){var t=new i;return t.type=e,t.boxes=[],t},i.prototype._boxContainers=["dinf","edts","mdia","meco","mfra","minf","moof","moov","mvex","stbl","strk","traf","trak","tref","udta","vttc","sinf","schi","encv","enca"],i.prototype._boxProcessors={},i.prototype._procField=function(e,t,r){this._parsing?this[e]=this._readField(t,r):this._writeField(t,r,this[e])},i.prototype._procFieldArray=function(e,t,r,n){var i;if(this._parsing)for(this[e]=[],i=0;i<t;i++)this[e][i]=this._readField(r,n);else for(i=0;i<this[e].length;i++)this._writeField(r,n,this[e][i])},i.prototype._procFullBox=function(){this._procField("version","uint",8),this._procField("flags","uint",24)},i.prototype._procEntries=function(e,t,r){var n;if(this._parsing)for(this[e]=[],n=0;n<t;n++)this[e].push({}),r.call(this,this[e][n]);else for(n=0;n<t;n++)r.call(this,this[e][n])},i.prototype._procSubEntries=function(e,t,r,n){var i;if(this._parsing)for(e[t]=[],i=0;i<r;i++)e[t].push({}),n.call(this,e[t][i]);else for(i=0;i<r;i++)n.call(this,e[t][i])},i.prototype._procEntryField=function(e,t,r,n){this._parsing?e[t]=this._readField(r,n):this._writeField(r,n,e[t])},i.prototype._procSubBoxes=function(e,t){var r;if(this._parsing)for(this[e]=[],r=0;r<t;r++)this[e].push(i.parse(this));else for(r=0;r<t;r++)this._rawo?this[e][r].write():this.size+=this[e][r].getLength()},i.prototype._readField=function(e,t){switch(e){case"uint":return this._readUint(t);case"int":return this._readInt(t);case"template":return this._readTemplate(t);case"string":return-1===t?this._readTerminatedString():this._readString(t);case"data":return this._readData(t);case"utf8":return this._readUTF8String();default:return-1}},i.prototype._readInt=function(e){var t=null,r=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:t=this._raw.getInt8(r);break;case 16:t=this._raw.getInt16(r);break;case 32:t=this._raw.getInt32(r);break;case 64:var n=this._raw.getInt32(r),i=this._raw.getInt32(r+4);t=n*Math.pow(2,32)+i}return this._cursor.offset+=e>>3,t},i.prototype._readUint=function(e){var t,r,n=null,i=this._cursor.offset-this._raw.byteOffset;switch(e){case 8:n=this._raw.getUint8(i);break;case 16:n=this._raw.getUint16(i);break;case 24:n=((t=this._raw.getUint16(i))<<8)+(r=this._raw.getUint8(i+2));break;case 32:n=this._raw.getUint32(i);break;case 64:t=this._raw.getUint32(i),r=this._raw.getUint32(i+4),n=t*Math.pow(2,32)+r}return this._cursor.offset+=e>>3,n},i.prototype._readString=function(e){for(var t="",r=0;r<e;r++){var n=this._readUint(8);t+=String.fromCharCode(n)}return t},i.prototype._readTemplate=function(e){return this._readUint(e/2)+this._readUint(e/2)/Math.pow(2,e/2)},i.prototype._readTerminatedString=function(){for(var e="";this._cursor.offset-this._offset<this._raw.byteLength;){var t=this._readUint(8);if(0===t)break;e+=String.fromCharCode(t)}return e},i.prototype._readData=function(e){var t=e>0?e:this._raw.byteLength-(this._cursor.offset-this._offset);if(t>0){var r=new Uint8Array(this._raw.buffer,this._cursor.offset,t);return this._cursor.offset+=t,r}return null},i.prototype._readUTF8String=function(){var e=this._raw.byteLength-(this._cursor.offset-this._offset),t=null;return e>0&&(t=new DataView(this._raw.buffer,this._cursor.offset,e),this._cursor.offset+=e),t?r.Utils.dataViewToString(t):t},i.prototype._parseBox=function(){if(this._parsing=!0,this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)this._root._incomplete=!0;else{switch(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}this._incomplete||(this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type)?this._parseContainerBox():this._data=this._readData())}},i.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},i.prototype._parseContainerBox=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(i.parse(this))},i.prototype.append=function(e,t){r.Utils.appendBox(this,e,t)},i.prototype.getLength=function(){if(this._parsing=!1,this._rawo=null,this.size=0,this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.size+=this.boxes[e].getLength();return this._data&&this._writeData(this._data),this.size},i.prototype.write=function(){switch(this._parsing=!1,this._cursor.offset=this._parent._cursor.offset,this.size){case 0:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.parent._rawo.byteLength-this._cursor.offset);break;case 1:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.largesize);break;default:this._rawo=new DataView(this._parent._rawo.buffer,this._cursor.offset,this.size)}if(this._procField("size","uint",32),this._procField("type","string",4),1===this.size&&this._procField("largesize","uint",64),"uuid"===this.type&&this._procFieldArray("usertype",16,"uint",8),this._boxProcessors[this.type]&&this._boxProcessors[this.type].call(this),-1!==this._boxContainers.indexOf(this.type))for(var e=0;e<this.boxes.length;e++)this.boxes[e].write();return this._data&&this._writeData(this._data),this._parent._cursor.offset+=this.size,this.size},i.prototype._writeInt=function(e,t){if(this._rawo){var r=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setInt8(r,t);break;case 16:this._rawo.setInt16(r,t);break;case 32:this._rawo.setInt32(r,t);break;case 64:var n=Math.floor(t/Math.pow(2,32)),i=t-n*Math.pow(2,32);this._rawo.setUint32(r,n),this._rawo.setUint32(r+4,i)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeUint=function(e,t){if(this._rawo){var r,n,i=this._cursor.offset-this._rawo.byteOffset;switch(e){case 8:this._rawo.setUint8(i,t);break;case 16:this._rawo.setUint16(i,t);break;case 24:r=(16776960&t)>>8,n=255&t,this._rawo.setUint16(i,r),this._rawo.setUint8(i+2,n);break;case 32:this._rawo.setUint32(i,t);break;case 64:n=t-(r=Math.floor(t/Math.pow(2,32)))*Math.pow(2,32),this._rawo.setUint32(i,r),this._rawo.setUint32(i+4,n)}this._cursor.offset+=e>>3}else this.size+=e>>3},i.prototype._writeString=function(e,t){for(var r=0;r<e;r++)this._writeUint(8,t.charCodeAt(r))},i.prototype._writeTerminatedString=function(e){if(0!==e.length){for(var t=0;t<e.length;t++)this._writeUint(8,e.charCodeAt(t));this._writeUint(8,0)}},i.prototype._writeTemplate=function(e,t){var r=Math.floor(t),n=(t-r)*Math.pow(2,e/2);this._writeUint(e/2,r),this._writeUint(e/2,n)},i.prototype._writeData=function(e){if(e)if(this._rawo){if(e instanceof Array){for(var t=this._cursor.offset-this._rawo.byteOffset,r=0;r<e.length;r++)this._rawo.setInt8(t+r,e[r]);this._cursor.offset+=e.length}e instanceof Uint8Array&&(this._root.bytes.set(e,this._cursor.offset),this._cursor.offset+=e.length)}else this.size+=e.length},i.prototype._writeUTF8String=function(e){var t=r.Utils.utf8ToByteArray(e);if(this._rawo)for(var n=new DataView(this._rawo.buffer,this._cursor.offset,t.length),i=0;i<t.length;i++)n.setUint8(i,t[i]);else this.size+=t.length},i.prototype._writeField=function(e,t,r){switch(e){case"uint":this._writeUint(t,r);break;case"int":this._writeInt(t,r);break;case"template":this._writeTemplate(t,r);break;case"string":-1==t?this._writeTerminatedString(r):this._writeString(t,r);break;case"data":this._writeData(r);break;case"utf8":this._writeUTF8String(r)}},i.prototype._boxProcessors.avc1=i.prototype._boxProcessors.avc2=i.prototype._boxProcessors.avc3=i.prototype._boxProcessors.avc4=i.prototype._boxProcessors.hvc1=i.prototype._boxProcessors.hev1=i.prototype._boxProcessors.encv=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procField("pre_defined1","uint",16),this._procField("reserved2","uint",16),this._procFieldArray("pre_defined2",3,"uint",32),this._procField("width","uint",16),this._procField("height","uint",16),this._procField("horizresolution","template",32),this._procField("vertresolution","template",32),this._procField("reserved3","uint",32),this._procField("frame_count","uint",16),this._procFieldArray("compressorname",32,"uint",8),this._procField("depth","uint",16),this._procField("pre_defined3","int",16),this._procField("config","data",-1)},i.prototype._boxProcessors.ctts=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(e){this._procEntryField(e,"sample_count","uint",32),this._procEntryField(e,"sample_offset",1===this.version?"int":"uint",32)})},i.prototype._boxProcessors.dref=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.elst=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(e){this._procEntryField(e,"segment_duration","uint",1===this.version?64:32),this._procEntryField(e,"media_time","int",1===this.version?64:32),this._procEntryField(e,"media_rate_integer","int",16),this._procEntryField(e,"media_rate_fraction","int",16)})},i.prototype._boxProcessors.emsg=function(){this._procFullBox(),1==this.version?(this._procField("timescale","uint",32),this._procField("presentation_time","uint",64),this._procField("event_duration","uint",32),this._procField("id","uint",32),this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1)):(this._procField("scheme_id_uri","string",-1),this._procField("value","string",-1),this._procField("timescale","uint",32),this._procField("presentation_time_delta","uint",32),this._procField("event_duration","uint",32),this._procField("id","uint",32)),this._procField("message_data","data",-1)},i.prototype._boxProcessors.free=i.prototype._boxProcessors.skip=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.frma=function(){this._procField("data_format","uint",32)},i.prototype._boxProcessors.ftyp=i.prototype._boxProcessors.styp=function(){this._procField("major_brand","string",4),this._procField("minor_version","uint",32);var e=-1;this._parsing&&(e=(this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset))/4),this._procFieldArray("compatible_brands",e,"string",4)},i.prototype._boxProcessors.hdlr=function(){this._procFullBox(),this._procField("pre_defined","uint",32),this._procField("handler_type","string",4),this._procFieldArray("reserved",3,"uint",32),this._procField("name","string",-1)},i.prototype._boxProcessors.mdat=function(){this._procField("data","data",-1)},i.prototype._boxProcessors.mdhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._parsing||"string"!=typeof this.language||(this.language=this.language.charCodeAt(0)-96<<10|this.language.charCodeAt(1)-96<<5|this.language.charCodeAt(2)-96),this._procField("language","uint",16),this._parsing&&(this.language=String.fromCharCode(96+(this.language>>10&31),96+(this.language>>5&31),96+(31&this.language))),this._procField("pre_defined","uint",16)},i.prototype._boxProcessors.mehd=function(){this._procFullBox(),this._procField("fragment_duration","uint",1==this.version?64:32)},i.prototype._boxProcessors.mfhd=function(){this._procFullBox(),this._procField("sequence_number","uint",32)},i.prototype._boxProcessors.mfro=function(){this._procFullBox(),this._procField("mfra_size","uint",32)},i.prototype._boxProcessors.mp4a=i.prototype._boxProcessors.enca=function(){this._procFieldArray("reserved1",6,"uint",8),this._procField("data_reference_index","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procField("channelcount","uint",16),this._procField("samplesize","uint",16),this._procField("pre_defined","uint",16),this._procField("reserved3","uint",16),this._procField("samplerate","template",32),this._procField("esds","data",-1)},i.prototype._boxProcessors.mvhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("timescale","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procField("rate","template",32),this._procField("volume","template",16),this._procField("reserved1","uint",16),this._procFieldArray("reserved2",2,"uint",32),this._procFieldArray("matrix",9,"template",32),this._procFieldArray("pre_defined",6,"uint",32),this._procField("next_track_ID","uint",32)},i.prototype._boxProcessors.payl=function(){this._procField("cue_text","utf8")},i.prototype._boxProcessors.prft=function(){this._procFullBox(),this._procField("reference_track_ID","uint",32),this._procField("ntp_timestamp_sec","uint",32),this._procField("ntp_timestamp_frac","uint",32),this._procField("media_time","uint",1==this.version?64:32)},i.prototype._boxProcessors.pssh=function(){this._procFullBox(),this._procFieldArray("SystemID",16,"uint",8),this._procField("DataSize","uint",32),this._procFieldArray("Data",this.DataSize,"uint",8)},i.prototype._boxProcessors.schm=function(){this._procFullBox(),this._procField("scheme_type","uint",32),this._procField("scheme_version","uint",32),1&this.flags&&this._procField("scheme_uri","string",-1)},i.prototype._boxProcessors.sdtp=function(){this._procFullBox();var e=-1;this._parsing&&(e=this._raw.byteLength-(this._cursor.offset-this._raw.byteOffset)),this._procFieldArray("sample_dependency_table",e,"uint",8)},i.prototype._boxProcessors.sidx=function(){this._procFullBox(),this._procField("reference_ID","uint",32),this._procField("timescale","uint",32),this._procField("earliest_presentation_time","uint",1==this.version?64:32),this._procField("first_offset","uint",1==this.version?64:32),this._procField("reserved","uint",16),this._procField("reference_count","uint",16),this._procEntries("references",this.reference_count,function(e){this._parsing||(e.reference=(1&e.reference_type)<<31,e.reference|=2147483647&e.referenced_size,e.sap=(1&e.starts_with_SAP)<<31,e.sap|=(3&e.SAP_type)<<28,e.sap|=268435455&e.SAP_delta_time),this._procEntryField(e,"reference","uint",32),this._procEntryField(e,"subsegment_duration","uint",32),this._procEntryField(e,"sap","uint",32),this._parsing&&(e.reference_type=e.reference>>31&1,e.referenced_size=2147483647&e.reference,e.starts_with_SAP=e.sap>>31&1,e.SAP_type=e.sap>>28&7,e.SAP_delta_time=268435455&e.sap)})},i.prototype._boxProcessors.smhd=function(){this._procFullBox(),this._procField("balance","uint",16),this._procField("reserved","uint",16)},i.prototype._boxProcessors.ssix=function(){this._procFullBox(),this._procField("subsegment_count","uint",32),this._procEntries("subsegments",this.subsegment_count,function(e){this._procEntryField(e,"ranges_count","uint",32),this._procSubEntries(e,"ranges",e.ranges_count,function(e){this._procEntryField(e,"level","uint",8),this._procEntryField(e,"range_size","uint",24)})})},i.prototype._boxProcessors.stsd=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procSubBoxes("entries",this.entry_count)},i.prototype._boxProcessors.sttg=function(){this._procField("settings","utf8")},i.prototype._boxProcessors.stts=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(e){this._procEntryField(e,"sample_count","uint",32),this._procEntryField(e,"sample_delta","uint",32)})},i.prototype._boxProcessors.subs=function(){this._procFullBox(),this._procField("entry_count","uint",32),this._procEntries("entries",this.entry_count,function(e){this._procEntryField(e,"sample_delta","uint",32),this._procEntryField(e,"subsample_count","uint",16),this._procSubEntries(e,"subsamples",e.subsample_count,function(e){this._procEntryField(e,"subsample_size","uint",1===this.version?32:16),this._procEntryField(e,"subsample_priority","uint",8),this._procEntryField(e,"discardable","uint",8),this._procEntryField(e,"codec_specific_parameters","uint",32)})})},i.prototype._boxProcessors.tenc=function(){this._procFullBox(),this._procField("default_IsEncrypted","uint",24),this._procField("default_IV_size","uint",8),this._procFieldArray("default_KID",16,"uint",8)},i.prototype._boxProcessors.tfdt=function(){this._procFullBox(),this._procField("baseMediaDecodeTime","uint",1==this.version?64:32)},i.prototype._boxProcessors.tfhd=function(){this._procFullBox(),this._procField("track_ID","uint",32),1&this.flags&&this._procField("base_data_offset","uint",64),2&this.flags&&this._procField("sample_description_offset","uint",32),8&this.flags&&this._procField("default_sample_duration","uint",32),16&this.flags&&this._procField("default_sample_size","uint",32),32&this.flags&&this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.tfra=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._parsing||(this.reserved=0,this.reserved|=(48&this.length_size_of_traf_num)<<4,this.reserved|=(12&this.length_size_of_trun_num)<<2,this.reserved|=3&this.length_size_of_sample_num),this._procField("reserved","uint",32),this._parsing&&(this.length_size_of_traf_num=(48&this.reserved)>>4,this.length_size_of_trun_num=(12&this.reserved)>>2,this.length_size_of_sample_num=3&this.reserved),this._procField("number_of_entry","uint",32),this._procEntries("entries",this.number_of_entry,function(e){this._procEntryField(e,"time","uint",1===this.version?64:32),this._procEntryField(e,"moof_offset","uint",1===this.version?64:32),this._procEntryField(e,"traf_number","uint",8*(this.length_size_of_traf_num+1)),this._procEntryField(e,"trun_number","uint",8*(this.length_size_of_trun_num+1)),this._procEntryField(e,"sample_number","uint",8*(this.length_size_of_sample_num+1))})},i.prototype._boxProcessors.tkhd=function(){this._procFullBox(),this._procField("creation_time","uint",1==this.version?64:32),this._procField("modification_time","uint",1==this.version?64:32),this._procField("track_ID","uint",32),this._procField("reserved1","uint",32),this._procField("duration","uint",1==this.version?64:32),this._procFieldArray("reserved2",2,"uint",32),this._procField("layer","uint",16),this._procField("alternate_group","uint",16),this._procField("volume","template",16),this._procField("reserved3","uint",16),this._procFieldArray("matrix",9,"template",32),this._procField("width","template",32),this._procField("height","template",32)},i.prototype._boxProcessors.trex=function(){this._procFullBox(),this._procField("track_ID","uint",32),this._procField("default_sample_description_index","uint",32),this._procField("default_sample_duration","uint",32),this._procField("default_sample_size","uint",32),this._procField("default_sample_flags","uint",32)},i.prototype._boxProcessors.trun=function(){this._procFullBox(),this._procField("sample_count","uint",32),1&this.flags&&this._procField("data_offset","int",32),4&this.flags&&this._procField("first_sample_flags","uint",32),this._procEntries("samples",this.sample_count,function(e){256&this.flags&&this._procEntryField(e,"sample_duration","uint",32),512&this.flags&&this._procEntryField(e,"sample_size","uint",32),1024&this.flags&&this._procEntryField(e,"sample_flags","uint",32),2048&this.flags&&this._procEntryField(e,"sample_composition_time_offset",1===this.version?"int":"uint",32)})},i.prototype._boxProcessors["url "]=i.prototype._boxProcessors["urn "]=function(){this._procFullBox(),"urn "===this.type&&this._procField("name","string",-1),this._procField("location","string",-1)},i.prototype._boxProcessors.vlab=function(){this._procField("source_label","utf8")},i.prototype._boxProcessors.vmhd=function(){this._procFullBox(),this._procField("graphicsmode","uint",16),this._procFieldArray("opcolor",3,"uint",16)},i.prototype._boxProcessors.vttC=function(){this._procField("config","utf8")},i.prototype._boxProcessors.vtte=function(){}},5530:function(e,t,r){e.exports=r(6146).polyfill()},6146:function(e,t,r){e.exports=function(){function e(e){return"function"==typeof e}var t=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,i=void 0,a=void 0,s=function(e,t){h[n]=e,h[n+1]=t,2===(n+=2)&&(a?a(g):E())},o="undefined"!=typeof window?window:void 0,l=o||{},u=l.MutationObserver||l.WebKitMutationObserver,c="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),d="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function f(){var e=setTimeout;return function(){return e(g,1)}}var h=new Array(1e3);function g(){for(var e=0;e<n;e+=2)(0,h[e])(h[e+1]),h[e]=void 0,h[e+1]=void 0;n=0}var p,m,v,y,E=void 0;function T(e,t){var r=this,n=new this.constructor(b);void 0===n[S]&&M(n);var i=r._state;if(i){var a=arguments[i-1];s(function(){return P(i,n,a,r._result)})}else C(r,n,e,t);return n}function _(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(b);return R(t,e),t}E=c?function(){return process.nextTick(g)}:u?(m=0,v=new u(g),y=document.createTextNode(""),v.observe(y,{characterData:!0}),function(){y.data=m=++m%2}):d?((p=new MessageChannel).port1.onmessage=g,function(){return p.port2.postMessage(0)}):void 0===o?function(){try{var e=Function("return this")().require("vertx");return void 0!==(i=e.runOnLoop||e.runOnContext)?function(){i(g)}:f()}catch(e){return f()}}():f();var S=Math.random().toString(36).substring(2);function b(){}var A=void 0;function I(t,r,n){r.constructor===t.constructor&&n===T&&r.constructor.resolve===_?function(e,t){1===t._state?D(e,t._result):2===t._state?L(e,t._result):C(t,void 0,function(t){return R(e,t)},function(t){return L(e,t)})}(t,r):void 0===n?D(t,r):e(n)?function(e,t,r){s(function(e){var n=!1,i=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(r,t,function(r){n||(n=!0,t!==r?R(e,r):D(e,r))},function(t){n||(n=!0,L(e,t))},e._label);!n&&i&&(n=!0,L(e,i))},e)}(t,r,n):D(t,r)}function R(e,t){if(e===t)L(e,new TypeError("You cannot resolve a promise with itself"));else if(i=typeof(n=t),null===n||"object"!==i&&"function"!==i)D(e,t);else{var r=void 0;try{r=t.then}catch(t){return void L(e,t)}I(e,t,r)}var n,i}function w(e){e._onerror&&e._onerror(e._result),N(e)}function D(e,t){e._state===A&&(e._result=t,e._state=1,0!==e._subscribers.length&&s(N,e))}function L(e,t){e._state===A&&(e._state=2,e._result=t,s(w,e))}function C(e,t,r,n){var i=e._subscribers,a=i.length;e._onerror=null,i[a]=t,i[a+1]=r,i[a+2]=n,0===a&&e._state&&s(N,e)}function N(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,a=e._result,s=0;s<t.length;s+=3)n=t[s],i=t[s+r],n?P(r,n,i,a):i(a);e._subscribers.length=0}}function P(t,r,n,i){var a=e(n),s=void 0,o=void 0,l=!0;if(a){try{s=n(i)}catch(e){l=!1,o=e}if(r===s)return void L(r,new TypeError("A promises callback cannot return that same promise."))}else s=i;r._state!==A||(a&&l?R(r,s):!1===l?L(r,o):1===t?D(r,s):2===t&&L(r,s))}var O=0;function M(e){e[S]=O++,e._state=void 0,e._result=void 0,e._subscribers=[]}var k=function(){function e(e,r){this._instanceConstructor=e,this.promise=new e(b),this.promise[S]||M(this.promise),t(r)?(this.length=r.length,this._remaining=r.length,this._result=new Array(this.length),0===this.length?D(this.promise,this._result):(this.length=this.length||0,this._enumerate(r),0===this._remaining&&D(this.promise,this._result))):L(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===A&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===_){var i=void 0,a=void 0,s=!1;try{i=e.then}catch(e){s=!0,a=e}if(i===T&&e._state!==A)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===x){var o=new r(b);s?L(o,a):I(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===A&&(this._remaining--,2===e?L(n,r):this._result[t]=r),0===this._remaining&&D(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;C(e,void 0,function(e){return r._settledAt(1,t,e)},function(e){return r._settledAt(2,t,e)})},e}(),x=function(){function t(e){this[S]=O++,this._result=this._state=void 0,this._subscribers=[],b!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t(function(t){R(e,t)},function(t){L(e,t)})}catch(t){L(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this,n=r.constructor;return e(t)?r.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})}):r.then(t,t)},t}();return x.prototype.then=T,x.all=function(e){return new k(this,e).promise},x.race=function(e){var r=this;return t(e)?new r(function(t,n){for(var i=e.length,a=0;a<i;a++)r.resolve(e[a]).then(t,n)}):new r(function(e,t){return t(new TypeError("You must pass an array to race."))})},x.resolve=_,x.reject=function(e){var t=new this(b);return L(t,e),t},x._setScheduler=function(e){a=e},x._setAsap=function(e){s=e},x._asap=s,x.polyfill=function(){var e=void 0;if(void 0!==r.g)e=r.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=x},x.Promise=x,x}()},1159:function(e){var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise(function(r,n){function i(r){e.removeListener(t,a),n(r)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}p(e,t,a,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&p(e,"error",t,{once:!0})}(e,i)})},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var i,a,s,u;if(o(r),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),a=e._events),s=a[t]),void 0===s)s=a[t]=r,++e._eventsCount;else if("function"==typeof s?s=a[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=l(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,u=c,console&&console.warn&&console.warn(u)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=c.bind(n);return i.listener=r,n.wrapFn=i,i}function f(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):g(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function g(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function p(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function i(a){n.once&&e.removeEventListener(t,i),r(a)})}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return l(this)},a.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,a=this._events;if(void 0!==a)i=i&&void 0===a.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var l=a[e];if(void 0===l)return!1;if("function"==typeof l)n(l,this,t);else{var u=l.length,c=g(l,u);for(r=0;r<u;++r)n(c[r],this,t)}return!0},a.prototype.addListener=function(e,t){return u(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return u(this,e,t,!0)},a.prototype.once=function(e,t){return o(t),this.on(e,d(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,d(this,e,t)),this},a.prototype.removeListener=function(e,t){var r,n,i,a,s;if(o(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===t||r[a].listener===t){s=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,a=Object.keys(r);for(n=0;n<a.length;++n)"removeListener"!==(i=a[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},a.prototype.listeners=function(e){return f(this,e,!0)},a.prototype.rawListeners=function(e){return f(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},a.prototype.listenerCount=h,a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},3101:function(e){var t=Array.isArray,r=Object.keys,n=Object.prototype.hasOwnProperty;e.exports=function e(i,a){if(i===a)return!0;if(i&&a&&"object"==typeof i&&"object"==typeof a){var s,o,l,u=t(i),c=t(a);if(u&&c){if((o=i.length)!=a.length)return!1;for(s=o;0!=s--;)if(!e(i[s],a[s]))return!1;return!0}if(u!=c)return!1;var d=i instanceof Date,f=a instanceof Date;if(d!=f)return!1;if(d&&f)return i.getTime()==a.getTime();var h=i instanceof RegExp,g=a instanceof RegExp;if(h!=g)return!1;if(h&&g)return i.toString()==a.toString();var p=r(i);if((o=p.length)!==r(a).length)return!1;for(s=o;0!=s--;)if(!n.call(a,p[s]))return!1;for(s=o;0!=s--;)if(!e(i[l=p[s]],a[l]))return!1;return!0}return i!=i&&a!=a}},3362:function(e,t,r){!function(e,t,r,n,i){function a(e){if("contents"in e)for(var t=("styleAttrs"in e?e.styleAttrs[n.byName.ruby.qname]:null),r="span"===e.kind&&("container"===t||"textContainer"===t||"baseContainer"===t),i=e.contents.length-1;i>=0;i--)!r||"styleAttrs"in e.contents[i]&&n.byName.ruby.qname in e.contents[i].styleAttrs?a(e.contents[i]):delete e.contents[i]}function s(e,t,r,n){var i=n&&"seq"===n.timeContainer,a=0;n&&(a=i&&r?r.end:n.begin),t.begin=t.explicit_begin?t.explicit_begin+a:a;var o=t.begin,l=null;if("sets"in t)for(var u=0;u<t.sets.length;u++)s(e,t.sets[u],l,t),o="seq"===t.timeContainer?t.sets[u].end:Math.max(o,t.sets[u].end),l=t.sets[u];if("contents"in t){if("contents"in t)for(var c=0;c<t.contents.length;c++)s(e,t.contents[c],l,t),o="seq"===t.timeContainer?t.contents[c].end:Math.max(o,t.contents[c].end),l=t.contents[c]}else o=i?t.begin:Number.POSITIVE_INFINITY;null!==t.explicit_end&&null!==t.explicit_dur?t.end=Math.min(t.begin+t.explicit_dur,a+t.explicit_end):null===t.explicit_end&&null!==t.explicit_dur?t.end=t.begin+t.explicit_dur:null!==t.explicit_end&&null===t.explicit_dur?t.end=a+t.explicit_end:t.end=o,delete t.explicit_begin,delete t.explicit_dur,delete t.explicit_end,e._registerEvent(t)}function o(e){this.node=e}function l(){this.events=[],this.head=new u,this.body=null}function u(){this.styling=new c,this.layout=new h}function c(){this.styles={},this.initials={}}function d(){this.id=null,this.styleAttrs=null,this.styleRefs=null}function f(){this.styleAttrs=null}function h(){this.regions={}}function g(e,t){p.call(this,"image"),this.src=e,this.type=t}function p(e){this.kind=e}function m(e){this.id=e}function v(e){this.regionID=e}function y(e){this.styleAttrs=e}function E(e){this.sets=e}function T(e){this.contents=e}function _(e,t,r){this.explicit_begin=e,this.explicit_end=t,this.explicit_dur=r}function S(){p.call(this,"body")}function b(){p.call(this,"div")}function A(){p.call(this,"p")}function I(){p.call(this,"span")}function R(){p.call(this,"span")}function w(){p.call(this,"br")}function D(){}function L(){}function C(e){return e&&"xml:id"in e.attributes&&e.attributes["xml:id"].value||null}function N(e){return e&&"style"in e.attributes?e.attributes.style.value.split(" "):[]}function P(e,t){var r={};if(null!==e)for(var i in e.attributes){var a=e.attributes[i].uri+" "+e.attributes[i].local,s=n.byQName[a];if(void 0!==s){var o=s.parse(e.attributes[i].value);null!==o?(r[a]=o,s===n.byName.zIndex&&B(t,"zIndex attribute present but not used by IMSC1 since regions do not overlap")):U(t,"Cannot parse styling attribute "+a+" --\x3e "+e.attributes[i].value)}}return r}function O(e,t,r){for(var n in e.attributes)if(e.attributes[n].uri===t&&e.attributes[n].local===r)return e.attributes[n].value;return null}function M(e,t,r){var n,i=null;return null!==(n=/^(\d+(?:\.\d+)?)f$/.exec(r))?null!==t&&(i=parseFloat(n[1])/t):null!==(n=/^(\d+(?:\.\d+)?)t$/.exec(r))?null!==e&&(i=parseFloat(n[1])/e):null!==(n=/^(\d+(?:\.\d+)?)ms$/.exec(r))?i=parseFloat(n[1])/1e3:null!==(n=/^(\d+(?:\.\d+)?)s$/.exec(r))?i=parseFloat(n[1]):null!==(n=/^(\d+(?:\.\d+)?)h$/.exec(r))?i=3600*parseFloat(n[1]):null!==(n=/^(\d+(?:\.\d+)?)m$/.exec(r))?i=60*parseFloat(n[1]):null!==(n=/^(\d{2,}):(\d\d):(\d\d(?:\.\d+)?)$/.exec(r))?i=3600*parseInt(n[1])+60*parseInt(n[2])+parseFloat(n[3]):null!==(n=/^(\d{2,}):(\d\d):(\d\d)\:(\d{2,})$/.exec(r))&&null!==t&&(i=3600*parseInt(n[1])+60*parseInt(n[2])+parseInt(n[3])+(null===n[4]?0:parseInt(n[4])/t)),i}function k(e,t,r){for(;t.styleRefs.length>0;){var n=t.styleRefs.pop();n in e.styles?(k(e,e.styles[n],r),F(e.styles[n].styleAttrs,t.styleAttrs)):U(r,"Non-existant style id referenced")}}function x(e,t,r,n){for(var i=t.length-1;i>=0;i--){var a=t[i];a in e.styles?F(e.styles[a].styleAttrs,r):U(n,"Non-existant style id referenced")}}function F(e,t){for(var r in e)e.hasOwnProperty(r)&&(r in t||(t[r]=e[r]))}function B(e,t){if(e&&e.warn&&e.warn(t))throw t}function U(e,t){if(e&&e.error&&e.error(t))throw t}function Z(e,t){throw e&&e.fatal&&e.fatal(t),t}function G(e,t){for(var r,n=0,i=e.length-1;n<=i;){var a=e[r=Math.floor((n+i)/2)];if(a<t)n=r+1;else{if(!(a>t))return{found:!0,index:r};i=r-1}}return{found:!1,index:n}}e.fromXML=function(e,i,p){var m=t.parser(!0,{xmlns:!0}),v=[],y=[],E=[],T=0,_=null;m.onclosetag=function(e){if(v[0]instanceof D)null!==_.head&&null!==_.head.styling&&x(_.head.styling,v[0].styleRefs,v[0].styleAttrs,i),delete v[0].styleRefs;else if(v[0]instanceof c)for(var t in v[0].styles)v[0].styles.hasOwnProperty(t)&&k(v[0],v[0].styles[t],i);else if(v[0]instanceof A||v[0]instanceof I){if(v[0].contents.length>1){var n,a=[v[0].contents[0]];for(n=1;n<v[0].contents.length;n++)v[0].contents[n]instanceof R&&a[a.length-1]instanceof R?a[a.length-1].text+=v[0].contents[n].text:a.push(v[0].contents[n]);v[0].contents=a}v[0]instanceof I&&1===v[0].contents.length&&v[0].contents[0]instanceof R&&(v[0].text=v[0].contents[0].text,delete v[0].contents)}else v[0]instanceof o&&(v[0].node.uri===r.ns_tt&&"metadata"===v[0].node.local?T--:T>0&&p&&"onCloseTag"in p&&p.onCloseTag());E.shift(),y.shift(),v.shift()},m.ontext=function(e){if(void 0===v[0]);else if(v[0]instanceof I||v[0]instanceof A){if(v[0]instanceof I){var t=v[0].styleAttrs[n.byName.ruby.qname];if("container"===t||"textContainer"===t||"baseContainer"===t)return}var r=new R;r.initFromText(_,v[0],e,y[0],E[0],i),v[0].contents.push(r)}else v[0]instanceof o&&T>0&&p&&"onText"in p&&p.onText(e)},m.onopentag=function(e){var t=e.attributes["xml:space"];t?E.unshift(t.value):0===E.length?E.unshift("default"):E.unshift(E[0]);var a=e.attributes["xml:lang"];if(a?y.unshift(a.value):0===y.length?y.unshift(""):y.unshift(y[0]),e.uri===r.ns_tt)if("tt"===e.local)null!==_&&Z(i,"Two <tt> elements at ("+this.line+","+this.column+")"),(_=new l).initFromNode(e,y[0],i),v.unshift(_);else if("head"===e.local)v[0]instanceof l||Z(i,"Parent of <head> element is not <tt> at ("+this.line+","+this.column+")"),v.unshift(_.head);else if("styling"===e.local)v[0]instanceof u||Z(i,"Parent of <styling> element is not <head> at ("+this.line+","+this.column+")"),v.unshift(_.head.styling);else if("style"===e.local){var s;v[0]instanceof c?((s=new d).initFromNode(e,i),s.id?_.head.styling.styles[s.id]=s:U(i,"<style> element missing @id attribute"),v.unshift(s)):v[0]instanceof D?((s=new d).initFromNode(e,i),F(s.styleAttrs,v[0].styleAttrs),v.unshift(s)):Z(i,"Parent of <style> element is not <styling> or <region> at ("+this.line+","+this.column+")")}else if("initial"===e.local){var m;if(v[0]instanceof c){for(var R in(m=new f).initFromNode(e,i),m.styleAttrs)m.styleAttrs.hasOwnProperty(R)&&(_.head.styling.initials[R]=m.styleAttrs[R]);v.unshift(m)}else Z(i,"Parent of <initial> element is not <styling> at ("+this.line+","+this.column+")")}else if("layout"===e.local)v[0]instanceof u||Z(i,"Parent of <layout> element is not <head> at "+this.line+","+this.column+")"),v.unshift(_.head.layout);else if("region"===e.local){v[0]instanceof h||Z(i,"Parent of <region> element is not <layout> at "+this.line+","+this.column+")");var C=new D;C.initFromNode(_,e,y[0],i),!C.id||C.id in _.head.layout.regions?U(i,"Ignoring <region> with duplicate or missing @id at "+this.line+","+this.column+")"):_.head.layout.regions[C.id]=C,v.unshift(C)}else if("body"===e.local){v[0]instanceof l||Z(i,"Parent of <body> element is not <tt> at "+this.line+","+this.column+")"),null!==_.body&&Z(i,"Second <body> element at "+this.line+","+this.column+")");var N=new S;N.initFromNode(_,e,y[0],i),_.body=N,v.unshift(N)}else if("div"===e.local){v[0]instanceof b||v[0]instanceof S||Z(i,"Parent of <div> element is not <body> or <div> at "+this.line+","+this.column+")");var P=new b;P.initFromNode(_,v[0],e,y[0],i);var O=P.styleAttrs[n.byName.backgroundImage.qname];O&&(P.contents.push(new g(O)),delete P.styleAttrs[n.byName.backgroundImage.qname]),v[0].contents.push(P),v.unshift(P)}else if("image"===e.local){v[0]instanceof b||Z(i,"Parent of <image> element is not <div> at "+this.line+","+this.column+")");var M=new g;M.initFromNode(_,v[0],e,y[0],i),v[0].contents.push(M),v.unshift(M)}else if("p"===e.local){v[0]instanceof b||Z(i,"Parent of <p> element is not <div> at "+this.line+","+this.column+")");var k=new A;k.initFromNode(_,v[0],e,y[0],i),v[0].contents.push(k),v.unshift(k)}else if("span"===e.local){v[0]instanceof I||v[0]instanceof A||Z(i,"Parent of <span> element is not <span> or <p> at "+this.line+","+this.column+")");var x=new I;x.initFromNode(_,v[0],e,y[0],E[0],i),v[0].contents.push(x),v.unshift(x)}else if("br"===e.local){v[0]instanceof I||v[0]instanceof A||Z(i,"Parent of <br> element is not <span> or <p> at "+this.line+","+this.column+")");var B=new w;B.initFromNode(_,v[0],e,y[0],i),v[0].contents.push(B),v.unshift(B)}else if("set"===e.local){v[0]instanceof I||v[0]instanceof A||v[0]instanceof b||v[0]instanceof S||v[0]instanceof D||v[0]instanceof w||Z(i,"Parent of <set> element is not a content element or a region at "+this.line+","+this.column+")");var G=new L;G.initFromNode(_,v[0],e,i),v[0].sets.push(G),v.unshift(G)}else v.unshift(new o(e));else v.unshift(new o(e));if(v[0]instanceof o)if(e.uri===r.ns_tt&&"metadata"===e.local)T++;else if(T>0&&p&&"onOpenTag"in p){var H=[];for(var $ in e.attributes)H[e.attributes[$].uri+" "+e.attributes[$].local]={uri:e.attributes[$].uri,local:e.attributes[$].local,value:e.attributes[$].value};p.onOpenTag(e.uri,e.local,H)}},m.write(e).close(),delete _.head.styling.styles;var C=!1;for(var N in _.head.layout.regions)if(_.head.layout.regions.hasOwnProperty(N)){C=!0;break}if(!C){var P=D.prototype.createDefaultRegion(_.lang);_.head.layout.regions[P.id]=P}for(var O in _.head.layout.regions)_.head.layout.regions.hasOwnProperty(O)&&s(_,_.head.layout.regions[O],null,null);return _.body&&s(_,_.body,null,null),_.body&&a(_.body),_},l.prototype.initFromNode=function(e,t,n){var a=function(e,t){var n=O(e,r.ns_ttp,"cellResolution"),i=15,a=32;if(null!==n){var s=/(\d+) (\d+)/.exec(n);null!==s?(a=parseInt(s[1]),i=parseInt(s[2])):B(t,"Malformed cellResolution value (using initial value instead)")}return{w:a,h:i}}(e,n);this.cellLength={h:new i.ComputedLength(0,1/a.h),w:new i.ComputedLength(1/a.w,0)};var s=function(e,t){var n,i=O(e,r.ns_ttp,"frameRate"),a=30;null!==i&&(null!==(n=/(\d+)/.exec(i))?a=parseInt(n[1]):B(t,"Malformed frame rate attribute (using initial value instead)"));var s=O(e,r.ns_ttp,"frameRateMultiplier"),o=1;null!==s&&(null!==(n=/(\d+) (\d+)/.exec(s))?o=parseInt(n[1])/parseInt(n[2]):B(t,"Malformed frame rate multiplier attribute (using initial value instead)"));var l=o*a,u=1,c=O(e,r.ns_ttp,"tickRate");return null===c?null!==i&&(u=l):null!==(n=/(\d+)/.exec(c))?u=parseInt(n[1]):B(t,"Malformed tick rate attribute (using initial value instead)"),{effectiveFrameRate:l,tickRate:u}}(e,n);this.effectiveFrameRate=s.effectiveFrameRate,this.tickRate=s.tickRate,this.aspectRatio=function(e,t){var n=O(e,r.ns_ittp,"aspectRatio");null===n&&(n=O(e,r.ns_ttp,"displayAspectRatio"));var i=null;if(null!==n){var a=/(\d+)\s+(\d+)/.exec(n);if(null!==a){var s=parseInt(a[1]),o=parseInt(a[2]);0!==s&&0!==o?i=s/o:U(t,"Illegal aspectRatio values (ignoring)")}else U(t,"Malformed aspectRatio attribute (ignoring)")}return i}(e,n);var o=O(e,r.ns_ttp,"timeBase");null!==o&&"media"!==o&&Z(n,"Unsupported time base");var l=function(e,t){var n=O(e,r.ns_tts,"extent");if(null===n)return null;var a=n.split(" ");if(2!==a.length)return B(t,"Malformed extent (ignoring)"),null;var s=i.parseLength(a[0]),o=i.parseLength(a[1]);return o&&s?{h:o,w:s}:(B(t,"Malformed extent values (ignoring)"),null)}(e,n);null===l?this.pxLength={h:null,w:null}:("px"===l.h.unit&&"px"===l.w.unit||Z(n,"Extent on TT must be in px or absent"),this.pxLength={h:new i.ComputedLength(0,1/l.h.value),w:new i.ComputedLength(1/l.w.value,0)}),this.dimensions={h:new i.ComputedLength(0,1),w:new i.ComputedLength(1,0)},this.lang=t},l.prototype._registerEvent=function(e){if(!(e.end<=e.begin)){var t=G(this.events,e.begin);if(t.found||this.events.splice(t.index,0,e.begin),e.end!==Number.POSITIVE_INFINITY){var r=G(this.events,e.end);r.found||this.events.splice(r.index,0,e.end)}}},l.prototype.getMediaTimeRange=function(){return[this.events[0],this.events[this.events.length-1]]},l.prototype.getMediaTimeEvents=function(){return this.events},d.prototype.initFromNode=function(e,t){this.id=C(e),this.styleAttrs=P(e,t),this.styleRefs=N(e)},f.prototype.initFromNode=function(e,t){for(var n in this.styleAttrs={},e.attributes)if(e.attributes[n].uri===r.ns_itts||e.attributes[n].uri===r.ns_ebutts||e.attributes[n].uri===r.ns_tts){var i=e.attributes[n].uri+" "+e.attributes[n].local;this.styleAttrs[i]=e.attributes[n].value}},g.prototype.initFromNode=function(e,t,r,n,i){this.src="src"in r.attributes?r.attributes.src.value:null,this.src||U(i,"Invalid image@src attribute"),this.type="type"in r.attributes?r.attributes.type.value:null,this.type||U(i,"Invalid image@type attribute"),y.prototype.initFromNode.call(this,e,t,r,i),_.prototype.initFromNode.call(this,e,t,r,i),E.prototype.initFromNode.call(this,e,t,r,i),v.prototype.initFromNode.call(this,e,t,r,i),this.lang=n},m.prototype.initFromNode=function(e,t,r,n){this.id=C(r)},v.prototype.initFromNode=function(e,t,r,n){this.regionID=function(e){return e&&"region"in e.attributes?e.attributes.region.value:""}(r)},y.prototype.initFromNode=function(e,t,r,n){this.styleAttrs=P(r,n),null!==e.head&&null!==e.head.styling&&x(e.head.styling,N(r),this.styleAttrs,n)},E.prototype.initFromNode=function(e,t,r,n){this.sets=[]},T.prototype.initFromNode=function(e,t,r,n){this.contents=[]},_.prototype.initFromNode=function(e,t,r,n){var i=function(e,t,r,n){var i=null;r&&"begin"in r.attributes&&null===(i=M(e.tickRate,e.effectiveFrameRate,r.attributes.begin.value))&&B(n,"Malformed begin value "+r.attributes.begin.value+" (using 0)");var a=null;r&&"dur"in r.attributes&&null===(a=M(e.tickRate,e.effectiveFrameRate,r.attributes.dur.value))&&B(n,"Malformed dur value "+r.attributes.dur.value+" (ignoring)");var s=null;return r&&"end"in r.attributes&&null===(s=M(e.tickRate,e.effectiveFrameRate,r.attributes.end.value))&&B(n,"Malformed end value (ignoring)"),{explicit_begin:i,explicit_end:s,explicit_dur:a}}(e,0,r,n);this.explicit_begin=i.explicit_begin,this.explicit_end=i.explicit_end,this.explicit_dur=i.explicit_dur,this.timeContainer=function(e,t){var r=e&&"timeContainer"in e.attributes?e.attributes.timeContainer.value:null;return r&&"par"!==r?"seq"===r?"seq":(U(t,"Illegal value of timeContainer (assuming 'par')"),"par"):"par"}(r,n)},S.prototype.initFromNode=function(e,t,r,n){y.prototype.initFromNode.call(this,e,null,t,n),_.prototype.initFromNode.call(this,e,null,t,n),E.prototype.initFromNode.call(this,e,null,t,n),v.prototype.initFromNode.call(this,e,null,t,n),T.prototype.initFromNode.call(this,e,null,t,n),this.lang=r},b.prototype.initFromNode=function(e,t,r,n,i){y.prototype.initFromNode.call(this,e,t,r,i),_.prototype.initFromNode.call(this,e,t,r,i),E.prototype.initFromNode.call(this,e,t,r,i),v.prototype.initFromNode.call(this,e,t,r,i),T.prototype.initFromNode.call(this,e,t,r,i),this.lang=n},A.prototype.initFromNode=function(e,t,r,n,i){y.prototype.initFromNode.call(this,e,t,r,i),_.prototype.initFromNode.call(this,e,t,r,i),E.prototype.initFromNode.call(this,e,t,r,i),v.prototype.initFromNode.call(this,e,t,r,i),T.prototype.initFromNode.call(this,e,t,r,i),this.lang=n},I.prototype.initFromNode=function(e,t,r,n,i,a){y.prototype.initFromNode.call(this,e,t,r,a),_.prototype.initFromNode.call(this,e,t,r,a),E.prototype.initFromNode.call(this,e,t,r,a),v.prototype.initFromNode.call(this,e,t,r,a),T.prototype.initFromNode.call(this,e,t,r,a),this.space=i,this.lang=n},R.prototype.initFromText=function(e,t,r,n,i,a){_.prototype.initFromNode.call(this,e,t,null,a),this.text=r,this.space=i,this.lang=n},w.prototype.initFromNode=function(e,t,r,n,i){v.prototype.initFromNode.call(this,e,t,r,i),_.prototype.initFromNode.call(this,e,t,r,i),this.lang=n},D.prototype.createDefaultRegion=function(e){var t=new D;return m.call(t,""),y.call(t,{}),E.call(t,[]),_.call(t,0,Number.POSITIVE_INFINITY,null),this.lang=e,t},D.prototype.initFromNode=function(e,t,r,n){m.prototype.initFromNode.call(this,e,null,t,n),_.prototype.initFromNode.call(this,e,null,t,n),E.prototype.initFromNode.call(this,e,null,t,n),this.styleAttrs=P(t,n),this.styleRefs=N(t),this.lang=r},L.prototype.initFromNode=function(e,t,r,n){_.prototype.initFromNode.call(this,e,t,r,n);var i=P(r,n);for(var a in this.qname=null,this.value=null,i)if(i.hasOwnProperty(a)){if(this.qname){U(n,"More than one style specified on set");break}this.qname=a,this.value=i[a]}}}(t,"undefined"==typeof sax?r(5378):sax,"undefined"==typeof imscNames?r(210):imscNames,"undefined"==typeof imscStyles?r(6811):imscStyles,"undefined"==typeof imscUtils?r(5926):imscUtils)},506:function(e,t,r){var n=/firefox/i.test(navigator.userAgent);!function(e,t,r){function i(e,t,d,h){var g;if("region"===d.kind)(g=document.createElement("div")).style.position="absolute";else if("body"===d.kind)g=document.createElement("div");else if("div"===d.kind)g=document.createElement("div");else if("image"===d.kind){if(g=document.createElement("img"),null!==e.imgResolver&&null!==d.src){var v=e.imgResolver(d.src,g);v&&(g.src=v),g.height=e.regionH,g.width=e.regionW}}else if("p"===d.kind)g=document.createElement("p");else if("span"===d.kind)if("container"===d.styleAttrs[r.byName.ruby.qname])g=document.createElement("ruby"),e.ruby=!0;else if("base"===d.styleAttrs[r.byName.ruby.qname])g=document.createElement("span");else if("text"===d.styleAttrs[r.byName.ruby.qname])g=document.createElement("rt");else if("baseContainer"===d.styleAttrs[r.byName.ruby.qname])g=document.createElement("rbc");else if("textContainer"===d.styleAttrs[r.byName.ruby.qname])g=document.createElement("rtc");else{if("delimiter"===d.styleAttrs[r.byName.ruby.qname])return;g=document.createElement("span")}else"br"===d.kind&&(g=document.createElement("br"));if(g){if(d.lang&&("region"!==d.kind&&d.lang===h.lang||(g.lang=d.lang)),t.appendChild(g),g.style.margin="0","region"===d.kind){var T=d.styleAttrs[r.byName.writingMode.qname];"lrtb"===T||"lr"===T?(e.ipd="lr",e.bpd="tb"):"rltb"===T||"rl"===T?(e.ipd="rl",e.bpd="tb"):"tblr"===T?(e.ipd="tb",e.bpd="lr"):"tbrl"!==T&&"tb"!==T||(e.ipd="tb",e.bpd="rl")}else if("p"===d.kind&&"tb"===e.bpd){var _=d.styleAttrs[r.byName.direction.qname];e.ipd="ltr"===_?"lr":"rl"}for(var S=0;S<f.length;S++){var b=f[S],A=d.styleAttrs[b.qname];void 0!==A&&null!==b.map&&b.map(e,g,d,A)}var I=g,R=d.styleAttrs[r.byName.linePadding.qname];if(R&&!R.isZero()){var w=R.toUsedLength(e.w,e.h);if(w>0){var D=Math.ceil(w)+"px";"tb"===e.bpd?(I.style.paddingLeft=D,I.style.paddingRight=D):(I.style.paddingTop=D,I.style.paddingBottom=D),e.lp=R}}var L=d.styleAttrs[r.byName.multiRowAlign.qname];if(L&&"auto"!==L){var C=document.createElement("span");C.style.display="inline-block",C.style.textAlign=L,g.appendChild(C),I=C,e.mra=L}var N=d.styleAttrs[r.byName.rubyReserve.qname];if(N&&"none"!==N[0]&&(e.rubyReserve=N),d.styleAttrs[r.byName.fillLineGap.qname]&&(e.flg=!0),"span"===d.kind&&d.text){var P=d.styleAttrs[r.byName.textEmphasis.qname];if(P&&"none"!==P.style&&(e.textEmphasis=!0),r.byName.textCombine.qname in d.styleAttrs&&"all"===d.styleAttrs[r.byName.textCombine.qname])g.textContent=d.text,g._isd_element=d,P&&c(e,g,0,P);else for(var O="",M=0;M<d.text.length;M++){O+=d.text.charAt(M);var k=d.text.charCodeAt(M);if(k<55296||k>56319||M===d.text.length-1){var x=document.createElement("span");x.textContent=O,P&&c(e,x,0,P),g.appendChild(x),O="",x._isd_element=d}}}if("contents"in d)for(var F=0;F<d.contents.length;F++)i(e,I,d.contents[F],d);var B=[];if("p"===d.kind&&(u(e,I,B,null),e.rubyReserve&&(function(e,t){for(var r=0;r<e.length;r++){var n,i,a=document.createElement("ruby"),s=document.createElement("span");s.textContent="",a.appendChild(s);var o,l=t.rubyReserve[1].toUsedLength(t.w,t.h)+"px";"both"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&1==e.length?((n=document.createElement("rtc")).style[m]=p?"after":"under",n.textContent="",n.style.fontSize=l,(i=document.createElement("rtc")).style[m]=p?"before":"over",i.textContent="",i.style.fontSize=l,a.appendChild(n),a.appendChild(i)):((n=document.createElement("rtc")).textContent="",n.style.fontSize=l,o="after"===t.rubyReserve[0]||"outside"===t.rubyReserve[0]&&r>0?p?"after":"tb"===t.bpd||"rl"===t.bpd?"under":"over":p?"before":"tb"===t.bpd||"rl"===t.bpd?"over":"under",n.style[m]=o,a.appendChild(n));for(var u=null,c=0;c<e[r].rbc.length;c++)if("ruby"===e[r].rbc[c].localName){u=e[r].rbc[c];for(var d=0;d<u.style.length;d++)a.style.setProperty(u.style.item(d),u.style.getPropertyValue(u.style.item(d)));break}(u=u||e[r].elements[0].node).parentElement.insertBefore(a,u)}}(B,e),e.rubyReserve=null),(e.ruby||e.rubyReserve)&&(function(e,t){for(var r=0;r<e.length;r++)for(var n=0;n<e[r].rbc.length;n++){var i;e[r].rbc[n].style[m]||(i=p?0===r?"before":"after":"tb"===t.bpd||"rl"===t.bpd?0===r?"over":"under":0===r?"under":"over",e[r].rbc[n].style[m]=i)}}(B,e),e.ruby=null),e.textEmphasis&&(function(e,t){for(var r=0;r<e.length;r++)for(var n=0;n<e[r].te.length;n++){var i;e[r].te[n].style[y]&&"none"!==e[r].te[n].style[y]||(i="tb"===t.bpd?0===r?"left over":"left under":"rl"===t.bpd?0===r?"right under":"left under":0===r?"left under":"right under",e[r].te[n].style[y]=i)}}(B,e),e.textEmphasis=null),e.mra&&(function(e){for(var t=0;t<e.length-1;t++){var r=e[t].elements.length;if(0!==r&&!1===e[t].br){var n=document.createElement("br"),i=e[t].elements[r-1].node;i.parentElement.insertBefore(n,i.nextSibling)}}}(B),e.mra=null),e.lp&&(function(e,t,r){if(null!==e)for(var i=0;i<e.length;i++){var a=e[i].elements.length,s=Math.ceil(t)+"px",o="-"+Math.ceil(t)+"px";if(0!==a){var l=e[i].elements[e[i].start_elem],u=e[i].elements[e[i].end_elem];if(l===u){var c=l.node.getBoundingClientRect();if(0==c.width||0==c.height)continue}"lr"===r.ipd?(l.node.style.marginLeft=o,l.node.style.paddingLeft=s):"rl"===r.ipd?(l.node.style.paddingRight=s,l.node.style.marginRight=o):"tb"===r.ipd&&(l.node.style.paddingTop=s,l.node.style.marginTop=o),"lr"===r.ipd?(n||(u.node.style.marginRight=o),u.node.style.paddingRight=s):"rl"===r.ipd?(u.node.style.paddingLeft=s,n||(u.node.style.marginLeft=o)):"tb"===r.ipd&&(u.node.style.paddingBottom=s,u.node.style.marginBottom=o)}}}(B,e.lp.toUsedLength(e.w,e.h),e),e.lp=null),function(e,t){for(var r=0;r<e.length;r++)for(var n=e[r],i=1;i<n.elements.length;){var o=n.elements[i-1],l=n.elements[i];s(o.node,l.node,t)?n.elements.splice(i,1):i++}for(var u,c,d=[],f=0;f<e.length;f++)for(var h=0;h<e[f].elements.length;h++)(c=a(u=e[f].elements[h].node,d,!1))&&(u.style.backgroundColor=c);for(var g=0;g<d.length;g++)d[g].style.backgroundColor=""}(B,e),e.flg)){var U=l(I.getBoundingClientRect(),e);!function(e,t,r,n){for(var i=Math.sign(r-t),a=0;a<=e.length;a++){var s,o,l,u;if(s=0===a?Math.round(t):a===e.length?Math.round(r):Math.round((e[a-1].after+e[a].before)/2),a>0&&e[a-1])for(l=0;l<e[a-1].elements.length;l++)o=i*(s-(u=e[a-1].elements[l]).after)+"px","lr"===n.bpd?u.node.style.paddingRight=o:"rl"===n.bpd?u.node.style.paddingLeft=o:"tb"===n.bpd&&(u.node.style.paddingBottom=o);if(a<e.length)for(l=0;l<e[a].elements.length;l++)o=i*((u=e[a].elements[l]).before-s)+"px","lr"===n.bpd?u.node.style.paddingLeft=o:"rl"===n.bpd?u.node.style.paddingRight=o:"tb"===n.bpd&&(u.node.style.paddingTop=o)}}(B,U.before,U.after,e),e.flg=null}if("region"===d.kind&&"tb"===e.bpd&&e.enableRollUp&&d.contents.length>0&&"after"===d.styleAttrs[r.byName.displayAlign.qname]){u(e,I,B,null);var Z=new o(""===d.id?"_":d.id,B);if(e.currentISDState[Z.id]=Z,e.previousISDState&&Z.id in e.previousISDState&&e.previousISDState[Z.id].plist.length>0&&Z.plist.length>1&&Z.plist[Z.plist.length-2].text===e.previousISDState[Z.id].plist[e.previousISDState[Z.id].plist.length-1].text){var G=g.firstElementChild,H=Z.plist[Z.plist.length-1].after-Z.plist[Z.plist.length-1].before;G.style.bottom="-"+H+"px",G.style.transition="transform 0.4s",G.style.position="relative",G.style.transform="translateY(-"+H+"px)"}}}else E(e.errorHandler,"Error processing ISD element kind: "+d.kind)}function a(e,t,r){return e.style.backgroundColor?(r&&!t.includes(e)&&t.push(e),e.style.backgroundColor):"SPAN"===e.parentElement.nodeName||"RUBY"===e.parentElement.nodeName||"RBC"===e.parentElement.nodeName||"RTC"===e.parentElement.nodeName||"RT"===e.parentElement.nodeName?a(e.parentElement,t,!0):void 0}function s(e,t,r){if("SPAN"===e.tagName&&"SPAN"===t.tagName&&e._isd_element===t._isd_element){if(!e._isd_element)return E(r.errorHandler,"Internal error: HTML span is not linked to a source element; cannot merge spans."),!1;e.textContent+=t.textContent;for(var n=0;n<t.style.length;n++){var i=t.style[n];(i.indexOf("border")>=0||i.indexOf("padding")>=0||i.indexOf("margin")>=0)&&(e.style[i]=t.style[i])}return t.parentElement.removeChild(t),!0}return!1}function o(e,t){this.id=e,this.plist=t}function l(e,t){var r={before:null,after:null,start:null,end:null};return"tb"===t.bpd?(r.before=e.top,r.after=e.bottom,"lr"===t.ipd?(r.start=e.left,r.end=e.right):(r.start=e.right,r.end=e.left)):"lr"===t.bpd?(r.before=e.left,r.after=e.right,r.start=e.top,r.end=e.bottom):"rl"===t.bpd&&(r.before=e.right,r.after=e.left,r.start=e.top,r.end=e.bottom),r}function u(e,t,r,n){if("rt"!==t.localName&&"rtc"!==t.localName){var i,a,s,o,c=t.style.backgroundColor||n;if(0===t.childElementCount)if("span"===t.localName||"rb"===t.localName){var d=l(t.getBoundingClientRect(),e);if(0!==r.length&&(i=d.before,a=d.after,s=r[r.length-1].before,a<(o=r[r.length-1].after)&&i>s||o<=a&&s>=i)){var f=Math.sign(d.after-d.before),h=Math.sign(d.end-d.start);f*(d.before-r[r.length-1].before)<0&&(r[r.length-1].before=d.before),f*(d.after-r[r.length-1].after)>0&&(r[r.length-1].after=d.after),h*(d.start-r[r.length-1].start)<0&&(r[r.length-1].start=d.start,r[r.length-1].start_elem=r[r.length-1].elements.length),h*(d.end-r[r.length-1].end)>0&&(r[r.length-1].end=d.end,r[r.length-1].end_elem=r[r.length-1].elements.length)}else r.push({before:d.before,after:d.after,start:d.start,end:d.end,start_elem:0,end_elem:0,elements:[],rbc:[],te:[],text:"",br:!1});r[r.length-1].text+=t.textContent,r[r.length-1].elements.push({node:t,bgcolor:c,before:d.before,after:d.after})}else"br"===t.localName&&0!==r.length&&(r[r.length-1].br=!0);else for(var g=t.firstChild;g;)g.nodeType===Node.ELEMENT_NODE&&(u(e,g,r,c),"ruby"===g.localName||"rtc"===g.localName?r.length>0&&r[r.length-1].rbc.push(g):"span"===g.localName&&g.style[v]&&"none"!==g.style[v]&&r.length>0&&r[r.length-1].te.push(g)),g=g.nextSibling}}function c(e,t,r,n){var i;"none"!==n.style&&("auto"===n.style?t.style[v]="filled":t.style[v]=n.style+" "+n.symbol,("before"===n.position||"after"===n.position)&&(i="tb"===e.bpd?"before"===n.position?"left over":"left under":"rl"===e.bpd?"before"===n.position?"right under":"left under":"before"===n.position?"left under":"right under",t.style[y]=i))}function d(e,t){this.qname=e,this.map=t}e.render=function(e,t,r,n,a,s,o,l,u){var c=n||t.clientHeight,d=a||t.clientWidth;if(null!==e.aspectRatio){var f=c*e.aspectRatio;f>d?c=Math.round(d/e.aspectRatio):d=f}var h=document.createElement("div");h.style.position="relative",h.style.width=d+"px",h.style.height=c+"px",h.style.margin="auto",h.style.top=0,h.style.bottom=0,h.style.left=0,h.style.right=0,h.style.zIndex=0;var g={h:c,w:d,regionH:null,regionW:null,imgResolver:r,displayForcedOnlyMode:s||!1,isd:e,errorHandler:o,previousISDState:l,enableRollUp:u||!1,currentISDState:{},flg:null,lp:null,mra:null,ipd:null,bpd:null,ruby:null,textEmphasis:null,rubyReserve:null};if(t.appendChild(h),"contents"in e)for(var p=0;p<e.contents.length;p++)i(g,h,e.contents[p],e);return g.currentISDState};for(var f=[new d("http://www.w3.org/ns/ttml#styling backgroundColor",function(e,t,r,n){0!==n[3]&&(t.style.backgroundColor="rgba("+n[0].toString()+","+n[1].toString()+","+n[2].toString()+","+(n[3]/255).toString()+")")}),new d("http://www.w3.org/ns/ttml#styling color",function(e,t,r,n){t.style.color="rgba("+n[0].toString()+","+n[1].toString()+","+n[2].toString()+","+(n[3]/255).toString()+")"}),new d("http://www.w3.org/ns/ttml#styling direction",function(e,t,r,n){t.style.direction=n}),new d("http://www.w3.org/ns/ttml#styling display",function(e,t,r,n){}),new d("http://www.w3.org/ns/ttml#styling displayAlign",function(e,t,r,n){t.style.display="flex",t.style.flexDirection="column","before"===n?t.style.justifyContent="flex-start":"center"===n?t.style.justifyContent="center":"after"===n&&(t.style.justifyContent="flex-end")}),new d("http://www.w3.org/ns/ttml#styling extent",function(e,t,r,n){e.regionH=n.h.toUsedLength(e.w,e.h),e.regionW=n.w.toUsedLength(e.w,e.h);var i=0,a=0,s=r.styleAttrs["http://www.w3.org/ns/ttml#styling padding"];s&&(i=s[0].toUsedLength(e.w,e.h)+s[2].toUsedLength(e.w,e.h),a=s[1].toUsedLength(e.w,e.h)+s[3].toUsedLength(e.w,e.h)),t.style.height=e.regionH-i+"px",t.style.width=e.regionW-a+"px"}),new d("http://www.w3.org/ns/ttml#styling fontFamily",function(e,t,r,n){for(var i=[],a=0;a<n.length;a++)n[a]=n[a].trim(),"monospaceSerif"===n[a]?(i.push("Courier New"),i.push('"Liberation Mono"'),i.push("Courier"),i.push("monospace")):"proportionalSansSerif"===n[a]?(i.push("Arial"),i.push("Helvetica"),i.push('"Liberation Sans"'),i.push("sans-serif")):"monospace"===n[a]?i.push("monospace"):"sansSerif"===n[a]?i.push("sans-serif"):"serif"===n[a]?i.push("serif"):"monospaceSansSerif"===n[a]?(i.push("Consolas"),i.push("monospace")):"proportionalSerif"===n[a]?i.push("serif"):i.push(n[a]);if(i.length>0){for(var s=[i[0]],o=1;o<i.length;o++)-1==s.indexOf(i[o])&&s.push(i[o]);i=s}t.style.fontFamily=i.join(",")}),new d("http://www.w3.org/ns/ttml#styling shear",function(e,t,r,n){if(0!==n){var i=-.9*n;"tb"===e.bpd?t.style.transform="skewX("+i+"deg)":t.style.transform="skewY("+i+"deg)"}}),new d("http://www.w3.org/ns/ttml#styling fontSize",function(e,t,r,n){t.style.fontSize=n.toUsedLength(e.w,e.h)+"px"}),new d("http://www.w3.org/ns/ttml#styling fontStyle",function(e,t,r,n){t.style.fontStyle=n}),new d("http://www.w3.org/ns/ttml#styling fontWeight",function(e,t,r,n){t.style.fontWeight=n}),new d("http://www.w3.org/ns/ttml#styling lineHeight",function(e,t,r,n){t.style.lineHeight="normal"===n?"normal":n.toUsedLength(e.w,e.h)+"px"}),new d("http://www.w3.org/ns/ttml#styling opacity",function(e,t,r,n){t.style.opacity=n}),new d("http://www.w3.org/ns/ttml#styling origin",function(e,t,r,n){t.style.top=n.h.toUsedLength(e.w,e.h)+"px",t.style.left=n.w.toUsedLength(e.w,e.h)+"px"}),new d("http://www.w3.org/ns/ttml#styling overflow",function(e,t,r,n){t.style.overflow=n}),new d("http://www.w3.org/ns/ttml#styling padding",function(e,t,r,n){var i=[];i[0]=n[0].toUsedLength(e.w,e.h)+"px",i[1]=n[3].toUsedLength(e.w,e.h)+"px",i[2]=n[2].toUsedLength(e.w,e.h)+"px",i[3]=n[1].toUsedLength(e.w,e.h)+"px",t.style.padding=i.join(" ")}),new d("http://www.w3.org/ns/ttml#styling position",function(e,t,r,n){t.style.top=n.h.toUsedLength(e.w,e.h)+"px",t.style.left=n.w.toUsedLength(e.w,e.h)+"px"}),new d("http://www.w3.org/ns/ttml#styling rubyAlign",function(e,t,r,n){t.style.rubyAlign="spaceAround"===n?"space-around":"center"}),new d("http://www.w3.org/ns/ttml#styling rubyPosition",function(e,t,r,n){var i;"before"!==n&&"after"!==n||(i=p?n:"tb"===e.bpd||"rl"===e.bpd?"before"===n?"over":"under":"before"===n?"under":"over",t.parentElement.style[m]=i)}),new d("http://www.w3.org/ns/ttml#styling showBackground",null),new d("http://www.w3.org/ns/ttml#styling textAlign",function(e,t,r,n){var i;i="start"===n?"rl"===e.ipd?"right":"left":"end"===n?"rl"===e.ipd?"left":"right":n,t.style.textAlign=i}),new d("http://www.w3.org/ns/ttml#styling textDecoration",function(e,t,r,n){t.style.textDecoration=n.join(" ").replace("lineThrough","line-through")}),new d("http://www.w3.org/ns/ttml#styling textOutline",function(e,t,r,n){}),new d("http://www.w3.org/ns/ttml#styling textShadow",function(e,t,n,i){var a=n.styleAttrs[r.byName.textOutline.qname];if("none"===i&&"none"===a)t.style.textShadow="";else{var s=[];if("none"!==a){var o="rgba("+a.color[0].toString()+","+a.color[1].toString()+","+a.color[2].toString()+","+(a.color[3]/255).toString()+")";s.push("1px 1px 1px "+o),s.push("-1px 1px 1px "+o),s.push("1px -1px 1px "+o),s.push("-1px -1px 1px "+o)}if("none"!==i)for(var l=0;l<i.length;l++)s.push(i[l].x_off.toUsedLength(e.w,e.h)+"px "+i[l].y_off.toUsedLength(e.w,e.h)+"px "+i[l].b_radius.toUsedLength(e.w,e.h)+"px rgba("+i[l].color[0].toString()+","+i[l].color[1].toString()+","+i[l].color[2].toString()+","+(i[l].color[3]/255).toString()+")");t.style.textShadow=s.join(",")}}),new d("http://www.w3.org/ns/ttml#styling textCombine",function(e,t,r,n){t.style.textCombineUpright=n}),new d("http://www.w3.org/ns/ttml#styling textEmphasis",function(e,t,r,n){}),new d("http://www.w3.org/ns/ttml#styling unicodeBidi",function(e,t,r,n){var i;i="bidiOverride"===n?"bidi-override":n,t.style.unicodeBidi=i}),new d("http://www.w3.org/ns/ttml#styling visibility",function(e,t,r,n){t.style.visibility=n}),new d("http://www.w3.org/ns/ttml#styling wrapOption",function(e,t,r,n){"wrap"===n?"preserve"===r.space?t.style.whiteSpace="pre-wrap":t.style.whiteSpace="normal":"preserve"===r.space?t.style.whiteSpace="pre":t.style.whiteSpace="noWrap"}),new d("http://www.w3.org/ns/ttml#styling writingMode",function(e,t,r,n){"lrtb"===n||"lr"===n||"rltb"===n||"rl"===n?t.style.writingMode="horizontal-tb":"tblr"===n?t.style.writingMode="vertical-lr":"tbrl"!==n&&"tb"!==n||(t.style.writingMode="vertical-rl")}),new d("http://www.w3.org/ns/ttml#styling zIndex",function(e,t,r,n){t.style.zIndex=n}),new d("http://www.w3.org/ns/ttml/profile/imsc1#styling forcedDisplay",function(e,t,r,n){e.displayForcedOnlyMode&&!1===n&&(t.style.visibility="hidden")})],h={},g=0;g<f.length;g++)h[f[g].qname]=f[g];var p="webkitRubyPosition"in window.getComputedStyle(document.documentElement),m=p?"webkitRubyPosition":"rubyPosition",v="webkitTextEmphasisStyle"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisStyle":"textEmphasisStyle",y="webkitTextEmphasisPosition"in window.getComputedStyle(document.documentElement)?"webkitTextEmphasisPosition":"textEmphasisPosition";function E(e,t){if(e&&e.error&&e.error(t))throw t}}(t,"undefined"==typeof imscNames?r(210):imscNames,"undefined"==typeof imscStyles?r(6811):imscStyles,"undefined"==typeof imscUtils?r(5926):imscUtils)},4080:function(e,t,r){!function(e,t,r,n){e.generateISD=function(e,t,n){var i,s=new l(e),o={},u={},c=e.head.styling.initials[r.byName.showBackground.qname],d=e.head.styling.initials[r.byName.backgroundColor.qname];for(var f in e.head.layout.regions)if(e.head.layout.regions.hasOwnProperty(f)){var h=e.head.layout.regions[f],g=h.styleAttrs[r.byName.showBackground.qname]||c,p=h.styleAttrs[r.byName.backgroundColor.qname]||d;u[h.id]=("always"===g||void 0===g)&&void 0!==p&&!(t<h.begin||t>=h.end)}for(var m in e.body&&e.body.regionID&&(u[e.body.regionID]=!0),i=null!==e.body?function e(t,r){if(r.contents){var n={};for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i]);return n.contents=[],r.contents.filter(function(e){return!(t<e.begin||t>=e.end)}).forEach(function(r){var i=e(t,r);i.regionID&&(u[i.regionID]=!0),null!==i&&n.contents.push(i)}),n}return r}(t,e.body):null,void 0!==u[""]&&(u[""]=!0),u)if(u[m]){var v=a(e,t,e.head.layout.regions[m],i,null,"",e.head.layout.regions[m],n,o);null!==v&&s.contents.push(v.element)}return s};var i=[r.byName.color.qname,r.byName.textCombine.qname,r.byName.textDecoration.qname,r.byName.textEmphasis.qname,r.byName.textOutline.qname,r.byName.textShadow.qname];function a(e,t,l,d,f,h,g,p,m){if(t<g.begin||t>=g.end)return null;var v="regionID"in g&&""!==g.regionID?g.regionID:h;if(null!==f&&v!==l.id&&(!("contents"in g)||"contents"in g&&0===g.contents.length||""!==v))return null;var y=new u(g);if("sets"in g)for(var E=0;E<g.sets.length;E++)t<g.sets[E].begin||t>=g.sets[E].end||(y.styleAttrs[g.sets[E].qname]=g.sets[E].value);var T={};for(var _ in y.styleAttrs)if(y.styleAttrs.hasOwnProperty(_)&&(T[_]=!0,"region"===y.kind&&_===r.byName.writingMode.qname&&!(r.byName.direction.qname in y.styleAttrs))){var S=y.styleAttrs[_];"lrtb"===S||"lr"===S?y.styleAttrs[r.byName.direction.qname]="ltr":"rltb"!==S&&"rl"!==S||(y.styleAttrs[r.byName.direction.qname]="rtl")}if(null!==f)for(var b=0;b<r.all.length;b++){var A=r.all[b];if(A.qname===r.byName.textDecoration.qname){var I=f.styleAttrs[A.qname],R=y.styleAttrs[A.qname],w=[];void 0===R?w=I:-1===R.indexOf("none")?((-1===R.indexOf("noUnderline")&&-1!==I.indexOf("underline")||-1!==R.indexOf("underline"))&&w.push("underline"),(-1===R.indexOf("noLineThrough")&&-1!==I.indexOf("lineThrough")||-1!==R.indexOf("lineThrough"))&&w.push("lineThrough"),(-1===R.indexOf("noOverline")&&-1!==I.indexOf("overline")||-1!==R.indexOf("overline"))&&w.push("overline")):w.push("none"),y.styleAttrs[A.qname]=w}else if(A.qname!==r.byName.fontSize.qname||A.qname in y.styleAttrs||"span"!==y.kind||"textContainer"!==y.styleAttrs[r.byName.ruby.qname])if(A.qname!==r.byName.fontSize.qname||A.qname in y.styleAttrs||"span"!==y.kind||"text"!==y.styleAttrs[r.byName.ruby.qname])A.inherit&&A.qname in f.styleAttrs&&!(A.qname in y.styleAttrs)&&(y.styleAttrs[A.qname]=f.styleAttrs[A.qname]);else{var D=f.styleAttrs[r.byName.fontSize.qname];"textContainer"===f.styleAttrs[r.byName.ruby.qname]?y.styleAttrs[A.qname]=D:y.styleAttrs[A.qname]=new n.ComputedLength(.5*D.rw,.5*D.rh)}else{var L=f.styleAttrs[r.byName.fontSize.qname];y.styleAttrs[A.qname]=new n.ComputedLength(.5*L.rw,.5*L.rh)}}for(var C=0;C<r.all.length;C++){var N=r.all[C];if(!(N.qname in y.styleAttrs)&&!(N.qname===r.byName.position.qname&&r.byName.origin.qname in y.styleAttrs||N.qname===r.byName.origin.qname&&r.byName.position.qname in y.styleAttrs)){var P=e.head.styling.initials[N.qname]||N.initial;if(null!==P&&("region"===y.kind||!1===N.inherit&&null!==P)){var O=N.parse(P);null!==O?(y.styleAttrs[N.qname]=O,T[N.qname]=!0):c(p,"Invalid initial value for '"+N.qname+"' on element '"+y.kind)}}}for(var M=0;M<r.all.length;M++){var k=r.all[M];if(k.qname in T&&null!==k.compute){var x=k.compute(e,f,y,y.styleAttrs[k.qname],m);null!==x?y.styleAttrs[k.qname]=x:(y.styleAttrs[k.qname]=k.compute(e,f,y,k.parse(k.initial),m),c(p,"Style '"+k.qname+"' on element '"+y.kind+"' cannot be computed"))}}if("none"===y.styleAttrs[r.byName.display.qname])return null;var F=null;null===f?F=null===d?[]:[d]:"contents"in g&&(F=g.contents);for(var B=0;null!==F&&B<F.length;B++){var U=a(e,t,l,d,y,v,F[B],p,m);null!==U&&y.contents.push(U.element)}for(var Z in y.styleAttrs)if(y.styleAttrs.hasOwnProperty(Z)){var G=!1;if("span"===y.kind){var H=y.styleAttrs[r.byName.ruby.qname];(G=("container"===H||"textContainer"===H||"baseContainer"===H)&&-1!==i.indexOf(Z))||(G="container"!==H&&Z===r.byName.rubyAlign.qname),G||(G=!("textContainer"===H||"text"===H)&&Z===r.byName.rubyPosition.qname)}if(!G){var $=r.byQName[Z];"applies"in $&&(G=-1===$.applies.indexOf(y.kind))}G&&delete y.styleAttrs[Z]}var V=y.styleAttrs[r.byName.ruby.qname];if("p"===y.kind||"span"===y.kind&&("textContainer"===V||"text"===V)){var K=[];s(y,K),function(e){for(var t,r=0;r<e.length;)if("br"!==(t=e[r]).kind&&"preserve"!==t.space){var n=t.text.replace(/[\t\r\n ]+/g," ");/^[ ]/.test(n)&&(0===r||"br"===(i=e[r-1]).kind||/[\r\n\t ]$/.test(i.text))&&(n=n.substring(1)),t.text=n,0===n.length?e.splice(r,1):r++}else r++;var i,a;for(r=0;r<e.length;r++)"br"!==(t=e[r]).kind&&"preserve"!==t.space?/[ ]$/.test(t.text)&&(r===e.length-1||"br"===(a=e[r+1]).kind||"preserve"===a.space&&/^[\r\n]/.test(a.text))&&(t.text=t.text.slice(0,-1)):r++}(K),o(y)}return"div"===y.kind&&r.byName.backgroundImage.qname in y.styleAttrs||"br"===y.kind||"image"===y.kind||"contents"in y&&y.contents.length>0||"span"===y.kind&&null!==y.text||"region"===y.kind&&"always"===y.styleAttrs[r.byName.showBackground.qname]?{region_id:v,element:y}:null}function s(e,t){if("contents"in e)for(var n=0;n<e.contents.length;n++){var i=e.contents[n],a=i.styleAttrs[r.byName.ruby.qname];("span"!==i.kind||"textContainer"!==a&&"text"!==a)&&("contents"in i?s(i,t):("span"===i.kind&&0!==i.text.length||"br"===i.kind)&&t.push(i))}}function o(e){if("br"===e.kind)return!1;if("text"in e)return 0===e.text.length;if("contents"in e){for(var t=e.contents.length;t--;)o(e.contents[t])&&e.contents.splice(t,1);return 0===e.contents.length}}function l(e){this.contents=[],this.aspectRatio=e.aspectRatio,this.lang=e.lang}function u(e){for(var t in this.kind=e.kind||"region",this.lang=e.lang,e.id&&(this.id=e.id),this.styleAttrs={},e.styleAttrs)e.styleAttrs.hasOwnProperty(t)&&(this.styleAttrs[t]=e.styleAttrs[t]);"src"in e&&(this.src=e.src),"type"in e&&(this.type=e.type),"text"in e?this.text=e.text:("region"===this.kind||"contents"in e)&&(this.contents=[]),"space"in e&&(this.space=e.space)}function c(e,t){if(e&&e.error&&e.error(t))throw t}}(t,"undefined"==typeof imscNames?r(210):imscNames,"undefined"==typeof imscStyles?r(6811):imscStyles,"undefined"==typeof imscUtils?r(5926):imscUtils)},4403:function(e,t,r){t.generateISD=r(4080).generateISD,t.fromXML=r(3362).fromXML,t.renderHTML=r(506).render},210:function(e,t){!function(e){e.ns_tt="http://www.w3.org/ns/ttml",e.ns_tts="http://www.w3.org/ns/ttml#styling",e.ns_ttp="http://www.w3.org/ns/ttml#parameter",e.ns_xml="http://www.w3.org/XML/1998/namespace",e.ns_itts="http://www.w3.org/ns/ttml/profile/imsc1#styling",e.ns_ittp="http://www.w3.org/ns/ttml/profile/imsc1#parameter",e.ns_smpte="http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",e.ns_ebutts="urn:ebu:tt:style"}(t)},6811:function(e,t,r){!function(e,t,r){function n(e,t,r,n,i,a,s,o){this.name=t,this.ns=e,this.qname=e+" "+t,this.inherit=i,this.animatable=a,this.initial=r,this.applies=n,this.parse=s,this.compute=o}for(var i in e.all=[new n(t.ns_tts,"backgroundColor","transparent",["body","div","p","region","span"],!1,!0,r.parseColor,null),new n(t.ns_tts,"color","white",["span"],!0,!0,r.parseColor,null),new n(t.ns_tts,"direction","ltr",["p","span"],!0,!0,function(e){return e},null),new n(t.ns_tts,"display","auto",["body","div","p","region","span"],!1,!0,function(e){return e},null),new n(t.ns_tts,"displayAlign","before",["region"],!1,!0,function(e){return e},null),new n(t.ns_tts,"extent","auto",["tt","region"],!1,!0,function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var n=r.parseLength(t[0]),i=r.parseLength(t[1]);return i&&n?{h:i,w:n}:null},function(e,t,n,i,a){var s,o;if("auto"===i)s=new r.ComputedLength(0,1);else if(null===(s=r.toComputedLength(i.h.value,i.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===i)o=new r.ComputedLength(1,0);else if(null===(o=r.toComputedLength(i.w.value,i.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:s,w:o}}),new n(t.ns_tts,"fontFamily","default",["span","p"],!0,!0,function(e){for(var t=e.split(","),r=[],n=0;n<t.length;n++)t[n]=t[n].trim(),"'"!==t[n].charAt(0)&&'"'!==t[n].charAt(0)&&"default"===t[n]?r.push("monospaceSerif"):r.push(t[n]);return r},null),new n(t.ns_tts,"shear","0%",["p"],!0,!0,r.parseLength,function(e,t,r,n){return"%"!==n.unit?null:Math.abs(n.value)>100?100*Math.sign(n.value):n.value}),new n(t.ns_tts,"fontSize","1c",["span","p"],!0,!0,r.parseLength,function(t,n,i,a,s){return r.toComputedLength(a.value,a.unit,null!==n?n.styleAttrs[e.byName.fontSize.qname]:t.cellLength.h,null!==n?n.styleAttrs[e.byName.fontSize.qname]:t.cellLength.h,t.cellLength.h,t.pxLength.h)}),new n(t.ns_tts,"fontStyle","normal",["span","p"],!0,!0,function(e){return e},null),new n(t.ns_tts,"fontWeight","normal",["span","p"],!0,!0,function(e){return e},null),new n(t.ns_tts,"lineHeight","normal",["p"],!0,!0,function(e){return"normal"===e?e:r.parseLength(e)},function(t,n,i,a,s){var o;if("normal"===a)o=a;else if(null===(o=r.toComputedLength(a.value,a.unit,i.styleAttrs[e.byName.fontSize.qname],i.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h)))return null;return o}),new n(t.ns_tts,"opacity",1,["region"],!1,!0,parseFloat,null),new n(t.ns_tts,"origin","auto",["region"],!1,!0,function(e){if("auto"===e)return e;var t=e.split(" ");if(2!==t.length)return null;var n=r.parseLength(t[0]),i=r.parseLength(t[1]);return i&&n?{h:i,w:n}:null},function(e,t,n,i,a){var s,o;if("auto"===i)s=new r.ComputedLength(0,0);else if(null===(s=r.toComputedLength(i.h.value,i.h.unit,null,e.dimensions.h,null,e.pxLength.h)))return null;if("auto"===i)o=new r.ComputedLength(0,0);else if(null===(o=r.toComputedLength(i.w.value,i.w.unit,null,e.dimensions.w,null,e.pxLength.w)))return null;return{h:s,w:o}}),new n(t.ns_tts,"overflow","hidden",["region"],!1,!0,function(e){return e},null),new n(t.ns_tts,"padding","0px",["region"],!1,!0,function(e){var t=e.split(" ");if(t.length>4)return null;for(var n=[],i=0;i<t.length;i++){var a=r.parseLength(t[i]);if(!a)return null;n.push(a)}return n},function(t,n,i,a,s){var o;if(1===a.length)o=[a[0],a[0],a[0],a[0]];else if(2===a.length)o=[a[0],a[1],a[0],a[1]];else if(3===a.length)o=[a[0],a[1],a[2],a[1]];else{if(4!==a.length)return null;o=[a[0],a[1],a[2],a[3]]}var l=i.styleAttrs[e.byName.writingMode.qname];if("lrtb"===l||"lr"===l)o=[o[0],o[3],o[2],o[1]];else if("rltb"===l||"rl"===l)o=[o[0],o[1],o[2],o[3]];else if("tblr"===l)o=[o[3],o[0],o[1],o[2]];else{if("tbrl"!==l&&"tb"!==l)return null;o=[o[3],o[2],o[1],o[0]]}for(var u=[],c=0;c<o.length;c++)if(0===o[c].value)u[c]=new r.ComputedLength(0,0);else if(u[c]=r.toComputedLength(o[c].value,o[c].unit,i.styleAttrs[e.byName.fontSize.qname],0===c||2===c?i.styleAttrs[e.byName.extent.qname].h:i.styleAttrs[e.byName.extent.qname].w,0===c||2===c?t.cellLength.h:t.cellLength.w,0===c||2===c?t.pxLength.h:t.pxLength.w),null===u[c])return null;return u}),new n(t.ns_tts,"position","top left",["region"],!1,!0,function(e){return r.parsePosition(e)},function(t,n,i,a){var s,o;return null===(s=r.toComputedLength(a.v.offset.value,a.v.offset.unit,null,new r.ComputedLength(-i.styleAttrs[e.byName.extent.qname].h.rw,t.dimensions.h.rh-i.styleAttrs[e.byName.extent.qname].h.rh),null,t.pxLength.h))?null:("bottom"===a.v.edge&&(s=new r.ComputedLength(-s.rw-i.styleAttrs[e.byName.extent.qname].h.rw,t.dimensions.h.rh-s.rh-i.styleAttrs[e.byName.extent.qname].h.rh)),o=r.toComputedLength(a.h.offset.value,a.h.offset.unit,null,new r.ComputedLength(t.dimensions.w.rw-i.styleAttrs[e.byName.extent.qname].w.rw,-i.styleAttrs[e.byName.extent.qname].w.rh),null,t.pxLength.w),null===s?null:("right"===a.h.edge&&(o=new r.ComputedLength(t.dimensions.w.rw-o.rw-i.styleAttrs[e.byName.extent.qname].w.rw,-o.rh-i.styleAttrs[e.byName.extent.qname].w.rh)),{h:s,w:o}))}),new n(t.ns_tts,"ruby","none",["span"],!1,!0,function(e){return e},null),new n(t.ns_tts,"rubyAlign","center",["span"],!0,!0,function(e){return"center"!==e&&"spaceAround"!==e?null:e},null),new n(t.ns_tts,"rubyPosition","outside",["span"],!0,!0,function(e){return e},null),new n(t.ns_tts,"rubyReserve","none",["p"],!0,!0,function(e){var t=e.split(" "),n=[null,null];if(0===t.length||t.length>2)return null;if("none"!==t[0]&&"both"!==t[0]&&"after"!==t[0]&&"before"!==t[0]&&"outside"!==t[0])return null;if(n[0]=t[0],2===t.length&&"none"!==t[0]){var i=r.parseLength(t[1]);if(!i)return null;n[1]=i}return n},function(t,n,i,a,s){return"none"===a[0]?a:null===(o=null===a[1]?new r.ComputedLength(.5*i.styleAttrs[e.byName.fontSize.qname].rw,.5*i.styleAttrs[e.byName.fontSize.qname].rh):r.toComputedLength(a[1].value,a[1].unit,i.styleAttrs[e.byName.fontSize.qname],i.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h))?null:[a[0],o];var o}),new n(t.ns_tts,"showBackground","always",["region"],!1,!0,function(e){return e},null),new n(t.ns_tts,"textAlign","start",["p"],!0,!0,function(e){return e},function(e,t,r,n,i){return"left"===n?"start":"right"===n?"end":n}),new n(t.ns_tts,"textCombine","none",["span"],!0,!0,function(e){return"none"===e||"all"===e?e:null},null),new n(t.ns_tts,"textDecoration","none",["span"],!0,!0,function(e){return e.split(" ")},null),new n(t.ns_tts,"textEmphasis","none",["span"],!0,!0,function(e){for(var t=e.split(" "),n={style:null,symbol:null,color:null,position:null},i=0;i<t.length;i++)if("none"===t[i]||"auto"===t[i])n.style=t[i];else if("filled"===t[i]||"open"===t[i])n.style=t[i];else if("circle"===t[i]||"dot"===t[i]||"sesame"===t[i])n.symbol=t[i];else if("current"===t[i])n.color=t[i];else if("outside"===t[i]||"before"===t[i]||"after"===t[i])n.position=t[i];else if(n.color=r.parseColor(t[i]),null===n.color)return null;return null==n.style&&null==n.symbol?n.style="auto":(n.symbol=n.symbol||"circle",n.style=n.style||"filled"),n.position=n.position||"outside",n.color=n.color||"current",n},null),new n(t.ns_tts,"textOutline","none",["span"],!0,!0,function(e){if("none"===e)return e;var t={},n=e.split(" ");if(0===n.length||n.length>2)return null;var i=r.parseColor(n[0]);if(t.color=i,null!==i&&n.shift(),1!==n.length)return null;var a=r.parseLength(n[0]);return a?(t.thickness=a,t):null},function(t,n,i,a,s){if("none"===a)return a;var o={};return null===a.color?o.color=i.styleAttrs[e.byName.color.qname]:o.color=a.color,o.thickness=r.toComputedLength(a.thickness.value,a.thickness.unit,i.styleAttrs[e.byName.fontSize.qname],i.styleAttrs[e.byName.fontSize.qname],t.cellLength.h,t.pxLength.h),null===o.thickness?null:o}),new n(t.ns_tts,"textShadow","none",["span"],!0,!0,r.parseTextShadow,function(t,n,i,a){if("none"===a)return a;for(var s=[],o=0;o<a.length;o++){var l={};if(l.x_off=r.toComputedLength(a[o][0].value,a[o][0].unit,null,i.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.w),null===l.x_off)return null;if(l.y_off=r.toComputedLength(a[o][1].value,a[o][1].unit,null,i.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.h),null===l.y_off)return null;if(null===a[o][2])l.b_radius=0;else if(l.b_radius=r.toComputedLength(a[o][2].value,a[o][2].unit,null,i.styleAttrs[e.byName.fontSize.qname],null,t.pxLength.h),null===l.b_radius)return null;null===a[o][3]?l.color=i.styleAttrs[e.byName.color.qname]:l.color=a[o][3],s.push(l)}return s}),new n(t.ns_tts,"unicodeBidi","normal",["span","p"],!1,!0,function(e){return e},null),new n(t.ns_tts,"visibility","visible",["body","div","p","region","span"],!0,!0,function(e){return e},null),new n(t.ns_tts,"wrapOption","wrap",["span"],!0,!0,function(e){return e},null),new n(t.ns_tts,"writingMode","lrtb",["region"],!1,!0,function(e){return e},null),new n(t.ns_tts,"zIndex","auto",["region"],!1,!0,function(e){var t;return"auto"===e?t=e:(t=parseInt(e),isNaN(t)&&(t=null)),t},null),new n(t.ns_ebutts,"linePadding","0c",["p"],!0,!1,r.parseLength,function(e,t,n,i,a){return r.toComputedLength(i.value,i.unit,null,null,e.cellLength.w,null)}),new n(t.ns_ebutts,"multiRowAlign","auto",["p"],!0,!1,function(e){return e},null),new n(t.ns_smpte,"backgroundImage",null,["div"],!1,!1,function(e){return e},null),new n(t.ns_itts,"forcedDisplay","false",["body","div","p","region","span"],!0,!0,function(e){return"true"===e},null),new n(t.ns_itts,"fillLineGap","false",["p"],!0,!0,function(e){return"true"===e},null)],e.byQName={},e.all)e.byQName[e.all[i].qname]=e.all[i];for(var a in e.byName={},e.all)e.byName[e.all[a].name]=e.all[a]}(t,"undefined"==typeof imscNames?r(210):imscNames,"undefined"==typeof imscUtils?r(5926):imscUtils)},5926:function(e,t){!function(e){var t=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})?/,r=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,n=/rgba\(\s*(\d+),\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/,i={transparent:[0,0,0,0],black:[0,0,0,255],silver:[192,192,192,255],gray:[128,128,128,255],white:[255,255,255,255],maroon:[128,0,0,255],red:[255,0,0,255],purple:[128,0,128,255],fuchsia:[255,0,255,255],magenta:[255,0,255,255],green:[0,128,0,255],lime:[0,255,0,255],olive:[128,128,0,255],yellow:[255,255,0,255],navy:[0,0,128,255],blue:[0,0,255,255],teal:[0,128,128,255],aqua:[0,255,255,255],cyan:[0,255,255,255]};e.parseColor=function(e){var a,s=null,o=i[e.toLowerCase()];return void 0!==o?s=o:null!==(a=t.exec(e))?s=[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16),void 0!==a[4]?parseInt(a[4],16):255]:null!==(a=r.exec(e))?s=[parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),255]:null!==(a=n.exec(e))&&(s=[parseInt(a[1]),parseInt(a[2]),parseInt(a[3]),parseInt(a[4])]),s};var a=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/;e.parseLength=function(e){var t,r=null;return null!==(t=a.exec(e))&&(r={value:parseFloat(t[1]),unit:t[2]}),r},e.parseTextShadow=function(t){for(var r=t.match(/([^\(,\)]|\([^\)]+\))+/g),n=[],i=0;i<r.length;i++){var a=r[i].split(" ");if(1===a.length&&"none"===a[0])return"none";if(a.length>1&&a.length<5){var s=[null,null,null,null],o=e.parseLength(a.shift());if(null===o)return null;if(s[0]=o,null===(o=e.parseLength(a.shift())))return null;if(s[1]=o,0===a.length){n.push(s);continue}if(null!==(o=e.parseLength(a[0]))&&(s[2]=o,a.shift()),0===a.length){n.push(s);continue}var l=e.parseColor(a[0]);if(null===l)return null;s[3]=l,n.push(s)}}return n},e.parsePosition=function(t){var r=t.split(" "),n=function(e){return"center"===e||"left"===e||"top"===e||"bottom"===e||"right"===e};if(r.length>4)return null;for(var i=0;i<r.length;i++)if(!n(r[i])){var a=e.parseLength(r[i]);if(null===a)return null;r[i]=a}for(var s={h:{edge:"left",offset:{value:50,unit:"%"}},v:{edge:"top",offset:{value:50,unit:"%"}}},o=0;o<r.length;){var l=r[o++];if(n(l)){var u={value:0,unit:"%"};2!==r.length&&o<r.length&&!n(r[o])&&(u=r[o++]),"right"===l?(s.h.edge=l,s.h.offset=u):"bottom"===l?(s.v.edge=l,s.v.offset=u):"left"===l?s.h.offset=u:"top"===l&&(s.v.offset=u)}else{if(1!==r.length&&2!==r.length)return null;1===o?s.h.offset=l:s.v.offset=l}}return s},e.ComputedLength=function(e,t){this.rw=e,this.rh=t},e.ComputedLength.prototype.toUsedLength=function(e,t){return e*this.rw+t*this.rh},e.ComputedLength.prototype.isZero=function(){return 0===this.rw&&0===this.rh},e.toComputedLength=function(t,r,n,i,a,s){return"%"===r&&i?new e.ComputedLength(i.rw*t/100,i.rh*t/100):"em"===r&&n?new e.ComputedLength(n.rw*t,n.rh*t):"c"===r&&a?new e.ComputedLength(t*a.rw,t*a.rh):"px"===r&&s?new e.ComputedLength(t*s.rw,t*s.rh):"rh"===r?new e.ComputedLength(0,t/100):"rw"===r?new e.ComputedLength(t/100,0):null}}(t)},3516:function(e){e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=97&&t<=122||t>=65&&t<=90}},2219:function(e,t,r){var n=r(3516),i=r(395);e.exports=function(e){return n(e)||i(e)}},395:function(e){e.exports=function(e){var t="string"==typeof e?e.charCodeAt(0):e;return t>=48&&t<=57}},3875:function(e){function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function r(e,t){for(var r,n="",i=0,a=-1,s=0,o=0;o<=e.length;++o){if(o<e.length)r=e.charCodeAt(o);else{if(47===r)break;r=47}if(47===r){if(a===o-1||1===s);else if(a!==o-1&&2===s){if(n.length<2||2!==i||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var l=n.lastIndexOf("/");if(l!==n.length-1){-1===l?(n="",i=0):i=(n=n.slice(0,l)).length-1-n.lastIndexOf("/"),a=o,s=0;continue}}else if(2===n.length||1===n.length){n="",i=0,a=o,s=0;continue}t&&(n.length>0?n+="/..":n="..",i=2)}else n.length>0?n+="/"+e.slice(a+1,o):n=e.slice(a+1,o),i=o-a-1;a=o,s=0}else 46===r&&-1!==s?++s:s=-1}return n}var n={resolve:function(){for(var e,n="",i=!1,a=arguments.length-1;a>=-1&&!i;a--){var s;a>=0?s=arguments[a]:(void 0===e&&(e=process.cwd()),s=e),t(s),0!==s.length&&(n=s+"/"+n,i=47===s.charCodeAt(0))}return n=r(n,!i),i?n.length>0?"/"+n:"/":n.length>0?n:"."},normalize:function(e){if(t(e),0===e.length)return".";var n=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return 0!==(e=r(e,!n)).length||n||(e="."),e.length>0&&i&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,r=0;r<arguments.length;++r){var i=arguments[r];t(i),i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":n.normalize(e)},relative:function(e,r){if(t(e),t(r),e===r)return"";if((e=n.resolve(e))===(r=n.resolve(r)))return"";for(var i=1;i<e.length&&47===e.charCodeAt(i);++i);for(var a=e.length,s=a-i,o=1;o<r.length&&47===r.charCodeAt(o);++o);for(var l=r.length-o,u=s<l?s:l,c=-1,d=0;d<=u;++d){if(d===u){if(l>u){if(47===r.charCodeAt(o+d))return r.slice(o+d+1);if(0===d)return r.slice(o+d)}else s>u&&(47===e.charCodeAt(i+d)?c=d:0===d&&(c=0));break}var f=e.charCodeAt(i+d);if(f!==r.charCodeAt(o+d))break;47===f&&(c=d)}var h="";for(d=i+c+1;d<=a;++d)d!==a&&47!==e.charCodeAt(d)||(0===h.length?h+="..":h+="/..");return h.length>0?h+r.slice(o+c):(o+=c,47===r.charCodeAt(o)&&++o,r.slice(o))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var r=e.charCodeAt(0),n=47===r,i=-1,a=!0,s=e.length-1;s>=1;--s)if(47===(r=e.charCodeAt(s))){if(!a){i=s;break}}else a=!1;return-1===i?n?"/":".":n&&1===i?"//":e.slice(0,i)},basename:function(e,r){if(void 0!==r&&"string"!=typeof r)throw new TypeError('"ext" argument must be a string');t(e);var n,i=0,a=-1,s=!0;if(void 0!==r&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var o=r.length-1,l=-1;for(n=e.length-1;n>=0;--n){var u=e.charCodeAt(n);if(47===u){if(!s){i=n+1;break}}else-1===l&&(s=!1,l=n+1),o>=0&&(u===r.charCodeAt(o)?-1==--o&&(a=n):(o=-1,a=l))}return i===a?a=l:-1===a&&(a=e.length),e.slice(i,a)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!s){i=n+1;break}}else-1===a&&(s=!1,a=n+1);return-1===a?"":e.slice(i,a)},extname:function(e){t(e);for(var r=-1,n=0,i=-1,a=!0,s=0,o=e.length-1;o>=0;--o){var l=e.charCodeAt(o);if(47!==l)-1===i&&(a=!1,i=o+1),46===l?-1===r?r=o:1!==s&&(s=1):-1!==r&&(s=-1);else if(!a){n=o+1;break}}return-1===r||-1===i||0===s||1===s&&r===i-1&&r===n+1?"":e.slice(r,i)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var r=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return r?r===t.root?r+n:r+"/"+n:n}(0,e)},parse:function(e){t(e);var r={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return r;var n,i=e.charCodeAt(0),a=47===i;a?(r.root="/",n=1):n=0;for(var s=-1,o=0,l=-1,u=!0,c=e.length-1,d=0;c>=n;--c)if(47!==(i=e.charCodeAt(c)))-1===l&&(u=!1,l=c+1),46===i?-1===s?s=c:1!==d&&(d=1):-1!==s&&(d=-1);else if(!u){o=c+1;break}return-1===s||-1===l||0===d||1===d&&s===l-1&&s===o+1?-1!==l&&(r.base=r.name=0===o&&a?e.slice(1,l):e.slice(o,l)):(0===o&&a?(r.name=e.slice(1,s),r.base=e.slice(1,l)):(r.name=e.slice(o,s),r.base=e.slice(o,l)),r.ext=e.slice(s,l)),o>0?r.dir=e.slice(0,o-1):a&&(r.dir="/"),r},sep:"/",delimiter:":",win32:null,posix:null};n.posix=n,e.exports=n},8387:function(e,t,r){var n=r(1549),i=n.Buffer;function a(e,t){for(var r in e)t[r]=e[r]}function s(e,t,r){return i(e,t,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=s),a(i,s),s.from=function(e,t,r){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,r)},s.alloc=function(e,t,r){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=i(e);return void 0!==t?"string"==typeof r?n.fill(t,r):n.fill(t):n.fill(0),n},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},5378:function(e,t,r){!function(e){e.parser=function(e,t){return new i(e,t)},e.SAXParser=i,e.SAXStream=s,e.createStream=function(e,t){return new s(e,t)},e.MAX_BUFFER_LENGTH=65536;var t,n=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function i(t,r){if(!(this instanceof i))return new i(t,r);var a=this;!function(e){for(var t=0,r=n.length;t<r;t++)e[n[t]]=""}(a),a.q=a.c="",a.bufferCheckPosition=e.MAX_BUFFER_LENGTH,a.opt=r||{},a.opt.lowercase=a.opt.lowercase||a.opt.lowercasetags,a.looseCase=a.opt.lowercase?"toLowerCase":"toUpperCase",a.tags=[],a.closed=a.closedRoot=a.sawRoot=!1,a.tag=a.error=null,a.strict=!!t,a.noscript=!(!t&&!a.opt.noscript),a.state=I.BEGIN,a.strictEntities=a.opt.strictEntities,a.ENTITIES=a.strictEntities?Object.create(e.XML_ENTITIES):Object.create(e.ENTITIES),a.attribList=[],a.opt.xmlns&&(a.ns=Object.create(g)),a.trackPosition=!1!==a.opt.position,a.trackPosition&&(a.position=a.line=a.column=0),w(a,"onready")}e.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t}),Object.keys||(Object.keys=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}),i.prototype={end:function(){P(this)},write:function(t){var r=this;if(this.error)throw this.error;if(r.closed)return N(r,"Cannot write after close. Assign an onready handler.");if(null===t)return P(r);"object"==typeof t&&(t=t.toString());for(var i=0,a="";a=G(t,i++),r.c=a,a;)switch(r.trackPosition&&(r.position++,"\n"===a?(r.line++,r.column=0):r.column++),r.state){case I.BEGIN:if(r.state=I.BEGIN_WHITESPACE,"\ufeff"===a)continue;Z(r,a);continue;case I.BEGIN_WHITESPACE:Z(r,a);continue;case I.TEXT:if(r.sawRoot&&!r.closedRoot){for(var s=i-1;a&&"<"!==a&&"&"!==a;)(a=G(t,i++))&&r.trackPosition&&(r.position++,"\n"===a?(r.line++,r.column=0):r.column++);r.textNode+=t.substring(s,i-1)}"<"!==a||r.sawRoot&&r.closedRoot&&!r.strict?(!_(o,a)||r.sawRoot&&!r.closedRoot||O(r,"Text data outside of root node."),"&"===a?r.state=I.TEXT_ENTITY:r.textNode+=a):(r.state=I.OPEN_WAKA,r.startTagPosition=r.position);continue;case I.SCRIPT:"<"===a?r.state=I.SCRIPT_ENDING:r.script+=a;continue;case I.SCRIPT_ENDING:"/"===a?r.state=I.CLOSE_TAG:(r.script+="<"+a,r.state=I.SCRIPT);continue;case I.OPEN_WAKA:if("!"===a)r.state=I.SGML_DECL,r.sgmlDecl="";else if(T(o,a));else if(T(p,a))r.state=I.OPEN_TAG,r.tagName=a;else if("/"===a)r.state=I.CLOSE_TAG,r.tagName="";else if("?"===a)r.state=I.PROC_INST,r.procInstName=r.procInstBody="";else{if(O(r,"Unencoded <"),r.startTagPosition+1<r.position){var l=r.position-r.startTagPosition;a=new Array(l).join(" ")+a}r.textNode+="<"+a,r.state=I.TEXT}continue;case I.SGML_DECL:"[CDATA["===(r.sgmlDecl+a).toUpperCase()?(D(r,"onopencdata"),r.state=I.CDATA,r.sgmlDecl="",r.cdata=""):r.sgmlDecl+a==="--"?(r.state=I.COMMENT,r.comment="",r.sgmlDecl=""):"DOCTYPE"===(r.sgmlDecl+a).toUpperCase()?(r.state=I.DOCTYPE,(r.doctype||r.sawRoot)&&O(r,"Inappropriately located doctype declaration"),r.doctype="",r.sgmlDecl=""):">"===a?(D(r,"onsgmldeclaration",r.sgmlDecl),r.sgmlDecl="",r.state=I.TEXT):T(c,a)?(r.state=I.SGML_DECL_QUOTED,r.sgmlDecl+=a):r.sgmlDecl+=a;continue;case I.SGML_DECL_QUOTED:a===r.q&&(r.state=I.SGML_DECL,r.q=""),r.sgmlDecl+=a;continue;case I.DOCTYPE:">"===a?(r.state=I.TEXT,D(r,"ondoctype",r.doctype),r.doctype=!0):(r.doctype+=a,"["===a?r.state=I.DOCTYPE_DTD:T(c,a)&&(r.state=I.DOCTYPE_QUOTED,r.q=a));continue;case I.DOCTYPE_QUOTED:r.doctype+=a,a===r.q&&(r.q="",r.state=I.DOCTYPE);continue;case I.DOCTYPE_DTD:r.doctype+=a,"]"===a?r.state=I.DOCTYPE:T(c,a)&&(r.state=I.DOCTYPE_DTD_QUOTED,r.q=a);continue;case I.DOCTYPE_DTD_QUOTED:r.doctype+=a,a===r.q&&(r.state=I.DOCTYPE_DTD,r.q="");continue;case I.COMMENT:"-"===a?r.state=I.COMMENT_ENDING:r.comment+=a;continue;case I.COMMENT_ENDING:"-"===a?(r.state=I.COMMENT_ENDED,r.comment=C(r.opt,r.comment),r.comment&&D(r,"oncomment",r.comment),r.comment=""):(r.comment+="-"+a,r.state=I.COMMENT);continue;case I.COMMENT_ENDED:">"!==a?(O(r,"Malformed comment"),r.comment+="--"+a,r.state=I.COMMENT):r.state=I.TEXT;continue;case I.CDATA:"]"===a?r.state=I.CDATA_ENDING:r.cdata+=a;continue;case I.CDATA_ENDING:"]"===a?r.state=I.CDATA_ENDING_2:(r.cdata+="]"+a,r.state=I.CDATA);continue;case I.CDATA_ENDING_2:">"===a?(r.cdata&&D(r,"oncdata",r.cdata),D(r,"onclosecdata"),r.cdata="",r.state=I.TEXT):"]"===a?r.cdata+="]":(r.cdata+="]]"+a,r.state=I.CDATA);continue;case I.PROC_INST:"?"===a?r.state=I.PROC_INST_ENDING:T(o,a)?r.state=I.PROC_INST_BODY:r.procInstName+=a;continue;case I.PROC_INST_BODY:if(!r.procInstBody&&T(o,a))continue;"?"===a?r.state=I.PROC_INST_ENDING:r.procInstBody+=a;continue;case I.PROC_INST_ENDING:">"===a?(D(r,"onprocessinginstruction",{name:r.procInstName,body:r.procInstBody}),r.procInstName=r.procInstBody="",r.state=I.TEXT):(r.procInstBody+="?"+a,r.state=I.PROC_INST_BODY);continue;case I.OPEN_TAG:T(m,a)?r.tagName+=a:(M(r),">"===a?F(r):"/"===a?r.state=I.OPEN_TAG_SLASH:(_(o,a)&&O(r,"Invalid character in tag name"),r.state=I.ATTRIB));continue;case I.OPEN_TAG_SLASH:">"===a?(F(r,!0),B(r)):(O(r,"Forward-slash in opening tag not followed by >"),r.state=I.ATTRIB);continue;case I.ATTRIB:if(T(o,a))continue;">"===a?F(r):"/"===a?r.state=I.OPEN_TAG_SLASH:T(p,a)?(r.attribName=a,r.attribValue="",r.state=I.ATTRIB_NAME):O(r,"Invalid attribute name");continue;case I.ATTRIB_NAME:"="===a?r.state=I.ATTRIB_VALUE:">"===a?(O(r,"Attribute without value"),r.attribValue=r.attribName,x(r),F(r)):T(o,a)?r.state=I.ATTRIB_NAME_SAW_WHITE:T(m,a)?r.attribName+=a:O(r,"Invalid attribute name");continue;case I.ATTRIB_NAME_SAW_WHITE:if("="===a)r.state=I.ATTRIB_VALUE;else{if(T(o,a))continue;O(r,"Attribute without value"),r.tag.attributes[r.attribName]="",r.attribValue="",D(r,"onattribute",{name:r.attribName,value:""}),r.attribName="",">"===a?F(r):T(p,a)?(r.attribName=a,r.state=I.ATTRIB_NAME):(O(r,"Invalid attribute name"),r.state=I.ATTRIB)}continue;case I.ATTRIB_VALUE:if(T(o,a))continue;T(c,a)?(r.q=a,r.state=I.ATTRIB_VALUE_QUOTED):(O(r,"Unquoted attribute value"),r.state=I.ATTRIB_VALUE_UNQUOTED,r.attribValue=a);continue;case I.ATTRIB_VALUE_QUOTED:if(a!==r.q){"&"===a?r.state=I.ATTRIB_VALUE_ENTITY_Q:r.attribValue+=a;continue}x(r),r.q="",r.state=I.ATTRIB_VALUE_CLOSED;continue;case I.ATTRIB_VALUE_CLOSED:T(o,a)?r.state=I.ATTRIB:">"===a?F(r):"/"===a?r.state=I.OPEN_TAG_SLASH:T(p,a)?(O(r,"No whitespace between attributes"),r.attribName=a,r.attribValue="",r.state=I.ATTRIB_NAME):O(r,"Invalid attribute name");continue;case I.ATTRIB_VALUE_UNQUOTED:if(_(d,a)){"&"===a?r.state=I.ATTRIB_VALUE_ENTITY_U:r.attribValue+=a;continue}x(r),">"===a?F(r):r.state=I.ATTRIB;continue;case I.CLOSE_TAG:if(r.tagName)">"===a?B(r):T(m,a)?r.tagName+=a:r.script?(r.script+="</"+r.tagName,r.tagName="",r.state=I.SCRIPT):(_(o,a)&&O(r,"Invalid tagname in closing tag"),r.state=I.CLOSE_TAG_SAW_WHITE);else{if(T(o,a))continue;_(p,a)?r.script?(r.script+="</"+a,r.state=I.SCRIPT):O(r,"Invalid tagname in closing tag."):r.tagName=a}continue;case I.CLOSE_TAG_SAW_WHITE:if(T(o,a))continue;">"===a?B(r):O(r,"Invalid characters in closing tag");continue;case I.TEXT_ENTITY:case I.ATTRIB_VALUE_ENTITY_Q:case I.ATTRIB_VALUE_ENTITY_U:var u,f;switch(r.state){case I.TEXT_ENTITY:u=I.TEXT,f="textNode";break;case I.ATTRIB_VALUE_ENTITY_Q:u=I.ATTRIB_VALUE_QUOTED,f="attribValue";break;case I.ATTRIB_VALUE_ENTITY_U:u=I.ATTRIB_VALUE_UNQUOTED,f="attribValue"}";"===a?(r[f]+=U(r),r.entity="",r.state=u):T(r.entity.length?y:v,a)?r.entity+=a:(O(r,"Invalid character in entity name"),r[f]+="&"+r.entity+a,r.entity="",r.state=u);continue;default:throw new Error(r,"Unknown state: "+r.state)}return r.position>=r.bufferCheckPosition&&function(t){for(var r=Math.max(e.MAX_BUFFER_LENGTH,10),i=0,a=0,s=n.length;a<s;a++){var o=t[n[a]].length;if(o>r)switch(n[a]){case"textNode":L(t);break;case"cdata":D(t,"oncdata",t.cdata),t.cdata="";break;case"script":D(t,"onscript",t.script),t.script="";break;default:N(t,"Max buffer length exceeded: "+n[a])}i=Math.max(i,o)}var l=e.MAX_BUFFER_LENGTH-i;t.bufferCheckPosition=l+t.position}(r),r},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var e;L(e=this),""!==e.cdata&&(D(e,"oncdata",e.cdata),e.cdata=""),""!==e.script&&(D(e,"onscript",e.script),e.script="")}};try{t=r(182).Stream}catch(e){t=function(){}}var a=e.EVENTS.filter(function(e){return"error"!==e&&"end"!==e});function s(e,r){if(!(this instanceof s))return new s(e,r);t.apply(this),this._parser=new i(e,r),this.writable=!0,this.readable=!0;var n=this;this._parser.onend=function(){n.emit("end")},this._parser.onerror=function(e){n.emit("error",e),n._parser.error=null},this._decoder=null,a.forEach(function(e){Object.defineProperty(n,"on"+e,{get:function(){return n._parser["on"+e]},set:function(t){if(!t)return n.removeAllListeners(e),n._parser["on"+e]=t,t;n.on(e,t)},enumerable:!0,configurable:!1})})}s.prototype=Object.create(t.prototype,{constructor:{value:s}}),s.prototype.write=function(e){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(e)){if(!this._decoder){var t=r(7503).s;this._decoder=new t("utf8")}e=this._decoder.write(e)}return this._parser.write(e.toString()),this.emit("data",e),!0},s.prototype.end=function(e){return e&&e.length&&this.write(e),this._parser.end(),!0},s.prototype.on=function(e,r){var n=this;return n._parser["on"+e]||-1===a.indexOf(e)||(n._parser["on"+e]=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);t.splice(0,0,e),n.emit.apply(n,t)}),t.prototype.on.call(n,e,r)};var o="\r\n\t ",l="0124356789",u="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",c="'\"",d=o+">",f="http://www.w3.org/XML/1998/namespace",h="http://www.w3.org/2000/xmlns/",g={xml:f,xmlns:h};o=E(o),l=E(l),u=E(u);var p=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,m=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/,v=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,y=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;function E(e){return e.split("").reduce(function(e,t){return e[t]=!0,e},{})}function T(e,t){return function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}(e)?!!t.match(e):e[t]}function _(e,t){return!T(e,t)}c=E(c),d=E(d);var S,b,A,I=0;for(var R in e.STATE={BEGIN:I++,BEGIN_WHITESPACE:I++,TEXT:I++,TEXT_ENTITY:I++,OPEN_WAKA:I++,SGML_DECL:I++,SGML_DECL_QUOTED:I++,DOCTYPE:I++,DOCTYPE_QUOTED:I++,DOCTYPE_DTD:I++,DOCTYPE_DTD_QUOTED:I++,COMMENT_STARTING:I++,COMMENT:I++,COMMENT_ENDING:I++,COMMENT_ENDED:I++,CDATA:I++,CDATA_ENDING:I++,CDATA_ENDING_2:I++,PROC_INST:I++,PROC_INST_BODY:I++,PROC_INST_ENDING:I++,OPEN_TAG:I++,OPEN_TAG_SLASH:I++,ATTRIB:I++,ATTRIB_NAME:I++,ATTRIB_NAME_SAW_WHITE:I++,ATTRIB_VALUE:I++,ATTRIB_VALUE_QUOTED:I++,ATTRIB_VALUE_CLOSED:I++,ATTRIB_VALUE_UNQUOTED:I++,ATTRIB_VALUE_ENTITY_Q:I++,ATTRIB_VALUE_ENTITY_U:I++,CLOSE_TAG:I++,CLOSE_TAG_SAW_WHITE:I++,SCRIPT:I++,SCRIPT_ENDING:I++},e.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},e.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(e.ENTITIES).forEach(function(t){var r=e.ENTITIES[t],n="number"==typeof r?String.fromCharCode(r):r;e.ENTITIES[t]=n}),e.STATE)e.STATE[e.STATE[R]]=R;function w(e,t,r){e[t]&&e[t](r)}function D(e,t,r){e.textNode&&L(e),w(e,t,r)}function L(e){e.textNode=C(e.opt,e.textNode),e.textNode&&w(e,"ontext",e.textNode),e.textNode=""}function C(e,t){return e.trim&&(t=t.trim()),e.normalize&&(t=t.replace(/\s+/g," ")),t}function N(e,t){return L(e),e.trackPosition&&(t+="\nLine: "+e.line+"\nColumn: "+e.column+"\nChar: "+e.c),t=new Error(t),e.error=t,w(e,"onerror",t),e}function P(e){return e.sawRoot&&!e.closedRoot&&O(e,"Unclosed root tag"),e.state!==I.BEGIN&&e.state!==I.BEGIN_WHITESPACE&&e.state!==I.TEXT&&N(e,"Unexpected end"),L(e),e.c="",e.closed=!0,w(e,"onend"),i.call(e,e.strict,e.opt),e}function O(e,t){if("object"!=typeof e||!(e instanceof i))throw new Error("bad call to strictFail");e.strict&&N(e,t)}function M(e){e.strict||(e.tagName=e.tagName[e.looseCase]());var t=e.tags[e.tags.length-1]||e,r=e.tag={name:e.tagName,attributes:{}};e.opt.xmlns&&(r.ns=t.ns),e.attribList.length=0,D(e,"onopentagstart",r)}function k(e,t){var r=e.indexOf(":")<0?["",e]:e.split(":"),n=r[0],i=r[1];return t&&"xmlns"===e&&(n="xmlns",i=""),{prefix:n,local:i}}function x(e){if(e.strict||(e.attribName=e.attribName[e.looseCase]()),-1!==e.attribList.indexOf(e.attribName)||e.tag.attributes.hasOwnProperty(e.attribName))e.attribName=e.attribValue="";else{if(e.opt.xmlns){var t=k(e.attribName,!0),r=t.prefix,n=t.local;if("xmlns"===r)if("xml"===n&&e.attribValue!==f)O(e,"xml: prefix must be bound to "+f+"\nActual: "+e.attribValue);else if("xmlns"===n&&e.attribValue!==h)O(e,"xmlns: prefix must be bound to "+h+"\nActual: "+e.attribValue);else{var i=e.tag,a=e.tags[e.tags.length-1]||e;i.ns===a.ns&&(i.ns=Object.create(a.ns)),i.ns[n]=e.attribValue}e.attribList.push([e.attribName,e.attribValue])}else e.tag.attributes[e.attribName]=e.attribValue,D(e,"onattribute",{name:e.attribName,value:e.attribValue});e.attribName=e.attribValue=""}}function F(e,t){if(e.opt.xmlns){var r=e.tag,n=k(e.tagName);r.prefix=n.prefix,r.local=n.local,r.uri=r.ns[n.prefix]||"",r.prefix&&!r.uri&&(O(e,"Unbound namespace prefix: "+JSON.stringify(e.tagName)),r.uri=n.prefix);var i=e.tags[e.tags.length-1]||e;r.ns&&i.ns!==r.ns&&Object.keys(r.ns).forEach(function(t){D(e,"onopennamespace",{prefix:t,uri:r.ns[t]})});for(var a=0,s=e.attribList.length;a<s;a++){var o=e.attribList[a],l=o[0],u=o[1],c=k(l,!0),d=c.prefix,f=c.local,h=""===d?"":r.ns[d]||"",g={name:l,value:u,prefix:d,local:f,uri:h};d&&"xmlns"!==d&&!h&&(O(e,"Unbound namespace prefix: "+JSON.stringify(d)),g.uri=d),e.tag.attributes[l]=g,D(e,"onattribute",g)}e.attribList.length=0}e.tag.isSelfClosing=!!t,e.sawRoot=!0,e.tags.push(e.tag),D(e,"onopentag",e.tag),t||(e.noscript||"script"!==e.tagName.toLowerCase()?e.state=I.TEXT:e.state=I.SCRIPT,e.tag=null,e.tagName=""),e.attribName=e.attribValue="",e.attribList.length=0}function B(e){if(!e.tagName)return O(e,"Weird empty close tag."),e.textNode+="</>",void(e.state=I.TEXT);if(e.script){if("script"!==e.tagName)return e.script+="</"+e.tagName+">",e.tagName="",void(e.state=I.SCRIPT);D(e,"onscript",e.script),e.script=""}var t=e.tags.length,r=e.tagName;e.strict||(r=r[e.looseCase]());for(var n=r;t--&&e.tags[t].name!==n;)O(e,"Unexpected close tag");if(t<0)return O(e,"Unmatched closing tag: "+e.tagName),e.textNode+="</"+e.tagName+">",void(e.state=I.TEXT);e.tagName=r;for(var i=e.tags.length;i-- >t;){var a=e.tag=e.tags.pop();e.tagName=e.tag.name,D(e,"onclosetag",e.tagName);var s={};for(var o in a.ns)s[o]=a.ns[o];var l=e.tags[e.tags.length-1]||e;e.opt.xmlns&&a.ns!==l.ns&&Object.keys(a.ns).forEach(function(t){var r=a.ns[t];D(e,"onclosenamespace",{prefix:t,uri:r})})}0===t&&(e.closedRoot=!0),e.tagName=e.attribValue=e.attribName="",e.attribList.length=0,e.state=I.TEXT}function U(e){var t,r=e.entity,n=r.toLowerCase(),i="";return e.ENTITIES[r]?e.ENTITIES[r]:e.ENTITIES[n]?e.ENTITIES[n]:("#"===(r=n).charAt(0)&&("x"===r.charAt(1)?(r=r.slice(2),i=(t=parseInt(r,16)).toString(16)):(r=r.slice(1),i=(t=parseInt(r,10)).toString(10))),r=r.replace(/^0+/,""),i.toLowerCase()!==r?(O(e,"Invalid character entity"),"&"+e.entity+";"):String.fromCodePoint(t))}function Z(e,t){"<"===t?(e.state=I.OPEN_WAKA,e.startTagPosition=e.position):_(o,t)&&(O(e,"Non-whitespace before first tag."),e.textNode=t,e.state=I.TEXT)}function G(e,t){var r="";return t<e.length&&(r=e.charAt(t)),r}I=e.STATE,String.fromCodePoint||(S=String.fromCharCode,b=Math.floor,A=function(){var e,t,r=16384,n=[],i=-1,a=arguments.length;if(!a)return"";for(var s="";++i<a;){var o=Number(arguments[i]);if(!isFinite(o)||o<0||o>1114111||b(o)!==o)throw RangeError("Invalid code point: "+o);o<=65535?n.push(o):(e=55296+((o-=65536)>>10),t=o%1024+56320,n.push(e,t)),(i+1===a||n.length>r)&&(s+=S.apply(null,n),n.length=0)}return s},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:A,configurable:!0,writable:!0}):String.fromCodePoint=A)}(t)},182:function(e,t,r){e.exports=i;var n=r(1159).EventEmitter;function i(){n.call(this)}r(1765)(i,n),i.Readable=r(2846),i.Writable=r(8318),i.Duplex=r(6138),i.Transform=r(9798),i.PassThrough=r(5472),i.finished=r(8800),i.pipeline=r(7295),i.Stream=i,i.prototype.pipe=function(e,t){var r=this;function i(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function a(){r.readable&&r.resume&&r.resume()}r.on("data",i),e.on("drain",a),e._isStdio||t&&!1===t.end||(r.on("end",o),r.on("close",l));var s=!1;function o(){s||(s=!0,e.end())}function l(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function u(e){if(c(),0===n.listenerCount(this,"error"))throw e}function c(){r.removeListener("data",i),e.removeListener("drain",a),r.removeListener("end",o),r.removeListener("close",l),r.removeListener("error",u),e.removeListener("error",u),r.removeListener("end",c),r.removeListener("close",c),e.removeListener("close",c)}return r.on("error",u),e.on("error",u),r.on("end",c),r.on("close",c),e.on("close",c),e.emit("pipe",r),e}},1765:function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}},3690:function(e){var t={};function r(e,r,n){n||(n=Error);var i=function(e){var t,n;function i(t,n,i){return e.call(this,function(e,t,n){return"string"==typeof r?r:r(e,t,n)}(t,n,i))||this}return n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,i}(n);i.prototype.name=n.name,i.prototype.code=e,t[e]=i}function n(e,t){if(Array.isArray(e)){var r=e.length;return e=e.map(function(e){return String(e)}),r>2?"one of ".concat(t," ").concat(e.slice(0,r-1).join(", "),", or ")+e[r-1]:2===r?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}r("ERR_INVALID_OPT_VALUE",function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'},TypeError),r("ERR_INVALID_ARG_TYPE",function(e,t,r){var i,a,s,o,l;if("string"==typeof t&&(a="not ",t.substr(0,a.length)===a)?(i="must not be",t=t.replace(/^not /,"")):i="must be",function(e,t,r){return(void 0===r||r>e.length)&&(r=e.length),e.substring(r-t.length,r)===t}(e," argument"))s="The ".concat(e," ").concat(i," ").concat(n(t,"type"));else{var u=("number"!=typeof l&&(l=0),l+1>(o=e).length||-1===o.indexOf(".",l)?"argument":"property");s='The "'.concat(e,'" ').concat(u," ").concat(i," ").concat(n(t,"type"))}return s+". Received type ".concat(typeof r)},TypeError),r("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),r("ERR_METHOD_NOT_IMPLEMENTED",function(e){return"The "+e+" method is not implemented"}),r("ERR_STREAM_PREMATURE_CLOSE","Premature close"),r("ERR_STREAM_DESTROYED",function(e){return"Cannot call "+e+" after a stream was destroyed"}),r("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),r("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),r("ERR_STREAM_WRITE_AFTER_END","write after end"),r("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),r("ERR_UNKNOWN_ENCODING",function(e){return"Unknown encoding: "+e},TypeError),r("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},6138:function(e,t,r){var n=Object.keys||function(e){var t=[];for(var r in e)t.push(r);return t};e.exports=u;var i=r(2846),a=r(8318);r(1765)(u,i);for(var s=n(a.prototype),o=0;o<s.length;o++){var l=s[o];u.prototype[l]||(u.prototype[l]=a.prototype[l])}function u(e){if(!(this instanceof u))return new u(e);i.call(this,e),a.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",c)))}function c(){this._writableState.ended||process.nextTick(d,this)}function d(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},5472:function(e,t,r){e.exports=i;var n=r(9798);function i(e){if(!(this instanceof i))return new i(e);n.call(this,e)}r(1765)(i,n),i.prototype._transform=function(e,t,r){r(null,e)}},2846:function(e,t,r){var n;e.exports=A,A.ReadableState=b,r(1159).EventEmitter;var i,a=function(e,t){return e.listeners(t).length},s=r(9299),o=r(1549).Buffer,l=r.g.Uint8Array||function(){},u=r(964);i=u&&u.debuglog?u.debuglog("stream"):function(){};var c,d,f,h=r(8393),g=r(6163),p=r(7269).getHighWaterMark,m=r(3690).q,v=m.ERR_INVALID_ARG_TYPE,y=m.ERR_STREAM_PUSH_AFTER_EOF,E=m.ERR_METHOD_NOT_IMPLEMENTED,T=m.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;r(1765)(A,s);var _=g.errorOrDestroy,S=["error","close","destroy","pause","resume"];function b(e,t,i){n=n||r(6138),e=e||{},"boolean"!=typeof i&&(i=t instanceof n),this.objectMode=!!e.objectMode,i&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=p(this,e,"readableHighWaterMark",i),this.buffer=new h,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(c||(c=r(7503).s),this.decoder=new c(e.encoding),this.encoding=e.encoding)}function A(e){if(n=n||r(6138),!(this instanceof A))return new A(e);var t=this instanceof n;this._readableState=new b(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),s.call(this)}function I(e,t,r,n,a){i("readableAddChunk",t);var s,u=e._readableState;if(null===t)u.reading=!1,function(e,t){if(i("onEofChunk"),!t.ended){if(t.decoder){var r=t.decoder.end();r&&r.length&&(t.buffer.push(r),t.length+=t.objectMode?1:r.length)}t.ended=!0,t.sync?L(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,C(e)))}}(e,u);else if(a||(s=function(e,t){var r,n;return n=t,o.isBuffer(n)||n instanceof l||"string"==typeof t||void 0===t||e.objectMode||(r=new v("chunk",["string","Buffer","Uint8Array"],t)),r}(u,t)),s)_(e,s);else if(u.objectMode||t&&t.length>0)if("string"==typeof t||u.objectMode||Object.getPrototypeOf(t)===o.prototype||(t=function(e){return o.from(e)}(t)),n)u.endEmitted?_(e,new T):R(e,u,t,!0);else if(u.ended)_(e,new y);else{if(u.destroyed)return!1;u.reading=!1,u.decoder&&!r?(t=u.decoder.write(t),u.objectMode||0!==t.length?R(e,u,t,!1):N(e,u)):R(e,u,t,!1)}else n||(u.reading=!1,N(e,u));return!u.ended&&(u.length<u.highWaterMark||0===u.length)}function R(e,t,r,n){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",r)):(t.length+=t.objectMode?1:r.length,n?t.buffer.unshift(r):t.buffer.push(r),t.needReadable&&L(e)),N(e,t)}Object.defineProperty(A.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),A.prototype.destroy=g.destroy,A.prototype._undestroy=g.undestroy,A.prototype._destroy=function(e,t){t(e)},A.prototype.push=function(e,t){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=o.from(e,t),t=""),r=!0),I(this,e,t,!1,r)},A.prototype.unshift=function(e){return I(this,e,null,!0,!1)},A.prototype.isPaused=function(){return!1===this._readableState.flowing},A.prototype.setEncoding=function(e){c||(c=r(7503).s);var t=new c(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var n=this._readableState.buffer.head,i="";null!==n;)i+=t.write(n.data),n=n.next;return this._readableState.buffer.clear(),""!==i&&this._readableState.buffer.push(i),this._readableState.length=i.length,this};var w=1073741824;function D(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=w?e=w:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function L(e){var t=e._readableState;i("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(i("emitReadable",t.flowing),t.emittedReadable=!0,process.nextTick(C,e))}function C(e){var t=e._readableState;i("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,x(e)}function N(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(P,e,t))}function P(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var r=t.length;if(i("maybeReadMore read 0"),e.read(0),r===t.length)break}t.readingMore=!1}function O(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function M(e){i("readable nexttick read 0"),e.read(0)}function k(e,t){i("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),x(e),t.flowing&&!t.reading&&e.read(0)}function x(e){var t=e._readableState;for(i("flow",t.flowing);t.flowing&&null!==e.read(););}function F(e,t){return 0===t.length?null:(t.objectMode?r=t.buffer.shift():!e||e>=t.length?(r=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):r=t.buffer.consume(e,t.decoder),r);var r}function B(e){var t=e._readableState;i("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,process.nextTick(U,t,e))}function U(e,t){if(i("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var r=t._writableState;(!r||r.autoDestroy&&r.finished)&&t.destroy()}}function Z(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}A.prototype.read=function(e){i("read",e),e=parseInt(e,10);var t=this._readableState,r=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return i("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?B(this):L(this),null;if(0===(e=D(e,t))&&t.ended)return 0===t.length&&B(this),null;var n,a=t.needReadable;return i("need readable",a),(0===t.length||t.length-e<t.highWaterMark)&&i("length less than watermark",a=!0),t.ended||t.reading?i("reading or ended",a=!1):a&&(i("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=D(r,t))),null===(n=e>0?F(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),r!==e&&t.ended&&B(this)),null!==n&&this.emit("data",n),n},A.prototype._read=function(e){_(this,new E("_read()"))},A.prototype.pipe=function(e,t){var r=this,n=this._readableState;switch(n.pipesCount){case 0:n.pipes=e;break;case 1:n.pipes=[n.pipes,e];break;default:n.pipes.push(e)}n.pipesCount+=1,i("pipe count=%d opts=%j",n.pipesCount,t);var s=t&&!1===t.end||e===process.stdout||e===process.stderr?g:o;function o(){i("onend"),e.end()}n.endEmitted?process.nextTick(s):r.once("end",s),e.on("unpipe",function t(a,s){i("onunpipe"),a===r&&s&&!1===s.hasUnpiped&&(s.hasUnpiped=!0,i("cleanup"),e.removeListener("close",f),e.removeListener("finish",h),e.removeListener("drain",l),e.removeListener("error",d),e.removeListener("unpipe",t),r.removeListener("end",o),r.removeListener("end",g),r.removeListener("data",c),u=!0,!n.awaitDrain||e._writableState&&!e._writableState.needDrain||l())});var l=function(e){return function(){var t=e._readableState;i("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,x(e))}}(r);e.on("drain",l);var u=!1;function c(t){i("ondata");var a=e.write(t);i("dest.write",a),!1===a&&((1===n.pipesCount&&n.pipes===e||n.pipesCount>1&&-1!==Z(n.pipes,e))&&!u&&(i("false write response, pause",n.awaitDrain),n.awaitDrain++),r.pause())}function d(t){i("onerror",t),g(),e.removeListener("error",d),0===a(e,"error")&&_(e,t)}function f(){e.removeListener("finish",h),g()}function h(){i("onfinish"),e.removeListener("close",f),g()}function g(){i("unpipe"),r.unpipe(e)}return r.on("data",c),function(e,t,r){if("function"==typeof e.prependListener)return e.prependListener(t,r);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(r):e._events[t]=[r,e._events[t]]:e.on(t,r)}(e,"error",d),e.once("close",f),e.once("finish",h),e.emit("pipe",r),n.flowing||(i("pipe resume"),r.resume()),e},A.prototype.unpipe=function(e){var t=this._readableState,r={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,r)),this;if(!e){var n=t.pipes,i=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<i;a++)n[a].emit("unpipe",this,{hasUnpiped:!1});return this}var s=Z(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,r)),this},A.prototype.on=function(e,t){var r=s.prototype.on.call(this,e,t),n=this._readableState;return"data"===e?(n.readableListening=this.listenerCount("readable")>0,!1!==n.flowing&&this.resume()):"readable"===e&&(n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.flowing=!1,n.emittedReadable=!1,i("on readable",n.length,n.reading),n.length?L(this):n.reading||process.nextTick(M,this))),r},A.prototype.addListener=A.prototype.on,A.prototype.removeListener=function(e,t){var r=s.prototype.removeListener.call(this,e,t);return"readable"===e&&process.nextTick(O,this),r},A.prototype.removeAllListeners=function(e){var t=s.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||process.nextTick(O,this),t},A.prototype.resume=function(){var e=this._readableState;return e.flowing||(i("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,process.nextTick(k,e,t))}(this,e)),e.paused=!1,this},A.prototype.pause=function(){return i("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(i("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},A.prototype.wrap=function(e){var t=this,r=this._readableState,n=!1;for(var a in e.on("end",function(){if(i("wrapped end"),r.decoder&&!r.ended){var e=r.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(a){i("wrapped data"),r.decoder&&(a=r.decoder.write(a)),r.objectMode&&null==a||(r.objectMode||a&&a.length)&&(t.push(a)||(n=!0,e.pause()))}),e)void 0===this[a]&&"function"==typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));for(var s=0;s<S.length;s++)e.on(S[s],this.emit.bind(this,S[s]));return this._read=function(t){i("wrapped _read",t),n&&(n=!1,e.resume())},this},"function"==typeof Symbol&&(A.prototype[Symbol.asyncIterator]=function(){return void 0===d&&(d=r(7299)),d(this)}),Object.defineProperty(A.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(A.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(A.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),A._fromList=F,Object.defineProperty(A.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(A.from=function(e,t){return void 0===f&&(f=r(6233)),f(A,e,t)})},9798:function(e,t,r){e.exports=c;var n=r(3690).q,i=n.ERR_METHOD_NOT_IMPLEMENTED,a=n.ERR_MULTIPLE_CALLBACK,s=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=n.ERR_TRANSFORM_WITH_LENGTH_0,l=r(6138);function u(e,t){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(null===n)return this.emit("error",new a);r.writechunk=null,r.writecb=null,null!=t&&this.push(t),n(e);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function c(e){if(!(this instanceof c))return new c(e);l.call(this,e),this._transformState={afterTransform:u.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",d)}function d(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?f(this,null,null):this._flush(function(t,r){f(e,t,r)})}function f(e,t,r){if(t)return e.emit("error",t);if(null!=r&&e.push(r),e._writableState.length)throw new o;if(e._transformState.transforming)throw new s;return e.push(null)}r(1765)(c,l),c.prototype.push=function(e,t){return this._transformState.needTransform=!1,l.prototype.push.call(this,e,t)},c.prototype._transform=function(e,t,r){r(new i("_transform()"))},c.prototype._write=function(e,t,r){var n=this._transformState;if(n.writecb=r,n.writechunk=e,n.writeencoding=t,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},c.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},c.prototype._destroy=function(e,t){l.prototype._destroy.call(this,e,function(e){t(e)})}},8318:function(e,t,r){function n(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t){var r=e.entry;for(e.entry=null;r;){var n=r.callback;t.pendingcb--,n(void 0),r=r.next}t.corkedRequestsFree.next=e}(t,e)}}var i;e.exports=A,A.WritableState=b;var a,s={deprecate:r(7839)},o=r(9299),l=r(1549).Buffer,u=r.g.Uint8Array||function(){},c=r(6163),d=r(7269).getHighWaterMark,f=r(3690).q,h=f.ERR_INVALID_ARG_TYPE,g=f.ERR_METHOD_NOT_IMPLEMENTED,p=f.ERR_MULTIPLE_CALLBACK,m=f.ERR_STREAM_CANNOT_PIPE,v=f.ERR_STREAM_DESTROYED,y=f.ERR_STREAM_NULL_VALUES,E=f.ERR_STREAM_WRITE_AFTER_END,T=f.ERR_UNKNOWN_ENCODING,_=c.errorOrDestroy;function S(){}function b(e,t,a){i=i||r(6138),e=e||{},"boolean"!=typeof a&&(a=t instanceof i),this.objectMode=!!e.objectMode,a&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=d(this,e,"writableHighWaterMark",a),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var s=!1===e.decodeStrings;this.decodeStrings=!s,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var r=e._writableState,n=r.sync,i=r.writecb;if("function"!=typeof i)throw new p;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(r),t)!function(e,t,r,n,i){--t.pendingcb,r?(process.nextTick(i,n),process.nextTick(C,e,t),e._writableState.errorEmitted=!0,_(e,n)):(i(n),e._writableState.errorEmitted=!0,_(e,n),C(e,t))}(e,r,n,t,i);else{var a=D(r)||e.destroyed;a||r.corked||r.bufferProcessing||!r.bufferedRequest||w(e,r),n?process.nextTick(R,e,r,a,i):R(e,r,a,i)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}function A(e){var t=this instanceof(i=i||r(6138));if(!t&&!a.call(A,this))return new A(e);this._writableState=new b(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),o.call(this)}function I(e,t,r,n,i,a,s){t.writelen=n,t.writecb=s,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new v("write")):r?e._writev(i,t.onwrite):e._write(i,a,t.onwrite),t.sync=!1}function R(e,t,r,n){r||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,n(),C(e,t)}function w(e,t){t.bufferProcessing=!0;var r=t.bufferedRequest;if(e._writev&&r&&r.next){var i=t.bufferedRequestCount,a=new Array(i),s=t.corkedRequestsFree;s.entry=r;for(var o=0,l=!0;r;)a[o]=r,r.isBuf||(l=!1),r=r.next,o+=1;a.allBuffers=l,I(e,t,!0,t.length,a,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new n(t),t.bufferedRequestCount=0}else{for(;r;){var u=r.chunk,c=r.encoding,d=r.callback;if(I(e,t,!1,t.objectMode?1:u.length,u,c,d),r=r.next,t.bufferedRequestCount--,t.writing)break}null===r&&(t.lastBufferedRequest=null)}t.bufferedRequest=r,t.bufferProcessing=!1}function D(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function L(e,t){e._final(function(r){t.pendingcb--,r&&_(e,r),t.prefinished=!0,e.emit("prefinish"),C(e,t)})}function C(e,t){var r=D(t);if(r&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,process.nextTick(L,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var n=e._readableState;(!n||n.autoDestroy&&n.endEmitted)&&e.destroy()}return r}r(1765)(A,o),b.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(b.prototype,"buffer",{get:s.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(a=Function.prototype[Symbol.hasInstance],Object.defineProperty(A,Symbol.hasInstance,{value:function(e){return!!a.call(this,e)||this===A&&e&&e._writableState instanceof b}})):a=function(e){return e instanceof this},A.prototype.pipe=function(){_(this,new m)},A.prototype.write=function(e,t,r){var n,i=this._writableState,a=!1,s=!i.objectMode&&(n=e,l.isBuffer(n)||n instanceof u);return s&&!l.isBuffer(e)&&(e=function(e){return l.from(e)}(e)),"function"==typeof t&&(r=t,t=null),s?t="buffer":t||(t=i.defaultEncoding),"function"!=typeof r&&(r=S),i.ending?function(e,t){var r=new E;_(e,r),process.nextTick(t,r)}(this,r):(s||function(e,t,r,n){var i;return null===r?i=new y:"string"==typeof r||t.objectMode||(i=new h("chunk",["string","Buffer"],r)),!i||(_(e,i),process.nextTick(n,i),!1)}(this,i,e,r))&&(i.pendingcb++,a=function(e,t,r,n,i,a){if(!r){var s=function(e,t,r){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=l.from(t,r)),t}(t,n,i);n!==s&&(r=!0,i="buffer",n=s)}var o=t.objectMode?1:n.length;t.length+=o;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:a,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else I(e,t,!1,o,n,i,a);return u}(this,i,s,e,t,r)),a},A.prototype.cork=function(){this._writableState.corked++},A.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||w(this,e))},A.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new T(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(A.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(A.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),A.prototype._write=function(e,t,r){r(new g("_write()"))},A.prototype._writev=null,A.prototype.end=function(e,t,r){var n=this._writableState;return"function"==typeof e?(r=e,e=null,t=null):"function"==typeof t&&(r=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||function(e,t,r){t.ending=!0,C(e,t),r&&(t.finished?process.nextTick(r):e.once("finish",r)),t.ended=!0,e.writable=!1}(this,n,r),this},Object.defineProperty(A.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(A.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),A.prototype.destroy=c.destroy,A.prototype._undestroy=c.undestroy,A.prototype._destroy=function(e,t){t(e)}},7299:function(e,t,r){var n;function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var a=r(8800),s=Symbol("lastResolve"),o=Symbol("lastReject"),l=Symbol("error"),u=Symbol("ended"),c=Symbol("lastPromise"),d=Symbol("handlePromise"),f=Symbol("stream");function h(e,t){return{value:e,done:t}}function g(e){var t=e[s];if(null!==t){var r=e[f].read();null!==r&&(e[c]=null,e[s]=null,e[o]=null,t(h(r,!1)))}}function p(e){process.nextTick(g,e)}var m=Object.getPrototypeOf(function(){}),v=Object.setPrototypeOf((i(n={get stream(){return this[f]},next:function(){var e=this,t=this[l];if(null!==t)return Promise.reject(t);if(this[u])return Promise.resolve(h(void 0,!0));if(this[f].destroyed)return new Promise(function(t,r){process.nextTick(function(){e[l]?r(e[l]):t(h(void 0,!0))})});var r,n=this[c];if(n)r=new Promise(function(e,t){return function(r,n){e.then(function(){t[u]?r(h(void 0,!0)):t[d](r,n)},n)}}(n,this));else{var i=this[f].read();if(null!==i)return Promise.resolve(h(i,!1));r=new Promise(this[d])}return this[c]=r,r}},Symbol.asyncIterator,function(){return this}),i(n,"return",function(){var e=this;return new Promise(function(t,r){e[f].destroy(null,function(e){e?r(e):t(h(void 0,!0))})})}),n),m);e.exports=function(e){var t,r=Object.create(v,(i(t={},f,{value:e,writable:!0}),i(t,s,{value:null,writable:!0}),i(t,o,{value:null,writable:!0}),i(t,l,{value:null,writable:!0}),i(t,u,{value:e._readableState.endEmitted,writable:!0}),i(t,d,{value:function(e,t){var n=r[f].read();n?(r[c]=null,r[s]=null,r[o]=null,e(h(n,!1))):(r[s]=e,r[o]=t)},writable:!0}),t));return r[c]=null,a(e,function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=r[o];return null!==t&&(r[c]=null,r[s]=null,r[o]=null,t(e)),void(r[l]=e)}var n=r[s];null!==n&&(r[c]=null,r[s]=null,r[o]=null,n(h(void 0,!0))),r[u]=!0}),e.on("readable",p.bind(null,r)),r}},8393:function(e,t,r){function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=r(1549).Buffer,o=r(9862).inspect,l=o&&o.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t;return t=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,r=""+t.data;t=t.next;)r+=e+t.data;return r}},{key:"concat",value:function(e){if(0===this.length)return s.alloc(0);for(var t,r,n,i=s.allocUnsafe(e>>>0),a=this.head,o=0;a;)t=a.data,r=i,n=o,s.prototype.copy.call(t,r,n),o+=a.data.length,a=a.next;return i}},{key:"consume",value:function(e,t){var r;return e<this.head.data.length?(r=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):r=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),r}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,r=1,n=t.data;for(e-=n.length;t=t.next;){var i=t.data,a=e>i.length?i.length:e;if(a===i.length?n+=i:n+=i.slice(0,e),0==(e-=a)){a===i.length?(++r,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=i.slice(a));break}++r}return this.length-=r,n}},{key:"_getBuffer",value:function(e){var t=s.allocUnsafe(e),r=this.head,n=1;for(r.data.copy(t),e-=r.data.length;r=r.next;){var i=r.data,a=e>i.length?i.length:e;if(i.copy(t,t.length-e,0,a),0==(e-=a)){a===i.length?(++n,r.next?this.head=r.next:this.head=this.tail=null):(this.head=r,r.data=i.slice(a));break}++n}return this.length-=n,t}},{key:l,value:function(e,t){return o(this,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach(function(t){i(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},t,{depth:0,customInspect:!1}))}}],t&&a(e.prototype,t),e}()},6163:function(e){function t(e,t){n(e,t),r(e)}function r(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function n(e,t){e.emit("error",t)}e.exports={destroy:function(e,i){var a=this,s=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return s||o?(i?i(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(n,this,e)):process.nextTick(n,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!i&&e?a._writableState?a._writableState.errorEmitted?process.nextTick(r,a):(a._writableState.errorEmitted=!0,process.nextTick(t,a,e)):process.nextTick(t,a,e):i?(process.nextTick(r,a),i(e)):process.nextTick(r,a)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var r=e._readableState,n=e._writableState;r&&r.autoDestroy||n&&n.autoDestroy?e.destroy(t):e.emit("error",t)}}},8800:function(e,t,r){var n=r(3690).q.ERR_STREAM_PREMATURE_CLOSE;function i(){}e.exports=function e(t,r,a){if("function"==typeof r)return e(t,null,r);r||(r={}),a=function(e){var t=!1;return function(){if(!t){t=!0;for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];e.apply(this,n)}}}(a||i);var s=r.readable||!1!==r.readable&&t.readable,o=r.writable||!1!==r.writable&&t.writable,l=function(){t.writable||c()},u=t._writableState&&t._writableState.finished,c=function(){o=!1,u=!0,s||a.call(t)},d=t._readableState&&t._readableState.endEmitted,f=function(){s=!1,d=!0,o||a.call(t)},h=function(e){a.call(t,e)},g=function(){var e;return s&&!d?(t._readableState&&t._readableState.ended||(e=new n),a.call(t,e)):o&&!u?(t._writableState&&t._writableState.ended||(e=new n),a.call(t,e)):void 0},p=function(){t.req.on("finish",c)};return function(e){return e.setHeader&&"function"==typeof e.abort}(t)?(t.on("complete",c),t.on("abort",g),t.req?p():t.on("request",p)):o&&!t._writableState&&(t.on("end",l),t.on("close",l)),t.on("end",f),t.on("finish",c),!1!==r.error&&t.on("error",h),t.on("close",g),function(){t.removeListener("complete",c),t.removeListener("abort",g),t.removeListener("request",p),t.req&&t.req.removeListener("finish",c),t.removeListener("end",l),t.removeListener("close",l),t.removeListener("finish",c),t.removeListener("end",f),t.removeListener("error",h),t.removeListener("close",g)}}},6233:function(e){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},7295:function(e,t,r){var n,i=r(3690).q,a=i.ERR_MISSING_ARGS,s=i.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function l(e,t,i,a){a=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(a);var o=!1;e.on("close",function(){o=!0}),void 0===n&&(n=r(8800)),n(e,{readable:t,writable:i},function(e){if(e)return a(e);o=!0,a()});var l=!1;return function(t){if(!o&&!l)return l=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void a(t||new s("pipe"))}}function u(e){e()}function c(e,t){return e.pipe(t)}function d(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}e.exports=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n,i=d(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new a("streams");var s=t.map(function(e,r){var a=r<t.length-1;return l(e,a,r>0,function(e){n||(n=e),e&&s.forEach(u),a||(s.forEach(u),i(n))})});return t.reduce(c)}},7269:function(e,t,r){var n=r(3690).q.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,r,i){var a=function(e,t,r){return null!=e.highWaterMark?e.highWaterMark:t?e[r]:null}(t,i,r);if(null!=a){if(!isFinite(a)||Math.floor(a)!==a||a<0)throw new n(i?r:"highWaterMark",a);return Math.floor(a)}return e.objectMode?16:16384}}},9299:function(e,t,r){e.exports=r(1159).EventEmitter},7503:function(e,t,r){var n=r(8387).Buffer,i=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===i||!i(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=l,this.end=u,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=c,this.end=d,t=3;break;default:return this.write=f,void(this.end=h)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function s(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,r=function(e,t){if(128!=(192&t[0]))return e.lastNeed=0,"";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,""}}(this,e);return void 0!==r?r:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function l(e,t){if((e.length-t)%2==0){var r=e.toString("utf16le",t);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,r)}return t}function c(e,t){var r=(e.length-t)%3;return 0===r?e.toString("base64",t):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-r))}function d(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function h(e){return e&&e.length?this.write(e):""}t.s=a,a.prototype.write=function(e){if(0===e.length)return"";var t,r;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<e.length?t?t+this.text(e,r):this.text(e,r):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"":t},a.prototype.text=function(e,t){var r=function(e,t,r){var n=t.length-1;if(n<r)return 0;var i=s(t[n]);return i>=0?(i>0&&(e.lastNeed=i-1),i):--n<r||-2===i?0:(i=s(t[n]))>=0?(i>0&&(e.lastNeed=i-2),i):--n<r||-2===i?0:(i=s(t[n]))>=0?(i>0&&(2===i?i=0:e.lastNeed=i-3),i):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=r;var n=e.length-(r-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},1067:function(e,t,r){var n;!function(i,a){var s="function",o="undefined",l="object",u="string",c="major",d="model",f="name",h="type",g="vendor",p="version",m="architecture",v="console",y="mobile",E="tablet",T="smarttv",_="wearable",S="embedded",b="Amazon",A="Apple",I="ASUS",R="BlackBerry",w="Browser",D="Chrome",L="Firefox",C="Google",N="Huawei",P="LG",O="Microsoft",M="Motorola",k="Opera",x="Samsung",F="Sharp",B="Sony",U="Xiaomi",Z="Zebra",G="Facebook",H="Chromium OS",$="Mac OS",V=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},K=function(e,t){return typeof e===u&&-1!==q(t).indexOf(q(e))},q=function(e){return e.toLowerCase()},Y=function(e,t){if(typeof e===u)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,500)},j=function(e,t){for(var r,n,i,o,u,c,d=0;d<t.length&&!u;){var f=t[d],h=t[d+1];for(r=n=0;r<f.length&&!u&&f[r];)if(u=f[r++].exec(e))for(i=0;i<h.length;i++)c=u[++n],typeof(o=h[i])===l&&o.length>0?2===o.length?typeof o[1]==s?this[o[0]]=o[1].call(this,c):this[o[0]]=o[1]:3===o.length?typeof o[1]!==s||o[1].exec&&o[1].test?this[o[0]]=c?c.replace(o[1],o[2]):a:this[o[0]]=c?o[1].call(this,c,o[2]):a:4===o.length&&(this[o[0]]=c?o[3].call(this,c.replace(o[1],o[2])):a):this[o]=c||a;d+=2}},z=function(e,t){for(var r in t)if(typeof t[r]===l&&t[r].length>0){for(var n=0;n<t[r].length;n++)if(K(t[r][n],e))return"?"===r?a:r}else if(K(t[r],e))return"?"===r?a:r;return e},W={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},X={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[p,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[p,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,p],[/opios[\/ ]+([\w\.]+)/i],[p,[f,k+" Mini"]],[/\bopr\/([\w\.]+)/i],[p,[f,k]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[p,[f,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[f,p],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[p,[f,"UC"+w]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[p,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[p,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[p,[f,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[p,[f,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[p,[f,"Smart Lenovo "+w]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+w],p],[/\bfocus\/([\w\.]+)/i],[p,[f,L+" Focus"]],[/\bopt\/([\w\.]+)/i],[p,[f,k+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[p,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[p,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[p,[f,k+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[p,[f,"MIUI "+w]],[/fxios\/([-\w\.]+)/i],[p,[f,L]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 "+w]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 "+w],p],[/samsungbrowser\/([\w\.]+)/i],[p,[f,x+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],p],[/metasr[\/ ]?([\d\.]+)/i],[p,[f,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[f,"Sogou Mobile"],p],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[f,p],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,G],p],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[f,p],[/\bgsa\/([\w\.]+) .*safari\//i],[p,[f,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[p,[f,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[p,[f,D+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,D+" WebView"],p],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[p,[f,"Android "+w]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,p],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[p,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[p,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[p,z,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[f,p],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],p],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[p,[f,L+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[f,p],[/(cobalt)\/([\w\.]+)/i],[f,[p,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,q]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",q]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,q]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[d,[g,x],[h,E]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[d,[g,x],[h,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[d,[g,A],[h,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[d,[g,A],[h,E]],[/(macintosh);/i],[d,[g,A]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[d,[g,F],[h,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[d,[g,N],[h,E]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[d,[g,N],[h,y]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[d,/_/g," "],[g,U],[h,y]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[d,/_/g," "],[g,U],[h,E]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[d,[g,"OPPO"],[h,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[d,[g,"Vivo"],[h,y]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[d,[g,"Realme"],[h,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[d,[g,M],[h,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[d,[g,M],[h,E]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[d,[g,P],[h,E]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[d,[g,P],[h,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[d,[g,"Lenovo"],[h,E]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[d,/_/g," "],[g,"Nokia"],[h,y]],[/(pixel c)\b/i],[d,[g,C],[h,E]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[d,[g,C],[h,y]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[d,[g,B],[h,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[d,"Xperia Tablet"],[g,B],[h,E]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[d,[g,"OnePlus"],[h,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[d,[g,b],[h,E]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[d,/(.+)/g,"Fire Phone $1"],[g,b],[h,y]],[/(playbook);[-\w\),; ]+(rim)/i],[d,g,[h,E]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[d,[g,R],[h,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[d,[g,I],[h,E]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[d,[g,I],[h,y]],[/(nexus 9)/i],[d,[g,"HTC"],[h,E]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[d,/_/g," "],[h,y]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[d,[g,"Acer"],[h,E]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[d,[g,"Meizu"],[h,y]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[d,[g,"Ulefone"],[h,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,d,[h,y]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,d,[h,E]],[/(surface duo)/i],[d,[g,O],[h,E]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[d,[g,"Fairphone"],[h,y]],[/(u304aa)/i],[d,[g,"AT&T"],[h,y]],[/\bsie-(\w*)/i],[d,[g,"Siemens"],[h,y]],[/\b(rct\w+) b/i],[d,[g,"RCA"],[h,E]],[/\b(venue[\d ]{2,7}) b/i],[d,[g,"Dell"],[h,E]],[/\b(q(?:mv|ta)\w+) b/i],[d,[g,"Verizon"],[h,E]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[d,[g,"Barnes & Noble"],[h,E]],[/\b(tm\d{3}\w+) b/i],[d,[g,"NuVision"],[h,E]],[/\b(k88) b/i],[d,[g,"ZTE"],[h,E]],[/\b(nx\d{3}j) b/i],[d,[g,"ZTE"],[h,y]],[/\b(gen\d{3}) b.+49h/i],[d,[g,"Swiss"],[h,y]],[/\b(zur\d{3}) b/i],[d,[g,"Swiss"],[h,E]],[/\b((zeki)?tb.*\b) b/i],[d,[g,"Zeki"],[h,E]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],d,[h,E]],[/\b(ns-?\w{0,9}) b/i],[d,[g,"Insignia"],[h,E]],[/\b((nxa|next)-?\w{0,9}) b/i],[d,[g,"NextBook"],[h,E]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],d,[h,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],d,[h,y]],[/\b(ph-1) /i],[d,[g,"Essential"],[h,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[d,[g,"Envizen"],[h,E]],[/\b(trio[-\w\. ]+) b/i],[d,[g,"MachSpeed"],[h,E]],[/\btu_(1491) b/i],[d,[g,"Rotor"],[h,E]],[/(shield[\w ]+) b/i],[d,[g,"Nvidia"],[h,E]],[/(sprint) (\w+)/i],[g,d,[h,y]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[g,O],[h,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[d,[g,Z],[h,E]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[d,[g,Z],[h,y]],[/smart-tv.+(samsung)/i],[g,[h,T]],[/hbbtv.+maple;(\d+)/i],[[d,/^/,"SmartTV"],[g,x],[h,T]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,P],[h,T]],[/(apple) ?tv/i],[g,[d,A+" TV"],[h,T]],[/crkey/i],[[d,D+"cast"],[g,C],[h,T]],[/droid.+aft(\w+)( bui|\))/i],[d,[g,b],[h,T]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[d,[g,F],[h,T]],[/(bravia[\w ]+)( bui|\))/i],[d,[g,B],[h,T]],[/(mitv-\w{5}) bui/i],[d,[g,U],[h,T]],[/Hbbtv.*(technisat) (.*);/i],[g,d,[h,T]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,Y],[d,Y],[h,T]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[h,T]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,d,[h,v]],[/droid.+; (shield) bui/i],[d,[g,"Nvidia"],[h,v]],[/(playstation [345portablevi]+)/i],[d,[g,B],[h,v]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[d,[g,O],[h,v]],[/((pebble))app/i],[g,d,[h,_]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[d,[g,A],[h,_]],[/droid.+; (glass) \d/i],[d,[g,C],[h,_]],[/droid.+; (wt63?0{2,3})\)/i],[d,[g,Z],[h,_]],[/(quest( 2| pro)?)/i],[d,[g,G],[h,_]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[h,S]],[/(aeobc)\b/i],[d,[g,b],[h,S]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[d,[h,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[d,[h,E]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[h,E]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[h,y]],[/(android[-\w\. ]{0,9});.+buil/i],[d,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[p,[f,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[f,p],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[p,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,p],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[f,[p,z,W]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[p,z,W],[f,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[p,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,$],[p,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[p,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,p],[/\(bb(10);/i],[p,[f,R]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[p,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[p,[f,L+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[p,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[p,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[p,[f,D+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,H],p],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,p],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],p],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[f,p]]},Q=function(e,t){if(typeof e===l&&(t=e,e=a),!(this instanceof Q))return new Q(e,t).getResult();var r=typeof i!==o&&i.navigator?i.navigator:a,n=e||(r&&r.userAgent?r.userAgent:""),v=r&&r.userAgentData?r.userAgentData:a,T=t?function(e,t){var r={};for(var n in e)t[n]&&t[n].length%2==0?r[n]=t[n].concat(e[n]):r[n]=e[n];return r}(X,t):X,_=r&&r.userAgent==n;return this.getBrowser=function(){var e,t={};return t[f]=a,t[p]=a,j.call(t,n,T.browser),t[c]=typeof(e=t[p])===u?e.replace(/[^\d\.]/g,"").split(".")[0]:a,_&&r&&r.brave&&typeof r.brave.isBrave==s&&(t[f]="Brave"),t},this.getCPU=function(){var e={};return e[m]=a,j.call(e,n,T.cpu),e},this.getDevice=function(){var e={};return e[g]=a,e[d]=a,e[h]=a,j.call(e,n,T.device),_&&!e[h]&&v&&v.mobile&&(e[h]=y),_&&"Macintosh"==e[d]&&r&&typeof r.standalone!==o&&r.maxTouchPoints&&r.maxTouchPoints>2&&(e[d]="iPad",e[h]=E),e},this.getEngine=function(){var e={};return e[f]=a,e[p]=a,j.call(e,n,T.engine),e},this.getOS=function(){var e={};return e[f]=a,e[p]=a,j.call(e,n,T.os),_&&!e[f]&&v&&"Unknown"!=v.platform&&(e[f]=v.platform.replace(/chrome os/i,H).replace(/macos/i,$)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=typeof e===u&&e.length>500?Y(e,500):e,this},this.setUA(n),this};Q.VERSION="1.0.37",Q.BROWSER=V([f,p,c]),Q.CPU=V([m]),Q.DEVICE=V([d,g,h,v,y,T,E,_,S]),Q.ENGINE=Q.OS=V([f,p]),typeof t!==o?(e.exports&&(t=e.exports=Q),t.UAParser=Q):r.amdO?(n=function(){return Q}.call(t,r,t,e))===a||(e.exports=n):typeof i!==o&&(i.UAParser=Q);var J=typeof i!==o&&(i.jQuery||i.Zepto);if(J&&!J.ua){var ee=new Q;J.ua=ee.getResult(),J.ua.get=function(){return ee.getUA()},J.ua.set=function(e){ee.setUA(e);var t=ee.getResult();for(var r in t)J.ua[r]=t[r]}}}("object"==typeof window?window:this)},7839:function(e,t,r){function n(e){try{if(!r.g.localStorage)return!1}catch(e){return!1}var t=r.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(n("noDeprecation"))return e;var r=!1;return function(){if(!r){if(n("throwDeprecation"))throw new Error(t);n("traceDeprecation")?console.trace(t):console.warn(t),r=!0}return e.apply(this,arguments)}}},9862:function(){},964:function(){},3165:function(e){e.exports=JSON.parse('["mni-beng-in","mni-mtei-in","sat-deva-in","sat-olck-in","shi-latn-ma","shi-tfng-ma","vai-latn-lr","vai-vaii-lr","yue-hans-cn","yue-hant-hk","az-arab-ir","az-cyrl-az","az-latn-az","bm-nkoo-ml","bs-cyrl-ba","bs-latn-ba","en-dsrt-us","ff-adlm-gn","ff-latn-sn","ha-arab-ng","hi-latn-in","iu-latn-ca","ks-arab-in","ks-deva-in","mn-mong-cn","ms-arab-my","pa-arab-pk","pa-guru-in","sd-arab-pk","sd-deva-in","sr-cyrl-rs","sr-latn-rs","su-latn-id","uz-arab-af","uz-cyrl-uz","uz-latn-uz","zh-hans-cn","zh-hant-tw","mni-beng","sat-olck","shi-tfng","vai-vaii","yue-hant","az-latn","bs-latn","ff-latn","jbo-001","ks-arab","pa-guru","prg-001","sd-arab","sr-cyrl","su-latn","uz-latn","zh-hans","agq-cm","ar-001","arn-cl","asa-tz","ast-es","bas-cm","bem-zm","bez-tz","bgn-pk","blt-vn","brx-in","bss-cm","byn-er","cad-us","cch-ng","ccp-bd","ceb-ph","cgg-ug","chr-us","cic-us","ckb-iq","dav-ke","dje-ne","doi-in","dsb-de","dua-cm","dyo-sn","ebu-ke","eo-001","ewo-cm","fil-ph","fur-it","gaa-gh","gez-et","gsw-ch","guz-ke","haw-us","hsb-de","ia-001","ife-tg","io-001","jgo-cm","jmc-tz","kab-dz","kaj-ng","kam-ke","kcg-ng","kde-tz","kea-cv","ken-cm","khq-ml","kkj-cm","kln-ke","kok-in","kpe-lr","ksb-tz","ksf-cm","ksh-de","lag-tz","lkt-us","lrc-ir","luo-ke","luy-ke","mai-in","mas-ke","mer-ke","mfe-mu","mgh-mz","mgo-cm","moh-ca","mua-cm","mus-us","myv-ru","mzn-ir","naq-na","nds-de","nmg-cm","nnh-cm","nqo-gn","nso-za","nus-ss","nyn-ug","osa-us","pcm-ng","quc-gt","rof-tz","rwk-tz","sah-ru","saq-ke","sbp-tz","scn-it","sdh-ir","seh-mz","ses-ml","sid-et","sma-se","smj-se","smn-fi","sms-fi","ssy-er","syr-iq","szl-pl","teo-ug","tig-er","trv-tw","trw-pk","twq-ne","tzm-ma","vo-001","vun-tz","wae-ch","wal-et","wbp-au","xog-ug","yav-cm","yi-001","zgh-ma","aa-et","af-za","ak-gh","am-et","an-es","as-in","ba-ru","be-by","bg-bg","bm-ml","bn-bd","bo-cn","br-fr","ca-es","ce-ru","co-fr","cs-cz","cu-ru","cv-ru","cy-gb","da-dk","de-de","dv-mv","dz-bt","ee-gh","el-gr","en-us","es-es","et-ee","eu-es","fa-ir","fi-fi","fo-fo","fr-fr","fy-nl","ga-ie","gd-gb","gl-es","gn-py","gu-in","gv-im","ha-ng","he-il","hi-in","hr-hr","hu-hu","hy-am","id-id","ig-ng","ii-cn","is-is","it-it","iu-ca","ja-jp","jv-id","ka-ge","ki-ke","kk-kz","kl-gl","km-kh","kn-in","ko-kr","ku-tr","kw-gb","ky-kg","lb-lu","lg-ug","ln-cd","lo-la","lt-lt","lu-cd","lv-lv","mg-mg","mi-nz","mk-mk","ml-in","mn-mn","mr-in","ms-my","mt-mt","my-mm","nb-no","nd-zw","ne-np","nl-nl","nn-no","nr-za","nv-us","ny-mw","oc-fr","om-et","or-in","os-ge","pl-pl","ps-af","pt-br","qu-pe","rm-ch","rn-bi","ro-ro","ru-ru","rw-rw","sa-in","sc-it","se-no","sg-cf","si-lk","sk-sk","sl-si","sn-zw","so-so","sq-al","ss-za","st-za","sv-se","sw-tz","ta-in","te-in","tg-tj","th-th","ti-et","tk-tm","tn-za","to-to","tr-tr","ts-za","tt-ru","ug-cn","uk-ua","ur-pk","ve-za","vi-vn","wa-be","wo-sn","xh-za","yo-ng","zu-za"]')},5813:function(e){e.exports=JSON.parse('[{"from":{"field":"script","value":"qaai"},"to":{"field":"script","value":"zinh"}},{"from":{"field":"region","value":"bu"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"ct"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"dd"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"dy"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"fx"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"hv"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"jt"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"mi"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"nh"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"nq"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"pu"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"pz"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"qu"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"rh"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"tp"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"uk"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"vd"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"wk"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"yd"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"zr"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"230"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"280"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"736"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"886"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"958"},"to":{"field":"region","value":"aa"}},{"from":{"field":"region","value":"020"},"to":{"field":"region","value":"ad"}},{"from":{"field":"region","value":"784"},"to":{"field":"region","value":"ae"}},{"from":{"field":"region","value":"004"},"to":{"field":"region","value":"af"}},{"from":{"field":"region","value":"028"},"to":{"field":"region","value":"ag"}},{"from":{"field":"region","value":"660"},"to":{"field":"region","value":"ai"}},{"from":{"field":"region","value":"008"},"to":{"field":"region","value":"al"}},{"from":{"field":"region","value":"051"},"to":{"field":"region","value":"am"}},{"from":{"field":"region","value":"024"},"to":{"field":"region","value":"ao"}},{"from":{"field":"region","value":"010"},"to":{"field":"region","value":"aq"}},{"from":{"field":"region","value":"032"},"to":{"field":"region","value":"ar"}},{"from":{"field":"region","value":"016"},"to":{"field":"region","value":"as"}},{"from":{"field":"region","value":"040"},"to":{"field":"region","value":"at"}},{"from":{"field":"region","value":"036"},"to":{"field":"region","value":"au"}},{"from":{"field":"region","value":"533"},"to":{"field":"region","value":"aw"}},{"from":{"field":"region","value":"248"},"to":{"field":"region","value":"ax"}},{"from":{"field":"region","value":"031"},"to":{"field":"region","value":"az"}},{"from":{"field":"region","value":"070"},"to":{"field":"region","value":"ba"}},{"from":{"field":"region","value":"052"},"to":{"field":"region","value":"bb"}},{"from":{"field":"region","value":"050"},"to":{"field":"region","value":"bd"}},{"from":{"field":"region","value":"056"},"to":{"field":"region","value":"be"}},{"from":{"field":"region","value":"854"},"to":{"field":"region","value":"bf"}},{"from":{"field":"region","value":"100"},"to":{"field":"region","value":"bg"}},{"from":{"field":"region","value":"048"},"to":{"field":"region","value":"bh"}},{"from":{"field":"region","value":"108"},"to":{"field":"region","value":"bi"}},{"from":{"field":"region","value":"204"},"to":{"field":"region","value":"bj"}},{"from":{"field":"region","value":"652"},"to":{"field":"region","value":"bl"}},{"from":{"field":"region","value":"060"},"to":{"field":"region","value":"bm"}},{"from":{"field":"region","value":"096"},"to":{"field":"region","value":"bn"}},{"from":{"field":"region","value":"068"},"to":{"field":"region","value":"bo"}},{"from":{"field":"region","value":"535"},"to":{"field":"region","value":"bq"}},{"from":{"field":"region","value":"076"},"to":{"field":"region","value":"br"}},{"from":{"field":"region","value":"044"},"to":{"field":"region","value":"bs"}},{"from":{"field":"region","value":"064"},"to":{"field":"region","value":"bt"}},{"from":{"field":"region","value":"104"},"to":{"field":"region","value":"mm"}},{"from":{"field":"region","value":"074"},"to":{"field":"region","value":"bv"}},{"from":{"field":"region","value":"072"},"to":{"field":"region","value":"bw"}},{"from":{"field":"region","value":"112"},"to":{"field":"region","value":"by"}},{"from":{"field":"region","value":"084"},"to":{"field":"region","value":"bz"}},{"from":{"field":"region","value":"124"},"to":{"field":"region","value":"ca"}},{"from":{"field":"region","value":"166"},"to":{"field":"region","value":"cc"}},{"from":{"field":"region","value":"180"},"to":{"field":"region","value":"cd"}},{"from":{"field":"region","value":"140"},"to":{"field":"region","value":"cf"}},{"from":{"field":"region","value":"178"},"to":{"field":"region","value":"cg"}},{"from":{"field":"region","value":"756"},"to":{"field":"region","value":"ch"}},{"from":{"field":"region","value":"384"},"to":{"field":"region","value":"ci"}},{"from":{"field":"region","value":"184"},"to":{"field":"region","value":"ck"}},{"from":{"field":"region","value":"152"},"to":{"field":"region","value":"cl"}},{"from":{"field":"region","value":"120"},"to":{"field":"region","value":"cm"}},{"from":{"field":"region","value":"156"},"to":{"field":"region","value":"cn"}},{"from":{"field":"region","value":"170"},"to":{"field":"region","value":"co"}},{"from":{"field":"region","value":"188"},"to":{"field":"region","value":"cr"}},{"from":{"field":"region","value":"192"},"to":{"field":"region","value":"cu"}},{"from":{"field":"region","value":"132"},"to":{"field":"region","value":"cv"}},{"from":{"field":"region","value":"531"},"to":{"field":"region","value":"cw"}},{"from":{"field":"region","value":"162"},"to":{"field":"region","value":"cx"}},{"from":{"field":"region","value":"196"},"to":{"field":"region","value":"cy"}},{"from":{"field":"region","value":"203"},"to":{"field":"region","value":"cz"}},{"from":{"field":"region","value":"278"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"276"},"to":{"field":"region","value":"de"}},{"from":{"field":"region","value":"262"},"to":{"field":"region","value":"dj"}},{"from":{"field":"region","value":"208"},"to":{"field":"region","value":"dk"}},{"from":{"field":"region","value":"212"},"to":{"field":"region","value":"dm"}},{"from":{"field":"region","value":"214"},"to":{"field":"region","value":"do"}},{"from":{"field":"region","value":"012"},"to":{"field":"region","value":"dz"}},{"from":{"field":"region","value":"218"},"to":{"field":"region","value":"ec"}},{"from":{"field":"region","value":"233"},"to":{"field":"region","value":"ee"}},{"from":{"field":"region","value":"818"},"to":{"field":"region","value":"eg"}},{"from":{"field":"region","value":"732"},"to":{"field":"region","value":"eh"}},{"from":{"field":"region","value":"232"},"to":{"field":"region","value":"er"}},{"from":{"field":"region","value":"724"},"to":{"field":"region","value":"es"}},{"from":{"field":"region","value":"231"},"to":{"field":"region","value":"et"}},{"from":{"field":"region","value":"246"},"to":{"field":"region","value":"fi"}},{"from":{"field":"region","value":"242"},"to":{"field":"region","value":"fj"}},{"from":{"field":"region","value":"238"},"to":{"field":"region","value":"fk"}},{"from":{"field":"region","value":"583"},"to":{"field":"region","value":"fm"}},{"from":{"field":"region","value":"234"},"to":{"field":"region","value":"fo"}},{"from":{"field":"region","value":"250"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"249"},"to":{"field":"region","value":"fr"}},{"from":{"field":"region","value":"266"},"to":{"field":"region","value":"ga"}},{"from":{"field":"region","value":"826"},"to":{"field":"region","value":"gb"}},{"from":{"field":"region","value":"308"},"to":{"field":"region","value":"gd"}},{"from":{"field":"region","value":"268"},"to":{"field":"region","value":"ge"}},{"from":{"field":"region","value":"254"},"to":{"field":"region","value":"gf"}},{"from":{"field":"region","value":"831"},"to":{"field":"region","value":"gg"}},{"from":{"field":"region","value":"288"},"to":{"field":"region","value":"gh"}},{"from":{"field":"region","value":"292"},"to":{"field":"region","value":"gi"}},{"from":{"field":"region","value":"304"},"to":{"field":"region","value":"gl"}},{"from":{"field":"region","value":"270"},"to":{"field":"region","value":"gm"}},{"from":{"field":"region","value":"324"},"to":{"field":"region","value":"gn"}},{"from":{"field":"region","value":"312"},"to":{"field":"region","value":"gp"}},{"from":{"field":"region","value":"226"},"to":{"field":"region","value":"gq"}},{"from":{"field":"region","value":"300"},"to":{"field":"region","value":"gr"}},{"from":{"field":"region","value":"239"},"to":{"field":"region","value":"gs"}},{"from":{"field":"region","value":"320"},"to":{"field":"region","value":"gt"}},{"from":{"field":"region","value":"316"},"to":{"field":"region","value":"gu"}},{"from":{"field":"region","value":"624"},"to":{"field":"region","value":"gw"}},{"from":{"field":"region","value":"328"},"to":{"field":"region","value":"gy"}},{"from":{"field":"region","value":"344"},"to":{"field":"region","value":"hk"}},{"from":{"field":"region","value":"334"},"to":{"field":"region","value":"hm"}},{"from":{"field":"region","value":"340"},"to":{"field":"region","value":"hn"}},{"from":{"field":"region","value":"191"},"to":{"field":"region","value":"hr"}},{"from":{"field":"region","value":"332"},"to":{"field":"region","value":"ht"}},{"from":{"field":"region","value":"348"},"to":{"field":"region","value":"hu"}},{"from":{"field":"region","value":"360"},"to":{"field":"region","value":"id"}},{"from":{"field":"region","value":"372"},"to":{"field":"region","value":"ie"}},{"from":{"field":"region","value":"376"},"to":{"field":"region","value":"il"}},{"from":{"field":"region","value":"833"},"to":{"field":"region","value":"im"}},{"from":{"field":"region","value":"356"},"to":{"field":"region","value":"in"}},{"from":{"field":"region","value":"086"},"to":{"field":"region","value":"io"}},{"from":{"field":"region","value":"368"},"to":{"field":"region","value":"iq"}},{"from":{"field":"region","value":"364"},"to":{"field":"region","value":"ir"}},{"from":{"field":"region","value":"352"},"to":{"field":"region","value":"is"}},{"from":{"field":"region","value":"380"},"to":{"field":"region","value":"it"}},{"from":{"field":"region","value":"832"},"to":{"field":"region","value":"je"}},{"from":{"field":"region","value":"388"},"to":{"field":"region","value":"jm"}},{"from":{"field":"region","value":"400"},"to":{"field":"region","value":"jo"}},{"from":{"field":"region","value":"392"},"to":{"field":"region","value":"jp"}},{"from":{"field":"region","value":"404"},"to":{"field":"region","value":"ke"}},{"from":{"field":"region","value":"417"},"to":{"field":"region","value":"kg"}},{"from":{"field":"region","value":"116"},"to":{"field":"region","value":"kh"}},{"from":{"field":"region","value":"296"},"to":{"field":"region","value":"ki"}},{"from":{"field":"region","value":"174"},"to":{"field":"region","value":"km"}},{"from":{"field":"region","value":"659"},"to":{"field":"region","value":"kn"}},{"from":{"field":"region","value":"408"},"to":{"field":"region","value":"kp"}},{"from":{"field":"region","value":"410"},"to":{"field":"region","value":"kr"}},{"from":{"field":"region","value":"414"},"to":{"field":"region","value":"kw"}},{"from":{"field":"region","value":"136"},"to":{"field":"region","value":"ky"}},{"from":{"field":"region","value":"398"},"to":{"field":"region","value":"kz"}},{"from":{"field":"region","value":"418"},"to":{"field":"region","value":"la"}},{"from":{"field":"region","value":"422"},"to":{"field":"region","value":"lb"}},{"from":{"field":"region","value":"662"},"to":{"field":"region","value":"lc"}},{"from":{"field":"region","value":"438"},"to":{"field":"region","value":"li"}},{"from":{"field":"region","value":"144"},"to":{"field":"region","value":"lk"}},{"from":{"field":"region","value":"430"},"to":{"field":"region","value":"lr"}},{"from":{"field":"region","value":"426"},"to":{"field":"region","value":"ls"}},{"from":{"field":"region","value":"440"},"to":{"field":"region","value":"lt"}},{"from":{"field":"region","value":"442"},"to":{"field":"region","value":"lu"}},{"from":{"field":"region","value":"428"},"to":{"field":"region","value":"lv"}},{"from":{"field":"region","value":"434"},"to":{"field":"region","value":"ly"}},{"from":{"field":"region","value":"504"},"to":{"field":"region","value":"ma"}},{"from":{"field":"region","value":"492"},"to":{"field":"region","value":"mc"}},{"from":{"field":"region","value":"498"},"to":{"field":"region","value":"md"}},{"from":{"field":"region","value":"499"},"to":{"field":"region","value":"me"}},{"from":{"field":"region","value":"663"},"to":{"field":"region","value":"mf"}},{"from":{"field":"region","value":"450"},"to":{"field":"region","value":"mg"}},{"from":{"field":"region","value":"584"},"to":{"field":"region","value":"mh"}},{"from":{"field":"region","value":"807"},"to":{"field":"region","value":"mk"}},{"from":{"field":"region","value":"466"},"to":{"field":"region","value":"ml"}},{"from":{"field":"region","value":"496"},"to":{"field":"region","value":"mn"}},{"from":{"field":"region","value":"446"},"to":{"field":"region","value":"mo"}},{"from":{"field":"region","value":"580"},"to":{"field":"region","value":"mp"}},{"from":{"field":"region","value":"474"},"to":{"field":"region","value":"mq"}},{"from":{"field":"region","value":"478"},"to":{"field":"region","value":"mr"}},{"from":{"field":"region","value":"500"},"to":{"field":"region","value":"ms"}},{"from":{"field":"region","value":"470"},"to":{"field":"region","value":"mt"}},{"from":{"field":"region","value":"480"},"to":{"field":"region","value":"mu"}},{"from":{"field":"region","value":"462"},"to":{"field":"region","value":"mv"}},{"from":{"field":"region","value":"454"},"to":{"field":"region","value":"mw"}},{"from":{"field":"region","value":"484"},"to":{"field":"region","value":"mx"}},{"from":{"field":"region","value":"458"},"to":{"field":"region","value":"my"}},{"from":{"field":"region","value":"508"},"to":{"field":"region","value":"mz"}},{"from":{"field":"region","value":"516"},"to":{"field":"region","value":"na"}},{"from":{"field":"region","value":"540"},"to":{"field":"region","value":"nc"}},{"from":{"field":"region","value":"562"},"to":{"field":"region","value":"ne"}},{"from":{"field":"region","value":"574"},"to":{"field":"region","value":"nf"}},{"from":{"field":"region","value":"566"},"to":{"field":"region","value":"ng"}},{"from":{"field":"region","value":"558"},"to":{"field":"region","value":"ni"}},{"from":{"field":"region","value":"528"},"to":{"field":"region","value":"nl"}},{"from":{"field":"region","value":"578"},"to":{"field":"region","value":"no"}},{"from":{"field":"region","value":"524"},"to":{"field":"region","value":"np"}},{"from":{"field":"region","value":"520"},"to":{"field":"region","value":"nr"}},{"from":{"field":"region","value":"570"},"to":{"field":"region","value":"nu"}},{"from":{"field":"region","value":"554"},"to":{"field":"region","value":"nz"}},{"from":{"field":"region","value":"512"},"to":{"field":"region","value":"om"}},{"from":{"field":"region","value":"591"},"to":{"field":"region","value":"pa"}},{"from":{"field":"region","value":"604"},"to":{"field":"region","value":"pe"}},{"from":{"field":"region","value":"258"},"to":{"field":"region","value":"pf"}},{"from":{"field":"region","value":"598"},"to":{"field":"region","value":"pg"}},{"from":{"field":"region","value":"608"},"to":{"field":"region","value":"ph"}},{"from":{"field":"region","value":"586"},"to":{"field":"region","value":"pk"}},{"from":{"field":"region","value":"616"},"to":{"field":"region","value":"pl"}},{"from":{"field":"region","value":"666"},"to":{"field":"region","value":"pm"}},{"from":{"field":"region","value":"612"},"to":{"field":"region","value":"pn"}},{"from":{"field":"region","value":"630"},"to":{"field":"region","value":"pr"}},{"from":{"field":"region","value":"275"},"to":{"field":"region","value":"ps"}},{"from":{"field":"region","value":"620"},"to":{"field":"region","value":"pt"}},{"from":{"field":"region","value":"585"},"to":{"field":"region","value":"pw"}},{"from":{"field":"region","value":"600"},"to":{"field":"region","value":"py"}},{"from":{"field":"region","value":"634"},"to":{"field":"region","value":"qa"}},{"from":{"field":"region","value":"959"},"to":{"field":"region","value":"qm"}},{"from":{"field":"region","value":"960"},"to":{"field":"region","value":"qn"}},{"from":{"field":"region","value":"962"},"to":{"field":"region","value":"qp"}},{"from":{"field":"region","value":"963"},"to":{"field":"region","value":"qq"}},{"from":{"field":"region","value":"964"},"to":{"field":"region","value":"qr"}},{"from":{"field":"region","value":"965"},"to":{"field":"region","value":"qs"}},{"from":{"field":"region","value":"966"},"to":{"field":"region","value":"qt"}},{"from":{"field":"region","value":"967"},"to":{"field":"region","value":"eu"}},{"from":{"field":"region","value":"968"},"to":{"field":"region","value":"qv"}},{"from":{"field":"region","value":"969"},"to":{"field":"region","value":"qw"}},{"from":{"field":"region","value":"970"},"to":{"field":"region","value":"qx"}},{"from":{"field":"region","value":"971"},"to":{"field":"region","value":"qy"}},{"from":{"field":"region","value":"972"},"to":{"field":"region","value":"qz"}},{"from":{"field":"region","value":"638"},"to":{"field":"region","value":"re"}},{"from":{"field":"region","value":"642"},"to":{"field":"region","value":"ro"}},{"from":{"field":"region","value":"688"},"to":{"field":"region","value":"rs"}},{"from":{"field":"region","value":"643"},"to":{"field":"region","value":"ru"}},{"from":{"field":"region","value":"646"},"to":{"field":"region","value":"rw"}},{"from":{"field":"region","value":"682"},"to":{"field":"region","value":"sa"}},{"from":{"field":"region","value":"090"},"to":{"field":"region","value":"sb"}},{"from":{"field":"region","value":"690"},"to":{"field":"region","value":"sc"}},{"from":{"field":"region","value":"729"},"to":{"field":"region","value":"sd"}},{"from":{"field":"region","value":"752"},"to":{"field":"region","value":"se"}},{"from":{"field":"region","value":"702"},"to":{"field":"region","value":"sg"}},{"from":{"field":"region","value":"654"},"to":{"field":"region","value":"sh"}},{"from":{"field":"region","value":"705"},"to":{"field":"region","value":"si"}},{"from":{"field":"region","value":"744"},"to":{"field":"region","value":"sj"}},{"from":{"field":"region","value":"703"},"to":{"field":"region","value":"sk"}},{"from":{"field":"region","value":"694"},"to":{"field":"region","value":"sl"}},{"from":{"field":"region","value":"674"},"to":{"field":"region","value":"sm"}},{"from":{"field":"region","value":"686"},"to":{"field":"region","value":"sn"}},{"from":{"field":"region","value":"706"},"to":{"field":"region","value":"so"}},{"from":{"field":"region","value":"740"},"to":{"field":"region","value":"sr"}},{"from":{"field":"region","value":"728"},"to":{"field":"region","value":"ss"}},{"from":{"field":"region","value":"678"},"to":{"field":"region","value":"st"}},{"from":{"field":"region","value":"222"},"to":{"field":"region","value":"sv"}},{"from":{"field":"region","value":"534"},"to":{"field":"region","value":"sx"}},{"from":{"field":"region","value":"760"},"to":{"field":"region","value":"sy"}},{"from":{"field":"region","value":"748"},"to":{"field":"region","value":"sz"}},{"from":{"field":"region","value":"796"},"to":{"field":"region","value":"tc"}},{"from":{"field":"region","value":"148"},"to":{"field":"region","value":"td"}},{"from":{"field":"region","value":"260"},"to":{"field":"region","value":"tf"}},{"from":{"field":"region","value":"768"},"to":{"field":"region","value":"tg"}},{"from":{"field":"region","value":"764"},"to":{"field":"region","value":"th"}},{"from":{"field":"region","value":"762"},"to":{"field":"region","value":"tj"}},{"from":{"field":"region","value":"772"},"to":{"field":"region","value":"tk"}},{"from":{"field":"region","value":"626"},"to":{"field":"region","value":"tl"}},{"from":{"field":"region","value":"795"},"to":{"field":"region","value":"tm"}},{"from":{"field":"region","value":"788"},"to":{"field":"region","value":"tn"}},{"from":{"field":"region","value":"776"},"to":{"field":"region","value":"to"}},{"from":{"field":"region","value":"792"},"to":{"field":"region","value":"tr"}},{"from":{"field":"region","value":"780"},"to":{"field":"region","value":"tt"}},{"from":{"field":"region","value":"798"},"to":{"field":"region","value":"tv"}},{"from":{"field":"region","value":"158"},"to":{"field":"region","value":"tw"}},{"from":{"field":"region","value":"834"},"to":{"field":"region","value":"tz"}},{"from":{"field":"region","value":"804"},"to":{"field":"region","value":"ua"}},{"from":{"field":"region","value":"800"},"to":{"field":"region","value":"ug"}},{"from":{"field":"region","value":"581"},"to":{"field":"region","value":"um"}},{"from":{"field":"region","value":"840"},"to":{"field":"region","value":"us"}},{"from":{"field":"region","value":"858"},"to":{"field":"region","value":"uy"}},{"from":{"field":"region","value":"860"},"to":{"field":"region","value":"uz"}},{"from":{"field":"region","value":"336"},"to":{"field":"region","value":"va"}},{"from":{"field":"region","value":"670"},"to":{"field":"region","value":"vc"}},{"from":{"field":"region","value":"862"},"to":{"field":"region","value":"ve"}},{"from":{"field":"region","value":"092"},"to":{"field":"region","value":"vg"}},{"from":{"field":"region","value":"850"},"to":{"field":"region","value":"vi"}},{"from":{"field":"region","value":"704"},"to":{"field":"region","value":"vn"}},{"from":{"field":"region","value":"548"},"to":{"field":"region","value":"vu"}},{"from":{"field":"region","value":"876"},"to":{"field":"region","value":"wf"}},{"from":{"field":"region","value":"882"},"to":{"field":"region","value":"ws"}},{"from":{"field":"region","value":"973"},"to":{"field":"region","value":"xa"}},{"from":{"field":"region","value":"974"},"to":{"field":"region","value":"xb"}},{"from":{"field":"region","value":"975"},"to":{"field":"region","value":"xc"}},{"from":{"field":"region","value":"976"},"to":{"field":"region","value":"xd"}},{"from":{"field":"region","value":"977"},"to":{"field":"region","value":"xe"}},{"from":{"field":"region","value":"978"},"to":{"field":"region","value":"xf"}},{"from":{"field":"region","value":"979"},"to":{"field":"region","value":"xg"}},{"from":{"field":"region","value":"980"},"to":{"field":"region","value":"xh"}},{"from":{"field":"region","value":"981"},"to":{"field":"region","value":"xi"}},{"from":{"field":"region","value":"982"},"to":{"field":"region","value":"xj"}},{"from":{"field":"region","value":"983"},"to":{"field":"region","value":"xk"}},{"from":{"field":"region","value":"984"},"to":{"field":"region","value":"xl"}},{"from":{"field":"region","value":"985"},"to":{"field":"region","value":"xm"}},{"from":{"field":"region","value":"986"},"to":{"field":"region","value":"xn"}},{"from":{"field":"region","value":"987"},"to":{"field":"region","value":"xo"}},{"from":{"field":"region","value":"988"},"to":{"field":"region","value":"xp"}},{"from":{"field":"region","value":"989"},"to":{"field":"region","value":"xq"}},{"from":{"field":"region","value":"990"},"to":{"field":"region","value":"xr"}},{"from":{"field":"region","value":"991"},"to":{"field":"region","value":"xs"}},{"from":{"field":"region","value":"992"},"to":{"field":"region","value":"xt"}},{"from":{"field":"region","value":"993"},"to":{"field":"region","value":"xu"}},{"from":{"field":"region","value":"994"},"to":{"field":"region","value":"xv"}},{"from":{"field":"region","value":"995"},"to":{"field":"region","value":"xw"}},{"from":{"field":"region","value":"996"},"to":{"field":"region","value":"xx"}},{"from":{"field":"region","value":"997"},"to":{"field":"region","value":"xy"}},{"from":{"field":"region","value":"998"},"to":{"field":"region","value":"xz"}},{"from":{"field":"region","value":"720"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"887"},"to":{"field":"region","value":"ye"}},{"from":{"field":"region","value":"175"},"to":{"field":"region","value":"yt"}},{"from":{"field":"region","value":"710"},"to":{"field":"region","value":"za"}},{"from":{"field":"region","value":"894"},"to":{"field":"region","value":"zm"}},{"from":{"field":"region","value":"716"},"to":{"field":"region","value":"zw"}},{"from":{"field":"region","value":"999"},"to":{"field":"region","value":"zz"}},{"from":{"field":"variants","value":"aaland"},"to":{"field":"region","value":"ax"}},{"from":{"field":"variants","value":"polytoni"},"to":{"field":"variants","value":"polyton"}},{"from":{"field":"variants","value":"heploc"},"to":{"field":"variants","value":"alalc97"}},{"from":{"field":"variants","value":"arevela"},"to":{"field":"language","value":"hy"}},{"from":{"field":"variants","value":"arevmda"},"to":{"field":"language","value":"hyw"}}]')},9460:function(e){e.exports=JSON.parse('{"region":{"172":["ru","am","az","by","ge","kg","kz","md","tj","tm","ua","uz"],"200":["cz","sk"],"530":["cw","sx","bq"],"532":["cw","sx","bq"],"536":["sa","iq"],"582":["fm","mh","mp","pw"],"810":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"830":["je","gg"],"890":["rs","me","si","hr","mk","ba"],"891":["rs","me"],"an":["cw","sx","bq"],"cs":["rs","me"],"fq":["aq","tf"],"nt":["sa","iq"],"pc":["fm","mh","mp","pw"],"su":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yu":["rs","me"],"062":["034","143"],"ant":["cw","sx","bq"],"scg":["rs","me"],"ntz":["sa","iq"],"sun":["ru","am","az","by","ee","ge","kz","kg","lv","lt","md","tj","tm","ua","uz"],"yug":["rs","me"]}}')},7778:function(e){e.exports=JSON.parse('[{"from":"in","to":"id"},{"from":"iw","to":"he"},{"from":"ji","to":"yi"},{"from":"jw","to":"jv"},{"from":"mo","to":"ro"},{"from":"scc","to":"sr"},{"from":"scr","to":"hr"},{"from":"aam","to":"aas"},{"from":"adp","to":"dz"},{"from":"aue","to":"ktz"},{"from":"ayx","to":"nun"},{"from":"bgm","to":"bcg"},{"from":"bjd","to":"drl"},{"from":"ccq","to":"rki"},{"from":"cjr","to":"mom"},{"from":"cka","to":"cmr"},{"from":"cmk","to":"xch"},{"from":"coy","to":"pij"},{"from":"cqu","to":"quh"},{"from":"drh","to":"mn"},{"from":"drw","to":"fa-af"},{"from":"gav","to":"dev"},{"from":"gfx","to":"vaj"},{"from":"ggn","to":"gvr"},{"from":"gti","to":"nyc"},{"from":"guv","to":"duz"},{"from":"hrr","to":"jal"},{"from":"ibi","to":"opa"},{"from":"ilw","to":"gal"},{"from":"jeg","to":"oyb"},{"from":"kgc","to":"tdf"},{"from":"kgh","to":"kml"},{"from":"koj","to":"kwv"},{"from":"krm","to":"bmf"},{"from":"ktr","to":"dtp"},{"from":"kvs","to":"gdj"},{"from":"kwq","to":"yam"},{"from":"kxe","to":"tvd"},{"from":"kzj","to":"dtp"},{"from":"kzt","to":"dtp"},{"from":"lii","to":"raq"},{"from":"lmm","to":"rmx"},{"from":"meg","to":"cir"},{"from":"mst","to":"mry"},{"from":"mwj","to":"vaj"},{"from":"myt","to":"mry"},{"from":"nad","to":"xny"},{"from":"ncp","to":"kdz"},{"from":"nnx","to":"ngv"},{"from":"nts","to":"pij"},{"from":"oun","to":"vaj"},{"from":"pcr","to":"adx"},{"from":"pmc","to":"huw"},{"from":"pmu","to":"phr"},{"from":"ppa","to":"bfy"},{"from":"ppr","to":"lcq"},{"from":"pry","to":"prt"},{"from":"puz","to":"pub"},{"from":"sca","to":"hle"},{"from":"skk","to":"oyb"},{"from":"tdu","to":"dtp"},{"from":"thc","to":"tpo"},{"from":"thx","to":"oyb"},{"from":"tie","to":"ras"},{"from":"tkk","to":"twm"},{"from":"tlw","to":"weo"},{"from":"tmp","to":"tyj"},{"from":"tne","to":"kak"},{"from":"tnf","to":"fa-af"},{"from":"tsf","to":"taj"},{"from":"uok","to":"ema"},{"from":"xba","to":"cax"},{"from":"xia","to":"acn"},{"from":"xkh","to":"waw"},{"from":"xsj","to":"suj"},{"from":"ybd","to":"rki"},{"from":"yma","to":"lrr"},{"from":"ymt","to":"mtm"},{"from":"yos","to":"zom"},{"from":"yuu","to":"yug"},{"from":"asd","to":"snz"},{"from":"dit","to":"dif"},{"from":"llo","to":"ngt"},{"from":"myd","to":"aog"},{"from":"nns","to":"nbr"},{"from":"sgn-br","to":"bzs"},{"from":"sgn-co","to":"csn"},{"from":"sgn-de","to":"gsg"},{"from":"sgn-dk","to":"dsl"},{"from":"sgn-fr","to":"fsl"},{"from":"sgn-gb","to":"bfi"},{"from":"sgn-gr","to":"gss"},{"from":"sgn-ie","to":"isg"},{"from":"sgn-it","to":"ise"},{"from":"sgn-jp","to":"jsl"},{"from":"sgn-mx","to":"mfs"},{"from":"sgn-ni","to":"ncs"},{"from":"sgn-nl","to":"dse"},{"from":"sgn-no","to":"nsi"},{"from":"sgn-pt","to":"psr"},{"from":"sgn-se","to":"swl"},{"from":"sgn-us","to":"ase"},{"from":"sgn-za","to":"sfs"},{"from":"no-bokmal","to":"nb"},{"from":"no-nynorsk","to":"nn"},{"from":"aa-saaho","to":"ssy"},{"from":"sh","to":"sr-latn"},{"from":"cnr","to":"sr-me"},{"from":"no","to":"nb"},{"from":"tl","to":"fil"},{"from":"az-az","to":"az-latn-az"},{"from":"bs-ba","to":"bs-latn-ba"},{"from":"ha-latn-gh","to":"ha-gh"},{"from":"ha-latn-ne","to":"ha-ne"},{"from":"ha-latn-ng","to":"ha-ng"},{"from":"kk-cyrl-kz","to":"kk-kz"},{"from":"ky-cyrl-kg","to":"ky-kg"},{"from":"ks-arab-in","to":"ks-in"},{"from":"mn-cyrl-mn","to":"mn-mn"},{"from":"ms-latn-bn","to":"ms-bn"},{"from":"ms-latn-my","to":"ms-my"},{"from":"ms-latn-sg","to":"ms-sg"},{"from":"pa-in","to":"pa-guru-in"},{"from":"pa-pk","to":"pa-arab-pk"},{"from":"shi-ma","to":"shi-tfng-ma"},{"from":"sr-ba","to":"sr-cyrl-ba"},{"from":"sr-me","to":"sr-latn-me"},{"from":"sr-rs","to":"sr-cyrl-rs"},{"from":"sr-xk","to":"sr-cyrl-xk"},{"from":"tzm-latn-ma","to":"tzm-ma"},{"from":"ug-arab-cn","to":"ug-cn"},{"from":"uz-af","to":"uz-arab-af"},{"from":"uz-uz","to":"uz-latn-uz"},{"from":"vai-lr","to":"vai-vaii-lr"},{"from":"yue-cn","to":"yue-hans-cn"},{"from":"yue-hk","to":"yue-hant-hk"},{"from":"zh-cn","to":"zh-hans-cn"},{"from":"zh-hk","to":"zh-hant-hk"},{"from":"zh-mo","to":"zh-hant-mo"},{"from":"zh-sg","to":"zh-hans-sg"},{"from":"zh-tw","to":"zh-hant-tw"},{"from":"aju","to":"jrb"},{"from":"als","to":"sq"},{"from":"arb","to":"ar"},{"from":"ayr","to":"ay"},{"from":"azj","to":"az"},{"from":"bcc","to":"bal"},{"from":"bcl","to":"bik"},{"from":"bxk","to":"luy"},{"from":"bxr","to":"bua"},{"from":"cld","to":"syr"},{"from":"cmn","to":"zh"},{"from":"cwd","to":"cr"},{"from":"dgo","to":"doi"},{"from":"dhd","to":"mwr"},{"from":"dik","to":"din"},{"from":"diq","to":"zza"},{"from":"lbk","to":"bnc"},{"from":"ekk","to":"et"},{"from":"emk","to":"man"},{"from":"esk","to":"ik"},{"from":"fat","to":"ak"},{"from":"fuc","to":"ff"},{"from":"gaz","to":"om"},{"from":"gbo","to":"grb"},{"from":"gno","to":"gon"},{"from":"gug","to":"gn"},{"from":"gya","to":"gba"},{"from":"hdn","to":"hai"},{"from":"hea","to":"hmn"},{"from":"ike","to":"iu"},{"from":"kmr","to":"ku"},{"from":"knc","to":"kr"},{"from":"kng","to":"kg"},{"from":"knn","to":"kok"},{"from":"kpv","to":"kv"},{"from":"lvs","to":"lv"},{"from":"mhr","to":"chm"},{"from":"mup","to":"raj"},{"from":"khk","to":"mn"},{"from":"npi","to":"ne"},{"from":"ojg","to":"oj"},{"from":"ory","to":"or"},{"from":"pbu","to":"ps"},{"from":"pes","to":"fa"},{"from":"plt","to":"mg"},{"from":"pnb","to":"lah"},{"from":"quz","to":"qu"},{"from":"rmy","to":"rom"},{"from":"spy","to":"kln"},{"from":"src","to":"sc"},{"from":"swh","to":"sw"},{"from":"ttq","to":"tmh"},{"from":"tw","to":"ak"},{"from":"umu","to":"del"},{"from":"uzn","to":"uz"},{"from":"xpe","to":"kpe"},{"from":"xsl","to":"den"},{"from":"ydd","to":"yi"},{"from":"zai","to":"zap"},{"from":"zsm","to":"ms"},{"from":"zyb","to":"za"},{"from":"him","to":"srx"},{"from":"mnk","to":"man"},{"from":"bh","to":"bho"},{"from":"prs","to":"fa-af"},{"from":"swc","to":"sw-cd"},{"from":"aar","to":"aa"},{"from":"abk","to":"ab"},{"from":"ave","to":"ae"},{"from":"afr","to":"af"},{"from":"aka","to":"ak"},{"from":"amh","to":"am"},{"from":"arg","to":"an"},{"from":"ara","to":"ar"},{"from":"asm","to":"as"},{"from":"ava","to":"av"},{"from":"aym","to":"ay"},{"from":"aze","to":"az"},{"from":"bak","to":"ba"},{"from":"bel","to":"be"},{"from":"bul","to":"bg"},{"from":"bih","to":"bho"},{"from":"bis","to":"bi"},{"from":"bam","to":"bm"},{"from":"ben","to":"bn"},{"from":"bod","to":"bo"},{"from":"bre","to":"br"},{"from":"bos","to":"bs"},{"from":"cat","to":"ca"},{"from":"che","to":"ce"},{"from":"cha","to":"ch"},{"from":"cos","to":"co"},{"from":"cre","to":"cr"},{"from":"ces","to":"cs"},{"from":"chu","to":"cu"},{"from":"chv","to":"cv"},{"from":"cym","to":"cy"},{"from":"dan","to":"da"},{"from":"deu","to":"de"},{"from":"div","to":"dv"},{"from":"dzo","to":"dz"},{"from":"ewe","to":"ee"},{"from":"ell","to":"el"},{"from":"eng","to":"en"},{"from":"epo","to":"eo"},{"from":"spa","to":"es"},{"from":"est","to":"et"},{"from":"eus","to":"eu"},{"from":"fas","to":"fa"},{"from":"ful","to":"ff"},{"from":"fin","to":"fi"},{"from":"fij","to":"fj"},{"from":"fao","to":"fo"},{"from":"fra","to":"fr"},{"from":"fry","to":"fy"},{"from":"gle","to":"ga"},{"from":"gla","to":"gd"},{"from":"glg","to":"gl"},{"from":"grn","to":"gn"},{"from":"guj","to":"gu"},{"from":"glv","to":"gv"},{"from":"hau","to":"ha"},{"from":"heb","to":"he"},{"from":"hin","to":"hi"},{"from":"hmo","to":"ho"},{"from":"hrv","to":"hr"},{"from":"hat","to":"ht"},{"from":"hun","to":"hu"},{"from":"hye","to":"hy"},{"from":"her","to":"hz"},{"from":"ina","to":"ia"},{"from":"ind","to":"id"},{"from":"ile","to":"ie"},{"from":"ibo","to":"ig"},{"from":"iii","to":"ii"},{"from":"ipk","to":"ik"},{"from":"ido","to":"io"},{"from":"isl","to":"is"},{"from":"ita","to":"it"},{"from":"iku","to":"iu"},{"from":"jpn","to":"ja"},{"from":"jav","to":"jv"},{"from":"kat","to":"ka"},{"from":"kon","to":"kg"},{"from":"kik","to":"ki"},{"from":"kua","to":"kj"},{"from":"kaz","to":"kk"},{"from":"kal","to":"kl"},{"from":"khm","to":"km"},{"from":"kan","to":"kn"},{"from":"kor","to":"ko"},{"from":"kau","to":"kr"},{"from":"kas","to":"ks"},{"from":"kur","to":"ku"},{"from":"kom","to":"kv"},{"from":"cor","to":"kw"},{"from":"kir","to":"ky"},{"from":"lat","to":"la"},{"from":"ltz","to":"lb"},{"from":"lug","to":"lg"},{"from":"lim","to":"li"},{"from":"lin","to":"ln"},{"from":"lao","to":"lo"},{"from":"lit","to":"lt"},{"from":"lub","to":"lu"},{"from":"lav","to":"lv"},{"from":"mlg","to":"mg"},{"from":"mah","to":"mh"},{"from":"mri","to":"mi"},{"from":"mkd","to":"mk"},{"from":"mal","to":"ml"},{"from":"mon","to":"mn"},{"from":"mol","to":"ro"},{"from":"mar","to":"mr"},{"from":"msa","to":"ms"},{"from":"mlt","to":"mt"},{"from":"mya","to":"my"},{"from":"nau","to":"na"},{"from":"nob","to":"nb"},{"from":"nde","to":"nd"},{"from":"nep","to":"ne"},{"from":"ndo","to":"ng"},{"from":"nld","to":"nl"},{"from":"nno","to":"nn"},{"from":"nor","to":"nb"},{"from":"nbl","to":"nr"},{"from":"nav","to":"nv"},{"from":"nya","to":"ny"},{"from":"oci","to":"oc"},{"from":"oji","to":"oj"},{"from":"orm","to":"om"},{"from":"ori","to":"or"},{"from":"oss","to":"os"},{"from":"pan","to":"pa"},{"from":"pli","to":"pi"},{"from":"pol","to":"pl"},{"from":"pus","to":"ps"},{"from":"por","to":"pt"},{"from":"que","to":"qu"},{"from":"roh","to":"rm"},{"from":"run","to":"rn"},{"from":"ron","to":"ro"},{"from":"rus","to":"ru"},{"from":"kin","to":"rw"},{"from":"san","to":"sa"},{"from":"srd","to":"sc"},{"from":"snd","to":"sd"},{"from":"sme","to":"se"},{"from":"sag","to":"sg"},{"from":"hbs","to":"sr-latn"},{"from":"sin","to":"si"},{"from":"slk","to":"sk"},{"from":"slv","to":"sl"},{"from":"smo","to":"sm"},{"from":"sna","to":"sn"},{"from":"som","to":"so"},{"from":"sqi","to":"sq"},{"from":"srp","to":"sr"},{"from":"ssw","to":"ss"},{"from":"sot","to":"st"},{"from":"sun","to":"su"},{"from":"swe","to":"sv"},{"from":"swa","to":"sw"},{"from":"tam","to":"ta"},{"from":"tel","to":"te"},{"from":"tgk","to":"tg"},{"from":"tha","to":"th"},{"from":"tir","to":"ti"},{"from":"tuk","to":"tk"},{"from":"tgl","to":"fil"},{"from":"tsn","to":"tn"},{"from":"ton","to":"to"},{"from":"tur","to":"tr"},{"from":"tso","to":"ts"},{"from":"tat","to":"tt"},{"from":"twi","to":"ak"},{"from":"tah","to":"ty"},{"from":"uig","to":"ug"},{"from":"ukr","to":"uk"},{"from":"urd","to":"ur"},{"from":"uzb","to":"uz"},{"from":"ven","to":"ve"},{"from":"vie","to":"vi"},{"from":"vol","to":"vo"},{"from":"wln","to":"wa"},{"from":"wol","to":"wo"},{"from":"xho","to":"xh"},{"from":"yid","to":"yi"},{"from":"yor","to":"yo"},{"from":"zha","to":"za"},{"from":"zho","to":"zh"},{"from":"zul","to":"zu"},{"from":"alb","to":"sq"},{"from":"arm","to":"hy"},{"from":"baq","to":"eu"},{"from":"bur","to":"my"},{"from":"chi","to":"zh"},{"from":"cze","to":"cs"},{"from":"dut","to":"nl"},{"from":"fre","to":"fr"},{"from":"geo","to":"ka"},{"from":"ger","to":"de"},{"from":"gre","to":"el"},{"from":"ice","to":"is"},{"from":"mac","to":"mk"},{"from":"mao","to":"mi"},{"from":"may","to":"ms"},{"from":"per","to":"fa"},{"from":"rum","to":"ro"},{"from":"slo","to":"sk"},{"from":"tib","to":"bo"},{"from":"wel","to":"cy"}]')},8589:function(e){e.exports=JSON.parse('{"en-gb-oed":"en-GB-oxendict","i-ami":"ami","i-bnn":"bnn","i-default":null,"i-enochian":null,"i-hak":"hak","i-klingon":"tlh","i-lux":"lb","i-mingo":null,"i-navajo":"nv","i-pwn":"pwn","i-tao":"tao","i-tay":"tay","i-tsu":"tsu","sgn-be-fr":"sfb","sgn-be-nl":"vgt","sgn-ch-de":"sgg","art-lojban":"jbo","cel-gaulish":null,"no-bok":"nb","no-nyn":"nn","zh-guoyu":"cmn","zh-hakka":"hak","zh-min":null,"zh-min-nan":"nan","zh-xiang":"hsn"}')},858:function(e){e.exports=JSON.parse('["art-lojban","cel-gaulish","no-bok","no-nyn","zh-guoyu","zh-hakka","zh-min","zh-min-nan","zh-xiang"]')}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}r.amdO={},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var n={};return function(){r.d(n,{default:function(){return c}}),r(8416);var e,t=r(1715),i=r(8080),a=r(1737),s=r(1139),o=function(){var e,t="application/dash+xml";function r(r,n,i){if(!r||!/^VIDEO$/i.test(r.nodeName))return null;if(r._dashjs_player)return r._dashjs_player;var a,o=r.id||r.name||"video element";if(!(n=n||[].slice.call(r.querySelectorAll("source")).filter(function(e){return e.type==t})[0])&&r.src)(n=document.createElement("source")).src=r.src;else if(!n&&!r.src)return null;return i=i||{},(a=(0,s.Z)(i).create()).initialize(r,n.src,r.autoplay),e||(e=a.getDebug().getLogger()),e.debug("Converted "+o+" to dash.js player and added content: "+n.src),r._dashjs_player=a,a}function n(e){return/^VIDEO$/i.test(e.nodeName)?e:n(e.parentNode)}return{create:r,createAll:function(e,i){var a=[];e=e||"[data-dashjs-player]";for(var s=(i=i||document).querySelectorAll(e),o=0;o<s.length;o++){var l=r(s[o],null);a.push(l)}for(var u=i.querySelectorAll('source[type="'+t+'"]'),c=0;c<u.length;c++){var d=r(n(u[c]),null);a.push(d)}return a}}}();!("undefined"!=typeof window&&window&&window.dashjs&&window.dashjs.skipAutoCreate)&&"undefined"!=typeof window&&window&&window.addEventListener&&("complete"===window.document.readyState?window.dashjs?o.createAll():e=window.setInterval(function(){window.dashjs&&(window.clearInterval(e),o.createAll())},500):window.addEventListener("load",function e(){window.removeEventListener("load",e),o.createAll()}));var l=o,u=r(6398);dashjs.Protection=a.default,dashjs.MetricsReporting=i.default,dashjs.MediaPlayerFactory=l,dashjs.Debug=u.Z,dashjs.supportsMediaSource=t.B;var c=dashjs}(),n.default}()),xc.exports);function Bc(e){return e?e>=2160?"4K":e>=1440?"1440p":e>=1080?"1080p":e>=720?"720p":e>=540?"540p":e>=480?"480p":e>=360?"360p":e>=240?"240p":`${e}p`:null}function Uc(e){if(!e)return!1;const t=e.toLowerCase();return t.endsWith(".mpd")||t.includes("/dash/")||t.includes("format=dash")}function Zc(e,t,r,i,a,s,o,l,u){const c=n(null),d=n(null),f=n(null),h=n(null),g=n(null),p=n(null),m=e=>e?e>=2160?"4K":e>=1440?"1440p":e>=1080?"1080p":e>=720?"720p":e>=480?"480p":e>=360?"360p":e>=240?"240p":`${e}p`:null,v=()=>{if(c.value){if(d.value&&(d.value.destroy(),d.value=null),f.value){try{f.value.reset(),f.value.destroy()}catch(e){console.warn("[ReplacementPlayer] Error cleaning up DASH:",e)}f.value=null}if(h.value=null,c.value.src="",c.value.removeAttribute("src"),s.value){const e=a.value;if(e&&c.value){const t=c.value;if(Uc(e))try{const r=Fc.MediaPlayer().create();r.updateSettings({streaming:{buffer:{bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:30,longFormContentDurationThreshold:600,initialBufferLevel:30,fastSwitchEnabled:!0},abr:{useDefaultABRRules:!0,initialBitrate:{audio:-1,video:-1}}}});const n=()=>{try{const e=r,t=e.getRepresentationsForType?.("video");if(!t||0===t.length)return;const n=e.getQualityFor?.("video")??-1;if(n>=0&&n<t.length)h.value=m(t[n].height);else if(t.length>0){const e=[...t].sort((e,t)=>(t.height||0)-(e.height||0));h.value=m(e[0].height)}y()}catch(e){console.warn("[ReplacementPlayer] Error updating DASH quality:",e)}},i=Fc.MediaPlayer.events;i&&(i.STREAM_INITIALIZED&&r.on(i.STREAM_INITIALIZED,()=>{setTimeout(n,200)}),i.QUALITY_CHANGE_RENDERED&&r.on(i.QUALITY_CHANGE_RENDERED,n)),r.initialize(t,e,!1),f.value=r,t.addEventListener("loadedmetadata",()=>{setTimeout(n,300)}),setTimeout(n,1e3)}catch(r){console.error("[ReplacementPlayer] Error setting up DASH:",r),l(t,e)}else if(Oc.isSupported()){const r=new Oc({enableWorker:!0,lowLatencyMode:!0,backBufferLength:90,autoStartLoad:!0,maxBufferLength:3,maxMaxBufferLength:6,maxBufferSize:6e7});r.loadSource(e),r.attachMedia(t),d.value=r;const n=()=>{if(r.levels&&r.levels.length>0){const e=r.currentLevel;if(e>=0&&e<r.levels.length)h.value=m(r.levels[e].height);else if(r.levels.length>0){const e=[...r.levels].sort((e,t)=>(t.height||0)-(e.height||0));h.value=m(e[0].height)}y()}};r.on(Oc.Events.LEVEL_SWITCHED,n),r.on(Oc.Events.LEVEL_LOADED,n),r.on(Oc.Events.MANIFEST_PARSED,()=>{setTimeout(n,100)});const i=()=>{r&&(r.startLoad(),t.removeEventListener("play",i))};t.addEventListener("play",i)}else o(t,e)}}else{const e=u.value;e&&(c.value.src=e,c.value.load())}y()}},y=()=>{const t=document.querySelector(".file-preview");if(!t)return;const r=t.querySelector(".replacement-player-info");if(!r)return;const n=e.value&&"string"==typeof e.value?e.value.split("/").pop():"",i=a.value,o=!!i&&Uc(i),l=s.value&&i?o?"DASH":"HLS":"",u=h.value||"",c=[];n&&c.push(`<span style="font-weight: 500;">${n}</span>`),l&&c.push(`<span class="${o?"dash":"hls"}-label" style="background: var(--theme--primary, #6644ff); color: var(--white, #fff); padding: 2px 6px; border-radius: 4px; font-weight: 500; font-size: 11px;">${l}</span>`),u&&c.push(`<span class="quality-label" style="background: var(--theme--primary, #6644ff); color: var(--white, #fff); padding: 2px 6px; border-radius: 4px; font-weight: 500; font-size: 11px;">${u}</span>`),r.innerHTML=`\n\t\t\t<div style="color: var(--theme--foreground-inverse-subdued, rgba(255, 255, 255, 0.7)); font-size: 12px; display: flex; gap: 8px; flex-wrap: wrap; align-items: center;">\n\t\t\t\t${c.join("")}\n\t\t\t</div>\n\t\t`},E=()=>{g.value=function(e){if("undefined"!=typeof window){const e=window.location.pathname.match(/\/files\/([^\/]+)/);if(e&&e[1])return e[1]}return e?.["primary-key"]?e["primary-key"]:null}(t),setTimeout(()=>{const e=document.querySelector(".file-preview");if(!e)return void setTimeout(E,100);const t=e.querySelector("video");if(!t)return;if("true"===t.dataset.replacedByHls)return void v();const n=a.value;if(!n){const e=u.value;return e&&!s.value?(c.value=t,t.dataset.replacedByHls="true",t.src=e,void t.load()):void 0}c.value=t,t.dataset.replacedByHls="true",t.src="",t.removeAttribute("src"),t.removeAttribute("poster"),t.poster="";const i=t;i.style.width="100%",i.style.height="auto",i.style.display="block",i.style.aspectRatio="16 / 9",i.style.maxWidth="100%",i.style.minWidth="100%",i.style.objectFit="contain";const T=i.parentElement;T&&!T.classList.contains("video-container-wrapper")&&(T.style.position="relative",T.style.width="100%",T.style.maxWidth="100%",T.classList.add("video-container-wrapper"));const _=()=>{i.style.width="100%",i.style.maxWidth="100%",i.style.minWidth="100%",T&&(T.style.width="100%",T.style.maxWidth="100%"),i.offsetWidth};if(Uc(n))try{const e=Fc.MediaPlayer().create();e.updateSettings({streaming:{buffer:{bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:30,longFormContentDurationThreshold:600,initialBufferLevel:30,fastSwitchEnabled:!0},abr:{useDefaultABRRules:!0,initialBitrate:{audio:-1,video:-1}}}});const t=()=>{try{const t=e,r=t.getRepresentationsForType?.("video");if(!r||0===r.length)return;const n=t.getQualityFor?.("video")??-1;if(n>=0&&n<r.length){const e=r[n];h.value=m(e.height)}else if(r.length>0){const e=[...r].sort((e,t)=>(t.height||0)-(e.height||0));h.value=m(e[0].height)}y()}catch(e){console.warn("[ReplacementPlayer] Error updating DASH quality:",e)}},r=Fc.MediaPlayer.events;r&&(r.STREAM_INITIALIZED&&e.on(r.STREAM_INITIALIZED,()=>{setTimeout(()=>{t()},200)}),r.QUALITY_CHANGE_RENDERED&&e.on(r.QUALITY_CHANGE_RENDERED,()=>{t()})),e.initialize(i,n,!1),f.value=e,i.addEventListener("loadedmetadata",()=>{setTimeout(()=>{t()},300)}),i.addEventListener("playing",()=>{setTimeout(()=>{t()},500)}),setTimeout(()=>{t()},1e3)}catch(e){console.error("[ReplacementPlayer] Error setting up DASH:",e),l(i,n)}else if(Oc.isSupported()){const e=new Oc({enableWorker:!0,lowLatencyMode:!0,backBufferLength:90,autoStartLoad:!0,maxBufferLength:3,maxMaxBufferLength:6,maxBufferSize:6e7});e.loadSource(n),e.attachMedia(i),d.value=e;const t=()=>{if(e.levels&&e.levels.length>0){const t=e.currentLevel;if(t>=0&&t<e.levels.length){const r=e.levels[t];h.value=m(r.height)}else if(e.levels.length>0){const t=[...e.levels].sort((e,t)=>(t.height||0)-(e.height||0));h.value=m(t[0].height)}y()}};e.on(Oc.Events.LEVEL_SWITCHED,()=>{_(),t(),setTimeout(_,50)}),e.on(Oc.Events.LEVEL_LOADED,()=>{_(),t()}),e.on(Oc.Events.MANIFEST_PARSED,()=>{_(),setTimeout(()=>{_(),t()},100)});const r=()=>{e&&(e.startLoad(),i.removeEventListener("play",r))};i.addEventListener("play",r)}else o(i,n);i.setAttribute("preload","none"),i.addEventListener("loadedmetadata",()=>{_(),setTimeout(_,100)}),i.addEventListener("loadeddata",()=>{_()}),i.addEventListener("resize",_),g.value&&(async e=>{try{const t=(await r.get(`/files/${e}`)).data.data;p.value=t.type||"video/mp4"}catch(e){console.error("Failed to load file data for replacement player:",e),p.value="video/mp4"}})(g.value),(e=>{let t=e.querySelector(".replacement-player-info");if(!t){t=document.createElement("div"),t.className="replacement-player-info",t.style.cssText="\n\t\t\t\tposition: absolute;\n\t\t\t\tinset-block-start: 0;\n\t\t\t\tinset-inline-start: 0;\n\t\t\t\tz-index: 3;\n\t\t\t\tpadding: 12px;\n\t\t\t\tline-height: 1.2;\n\t\t\t\topacity: 0;\n\t\t\t\tvisibility: hidden;\n\t\t\t\ttransition: opacity 0.2s ease, visibility 0.2s ease;\n\t\t\t\tpointer-events: none;\n\t\t\t";const r=e.querySelector(".video-container-wrapper")||e;r&&(r.addEventListener("mouseenter",()=>{t&&(t.style.opacity="1",t.style.visibility="visible")}),r.addEventListener("mouseleave",()=>{t&&(t.style.opacity="0",t.style.visibility="hidden")})),e.appendChild(t)}y()})(e),setTimeout(()=>{y()},500),((e,t)=>{const r=e.querySelector(".format-toggle-container");if(r){const e=r.querySelector(".format-toggle");return void(e&&(e.textContent=s.value?"Switch to File":"Switch to Stream"))}const n=document.createElement("div");n.className="format-toggle-container",n.style.cssText="display: flex; justify-content: flex-end; margin-block-start: 12px; position: absolute; right: 0;";const i=document.createElement("button");i.className="format-toggle",i.textContent=s.value?"Switch to File":"Switch to Stream",i.style.cssText="color: var(--theme--primary); cursor: pointer; font-weight: 600; background: none; border: none; padding: 0;",i.addEventListener("click",()=>{t(),i.textContent=s.value?"Switch to File":"Switch to Stream"}),n.appendChild(i),e.appendChild(n)})(e,()=>{s.value=!s.value,v();const t=e.querySelector(".format-toggle");t&&(t.textContent=s.value?"Switch to File":"Switch to Stream")})},100)};return{replacementVideoElement:c,replacementHlsInstance:d,currentFileId:g,currentFileType:p,mp4Url:u,replaceDefaultVideoPlayer:E,updateReplacementPlayer:v,cleanupReplacementPlayer:()=>{if(d.value&&(d.value.destroy(),d.value=null),f.value){try{f.value.reset(),f.value.destroy()}catch(e){console.warn("[ReplacementPlayer] Error cleaning up DASH:",e)}f.value=null}c.value&&(c.value.dataset.replacedByHls="false",c.value=null),h.value=null},togglePlaybackFormat:(e,t)=>{if(s.value=!s.value,i.value&&c.value){v();const e=document.querySelector(".file-preview");if(e){const t=e.querySelector(".format-toggle");t&&(t.textContent=s.value?"Switch to File":"Switch to Stream")}}else if(e.value){const r=s.value?"none":"metadata";e.value.setAttribute("preload",r),e.value.preload=r,t()}}}}const Gc={key:0,class:"video-preview"},Hc={class:"video-container"},$c=["preload"],Vc={class:"actions"},Kc={key:0,class:"info"},qc={class:"title"},Yc={class:"meta"},jc={key:0,class:"dash-label"},zc={key:1,class:"hls-label"},Wc={key:2,class:"quality-label"},Xc={key:0,class:"format-toggle-container"};var Qc=i({__name:"StringFieldSection",props:{value:{},editingValue:{},isEditingStringField:{type:Boolean},isFileModule:{type:Boolean},shouldReplaceDefaultPlayer:{type:Boolean},streamUrlFromValue:{},videoPreload:{},useHls:{type:Boolean},currentQuality:{},disabled:{type:Boolean},inputOptions:{},inputPlaceholder:{},processedValue:{}},emits:["update:value","focus","blur","loaded","fullscreen","edit","clear","toggle-format"],setup(e,{expose:t}){const i=e,a=n(null),s=n(!1),b=()=>{a.value&&(a.value.paused?(a.value.play(),s.value=!0):(a.value.pause(),s.value=!1))},A=()=>{a.value&&(s.value=!a.value.paused)},I=()=>{a.value&&(a.value.addEventListener("play",A),a.value.addEventListener("pause",A),a.value.addEventListener("ended",()=>{s.value=!1}),A())},R=r(()=>!!i.streamUrlFromValue&&Uc(i.streamUrlFromValue));return o(a,e=>{e&&I()},{immediate:!0}),l(()=>{u(()=>{I()})}),c(()=>{a.value&&(a.value.removeEventListener("play",A),a.value.removeEventListener("pause",A),a.value.removeEventListener("ended",()=>{s.value=!1}))}),t({videoElement:a}),(t,r)=>{const n=d("v-input"),i=d("v-icon"),o=d("v-button"),l=f("tooltip");return g(),h("div",null,[p(" Input field - show when value is null, when editing, or when in file module "),m("div",{class:v(["input-wrapper",`font-${e.inputOptions.font}`])},[!e.value||e.isEditingStringField||e.isFileModule?(g(),y(n,{key:0,"model-value":e.isEditingStringField?e.editingValue:e.processedValue,disabled:e.disabled,placeholder:e.inputPlaceholder,"icon-left":e.inputOptions.iconLeft,"icon-right":e.inputOptions.iconRight,autocomplete:e.inputOptions.masked?"off":void 0,type:e.inputOptions.masked?"password":"text","onUpdate:modelValue":r[0]||(r[0]=e=>t.$emit("update:value",e)),onFocus:r[1]||(r[1]=e=>t.$emit("focus")),onBlur:r[2]||(r[2]=e=>t.$emit("blur"))},null,8,["model-value","disabled","placeholder","icon-left","icon-right","autocomplete","type"])):p("v-if",!0),p(" Soft length indicator "),e.inputOptions.softLength&&(e.isEditingStringField?e.editingValue:e.processedValue)?(g(),h("div",{key:1,class:v(["soft-length-indicator",{"soft-length-exceeded":(e.isEditingStringField?e.editingValue:e.processedValue)?.length&&(e.isEditingStringField?e.editingValue:e.processedValue).length>e.inputOptions.softLength}])},E((e.isEditingStringField?e.editingValue:e.processedValue)?.length||0)+" / "+E(e.inputOptions.softLength),3)):p("v-if",!0)],2),p(" Video Player Preview for string fields (only show if not replacing default player and has value) "),!e.shouldReplaceDefaultPlayer&&e.value&&e.streamUrlFromValue?(g(),h("div",Gc,[m("div",Hc,[m("video",{ref_key:"videoElementRef",ref:a,controls:"",preload:e.videoPreload,class:"video-player",onLoadedmetadata:r[3]||(r[3]=e=>t.$emit("loaded"))}," Your browser does not support the video tag. ",40,$c),r[8]||(r[8]=m("div",{class:"shadow"},null,-1)),m("div",Vc,[T((g(),y(o,{rounded:"",icon:"",secondary:"",onClick:b},{default:_(()=>[S(i,{name:s.value?"pause":"play_arrow"},null,8,["name"])]),_:1})),[[l,s.value?"Pause":"Play"]]),T((g(),y(o,{rounded:"",icon:"",secondary:"",onClick:r[4]||(r[4]=e=>t.$emit("fullscreen"))},{default:_(()=>[S(i,{name:"zoom_in"})]),_:1})),[[l,"Fullscreen"]]),T((g(),y(o,{rounded:"",icon:"",secondary:"",onClick:r[5]||(r[5]=e=>t.$emit("edit"))},{default:_(()=>[S(i,{name:"edit"})]),_:1})),[[l,"Edit"]]),T((g(),y(o,{rounded:"",icon:"",secondary:"",onClick:r[6]||(r[6]=e=>t.$emit("clear"))},{default:_(()=>[S(i,{name:"close"})]),_:1})),[[l,"Clear"]])]),e.value?(g(),h("div",Kc,[m("div",qc,E(e.value.split("/").pop()),1),m("div",Yc,[R.value?(g(),h("span",jc," DASH ")):e.useHls?(g(),h("span",zc," HLS ")):p("v-if",!0),(R.value||e.useHls)&&e.currentQuality?(g(),h("span",Wc,E(e.currentQuality),1)):p("v-if",!0)])])):p("v-if",!0)]),p(" Toggle button below player - only show for file item pages "),e.isFileModule?(g(),h("div",Xc,[m("button",{class:"format-toggle",onClick:r[7]||(r[7]=e=>t.$emit("toggle-format"))},E(e.useHls?"Switch to Source File":"Switch to Stream"),1)])):p("v-if",!0)])):p("v-if",!0)])}}}),Jc=[],ed=[];function td(e,t){if(e&&"undefined"!=typeof document){var r,n=!0===t.prepend?"prepend":"append",i=!0===t.singleTag,a="string"==typeof t.container?document.querySelector(t.container):document.getElementsByTagName("head")[0];if(i){var s=Jc.indexOf(a);-1===s&&(s=Jc.push(a)-1,ed[s]={}),r=ed[s]&&ed[s][n]?ed[s][n]:ed[s][n]=o()}else r=o();65279===e.charCodeAt(0)&&(e=e.substring(1)),r.styleSheet?r.styleSheet.cssText+=e:r.appendChild(document.createTextNode(e))}function o(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),t.attributes)for(var r=Object.keys(t.attributes),i=0;i<r.length;i++)e.setAttribute(r[i],t.attributes[r[i]]);var s="prepend"===n?"afterbegin":"beforeend";return a.insertAdjacentElement(s,e),e}}td("\n.input-wrapper[data-v-e036b6ce] {\n\tposition: relative;\n}\n.input-wrapper.font-sans-serif[data-v-e036b6ce] input,\n.input-wrapper.font-sans-serif[data-v-e036b6ce] textarea {\n\tfont-family: var(--theme--font-family-sans, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif);\n}\n.input-wrapper.font-serif[data-v-e036b6ce] input,\n.input-wrapper.font-serif[data-v-e036b6ce] textarea {\n\tfont-family: var(--theme--font-family-serif, Georgia, 'Times New Roman', serif);\n}\n.input-wrapper.font-monospace[data-v-e036b6ce] input,\n.input-wrapper.font-monospace[data-v-e036b6ce] textarea {\n\tfont-family: var(--theme--font-family-monospace, 'Courier New', Courier, monospace);\n}\n.soft-length-indicator[data-v-e036b6ce] {\n\tposition: absolute;\n\tbottom: -20px;\n\tright: 0;\n\tfont-size: 12px;\n\tcolor: var(--theme--foreground-subdued, #999);\n\tpadding: 2px 4px;\n}\n.soft-length-indicator.soft-length-exceeded[data-v-e036b6ce] {\n\tcolor: var(--theme--danger, #ff0000);\n}\n.video-preview[data-v-e036b6ce] {\n\tbackground: var(--theme--background-subdued);\n\tborder-radius: var(--theme--border-radius);\n}\n.video-preview:hover .actions[data-v-e036b6ce],\n.video-preview:hover .info[data-v-e036b6ce] {\n\topacity: 1;\n\tvisibility: visible;\n}\n.video-container[data-v-e036b6ce] {\n\tposition: relative;\n\twidth: 100%;\n\tmax-width: 800px;\n\tmargin: 0 auto;\n}\n.shadow[data-v-e036b6ce] {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground: linear-gradient(to bottom, rgba(0, 0, 0, 0.3) 0%, transparent 30%, transparent 70%, rgba(0, 0, 0, 0.3) 100%);\n\tpointer-events: none;\n\tz-index: 1;\n}\n.actions[data-v-e036b6ce] {\n\t--v-button-color: var(--theme--form--field--input--foreground-subdued);\n\t--v-button-background-color: var(--white);\n\t--v-button-color-hover: var(--theme--form--field--input--foreground);\n\t--v-button-background-color-hover: var(--white);\n\t\n\tposition: absolute;\n\tinset-block-start: calc(50% - 32px);\n\tinset-inline-start: 0;\n\tz-index: 3;\n\tdisplay: flex;\n\tjustify-content: center;\n\tinline-size: 100%;\n\tgap: 12px;\n\t\n\topacity: 0;\n\tvisibility: hidden;\n\ttransition: opacity 0.2s ease, visibility 0.2s ease;\n}\n.actions[data-v-e036b6ce] .v-button {\n\t--v-button-background-color: var(--white) !important;\n\t--v-button-color: var(--theme--form--field--input--foreground-subdued) !important;\n\tbackground-color: var(--white) !important;\n\tborder-color: var(--white) !important;\n}\n.actions[data-v-e036b6ce] .v-button:hover {\n\t--v-button-background-color-hover: var(--white) !important;\n\t--v-button-color-hover: var(--theme--form--field--input--foreground) !important;\n\tbackground-color: var(--white) !important;\n\tborder-color: var(--white) !important;\n}\n.info[data-v-e036b6ce] {\n\tposition: absolute;\n\tinset-block-start: 0;\n\tinset-inline-start: 0;\n\tz-index: 3;\n\tpadding: 12px;\n\tline-height: 1.2;\n\t\n\topacity: 0;\n\tvisibility: hidden;\n\ttransition: opacity 0.2s ease, visibility 0.2s ease;\n}\n.info .title[data-v-e036b6ce] {\n\tcolor: var(--theme--foreground-inverse, #fff);\n\tmargin-bottom: 4px;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n.info .meta[data-v-e036b6ce] {\n\tcolor: var(--theme--foreground-inverse-subdued, rgba(255, 255, 255, 0.7));\n\tfont-size: 12px;\n\tdisplay: flex;\n\tgap: 8px;\n\tflex-wrap: wrap;\n}\n.info .meta .hls-label[data-v-e036b6ce],\n.info .meta .dash-label[data-v-e036b6ce] {\n\tbackground: var(--theme--primary, #6644ff);\n\tcolor: var(--white, #fff);\n\tmargin-top: 4px;\n\tpadding: 2px 6px;\n\tborder-radius: 4px;\n\tfont-weight: 500;\n\tfont-size: 11px;\n}\n.info .meta .quality-label[data-v-e036b6ce] {\n\tbackground: var(--theme--primary, #6644ff);\n\tcolor: var(--white, #fff);\n\tmargin-top: 4px;\n\tpadding: 2px 6px;\n\tborder-radius: 4px;\n\tfont-weight: 500;\n\tfont-size: 11px;\n}\n.video-player[data-v-e036b6ce] {\n\twidth: 100%;\n\theight: auto;\n\tdisplay: block;\n\taspect-ratio: 16/9;\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background-black, #000);\n}\n.video-player[data-v-e036b6ce]::-webkit-media-controls-loading-panel {\n\tdisplay: none !important;\n}\n.video-player[data-v-e036b6ce]::-webkit-media-controls-play-button {\n\tdisplay: flex !important;\n}\n.video-player[data-v-e036b6ce]::before {\n\tdisplay: none !important;\n\tcontent: none !important;\n}\n.video-player[data-v-e036b6ce]::after {\n\tdisplay: none !important;\n\tcontent: none !important;\n}\n.video-player[preload=\"none\"][data-v-e036b6ce] {\n\tbackground: var(--theme--background-black, #000);\n}\n.video-player[data-v-e036b6ce]:not([src])::before,\n.video-player[preload=\"none\"][data-v-e036b6ce]::before {\n\tdisplay: none !important;\n\tcontent: none !important;\n}\n.video-player[data-v-e036b6ce]::-moz-media-controls-loading-panel {\n\tdisplay: none !important;\n}\n.format-toggle-container[data-v-e036b6ce] {\n\tdisplay: flex;\n\tjustify-content: flex-end;\n\tmargin-block-start: 12px;\n\tposition: absolute;\n\tright: 0;\n}\n.format-toggle[data-v-e036b6ce] {\n\tcolor: var(--theme--primary);\n\tcursor: pointer;\n\tfont-weight: 600;\n\tbackground: none;\n\tborder: none;\n\tpadding: 0;\n\tfont-family: inherit;\n\tfont-size: inherit;\n}\n.format-toggle[data-v-e036b6ce]:hover {\n\topacity: 0.8;\n}\n",{});var rd=(e,t)=>{const r=e.__vccOpts||e;for(const[e,n]of t)r[e]=n;return r},nd=rd(Qc,[["__scopeId","data-v-e036b6ce"]]);const id={key:0},ad={key:0,class:"file-upload-area"},sd={key:1,class:"video-preview"},od={class:"video-container"},ld=["poster","preload"],ud={class:"actions"},cd={key:0,class:"info"},dd={class:"title"},fd={class:"meta"},hd={key:0},gd={key:1},pd={key:2},md={key:0,class:"meta"},vd={key:0},yd={key:1,class:"meta"},Ed={key:0,class:"dash-label"},Td={key:1,class:"hls-label"},_d={key:2,class:"quality-label"};var Sd=i({__name:"FileFieldSection",props:{value:{},fileData:{},shouldReplaceDefaultPlayer:{type:Boolean},isVideoFile:{type:Boolean},videoPreload:{},posterUrl:{},downloadUrl:{},streamLinkFieldName:{},currentQuality:{},createAllowed:{type:Boolean},enableCreateValue:{type:Boolean},enableSelectValue:{type:Boolean},folder:{},customFilter:{}},emits:["upload","loaded","fullscreen","edit","clear"],setup(e,{expose:t}){const i=e,a=n(null),s=n(!1),v=()=>{a.value&&(a.value.paused?(a.value.play(),s.value=!0):(a.value.pause(),s.value=!1))},A=()=>{a.value&&(s.value=!a.value.paused)},I=()=>{a.value&&(a.value.addEventListener("play",A),a.value.addEventListener("pause",A),a.value.addEventListener("ended",()=>{s.value=!1}),A())},R=r(()=>{if(!i.fileData||!i.streamLinkFieldName)return!1;const e=i.fileData[i.streamLinkFieldName];return"string"==typeof e&&Uc(e)});return o(a,e=>{e&&I()},{immediate:!0}),l(()=>{u(()=>{I()})}),c(()=>{a.value&&(a.value.removeEventListener("play",A),a.value.removeEventListener("pause",A),a.value.removeEventListener("ended",()=>{s.value=!1}))}),t({videoElement:a}),(t,r)=>{const n=d("v-upload"),i=d("v-icon"),o=d("v-button"),l=f("tooltip");return e.shouldReplaceDefaultPlayer?p("v-if",!0):(g(),h("div",id,[p(" Dropzone/Upload Area when no file is selected "),e.fileData&&e.value?p("v-if",!0):(g(),h("div",ad,[S(n,{"from-url":"","from-user":e.createAllowed&&e.enableCreateValue,"from-library":e.enableSelectValue,folder:e.folder,filter:e.customFilter,onInput:r[0]||(r[0]=e=>t.$emit("upload",e))},null,8,["from-user","from-library","folder","filter"])])),p(" Video Player Preview for file fields "),e.fileData&&e.isVideoFile?(g(),h("div",sd,[m("div",od,[m("video",{ref_key:"videoElementRef",ref:a,poster:e.posterUrl||void 0,controls:"",preload:e.videoPreload,class:"video-player",onLoadedmetadata:r[1]||(r[1]=e=>t.$emit("loaded"))}," Your browser does not support the video tag. ",40,ld),r[5]||(r[5]=m("div",{class:"shadow"},null,-1)),m("div",ud,[T((g(),y(o,{rounded:"",icon:"",secondary:"",onClick:v},{default:_(()=>[S(i,{name:s.value?"pause":"play_arrow"},null,8,["name"])]),_:1})),[[l,s.value?"Pause":"Play"]]),T((g(),y(o,{rounded:"",icon:"",secondary:"",onClick:r[2]||(r[2]=e=>t.$emit("fullscreen"))},{default:_(()=>[S(i,{name:"zoom_in"})]),_:1})),[[l,"Fullscreen"]]),T((g(),y(o,{rounded:"",icon:"",secondary:"",href:e.downloadUrl,download:e.fileData?.filename_download||"video"},{default:_(()=>[S(i,{name:"download"})]),_:1},8,["href","download"])),[[l,"Download"]]),T((g(),y(o,{rounded:"",icon:"",secondary:"",onClick:r[3]||(r[3]=e=>t.$emit("edit"))},{default:_(()=>[S(i,{name:"edit"})]),_:1})),[[l,"Edit"]]),T((g(),y(o,{rounded:"",icon:"",secondary:"",onClick:r[4]||(r[4]=e=>t.$emit("clear"))},{default:_(()=>[S(i,{name:"close"})]),_:1})),[[l,"Clear"]])]),e.fileData?(g(),h("div",cd,[m("div",dd,E(e.fileData.filename_download||e.fileData.id),1),m("div",fd,[e.fileData.width&&e.fileData.height?(g(),h("span",hd,E(e.fileData.width)+"x"+E(e.fileData.height),1)):p("v-if",!0),e.fileData.filesize?(g(),h("span",gd,E(b(vt)(e.fileData.filesize)),1)):p("v-if",!0),e.fileData.type?(g(),h("span",pd,E(e.fileData.type),1)):p("v-if",!0)]),e.fileData&&e.streamLinkFieldName&&e.fileData[e.streamLinkFieldName]?(g(),h("div",md,["string"==typeof e.fileData[e.streamLinkFieldName]?(g(),h("span",vd,E(e.fileData[e.streamLinkFieldName].split("/").pop()),1)):p("v-if",!0)])):p("v-if",!0),e.fileData&&e.streamLinkFieldName&&e.fileData[e.streamLinkFieldName]?(g(),h("div",yd,[R.value?(g(),h("span",Ed," DASH ")):(g(),h("span",Td," HLS ")),e.currentQuality?(g(),h("span",_d,E(e.currentQuality),1)):p("v-if",!0)])):p("v-if",!0)])):p("v-if",!0)])])):p("v-if",!0)]))}}});td('\n.file-upload-area[data-v-a0e2eefe] {\n\tmargin-bottom: 16px;\n}\n.video-preview[data-v-a0e2eefe] {\n\tbackground: var(--theme--background-subdued);\n\tborder-radius: var(--theme--border-radius);\n}\n.video-preview:hover .actions[data-v-a0e2eefe],\n.video-preview:hover .info[data-v-a0e2eefe] {\n\topacity: 1;\n\tvisibility: visible;\n}\n.video-container[data-v-a0e2eefe] {\n\tposition: relative;\n\twidth: 100%;\n\tmax-width: 800px;\n\tmargin: 0 auto;\n}\n.shadow[data-v-a0e2eefe] {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground: linear-gradient(to bottom, rgba(0, 0, 0, 0.3) 0%, transparent 30%, transparent 70%, rgba(0, 0, 0, 0.3) 100%);\n\tpointer-events: none;\n\tz-index: 1;\n}\n.actions[data-v-a0e2eefe] {\n\t--v-button-color: var(--theme--form--field--input--foreground-subdued);\n\t--v-button-background-color: var(--white);\n\t--v-button-color-hover: var(--theme--form--field--input--foreground);\n\t--v-button-background-color-hover: var(--white);\n\t\n\tposition: absolute;\n\tinset-block-start: calc(50% - 32px);\n\tinset-inline-start: 0;\n\tz-index: 3;\n\tdisplay: flex;\n\tjustify-content: center;\n\tinline-size: 100%;\n\tgap: 12px;\n\t\n\topacity: 0;\n\tvisibility: hidden;\n\ttransition: opacity 0.2s ease, visibility 0.2s ease;\n}\n.actions[data-v-a0e2eefe] .v-button {\n\t--v-button-background-color: var(--white) !important;\n\t--v-button-color: var(--theme--form--field--input--foreground-subdued) !important;\n\tbackground-color: var(--white) !important;\n\tborder-color: var(--white) !important;\n}\n.actions[data-v-a0e2eefe] .v-button:hover {\n\t--v-button-background-color-hover: var(--white) !important;\n\t--v-button-color-hover: var(--theme--form--field--input--foreground) !important;\n\tbackground-color: var(--white) !important;\n\tborder-color: var(--white) !important;\n}\n.info[data-v-a0e2eefe] {\n\tposition: absolute;\n\tinset-block-start: 0;\n\tinset-inline-start: 0;\n\tz-index: 3;\n\tpadding: 12px;\n\tline-height: 1.2;\n\t\n\topacity: 0;\n\tvisibility: hidden;\n\ttransition: opacity 0.2s ease, visibility 0.2s ease;\n}\n.info .title[data-v-a0e2eefe] {\n\tcolor: var(--theme--foreground-inverse, #fff);\n\tmargin-bottom: 4px;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n}\n.info .meta[data-v-a0e2eefe] {\n\tcolor: var(--theme--foreground-inverse-subdued, rgba(255, 255, 255, 0.7));\n\tfont-size: 12px;\n\tdisplay: flex;\n\tgap: 8px;\n\tflex-wrap: wrap;\n}\n.info .meta .hls-label[data-v-a0e2eefe],\n.info .meta .dash-label[data-v-a0e2eefe] {\n\tbackground: var(--theme--primary, #6644ff);\n\tcolor: var(--white, #fff);\n\tmargin-top: 4px;\n\tpadding: 2px 6px;\n\tborder-radius: 4px;\n\tfont-weight: 500;\n\tfont-size: 11px;\n}\n.info .meta .quality-label[data-v-a0e2eefe] {\n\tbackground: var(--theme--primary, #6644ff);\n\tcolor: var(--white, #fff);\n\tmargin-top: 4px;\n\tpadding: 2px 6px;\n\tborder-radius: 4px;\n\tfont-weight: 500;\n\tfont-size: 11px;\n}\n.video-player[data-v-a0e2eefe] {\n\twidth: 100%;\n\theight: auto;\n\tdisplay: block;\n\taspect-ratio: 16/9;\n\tborder-radius: var(--theme--border-radius);\n\tbackground: var(--theme--background-black, #000);\n}\n.video-player[data-v-a0e2eefe]::-webkit-media-controls-loading-panel {\n\tdisplay: none !important;\n}\n.video-player[data-v-a0e2eefe]::-webkit-media-controls-play-button {\n\tdisplay: flex !important;\n}\n.video-player[data-v-a0e2eefe]::before {\n\tdisplay: none !important;\n\tcontent: none !important;\n}\n.video-player[data-v-a0e2eefe]::after {\n\tdisplay: none !important;\n\tcontent: none !important;\n}\n.video-player[preload="none"][data-v-a0e2eefe] {\n\tbackground: var(--theme--background-black, #000);\n}\n.video-player[data-v-a0e2eefe]:not([src])::before,\n.video-player[preload="none"][data-v-a0e2eefe]::before {\n\tdisplay: none !important;\n\tcontent: none !important;\n}\n.video-player[data-v-a0e2eefe]::-moz-media-controls-loading-panel {\n\tdisplay: none !important;\n}\n',{});var bd=rd(Sd,[["__scopeId","data-v-a0e2eefe"]]),Ad=i({__name:"FileEditDrawer",props:{fileData:{},downloadUrl:{},disabled:{type:Boolean},value:{}},emits:["update"],setup(e,{expose:t,emit:i}){const a=e,s=n(!1),o=r(()=>a.value&&"object"==typeof a.value?a.value:{});return t({editDrawerActive:s}),(t,r)=>{const n=d("v-icon"),i=d("v-button"),a=d("drawer-item");return e.fileData?(g(),y(a,{key:0,active:s.value,"onUpdate:active":r[0]||(r[0]=e=>s.value=e),collection:"directus_files","primary-key":e.fileData.id,edits:o.value,disabled:e.disabled,onInput:r[1]||(r[1]=e=>t.$emit("update",e))},{actions:_(()=>[S(i,{secondary:"",rounded:"",icon:"",download:e.fileData?.filename_download,href:e.downloadUrl},{default:_(()=>[S(n,{name:"download"})]),_:1},8,["download","href"])]),_:1},8,["active","primary-key","edits","disabled"])):p("v-if",!0)}}});const Id={class:"video-player-interface"};var Rd=i({__name:"interface",props:{value:{},collection:{},field:{},disabled:{type:Boolean},loading:{type:Boolean},width:{},fieldMeta:{},item:{},folder:{},filter:{},enableCreate:{type:Boolean,default:!0},enableSelect:{type:Boolean,default:!0},options:{}},emits:["input"],setup(t,{emit:i}){const a=t,s=i,d=e(),f=A(),m=I("values",n({})),v=n(null),E=n(null),T=n(null),_=n(null),w=n(!0);let D=null;const{fileData:L,loadFileData:C,clearFileData:N}=function(){const t=e(),r=n(null),i=n(!1);return{fileData:r,loading:i,loadFileData:async e=>{i.value=!0;try{const n=await t.get(`/files/${e}`);return r.value=n.data.data,r.value}catch(e){return console.error("Failed to load file data:",e),r.value=null,null}finally{i.value=!1}},clearFileData:()=>{r.value=null}}}(),{inputOptions:P,inputPlaceholder:O,processValue:M}=function(e){const t=r(()=>({placeholder:e.placeholder||"Enter full URL or relative path",iconLeft:e.iconLeft,iconRight:e.iconRight,softLength:e.softLength,font:e.font||"sans-serif",trim:e.trim??!1,masked:e.masked??!1,clear:e.clear??!1,slug:e.slug??!1})),n=r(()=>t.value.placeholder);return{inputOptions:t,inputPlaceholder:n,processValue:(e,t)=>{if(!e)return e;let r=e;return t.trim&&(r=r.trim()),t.slug&&(r=r.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")),t.softLength&&r.length>t.softLength&&(r=r.substring(0,t.softLength)),r}}}(f),{hlsInstance:k,currentQuality:x,setupHlsPlayer:F,cleanupHls:B}=function(e){const t=n(null),r=n(null),i=n(null);return{hlsInstance:t,playEventListener:r,currentQuality:i,setupHlsPlayer:(n,a,s)=>{if(a&&Oc.isSupported()){const s=new Oc({enableWorker:!0,lowLatencyMode:!0,backBufferLength:90,autoStartLoad:!0,maxBufferLength:3,maxMaxBufferLength:6,maxBufferSize:6e7});s.loadSource(a),s.attachMedia(n);const o=()=>{s&&(s.startLoad(),n.removeEventListener("play",o))};n.addEventListener("play",o);const l=()=>{if(s.levels&&s.levels.length>0){const r=s.currentLevel;if(r>=0&&r<s.levels.length){const a=Mc(s.levels[r].height);s!==t.value&&n!==e.value||(i.value=a)}else if(s.levels.length>0){const r=Mc([...s.levels].sort((e,t)=>(t.height||0)-(e.height||0))[0].height);s!==t.value&&n!==e.value||(i.value=r)}}};s.on(Oc.Events.MANIFEST_PARSED,()=>{setTimeout(()=>{l()},100)}),s.on(Oc.Events.LEVEL_SWITCHED,()=>{l()}),s.on(Oc.Events.LEVEL_LOADED,()=>{l()}),n===e.value&&(t.value=s,r.value=o,s.levels&&s.levels.length>0&&l())}else a&&n.canPlayType("application/vnd.apple.mpegurl")?n.src=a:(console.warn("HLS not supported in this browser"),s&&s())},cleanupHls:n=>{const a=n||e.value;a&&r.value&&(a.removeEventListener("play",r.value),r.value=null),t.value&&(t.value.destroy(),t.value=null),i.value=null}}}(v),{currentQuality:U,setupDashPlayer:Z,cleanupDash:G}=function(e){const t=n(null),r=n(null),i=new Map;return{dashInstance:t,currentQuality:r,setupDashPlayer:(n,a,s)=>{if(a){if(n===e.value&&t.value){try{t.value.reset(),t.value.destroy()}catch(e){console.warn("[DashPlayer] Error cleaning up existing player:",e)}t.value=null,r.value=null}try{const s=Fc.MediaPlayer().create();s.updateSettings({streaming:{buffer:{bufferTimeAtTopQuality:30,bufferTimeAtTopQualityLongForm:30,longFormContentDurationThreshold:600,initialBufferLevel:30,fastSwitchEnabled:!0},abr:{useDefaultABRRules:!0,initialBitrate:{audio:-1,video:-1}}}});const o=n===e.value;o&&(t.value=s);const l=i=>{try{if(n!==e.value)return;const a=t.value;if(!a)return;const s=a;let o=i;if(o&&o.height){const e=Bc(o.height);if(e)return void(r.value=e)}if(o||(o=s.getCurrentRepresentationForType?.("video")),!o){const e=s.getQualityFor?.("video");if(null!=e){const t=s.getBitrateInfoListFor?.("video")||[];t[e]&&(o=t[e])}}if(!o){const e=s.getRepresentationsByType?.("video")||[];if(e.length>0){const t=s.getQualityFor?.("video");o=null!=t&&e[t]?e[t]:e[0]}}if(!o||!o.height){const e=n.videoHeight;if(e&&e>0){const t=Bc(e);if(t)return void(r.value=t)}}if(o&&o.height){const e=Bc(o.height);e&&(r.value=e)}}catch(e){console.error("[DashPlayer] Error updating quality:",e)}},u=Fc.MediaPlayer.events;if(u&&o?(console.log("[DashPlayer] Setting up event listeners for main player"),u.STREAM_INITIALIZED&&s.on(u.STREAM_INITIALIZED,()=>{console.log("[DashPlayer] STREAM_INITIALIZED event fired",{videoElMatches:n===e.value,hasStoredInstance:!!t.value}),n===e.value&&t.value?(console.log("[DashPlayer] Calling updateQuality from STREAM_INITIALIZED"),l()):console.log("[DashPlayer] Skipping updateQuality - not main video or no instance")}),u.QUALITY_CHANGE_RENDERED&&s.on(u.QUALITY_CHANGE_RENDERED,r=>{console.log("[DashPlayer] QUALITY_CHANGE_RENDERED event fired",{videoElMatches:n===e.value,hasStoredInstance:!!t.value,hasNewRep:!(!r||!r.newRepresentation),mediaType:r?.mediaType}),n===e.value&&t.value?(console.log("[DashPlayer] Calling updateQuality from QUALITY_CHANGE_RENDERED"),r&&r.newRepresentation&&"video"===r.mediaType?l(r.newRepresentation):l()):console.log("[DashPlayer] Skipping updateQuality - not main video or no instance")})):console.log("[DashPlayer] Not setting up event listeners",{hasEvents:!!u,isMainPlayer:o}),o){const r=()=>{t.value===s&&n===e.value&&l()};n.addEventListener("loadedmetadata",r),i.set(n,()=>{n.removeEventListener("loadedmetadata",r)})}s.initialize(n,a,!1)}catch(e){console.error("[DashPlayer] Error setting up DASH player:",e),s&&s()}}else s&&s()},cleanupDash:e=>{if(e){const t=i.get(e);t&&(t(),i.delete(e))}if(t.value){try{t.value.reset(),t.value.destroy()}catch(e){console.warn("[DashPlayer] Error cleaning up DASH player:",e)}t.value=null}r.value=null}}}(v),{getStreamUrl:H,apiBaseUrl:$}=Et({api:d,hostUrl:f.host_url,urlSchema:f.url_schema,streamSecret:f.stream_secret,includeIp:f.include_ip,expiresInMinutes:f.expires_in_minutes}),V=r(()=>x.value||U.value||null),K=r(()=>f.stream_link_field_name||""),{isStringField:q,isFileModule:Y,shouldReplaceDefaultPlayer:j,isVideoFile:z,streamUrlFromValue:W,mp4Url:X,posterUrl:Q,videoUrl:J,downloadUrl:ee,folder:te,enableSelectValue:re,enableCreateValue:ne,createAllowed:ie,customFilter:ae}=function(e,t,n,i,a,s,o){const l=r(()=>{const r=t["local-type"]||t.localType,n=e.fieldMeta?.type,a=t.type;if("file"===r)return!1;if("standard"===r)return!0;if("string"===n||"string"===a)return!0;if(t.m2o||t.relations)return!1;if("uuid"===n||"uuid"===a)return!1;if("directus_files"===e.collection&&i.value&&e.field===i.value)return!0;if(e.value&&"string"==typeof e.value){if(e.value.startsWith("/"))return!0;if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e.value))return!1}return!1}),u=r(()=>"directus_files"===e.collection),c=r(()=>!(!(u.value&&l.value&&e.value)||i.value&&e.field!==i.value)),d=r(()=>l.value?!!e.value:!!n.value?.type&&n.value.type.startsWith("video/")),f=r(()=>{if(l.value&&e.value)return a(e.value);if(i.value){const e=n.value?.[i.value];if(e)return a(e)}return null}),h=r(()=>{if(u.value&&l.value&&c.value){let e=null;if(t.primaryKey)e=t.primaryKey;else if(t["primary-key"])e=t["primary-key"];else if(t.item?.id)e=t.item.id;else if(o.value?.id)e=o.value.id;else if("undefined"!=typeof window){const t=window.location.pathname.match(/\/files\/([^\/]+)/);t&&t[1]&&(e=t[1])}if(e)return`${s.value.endsWith("/")?s.value.slice(0,-1):s.value}/assets/${e}`}return l.value&&!c.value?null:!l.value&&m.value?m.value:null}),g=r(()=>t.poster_image_field_name),p=r(()=>{if(u.value&&l.value&&e.value)return null;const t=g.value;if(!t)return null;const r=o.value?.[t];if(!r)return null;if("string"==typeof r)return r.startsWith("http://")||r.startsWith("https://")?r:`${s.value.endsWith("/")?s.value.slice(0,-1):s.value}/assets/${r}?key=system-large-cover`;const n=r?.id;return n?`${s.value.endsWith("/")?s.value.slice(0,-1):s.value}/assets/${n}?key=system-large-cover`:null}),m=r(()=>n.value?.id?`${s.value.endsWith("/")?s.value.slice(0,-1):s.value}/assets/${n.value.id}`:null),v=r(()=>n.value?.id?`${s.value.endsWith("/")?s.value.slice(0,-1):s.value}/assets/${n.value.id}?download=`:null),y=r(()=>t.folder||e.folder||null),E=r(()=>{const r=t.enableSelect,n=e.enableSelect;return void 0!==r?r:void 0===n||n}),T=r(()=>{const r=t.enableCreate,n=e.enableCreate;return void 0!==r?r:void 0===n||n}),_=r(()=>!1!==T.value),S=r(()=>e.filter?e.filter:null);return{isStringField:l,isFileModule:u,shouldReplaceDefaultPlayer:c,isVideoFile:d,streamUrlFromValue:f,mp4Url:h,posterUrl:p,videoUrl:m,downloadUrl:v,folder:y,enableSelectValue:E,enableCreateValue:T,createAllowed:_,customFilter:S}}(a,f,L,K,H,$,m),{isEditingStringField:se,editingValue:oe,editStringField:le,startEditing:ue,clearStringField:ce,handleStringInput:de,finishEditing:fe,resetEditingState:he}=function(e,t,r,i){const a=n(!1),s=n(null);return{isEditingStringField:a,editingValue:s,editStringField:()=>{s.value=e.value||"",a.value=!0},startEditing:()=>{a.value||(s.value=e.value||"",a.value=!0)},clearStringField:()=>{s.value=null,t("input",null),a.value=!0},handleStringInput:e=>{if(a.value){if(null==e)return void(s.value=null);let t=e;return r.value.softLength&&t.length>r.value.softLength&&(t=t.substring(0,r.value.softLength)),void(s.value=t)}if(null==e){const e=r.value.clear?"":null;return void t("input",e)}let n=e;n=i(n,r.value),t("input",n)},finishEditing:()=>{if(!a.value)return;let e=s.value;if(null==e){const e=r.value.clear?"":null;return t("input",e),void(a.value=!1)}e=i(e,r.value),t("input",e),a.value=!1},resetEditingState:()=>{a.value&&(a.value=!1,s.value=null)}}}(a,s,P,M),{mp4Url:ge,replaceDefaultVideoPlayer:pe,cleanupReplacementPlayer:me,togglePlaybackFormat:ve}=Zc(a,f,d,j,W,w,F,Z,X),{videoPreload:ye,setupVideoPlayer:Ee,openFullscreen:Te,onVideoLoaded:_e}=function(e,t,n,i,a,s,o,l,u,c,d,f,h,g){return{videoPreload:r(()=>u.value||l.value?"none":"metadata"),setupVideoPlayer:()=>{if(e.value){if(s.value&&!o.value){if(n(),a(),!e.value)return void console.warn("[VideoPlayerSetup] Video element not available for string field setup");const r=l.value;return r&&Uc(r)?void i(e.value,r,()=>{c.value?(e.value.preload="metadata",e.value.src=c.value,e.value.load()):console.warn("[VideoPlayerSetup] No MP4 URL available for DASH fallback")}):u.value||r&&(r.endsWith(".m3u8")||r.includes("m3u8"))?void(r?t(e.value,r,()=>{c.value?(e.value.preload="metadata",e.value.src=c.value,e.value.load()):console.warn("[VideoPlayerSetup] No stream URL and no MP4 URL available for string field")}):console.warn("[VideoPlayerSetup] No stream URL available for string field HLS playback. Value:",l.value)):void(c.value?(e.value.setAttribute("preload","metadata"),e.value.preload="metadata",e.value.src=c.value,e.value.load()):console.warn("[VideoPlayerSetup] No MP4 URL available for string field MP4 playback"))}if(d.value){if(n(),a(),f.value){const r=d.value?.[f.value];if(r){const n=h(r);if(n)return Uc(n)?void i(e.value,n,()=>{g.value&&(e.value.src=g.value)}):void t(e.value,n,()=>{g.value&&(e.value.src=g.value)})}}g.value&&e.value?(e.value.setAttribute("preload","metadata"),e.value.preload="metadata",e.value.src=g.value,e.value.load()):console.warn("[VideoPlayerSetup] No video URL available for file field playback",{videoUrl:g.value,hasVideoElement:!!e.value})}else console.warn("[VideoPlayerSetup] File field setup called but fileData is not available")}else console.warn("[VideoPlayerSetup] Video element not available")},openFullscreen:()=>{e.value&&e.value.requestFullscreen&&e.value.requestFullscreen()},onVideoLoaded:()=>{}}}(v,F,B,Z,G,q,j,W,w,ge,L,K,H,J);o([E,T],()=>{j.value||u(()=>{if(q.value&&E.value?.videoElement)v.value=E.value.videoElement,a.value&&W.value&&Ee();else if(!q.value&&T.value?.videoElement)v.value=T.value.videoElement,a.value&&L.value&&z.value&&Ee();else if(q.value&&E.value&&!E.value.videoElement){if(a.value&&W.value){const e={count:0},t=()=>{e.count++,E.value?.videoElement?(v.value=E.value.videoElement,Ee()):e.count<10&&setTimeout(t,100)};setTimeout(t,100)}}else if(!q.value&&T.value&&!T.value.videoElement&&a.value&&L.value&&z.value){const e={count:0},t=()=>{e.count++,T.value?.videoElement?(v.value=T.value.videoElement,Ee()):e.count<10&&setTimeout(t,100)};setTimeout(t,100)}})},{immediate:!0}),o(()=>T.value?.videoElement,(e,t)=>{j.value||q.value||se.value||e&&e!==t&&a.value&&L.value&&z.value&&(v.value=e,u(()=>{Ee()}))}),o(v,e=>{j.value||e&&a.value&&(q.value?u(()=>{v.value&&W.value&&Ee()}):!q.value&&L.value&&u(()=>{v.value&&Ee()}))},{immediate:!0}),o(W,e=>{j.value||se.value||q.value&&v.value&&e&&u(()=>{Ee()})}),o(L,(e,t)=>{if(!j.value&&!q.value&&e&&z.value){const r=!t||t.id!==e.id||K.value&&t[K.value]!==e[K.value],n=T.value?.videoElement||v.value,i=n&&(n.src||n.getAttribute("src")||n.querySelector("source")?.getAttribute("src")||k.value?.url);!r&&i||u(()=>{!v.value&&T.value?.videoElement&&(v.value=T.value.videoElement),v.value&&Ee()})}},{deep:!0}),o(()=>a.item,()=>{j.value||q.value||se.value||a.value&&L.value&&z.value&&u(()=>{!v.value&&T.value?.videoElement&&(v.value=T.value.videoElement),v.value&&Ee()})},{deep:!0}),o([v,()=>a.value,L,W],()=>{j.value||se.value||(D&&clearTimeout(D),D=setTimeout(()=>{const e=v.value||(q.value?E.value?.videoElement:T.value?.videoElement);if(e&&a.value){const t=e.src||e.getAttribute("src")||e.querySelector("source")?.getAttribute("src"),r=k.value?.url;!(q.value&&W.value||!q.value&&L.value&&z.value)||t||r||u(()=>{q.value&&E.value?.videoElement?v.value=E.value.videoElement:!q.value&&T.value?.videoElement&&(v.value=T.value.videoElement),v.value&&Ee()})}},300))},{immediate:!1}),o(w,e=>{if(v.value){const t=e?"none":"metadata";v.value.setAttribute("preload",t),v.value.preload=t}}),o(()=>a.value,e=>{const t=se.value;he(),t&&!se.value&&q.value&&e&&!j.value&&u(()=>{v.value&&W.value&&Ee()})});const Se=r(()=>a.value),be=()=>{Ae(null)},Ae=e=>{s("input",e),e?Ie(e):(N(),B(),G())},Ie=async e=>{await C(e)&&(await u(),Ee())},Re=e=>{Ae(e.id)},we=()=>{L.value?.id&&_.value&&(_.value.editDrawerActive=!0)},De=e=>{"string"==typeof e?Ae(e):e&&"object"==typeof e&&e.id?Ae(e.id):Ae(null)},Le=()=>{ve(v,Ee)};return o(()=>a.value,e=>{if(q.value){if(se.value)return;if(j.value)u(()=>{pe()});else if(me(),e){const e=(t=0)=>{E.value?.videoElement?(v.value=E.value.videoElement,Ee()):v.value?Ee():t<20&&setTimeout(()=>e(t+1),50)};u(()=>{e()})}else B(),G()}else e?C(e).then(()=>{u(()=>{if(!v.value&&T.value?.videoElement&&(v.value=T.value.videoElement),v.value)Ee();else if(z.value){const e={count:0},t=()=>{e.count++,T.value?.videoElement?(v.value=T.value.videoElement,Ee()):e.count<10&&setTimeout(t,100)};setTimeout(t,100)}})}):(L.value=null,B(),G())},{immediate:!0}),l(()=>{if(q.value){if(se.value)return;if(j.value)u(()=>{pe()});else if(a.value){const e=()=>{v.value&&W.value?Ee():v.value?setTimeout(e,100):setTimeout(e,50)};u(()=>{e()})}}else a.value&&C(a.value).then(()=>{u(()=>{v.value&&Ee()})})}),c(()=>{B(),G(),me(),D&&(clearTimeout(D),D=null)}),(e,r)=>(g(),h("div",Id,[p(" For string fields: show input only when null or editing "),b(q)?(g(),y(nd,{key:0,ref_key:"stringFieldRef",ref:E,value:t.value,"editing-value":b(oe),"is-editing-string-field":b(se),"is-file-module":b(Y),"should-replace-default-player":b(j),"stream-url-from-value":b(W),"video-preload":b(ye),"use-hls":w.value,"current-quality":V.value,disabled:t.disabled,"input-options":b(P),"input-placeholder":b(O),"processed-value":Se.value,"onUpdate:value":b(de),onFocus:b(ue),onBlur:b(fe),onLoaded:b(_e),onFullscreen:b(Te),onEdit:b(le),onClear:b(ce),onToggleFormat:Le},null,8,["value","editing-value","is-editing-string-field","is-file-module","should-replace-default-player","stream-url-from-value","video-preload","use-hls","current-quality","disabled","input-options","input-placeholder","processed-value","onUpdate:value","onFocus","onBlur","onLoaded","onFullscreen","onEdit","onClear"])):b(q)?p("v-if",!0):(g(),h(R,{key:1},[p(" For file fields: show upload area when empty, player when has value (NO input field) "),S(bd,{ref_key:"fileFieldRef",ref:T,value:t.value,"file-data":b(L),"should-replace-default-player":b(j),"is-video-file":b(z),"video-preload":b(ye),"poster-url":b(Q),"download-url":b(ee),"stream-link-field-name":K.value,"current-quality":V.value,"create-allowed":b(ie),"enable-create-value":b(ne),"enable-select-value":b(re),folder:b(te),"custom-filter":b(ae),onUpload:Re,onLoaded:b(_e),onFullscreen:b(Te),onEdit:we,onClear:be},null,8,["value","file-data","should-replace-default-player","is-video-file","video-preload","poster-url","download-url","stream-link-field-name","current-quality","create-allowed","enable-create-value","enable-select-value","folder","custom-filter","onLoaded","onFullscreen"])],2112)),p(" Edit Drawer "),S(Ad,{ref_key:"editDrawerRef",ref:_,"file-data":b(L),"download-url":b(ee),disabled:t.disabled,value:t.value,onUpdate:De},null,8,["file-data","download-url","disabled","value"])]))}});td("\n.video-player-interface[data-v-57852260] {\n\twidth: 100%;\n}\n",{});var wd=t({id:"interface-video-player",name:"Streaming Video Player",icon:"play_circle",description:"Play HLS and MPEG-DASH adaptive video streams and standard video files (mp4, etc.) with this enhanced video player interface",component:rd(Rd,[["__scopeId","data-v-57852260"]]),types:["uuid","string"],localTypes:["file","standard"],group:"relational",relational:!0,options:({relations:e,field:t})=>{if(!e||!e.m2o){const e=["bigInteger","integer","float","decimal"];t?.type&&e.includes(t.type);const r={field:"streaming_config",name:"Streaming Configuration",type:"alias",schema:null,meta:{field:"streaming_config",width:"full",interface:"group-detail",special:["alias","no-data","group"],options:{start:"collapsed"}}},n={field:"field_options",name:"Field Options",type:"alias",schema:null,meta:{field:"field_options",width:"full",interface:"group-detail",special:["alias","no-data","group"],options:{start:"collapsed"}}},i=[{field:"placeholder",name:"$t:placeholder",meta:{width:"full",interface:"system-input-translated-string",group:"field_options",options:{placeholder:"$t:enter_a_placeholder"}}},{field:"iconLeft",name:"$t:icon_left",type:"string",meta:{width:"half",interface:"select-icon",group:"field_options"}},{field:"iconRight",name:"$t:icon_right",type:"string",meta:{width:"half",interface:"select-icon",group:"field_options"}},{field:"softLength",name:"$t:soft_length",type:"integer",meta:{width:"half",interface:"input",group:"field_options",options:{placeholder:"255",min:1,max:t?.schema?.max_length}}},{field:"font",name:"$t:font",type:"string",meta:{width:"half",interface:"select-dropdown",group:"field_options",options:{choices:[{text:"$t:sans_serif",value:"sans-serif"},{text:"$t:monospace",value:"monospace"},{text:"$t:serif",value:"serif"}]}},schema:{default_value:"sans-serif"}},{field:"trim",name:"$t:interfaces.input.trim",type:"boolean",meta:{width:"half",interface:"boolean",group:"field_options",options:{label:"$t:interfaces.input.trim_label"}},schema:{default_value:!1}},{field:"masked",name:"$t:interfaces.input.mask",type:"boolean",meta:{width:"half",interface:"boolean",group:"field_options",options:{label:"$t:interfaces.input.mask_label"}},schema:{default_value:!1}},{field:"clear",name:"$t:interfaces.input.clear",type:"boolean",meta:{width:"half",interface:"boolean",group:"field_options",options:{label:"$t:interfaces.input.clear_label"}},schema:{default_value:!1}},{field:"slug",name:"$t:interfaces.input.slug",type:"boolean",meta:{width:"half",interface:"boolean",group:"field_options",options:{label:"$t:interfaces.input.slug_label"}},schema:{default_value:!1}}];return[{field:"info-notice",name:"Info",type:"alias",schema:null,meta:{width:"full",interface:"presentation-notice",special:["alias","no-data"],options:{text:"Setup complete for basic usage of the player",color:"info"}}},{field:"poster_image_field_name",name:"Poster Image Field Name",type:"string",meta:{width:"full",interface:"input",options:{placeholder:"image"},note:"Optional: Name of the local field that contains the poster image. It must be a file (UUID) or string field (full URL)."},schema:{default_value:""}},{field:"host_url",name:"Host URL",type:"string",meta:{width:"full",interface:"input",group:"streaming_config",options:{placeholder:"undefined"!=typeof window?window.location.origin:""},note:`Host domain (e.g., https://example.com). Default: ${"undefined"!=typeof window?window.location.origin:""}. Leave empty when working with fully qualified URLs in collection field.`}},r,{field:"stream_secret",name:"Stream Secret",type:"string",meta:{width:"full",interface:"input",group:"streaming_config",options:{placeholder:"Enter stream secret for HLS token generation",secret:!0},note:"Secret key used for generating secure link tokens (MD5 hash)"}},{field:"url_schema",name:"URL Schema",type:"string",meta:{width:"full",interface:"input",group:"streaming_config",options:{placeholder:"{{host_url}}{{item_field}}"},note:"Optional: URL template with mustache syntax placeholders: {{host_url}}, {{token}}, {{expires}}, {{item_field}}. Example: {{host_url}}/{{token}}/{{expires}}{{item_field}}",conditions:[{name:"Hide when stream_secret is empty",rule:{_or:[{stream_secret:{_eq:null}},{stream_secret:{_eq:""}}]},hidden:!0}]}},{field:"expires_in_minutes",name:"Token Expiration (minutes)",type:"integer",meta:{width:"full",interface:"input",group:"streaming_config",options:{placeholder:"60",min:1},note:"Token expiration time in minutes (default: 60)",conditions:[{name:"Hide when stream_secret is empty",rule:{_or:[{stream_secret:{_eq:null}},{stream_secret:{_eq:""}}]},hidden:!0}]},schema:{default_value:60}},{field:"include_ip",name:"Include IP",type:"boolean",meta:{width:"full",interface:"boolean",group:"streaming_config",readonly:!0,options:{label:"Include client IP"},note:"Include client IP address into secure token generation for client unique stream link protection",conditions:[{name:"Hide when stream_secret is empty",rule:{_or:[{stream_secret:{_eq:null}},{stream_secret:{_eq:""}}]},hidden:!0}]},schema:{default_value:!1}},n,...i]}const r=e.m2o?.related_collection;return[{field:"info-notice",name:"Info",type:"alias",schema:null,meta:{width:"full",interface:"presentation-notice",special:["alias","no-data"],options:{text:"Setup complete for basic usage of the player",color:"info"}}},{field:"poster_image_field_name",name:"Poster Image Field Name",type:"string",meta:{width:"full",interface:"input",options:{placeholder:"image"},note:"Optional: Name of the local field that contains the poster image. It must be a file (UUID) or string field (full URL)."},schema:{default_value:""}},{field:"stream_link_field_name",name:"Stream Link Field Name",type:"string",meta:{width:"full",interface:"input",options:{placeholder:"Field name in directus_files"},note:"Optional: Name of the field in the RELATED (m2o) directus_files collection",validation:{_and:[{stream_link_field_name:{_regex:"^[^\\s]+$"}}]},validation_message:"Field name cannot contain spaces"},schema:{default_value:""}},{field:"host_url",name:"Host URL",type:"string",meta:{width:"full",interface:"input",group:"streaming_config",options:{placeholder:"undefined"!=typeof window?window.location.origin:""},note:`Host domain (e.g., https://example.com). Default: ${"undefined"!=typeof window?window.location.origin:""}. Leave empty when working with fully qualified URLs in collection field.`}},{field:"streaming_config",name:"Streaming Configuration",type:"alias",schema:null,meta:{field:"streaming_config",width:"full",interface:"group-detail",special:["alias","no-data","group"],options:{start:"collapsed"},conditions:[{name:"Hide when stream_link_field_name is empty",rule:{_or:[{stream_link_field_name:{_eq:null}},{stream_link_field_name:{_eq:""}}]},hidden:!0}]}},{field:"stream_secret",name:"Stream Secret",type:"string",meta:{width:"full",interface:"input",group:"streaming_config",options:{placeholder:"Enter stream secret for HLS token generation",secret:!0},note:"Secret key used for generating secure HLS stream tokens (MD5 hash)"}},{field:"url_schema",name:"URL Schema",type:"string",meta:{width:"full",interface:"input",group:"streaming_config",options:{placeholder:"{{host_url}}{{item_field}}"},note:"Optional: URL template with mustache syntax placeholders: {{host_url}}, {{token}}, {{expires}}, {{item_field}}. Example: {{host_url}}/stream/{{token}}/{{expires}}{{item_field}}",conditions:[{name:"Hide when stream_secret is empty",rule:{_or:[{stream_secret:{_eq:null}},{stream_secret:{_eq:""}}]},hidden:!0}]}},{field:"expires_in_minutes",name:"Token Expiration (minutes)",type:"integer",meta:{width:"full",interface:"input",group:"streaming_config",options:{placeholder:"60",min:1},note:"Token expiration time in minutes (default: 60)",conditions:[{name:"Hide when stream_secret is empty",rule:{_or:[{stream_secret:{_eq:null}},{stream_secret:{_eq:""}}]},hidden:!0}]},schema:{default_value:60}},{field:"include_ip",name:"Include IP",type:"boolean",meta:{width:"full",interface:"boolean",group:"streaming_config",readonly:!0,options:{label:"Include client IP"},note:"Include client IP address into secure token generation for client unique stream link protection",conditions:[{name:"Hide when stream_secret is empty",rule:{_or:[{stream_secret:{_eq:null}},{stream_secret:{_eq:""}}]},hidden:!0}]},schema:{default_value:!1}},{field:"field_options",name:"Field Options",type:"alias",schema:null,meta:{field:"field_options",width:"full",interface:"group-detail",group:null,special:["alias","no-data","group"],options:{start:"collapsed"}}},{field:"folder",name:"$t:interfaces.system-folder.folder",type:"uuid",meta:{width:"full",interface:"system-folder",group:"field_options",note:"$t:interfaces.system-folder.field_hint"}},{field:"filter",name:"$t:filter",type:"json",meta:{interface:"system-filter",group:"field_options",options:{collectionName:r}}},{field:"enableCreate",name:"$t:creating_items",schema:{default_value:!0},meta:{interface:"boolean",group:"field_options",options:{label:"$t:enable_create_button"},width:"half"}},{field:"enableSelect",name:"$t:selecting_items",schema:{default_value:!0},meta:{interface:"boolean",group:"field_options",options:{label:"$t:enable_select_button"},width:"half"}}]}});export{wd as default};
